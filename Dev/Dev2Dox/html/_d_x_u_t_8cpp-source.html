<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>GameCode: d:/Projects/GameCodev2.2/Source/DX9Common/DXUT.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.3 -->
<div class="qindex"><a class="qindex" href="main.html">Main&nbsp;Page</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="dirs.html">Directories</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a></div>
<div class="nav">
<a class="el" href="dir_000000.html">d:</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_000001.html">Projects</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_000002.html">GameCodev2.2</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_000003.html">Source</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_000007.html">DX9Common</a></div>
<h1>DXUT.cpp</h1><a href="_d_x_u_t_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l00002"></a>00002 <span class="comment">// File: DXUT.cpp</span>
<a name="l00003"></a>00003 <span class="comment">//</span>
<a name="l00004"></a>00004 <span class="comment">// Copyright (c) Microsoft Corporation. All rights reserved.</span>
<a name="l00005"></a>00005 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l00006"></a>00006 <span class="preprocessor">#include "<a class="code" href="dxstdafx_8h.html">dxstdafx.h</a>"</span>
<a name="l00007"></a><a class="code" href="_d_x_u_t_8cpp.html#a0">00007</a> <span class="preprocessor">#define DXUT_MIN_WINDOW_SIZE_X 200</span>
<a name="l00008"></a><a class="code" href="_d_x_u_t_8cpp.html#a1">00008</a> <span class="preprocessor"></span><span class="preprocessor">#define DXUT_MIN_WINDOW_SIZE_Y 200</span>
<a name="l00009"></a>00009 <span class="preprocessor"></span><span class="preprocessor">#undef min // use __min instead inside this source file</span>
<a name="l00010"></a>00010 <span class="preprocessor"></span><span class="preprocessor">#undef max // use __max instead inside this source file</span>
<a name="l00011"></a>00011 <span class="preprocessor"></span>
<a name="l00012"></a>00012 
<a name="l00013"></a>00013 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l00014"></a>00014 <span class="comment">// Thread safety </span>
<a name="l00015"></a>00015 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l00016"></a><a class="code" href="_d_x_u_t_8cpp.html#a15">00016</a> CRITICAL_SECTION <a class="code" href="_d_x_u_t_8cpp.html#a15">g_cs</a>;  
<a name="l00017"></a><a class="code" href="_d_x_u_t_8cpp.html#a16">00017</a> <span class="keywordtype">bool</span> <a class="code" href="_d_x_u_t_8cpp.html#a16">g_bThreadSafe</a> = <span class="keyword">true</span>;
<a name="l00018"></a>00018 
<a name="l00019"></a>00019 
<a name="l00020"></a>00020 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l00021"></a>00021 <span class="comment">// Automatically enters &amp; leaves the CS upon object creation/deletion</span>
<a name="l00022"></a>00022 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l00023"></a><a class="code" href="class_d_x_u_t_lock.html">00023</a> <span class="keyword">class </span><a class="code" href="class_d_x_u_t_lock.html">DXUTLock</a>
<a name="l00024"></a>00024 {
<a name="l00025"></a>00025 <span class="keyword">public</span>:
<a name="l00026"></a><a class="code" href="class_d_x_u_t_lock.html#a0">00026</a>     <span class="keyword">inline</span> <a class="code" href="class_d_x_u_t_lock.html#a0">DXUTLock</a>()  { <span class="keywordflow">if</span>( <a class="code" href="_d_x_u_t_8cpp.html#a16">g_bThreadSafe</a> ) EnterCriticalSection( &amp;<a class="code" href="_d_x_u_t_8cpp.html#a15">g_cs</a> ); }
<a name="l00027"></a><a class="code" href="class_d_x_u_t_lock.html#a1">00027</a>     <span class="keyword">inline</span> <a class="code" href="class_d_x_u_t_lock.html#a1">~DXUTLock</a>() { <span class="keywordflow">if</span>( <a class="code" href="_d_x_u_t_8cpp.html#a16">g_bThreadSafe</a> ) LeaveCriticalSection( &amp;<a class="code" href="_d_x_u_t_8cpp.html#a15">g_cs</a> ); }
<a name="l00028"></a>00028 };
<a name="l00029"></a>00029 
<a name="l00030"></a>00030 
<a name="l00031"></a>00031 
<a name="l00032"></a>00032 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l00033"></a>00033 <span class="comment">// Helper macros to build member functions that access member variables with thread safety</span>
<a name="l00034"></a>00034 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l00035"></a><a class="code" href="_d_x_u_t_8cpp.html#a2">00035</a> <span class="preprocessor">#define SET_ACCESSOR( x, y )       inline void Set##y( x t )  { DXUTLock l; m_state.m_##y = t; };</span>
<a name="l00036"></a><a class="code" href="_d_x_u_t_8cpp.html#a3">00036</a> <span class="preprocessor"></span><span class="preprocessor">#define GET_ACCESSOR( x, y )       inline x Get##y() { DXUTLock l; return m_state.m_##y; };</span>
<a name="l00037"></a><a class="code" href="_d_x_u_t_8cpp.html#a4">00037</a> <span class="preprocessor"></span><span class="preprocessor">#define GET_SET_ACCESSOR( x, y )   SET_ACCESSOR( x, y ) GET_ACCESSOR( x, y )</span>
<a name="l00038"></a>00038 <span class="preprocessor"></span>
<a name="l00039"></a><a class="code" href="_d_x_u_t_8cpp.html#a5">00039</a> <span class="preprocessor">#define SETP_ACCESSOR( x, y )      inline void Set##y( x* t )  { DXUTLock l; m_state.m_##y = *t; };</span>
<a name="l00040"></a><a class="code" href="_d_x_u_t_8cpp.html#a6">00040</a> <span class="preprocessor"></span><span class="preprocessor">#define GETP_ACCESSOR( x, y )      inline x* Get##y() { DXUTLock l; return &amp;m_state.m_##y; };</span>
<a name="l00041"></a><a class="code" href="_d_x_u_t_8cpp.html#a7">00041</a> <span class="preprocessor"></span><span class="preprocessor">#define GETP_SETP_ACCESSOR( x, y ) SETP_ACCESSOR( x, y ) GETP_ACCESSOR( x, y )</span>
<a name="l00042"></a>00042 <span class="preprocessor"></span>
<a name="l00043"></a>00043 
<a name="l00044"></a>00044 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l00045"></a>00045 <span class="comment">// Stores timer callback info</span>
<a name="l00046"></a>00046 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l00047"></a><a class="code" href="struct_d_x_u_t___t_i_m_e_r.html">00047</a> <span class="keyword">struct </span><a class="code" href="struct_d_x_u_t___t_i_m_e_r.html">DXUT_TIMER</a>
<a name="l00048"></a>00048 {
<a name="l00049"></a><a class="code" href="struct_d_x_u_t___t_i_m_e_r.html#o0">00049</a>     <a class="code" href="_d_x_u_t_8h.html#a20">LPDXUTCALLBACKTIMER</a> <a class="code" href="struct_d_x_u_t___t_i_m_e_r.html#o0">pCallbackTimer</a>;
<a name="l00050"></a><a class="code" href="struct_d_x_u_t___t_i_m_e_r.html#o1">00050</a>     <span class="keywordtype">void</span>* <a class="code" href="struct_d_x_u_t___t_i_m_e_r.html#o1">pCallbackUserContext</a>;
<a name="l00051"></a><a class="code" href="struct_d_x_u_t___t_i_m_e_r.html#o2">00051</a>     <span class="keywordtype">float</span> <a class="code" href="struct_d_x_u_t___t_i_m_e_r.html#o2">fTimeoutInSecs</a>;
<a name="l00052"></a><a class="code" href="struct_d_x_u_t___t_i_m_e_r.html#o3">00052</a>     <span class="keywordtype">float</span> <a class="code" href="struct_d_x_u_t___t_i_m_e_r.html#o3">fCountdown</a>;
<a name="l00053"></a><a class="code" href="struct_d_x_u_t___t_i_m_e_r.html#o4">00053</a>     <span class="keywordtype">bool</span>  <a class="code" href="struct_d_x_u_t___t_i_m_e_r.html#o4">bEnabled</a>;
<a name="l00054"></a>00054 };
<a name="l00055"></a>00055 
<a name="l00056"></a>00056 
<a name="l00057"></a>00057 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l00058"></a>00058 <span class="comment">// Multimon handling to support OSes with or without multimon API support.  </span>
<a name="l00059"></a>00059 <span class="comment">// Purposely avoiding the use of multimon.h so DXUT.lib doesn't require </span>
<a name="l00060"></a>00060 <span class="comment">// COMPILE_MULTIMON_STUBS and cause complication with MFC or other users of multimon.h</span>
<a name="l00061"></a>00061 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l00062"></a>00062 <span class="preprocessor">#ifndef MONITOR_DEFAULTTOPRIMARY</span>
<a name="l00063"></a><a class="code" href="_d_x_u_t_8cpp.html#a8">00063</a> <span class="preprocessor"></span><span class="preprocessor">#define MONITORINFOF_PRIMARY        0x00000001</span>
<a name="l00064"></a><a class="code" href="_d_x_u_t_8cpp.html#a9">00064</a> <span class="preprocessor"></span><span class="preprocessor">#define MONITOR_DEFAULTTOPRIMARY    0x00000001</span>
<a name="l00065"></a><a class="code" href="_d_x_u_t_8cpp.html#a10">00065</a> <span class="preprocessor"></span><span class="preprocessor">#define MONITOR_DEFAULTTONEAREST    0x00000002</span>
<a name="l00066"></a><a class="code" href="structtag_m_o_n_i_t_o_r_i_n_f_o.html">00066</a> <span class="preprocessor"></span><span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structtag_m_o_n_i_t_o_r_i_n_f_o.html">tagMONITORINFO</a>
<a name="l00067"></a>00067 {
<a name="l00068"></a><a class="code" href="structtag_m_o_n_i_t_o_r_i_n_f_o.html#o0">00068</a>     <a class="code" href="_d_x_u_tgui_8cpp.html#a38">DWORD</a>   <a class="code" href="structtag_m_o_n_i_t_o_r_i_n_f_o.html#o0">cbSize</a>;
<a name="l00069"></a><a class="code" href="structtag_m_o_n_i_t_o_r_i_n_f_o.html#o1">00069</a>     RECT    <a class="code" href="structtag_m_o_n_i_t_o_r_i_n_f_o.html#o1">rcMonitor</a>;
<a name="l00070"></a><a class="code" href="structtag_m_o_n_i_t_o_r_i_n_f_o.html#o2">00070</a>     RECT    <a class="code" href="structtag_m_o_n_i_t_o_r_i_n_f_o.html#o2">rcWork</a>;
<a name="l00071"></a><a class="code" href="structtag_m_o_n_i_t_o_r_i_n_f_o.html#o3">00071</a>     <a class="code" href="_d_x_u_tgui_8cpp.html#a38">DWORD</a>   <a class="code" href="structtag_m_o_n_i_t_o_r_i_n_f_o.html#o3">dwFlags</a>;
<a name="l00072"></a>00072 } <a class="code" href="structtag_m_o_n_i_t_o_r_i_n_f_o.html">MONITORINFO</a>, *<a class="code" href="structtag_m_o_n_i_t_o_r_i_n_f_o.html">LPMONITORINFO</a>;
<a name="l00073"></a><a class="code" href="structtag_m_o_n_i_t_o_r_i_n_f_o_e_x_w.html">00073</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structtag_m_o_n_i_t_o_r_i_n_f_o_e_x_w.html">tagMONITORINFOEXW</a> : <span class="keyword">public</span> <a class="code" href="structtag_m_o_n_i_t_o_r_i_n_f_o.html">tagMONITORINFO</a>
<a name="l00074"></a>00074 {
<a name="l00075"></a><a class="code" href="structtag_m_o_n_i_t_o_r_i_n_f_o_e_x_w.html#o0">00075</a>     WCHAR       <a class="code" href="structtag_m_o_n_i_t_o_r_i_n_f_o_e_x_w.html#o0">szDevice</a>[CCHDEVICENAME];
<a name="l00076"></a>00076 } <a class="code" href="structtag_m_o_n_i_t_o_r_i_n_f_o_e_x_w.html">MONITORINFOEXW</a>, *<a class="code" href="structtag_m_o_n_i_t_o_r_i_n_f_o_e_x_w.html">LPMONITORINFOEXW</a>;
<a name="l00077"></a><a class="code" href="_d_x_u_t_8cpp.html#a21">00077</a> <span class="keyword">typedef</span> <a class="code" href="structtag_m_o_n_i_t_o_r_i_n_f_o_e_x_w.html">MONITORINFOEXW</a> <a class="code" href="structtag_m_o_n_i_t_o_r_i_n_f_o_e_x_w.html">MONITORINFOEX</a>;
<a name="l00078"></a><a class="code" href="_d_x_u_t_8cpp.html#a22">00078</a> <span class="keyword">typedef</span> LPMONITORINFOEXW <a class="code" href="structtag_m_o_n_i_t_o_r_i_n_f_o_e_x_w.html">LPMONITORINFOEX</a>;
<a name="l00079"></a>00079 <span class="preprocessor">#endif</span>
<a name="l00080"></a>00080 <span class="preprocessor"></span>HMONITOR WINAPI <a class="code" href="_d_x_u_t_8cpp.html#a28">DXUT_MonitorFromWindow</a>(<a class="code" href="_d_x_u_tgui_8cpp.html#a53">HWND</a> hWnd, <a class="code" href="_d_x_u_tgui_8cpp.html#a38">DWORD</a> dwFlags);
<a name="l00081"></a>00081 <span class="keywordtype">int</span> WINAPI <a class="code" href="_d_x_u_t_8cpp.html#a29">DXUT_GetSystemMetrics</a>(<span class="keywordtype">int</span> nIndex);
<a name="l00082"></a>00082 <a class="code" href="_d_x_u_tgui_8cpp.html#a39">BOOL</a> WINAPI <a class="code" href="_d_x_u_t_8cpp.html#a30">DXUT_GetMonitorInfo</a>(HMONITOR hMonitor, LPMONITORINFO lpMonitorInfo);
<a name="l00083"></a><a class="code" href="_d_x_u_t_8cpp.html#a11">00083</a> <span class="preprocessor">#define DXUT_PRIMARY_MONITOR ((HMONITOR)0x12340042)</span>
<a name="l00084"></a><a class="code" href="_d_x_u_t_8cpp.html#a23">00084</a> <span class="preprocessor"></span><span class="keyword">typedef</span> <a class="code" href="_d_x_u_tgui_8cpp.html#a37">int</a>      (WINAPI* <a class="code" href="_d_x_u_t_8cpp.html#a23">LPGETSYSTEMMETRICS</a>)(<a class="code" href="_d_x_u_tgui_8cpp.html#a37">int</a>);
<a name="l00085"></a><a class="code" href="_d_x_u_t_8cpp.html#a24">00085</a> <span class="keyword">typedef</span> HMONITOR (WINAPI* <a class="code" href="_d_x_u_t_8cpp.html#a24">LPMONITORFROMWINDOW</a>)(<a class="code" href="_d_x_u_tgui_8cpp.html#a53">HWND</a>, <a class="code" href="_d_x_u_tgui_8cpp.html#a38">DWORD</a>);
<a name="l00086"></a><a class="code" href="_d_x_u_t_8cpp.html#a25">00086</a> <span class="keyword">typedef</span> <a class="code" href="_d_x_u_tgui_8cpp.html#a39">BOOL</a>     (WINAPI* <a class="code" href="_d_x_u_t_8cpp.html#a25">LPGETMONITORINFO</a>)(HMONITOR, LPMONITORINFO);
<a name="l00087"></a>00087 
<a name="l00088"></a>00088 
<a name="l00089"></a>00089 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l00090"></a>00090 <span class="comment">// Stores DXUT state and data access is done with thread safety (if g_bThreadSafe==true)</span>
<a name="l00091"></a>00091 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l00092"></a><a class="code" href="class_d_x_u_t_state.html">00092</a> <span class="keyword">class </span><a class="code" href="class_d_x_u_t_state.html">DXUTState</a>
<a name="l00093"></a>00093 {
<a name="l00094"></a>00094 <span class="keyword">protected</span>:
<a name="l00095"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html">00095</a>     <span class="keyword">struct </span><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html">STATE</a>
<a name="l00096"></a>00096     {
<a name="l00097"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o0">00097</a>         IDirect3D9*          <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o0">m_D3D</a>;                     <span class="comment">// the main D3D object</span>
<a name="l00098"></a>00098 
<a name="l00099"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o1">00099</a>         IDirect3DDevice9*    <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o1">m_D3DDevice</a>;               <span class="comment">// the D3D rendering device</span>
<a name="l00100"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o2">00100</a>         <a class="code" href="class_c_d3_d_enumeration.html">CD3DEnumeration</a>*     <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o2">m_D3DEnumeration</a>;          <span class="comment">// CD3DEnumeration object</span>
<a name="l00101"></a>00101 
<a name="l00102"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o3">00102</a>         <a class="code" href="struct_d_x_u_t_device_settings.html">DXUTDeviceSettings</a>*  <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o3">m_CurrentDeviceSettings</a>;   <span class="comment">// current device settings</span>
<a name="l00103"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o4">00103</a>         D3DSURFACE_DESC      <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o4">m_BackBufferSurfaceDesc</a>;   <span class="comment">// back buffer surface description</span>
<a name="l00104"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o5">00104</a>         D3DCAPS9             <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o5">m_Caps</a>;                    <span class="comment">// D3D caps for current device</span>
<a name="l00105"></a>00105 
<a name="l00106"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o6">00106</a>         <a class="code" href="_d_x_u_tgui_8cpp.html#a53">HWND</a>  <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o6">m_HWNDFocus</a>;                  <span class="comment">// the main app focus window</span>
<a name="l00107"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o7">00107</a>         <a class="code" href="_d_x_u_tgui_8cpp.html#a53">HWND</a>  <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o7">m_HWNDDeviceFullScreen</a>;       <span class="comment">// the main app device window in fullscreen mode</span>
<a name="l00108"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o8">00108</a>         <a class="code" href="_d_x_u_tgui_8cpp.html#a53">HWND</a>  <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o8">m_HWNDDeviceWindowed</a>;         <span class="comment">// the main app device window in windowed mode</span>
<a name="l00109"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o9">00109</a>         HMONITOR <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o9">m_AdapterMonitor</a>;          <span class="comment">// the monitor of the adapter </span>
<a name="l00110"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o10">00110</a>         HMENU <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o10">m_Menu</a>;                       <span class="comment">// handle to menu</span>
<a name="l00111"></a>00111 
<a name="l00112"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o11">00112</a>         <a class="code" href="_d_x_u_tgui_8cpp.html#a45">UINT</a> <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o11">m_FullScreenBackBufferWidthAtModeChange</a>;  <span class="comment">// back buffer size of fullscreen mode right before switching to windowed mode.  Used to restore to same resolution when toggling back to fullscreen</span>
<a name="l00113"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o12">00113</a>         <a class="code" href="_d_x_u_tgui_8cpp.html#a45">UINT</a> <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o12">m_FullScreenBackBufferHeightAtModeChange</a>; <span class="comment">// back buffer size of fullscreen mode right before switching to windowed mode.  Used to restore to same resolution when toggling back to fullscreen</span>
<a name="l00114"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o13">00114</a>         <a class="code" href="_d_x_u_tgui_8cpp.html#a45">UINT</a> <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o13">m_WindowBackBufferWidthAtModeChange</a>;  <span class="comment">// back buffer size of windowed mode right before switching to fullscreen mode.  Used to restore to same resolution when toggling back to windowed mode</span>
<a name="l00115"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o14">00115</a>         <a class="code" href="_d_x_u_tgui_8cpp.html#a45">UINT</a> <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o14">m_WindowBackBufferHeightAtModeChange</a>; <span class="comment">// back buffer size of windowed mode right before switching to fullscreen mode.  Used to restore to same resolution when toggling back to windowed mode</span>
<a name="l00116"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o15">00116</a>         <a class="code" href="_d_x_u_tgui_8cpp.html#a38">DWORD</a> <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o15">m_WindowedStyleAtModeChange</a>;  <span class="comment">// window style</span>
<a name="l00117"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o16">00117</a>         WINDOWPLACEMENT <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o16">m_WindowedPlacement</a>; <span class="comment">// record of windowed HWND position/show state/etc</span>
<a name="l00118"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o17">00118</a>         <span class="keywordtype">bool</span>  <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o17">m_TopmostWhileWindowed</a>;       <span class="comment">// if true, the windowed HWND is topmost </span>
<a name="l00119"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o18">00119</a>         <span class="keywordtype">bool</span>  <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o18">m_Minimized</a>;                  <span class="comment">// if true, the HWND is minimized</span>
<a name="l00120"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o19">00120</a>         <span class="keywordtype">bool</span>  <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o19">m_Maximized</a>;                  <span class="comment">// if true, the HWND is maximized</span>
<a name="l00121"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o20">00121</a>         <span class="keywordtype">bool</span>  <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o20">m_MinimizedWhileFullscreen</a>;   <span class="comment">// if true, the HWND is minimized due to a focus switch away when fullscreen mode</span>
<a name="l00122"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o21">00122</a>         <span class="keywordtype">bool</span>  <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o21">m_IgnoreSizeChange</a>;           <span class="comment">// if true, DXUT won't reset the device upon HWND size change</span>
<a name="l00123"></a>00123 
<a name="l00124"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o22">00124</a>         <span class="keywordtype">double</span> <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o22">m_Time</a>;                      <span class="comment">// current time in seconds</span>
<a name="l00125"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o23">00125</a>         <span class="keywordtype">float</span> <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o23">m_ElapsedTime</a>;                <span class="comment">// time elapsed since last frame</span>
<a name="l00126"></a>00126 
<a name="l00127"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o24">00127</a>         HINSTANCE <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o24">m_HInstance</a>;              <span class="comment">// handle to the app instance</span>
<a name="l00128"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o25">00128</a>         <span class="keywordtype">double</span> <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o25">m_LastStatsUpdateTime</a>;       <span class="comment">// last time the stats were updated</span>
<a name="l00129"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o26">00129</a>         <a class="code" href="_d_x_u_tgui_8cpp.html#a38">DWORD</a> <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o26">m_LastStatsUpdateFrames</a>;      <span class="comment">// frames count since last time the stats were updated</span>
<a name="l00130"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o27">00130</a>         <span class="keywordtype">float</span> <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o27">m_FPS</a>;                        <span class="comment">// frames per second</span>
<a name="l00131"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o28">00131</a>         <span class="keywordtype">int</span>   <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o28">m_CurrentFrameNumber</a>;         <span class="comment">// the current frame number</span>
<a name="l00132"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o29">00132</a>         HHOOK <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o29">m_KeyboardHook</a>;               <span class="comment">// handle to keyboard hook</span>
<a name="l00133"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o30">00133</a>         <span class="keywordtype">bool</span>  <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o30">m_AllowShortcutKeysWhenFullscreen</a>; <span class="comment">// if true, when fullscreen enable shortcut keys (Windows keys, StickyKeys shortcut, ToggleKeys shortcut, FilterKeys shortcut) </span>
<a name="l00134"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o31">00134</a>         <span class="keywordtype">bool</span>  <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o31">m_AllowShortcutKeysWhenWindowed</a>;   <span class="comment">// if true, when windowed enable shortcut keys (Windows keys, StickyKeys shortcut, ToggleKeys shortcut, FilterKeys shortcut) </span>
<a name="l00135"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o32">00135</a>         <span class="keywordtype">bool</span>  <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o32">m_AllowShortcutKeys</a>;          <span class="comment">// if true, then shortcut keys are currently disabled (Windows key, etc)</span>
<a name="l00136"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o33">00136</a>         <span class="keywordtype">bool</span>  <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o33">m_CallDefWindowProc</a>;          <span class="comment">// if true, DXUTStaticWndProc will call DefWindowProc for unhandled messages. Applications rendering to a dialog may need to set this to false.</span>
<a name="l00137"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o34">00137</a>         STICKYKEYS <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o34">m_StartupStickyKeys</a>;     <span class="comment">// StickyKey settings upon startup so they can be restored later</span>
<a name="l00138"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o35">00138</a>         TOGGLEKEYS <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o35">m_StartupToggleKeys</a>;     <span class="comment">// ToggleKey settings upon startup so they can be restored later</span>
<a name="l00139"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o36">00139</a>         FILTERKEYS <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o36">m_StartupFilterKeys</a>;     <span class="comment">// FilterKey settings upon startup so they can be restored later</span>
<a name="l00140"></a>00140 
<a name="l00141"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o37">00141</a>         <span class="keywordtype">bool</span>  <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o37">m_HandleDefaultHotkeys</a>;       <span class="comment">// if true, then DXUT will handle some default hotkeys</span>
<a name="l00142"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o38">00142</a>         <span class="keywordtype">bool</span>  <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o38">m_HandleAltEnter</a>;             <span class="comment">// if true, then DXUT will handle Alt-Enter</span>
<a name="l00143"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o39">00143</a>         <span class="keywordtype">bool</span>  <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o39">m_ShowMsgBoxOnError</a>;          <span class="comment">// if true, then msgboxes are displayed upon errors</span>
<a name="l00144"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o40">00144</a>         <span class="keywordtype">bool</span>  <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o40">m_ClipCursorWhenFullScreen</a>;   <span class="comment">// if true, then DXUT will keep the cursor from going outside the window when full screen</span>
<a name="l00145"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o41">00145</a>         <span class="keywordtype">bool</span>  <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o41">m_ShowCursorWhenFullScreen</a>;   <span class="comment">// if true, then DXUT will show a cursor when full screen</span>
<a name="l00146"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o42">00146</a>         <span class="keywordtype">bool</span>  <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o42">m_ConstantFrameTime</a>;          <span class="comment">// if true, then elapsed frame time will always be 0.05f seconds which is good for debugging or automated capture</span>
<a name="l00147"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o43">00147</a>         <span class="keywordtype">float</span> <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o43">m_TimePerFrame</a>;               <span class="comment">// the constant time per frame in seconds, only valid if m_ConstantFrameTime==true</span>
<a name="l00148"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o44">00148</a>         <span class="keywordtype">bool</span>  <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o44">m_WireframeMode</a>;              <span class="comment">// if true, then D3DRS_FILLMODE==D3DFILL_WIREFRAME else D3DRS_FILLMODE==D3DFILL_SOLID </span>
<a name="l00149"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o45">00149</a>         <span class="keywordtype">bool</span>  <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o45">m_AutoChangeAdapter</a>;          <span class="comment">// if true, then the adapter will automatically change if the window is different monitor</span>
<a name="l00150"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o46">00150</a>         <span class="keywordtype">bool</span>  <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o46">m_WindowCreatedWithDefaultPositions</a>; <span class="comment">// if true, then CW_USEDEFAULT was used and the window should be moved to the right adapter</span>
<a name="l00151"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o47">00151</a>         <span class="keywordtype">int</span>   <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o47">m_ExitCode</a>;                   <span class="comment">// the exit code to be returned to the command line</span>
<a name="l00152"></a>00152 
<a name="l00153"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o48">00153</a>         <span class="keywordtype">bool</span>  <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o48">m_DXUTInited</a>;                 <span class="comment">// if true, then DXUTInit() has succeeded</span>
<a name="l00154"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o49">00154</a>         <span class="keywordtype">bool</span>  <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o49">m_WindowCreated</a>;              <span class="comment">// if true, then DXUTCreateWindow() or DXUTSetWindow() has succeeded</span>
<a name="l00155"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o50">00155</a>         <span class="keywordtype">bool</span>  <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o50">m_DeviceCreated</a>;              <span class="comment">// if true, then DXUTCreateDevice*() or DXUTSetDevice() has succeeded</span>
<a name="l00156"></a>00156 
<a name="l00157"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o51">00157</a>         <span class="keywordtype">bool</span>  <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o51">m_DXUTInitCalled</a>;             <span class="comment">// if true, then DXUTInit() was called</span>
<a name="l00158"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o52">00158</a>         <span class="keywordtype">bool</span>  <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o52">m_WindowCreateCalled</a>;         <span class="comment">// if true, then DXUTCreateWindow() or DXUTSetWindow() was called</span>
<a name="l00159"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o53">00159</a>         <span class="keywordtype">bool</span>  <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o53">m_DeviceCreateCalled</a>;         <span class="comment">// if true, then DXUTCreateDevice*() or DXUTSetDevice() was called</span>
<a name="l00160"></a>00160 
<a name="l00161"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o54">00161</a>         <span class="keywordtype">bool</span>  <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o54">m_DeviceObjectsCreated</a>;       <span class="comment">// if true, then DeviceCreated callback has been called (if non-NULL)</span>
<a name="l00162"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o55">00162</a>         <span class="keywordtype">bool</span>  <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o55">m_DeviceObjectsReset</a>;         <span class="comment">// if true, then DeviceReset callback has been called (if non-NULL)</span>
<a name="l00163"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o56">00163</a>         <span class="keywordtype">bool</span>  <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o56">m_InsideDeviceCallback</a>;       <span class="comment">// if true, then the framework is inside an app device callback</span>
<a name="l00164"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o57">00164</a>         <span class="keywordtype">bool</span>  <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o57">m_InsideMainloop</a>;             <span class="comment">// if true, then the framework is inside the main loop</span>
<a name="l00165"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o58">00165</a>         <span class="keywordtype">bool</span>  <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o58">m_Active</a>;                     <span class="comment">// if true, then the app is the active top level window</span>
<a name="l00166"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o59">00166</a>         <span class="keywordtype">bool</span>  <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o59">m_TimePaused</a>;                 <span class="comment">// if true, then time is paused</span>
<a name="l00167"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o60">00167</a>         <span class="keywordtype">bool</span>  <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o60">m_RenderingPaused</a>;            <span class="comment">// if true, then rendering is paused</span>
<a name="l00168"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o61">00168</a>         <span class="keywordtype">int</span>   <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o61">m_PauseRenderingCount</a>;        <span class="comment">// pause rendering ref count</span>
<a name="l00169"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o62">00169</a>         <span class="keywordtype">int</span>   <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o62">m_PauseTimeCount</a>;             <span class="comment">// pause time ref count</span>
<a name="l00170"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o63">00170</a>         <span class="keywordtype">bool</span>  <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o63">m_DeviceLost</a>;                 <span class="comment">// if true, then the device is lost and needs to be reset</span>
<a name="l00171"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o64">00171</a>         <span class="keywordtype">bool</span>  <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o64">m_NotifyOnMouseMove</a>;          <span class="comment">// if true, include WM_MOUSEMOVE in mousecallback</span>
<a name="l00172"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o65">00172</a>         <span class="keywordtype">bool</span>  <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o65">m_Automation</a>;                 <span class="comment">// if true, automation is enabled</span>
<a name="l00173"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o66">00173</a>         <span class="keywordtype">bool</span>  <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o66">m_InSizeMove</a>;                 <span class="comment">// if true, app is inside a WM_ENTERSIZEMOVE</span>
<a name="l00174"></a>00174 
<a name="l00175"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o67">00175</a>         <span class="keywordtype">int</span>   <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o67">m_OverrideAdapterOrdinal</a>;     <span class="comment">// if != -1, then override to use this adapter ordinal</span>
<a name="l00176"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o68">00176</a>         <span class="keywordtype">bool</span>  <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o68">m_OverrideWindowed</a>;           <span class="comment">// if true, then force to start windowed</span>
<a name="l00177"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o69">00177</a>         <span class="keywordtype">bool</span>  <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o69">m_OverrideFullScreen</a>;         <span class="comment">// if true, then force to start full screen</span>
<a name="l00178"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o70">00178</a>         <span class="keywordtype">int</span>   <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o70">m_OverrideStartX</a>;             <span class="comment">// if != -1, then override to this X position of the window</span>
<a name="l00179"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o71">00179</a>         <span class="keywordtype">int</span>   <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o71">m_OverrideStartY</a>;             <span class="comment">// if != -1, then override to this Y position of the window</span>
<a name="l00180"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o72">00180</a>         <span class="keywordtype">int</span>   <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o72">m_OverrideWidth</a>;              <span class="comment">// if != 0, then override to this width</span>
<a name="l00181"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o73">00181</a>         <span class="keywordtype">int</span>   <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o73">m_OverrideHeight</a>;             <span class="comment">// if != 0, then override to this height</span>
<a name="l00182"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o74">00182</a>         <span class="keywordtype">bool</span>  <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o74">m_OverrideForceHAL</a>;           <span class="comment">// if true, then force to HAL device (failing if one doesn't exist)</span>
<a name="l00183"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o75">00183</a>         <span class="keywordtype">bool</span>  <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o75">m_OverrideForceREF</a>;           <span class="comment">// if true, then force to REF device (failing if one doesn't exist)</span>
<a name="l00184"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o76">00184</a>         <span class="keywordtype">bool</span>  <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o76">m_OverrideForcePureHWVP</a>;      <span class="comment">// if true, then force to use pure HWVP (failing if device doesn't support it)</span>
<a name="l00185"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o77">00185</a>         <span class="keywordtype">bool</span>  <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o77">m_OverrideForceHWVP</a>;          <span class="comment">// if true, then force to use HWVP (failing if device doesn't support it)</span>
<a name="l00186"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o78">00186</a>         <span class="keywordtype">bool</span>  <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o78">m_OverrideForceSWVP</a>;          <span class="comment">// if true, then force to use SWVP </span>
<a name="l00187"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o79">00187</a>         <span class="keywordtype">bool</span>  <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o79">m_OverrideConstantFrameTime</a>;  <span class="comment">// if true, then force to constant frame time</span>
<a name="l00188"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o80">00188</a>         <span class="keywordtype">float</span> <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o80">m_OverrideConstantTimePerFrame</a>; <span class="comment">// the constant time per frame in seconds if m_OverrideConstantFrameTime==true</span>
<a name="l00189"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o81">00189</a>         <span class="keywordtype">int</span>   <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o81">m_OverrideQuitAfterFrame</a>;     <span class="comment">// if != 0, then it will force the app to quit after that frame</span>
<a name="l00190"></a>00190 
<a name="l00191"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o82">00191</a>         <a class="code" href="_d_x_u_t_8h.html#a9">LPDXUTCALLBACKISDEVICEACCEPTABLE</a>    <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o82">m_IsDeviceAcceptableFunc</a>;   <span class="comment">// is device acceptable callback</span>
<a name="l00192"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o83">00192</a>         <a class="code" href="_d_x_u_t_8h.html#a10">LPDXUTCALLBACKMODIFYDEVICESETTINGS</a>  <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o83">m_ModifyDeviceSettingsFunc</a>; <span class="comment">// modify device settings callback</span>
<a name="l00193"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o84">00193</a>         <a class="code" href="_d_x_u_t_8h.html#a11">LPDXUTCALLBACKDEVICECREATED</a>         <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o84">m_DeviceCreatedFunc</a>;        <span class="comment">// device created callback</span>
<a name="l00194"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o85">00194</a>         <a class="code" href="_d_x_u_t_8h.html#a12">LPDXUTCALLBACKDEVICERESET</a>           <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o85">m_DeviceResetFunc</a>;          <span class="comment">// device reset callback</span>
<a name="l00195"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o86">00195</a>         <a class="code" href="_d_x_u_t_8h.html#a14">LPDXUTCALLBACKDEVICELOST</a>            <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o86">m_DeviceLostFunc</a>;           <span class="comment">// device lost callback</span>
<a name="l00196"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o87">00196</a>         <a class="code" href="_d_x_u_t_8h.html#a13">LPDXUTCALLBACKDEVICEDESTROYED</a>       <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o87">m_DeviceDestroyedFunc</a>;      <span class="comment">// device destroyed callback</span>
<a name="l00197"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o88">00197</a>         <a class="code" href="_d_x_u_t_8h.html#a15">LPDXUTCALLBACKFRAMEMOVE</a>             <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o88">m_FrameMoveFunc</a>;            <span class="comment">// frame move callback</span>
<a name="l00198"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o89">00198</a>         <a class="code" href="_d_x_u_t_8h.html#a16">LPDXUTCALLBACKFRAMERENDER</a>           <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o89">m_FrameRenderFunc</a>;          <span class="comment">// frame render callback</span>
<a name="l00199"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o90">00199</a>         <a class="code" href="_d_x_u_t_8h.html#a17">LPDXUTCALLBACKKEYBOARD</a>              <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o90">m_KeyboardFunc</a>;             <span class="comment">// keyboard callback</span>
<a name="l00200"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o91">00200</a>         <a class="code" href="_d_x_u_t_8h.html#a18">LPDXUTCALLBACKMOUSE</a>                 <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o91">m_MouseFunc</a>;                <span class="comment">// mouse callback</span>
<a name="l00201"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o92">00201</a>         <a class="code" href="_d_x_u_t_8h.html#a19">LPDXUTCALLBACKMSGPROC</a>               <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o92">m_WindowMsgFunc</a>;            <span class="comment">// window messages callback</span>
<a name="l00202"></a>00202 
<a name="l00203"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o93">00203</a>         <a class="code" href="_d_x_u_t_8cpp.html#a23">LPGETSYSTEMMETRICS</a>                  <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o93">m_FnGetSystemMetrics</a>;       <span class="comment">// delay loading of multimon apis.  Might be NULL</span>
<a name="l00204"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o94">00204</a>         <a class="code" href="_d_x_u_t_8cpp.html#a24">LPMONITORFROMWINDOW</a>                 <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o94">m_FnMonitorFromWindow</a>;      <span class="comment">// delay loading of multimon apis.  Might be NULL</span>
<a name="l00205"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o95">00205</a>         <a class="code" href="_d_x_u_t_8cpp.html#a25">LPGETMONITORINFO</a>                    <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o95">m_FnGetMonitorInfo</a>;         <span class="comment">// delay loading of multimon apis.  Might be NULL</span>
<a name="l00206"></a>00206 
<a name="l00207"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o96">00207</a>         <span class="keywordtype">void</span>*                               <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o96">m_IsDeviceAcceptableFuncUserContext</a>;   <span class="comment">// user context for is device acceptable callback</span>
<a name="l00208"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o97">00208</a>         <span class="keywordtype">void</span>*                               <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o97">m_ModifyDeviceSettingsFuncUserContext</a>; <span class="comment">// user context for modify device settings callback</span>
<a name="l00209"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o98">00209</a>         <span class="keywordtype">void</span>*                               <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o98">m_DeviceCreatedUserContext</a>;            <span class="comment">// user context for device created callback</span>
<a name="l00210"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o99">00210</a>         <span class="keywordtype">void</span>*                               <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o99">m_DeviceCreatedFuncUserContext</a>;        <span class="comment">// user context for device created callback</span>
<a name="l00211"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o100">00211</a>         <span class="keywordtype">void</span>*                               <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o100">m_DeviceResetFuncUserContext</a>;          <span class="comment">// user context for device reset callback</span>
<a name="l00212"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o101">00212</a>         <span class="keywordtype">void</span>*                               <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o101">m_DeviceLostFuncUserContext</a>;           <span class="comment">// user context for device lost callback</span>
<a name="l00213"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o102">00213</a>         <span class="keywordtype">void</span>*                               <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o102">m_DeviceDestroyedFuncUserContext</a>;      <span class="comment">// user context for device destroyed callback</span>
<a name="l00214"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o103">00214</a>         <span class="keywordtype">void</span>*                               <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o103">m_FrameMoveFuncUserContext</a>;            <span class="comment">// user context for frame move callback</span>
<a name="l00215"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o104">00215</a>         <span class="keywordtype">void</span>*                               <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o104">m_FrameRenderFuncUserContext</a>;          <span class="comment">// user context for frame render callback</span>
<a name="l00216"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o105">00216</a>         <span class="keywordtype">void</span>*                               <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o105">m_KeyboardFuncUserContext</a>;             <span class="comment">// user context for keyboard callback</span>
<a name="l00217"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o106">00217</a>         <span class="keywordtype">void</span>*                               <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o106">m_MouseFuncUserContext</a>;                <span class="comment">// user context for mouse callback</span>
<a name="l00218"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o107">00218</a>         <span class="keywordtype">void</span>*                               <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o107">m_WindowMsgFuncUserContext</a>;            <span class="comment">// user context for window messages callback</span>
<a name="l00219"></a>00219 
<a name="l00220"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o108">00220</a>         <span class="keywordtype">bool</span>                         <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o108">m_Keys</a>[256];                       <span class="comment">// array of key state</span>
<a name="l00221"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o109">00221</a>         <span class="keywordtype">bool</span>                         <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o109">m_MouseButtons</a>[5];                 <span class="comment">// array of mouse states</span>
<a name="l00222"></a>00222 
<a name="l00223"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o110">00223</a>         <a class="code" href="class_c_growable_array.html">CGrowableArray&lt;DXUT_TIMER&gt;</a>*  <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o110">m_TimerList</a>;                       <span class="comment">// list of DXUT_TIMER structs</span>
<a name="l00224"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o111">00224</a>         WCHAR                        <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o111">m_StaticFrameStats</a>[256];           <span class="comment">// static part of frames stats </span>
<a name="l00225"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o112">00225</a>         WCHAR                        <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o112">m_FrameStats</a>[256];                 <span class="comment">// frame stats (fps, width, etc)</span>
<a name="l00226"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o113">00226</a>         WCHAR                        <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o113">m_DeviceStats</a>[256];                <span class="comment">// device stats (description, device type, etc)</span>
<a name="l00227"></a><a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o114">00227</a>         WCHAR                        <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o114">m_WindowTitle</a>[256];                <span class="comment">// window title</span>
<a name="l00228"></a>00228     };
<a name="l00229"></a>00229     
<a name="l00230"></a><a class="code" href="class_d_x_u_t_state.html#p0">00230</a>     <a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html">STATE</a> <a class="code" href="class_d_x_u_t_state.html#p0">m_state</a>;
<a name="l00231"></a>00231 
<a name="l00232"></a>00232 <span class="keyword">public</span>:
<a name="l00233"></a><a class="code" href="class_d_x_u_t_state.html#a0">00233</a>     <a class="code" href="class_d_x_u_t_state.html#a0">DXUTState</a>()  { <a class="code" href="class_d_x_u_t_state.html#a2">Create</a>(); }
<a name="l00234"></a><a class="code" href="class_d_x_u_t_state.html#a1">00234</a>     <a class="code" href="class_d_x_u_t_state.html#a1">~DXUTState</a>() { <a class="code" href="class_d_x_u_t_state.html#a3">Destroy</a>(); }
<a name="l00235"></a>00235 
<a name="l00236"></a><a class="code" href="class_d_x_u_t_state.html#a2">00236</a>     <span class="keywordtype">void</span> <a class="code" href="class_d_x_u_t_state.html#a2">Create</a>()
<a name="l00237"></a>00237     {
<a name="l00238"></a>00238         <span class="comment">// Make sure these are created before DXUTState so they </span>
<a name="l00239"></a>00239         <span class="comment">// destroyed last because DXUTState cleanup needs them</span>
<a name="l00240"></a>00240         <a class="code" href="_d_x_u_tmisc_8cpp.html#a17">DXUTGetGlobalResourceCache</a>();
<a name="l00241"></a>00241 
<a name="l00242"></a>00242         ZeroMemory( &amp;<a class="code" href="class_d_x_u_t_state.html#p0">m_state</a>, <span class="keyword">sizeof</span>(<a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html">STATE</a>) ); 
<a name="l00243"></a>00243         <a class="code" href="_d_x_u_t_8cpp.html#a16">g_bThreadSafe</a> = <span class="keyword">true</span>; 
<a name="l00244"></a>00244         InitializeCriticalSection( &amp;<a class="code" href="_d_x_u_t_8cpp.html#a15">g_cs</a> ); 
<a name="l00245"></a>00245         <a class="code" href="class_d_x_u_t_state.html#p0">m_state</a>.<a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o70">m_OverrideStartX</a> = -1; 
<a name="l00246"></a>00246         <a class="code" href="class_d_x_u_t_state.html#p0">m_state</a>.<a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o71">m_OverrideStartY</a> = -1; 
<a name="l00247"></a>00247         <a class="code" href="class_d_x_u_t_state.html#p0">m_state</a>.<a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o67">m_OverrideAdapterOrdinal</a> = -1; 
<a name="l00248"></a>00248         <a class="code" href="class_d_x_u_t_state.html#p0">m_state</a>.<a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o45">m_AutoChangeAdapter</a> = <span class="keyword">true</span>; 
<a name="l00249"></a>00249         <a class="code" href="class_d_x_u_t_state.html#p0">m_state</a>.<a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o39">m_ShowMsgBoxOnError</a> = <span class="keyword">true</span>;
<a name="l00250"></a>00250         <a class="code" href="class_d_x_u_t_state.html#p0">m_state</a>.<a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o31">m_AllowShortcutKeysWhenWindowed</a> = <span class="keyword">true</span>;
<a name="l00251"></a>00251         <a class="code" href="class_d_x_u_t_state.html#p0">m_state</a>.<a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o58">m_Active</a> = <span class="keyword">true</span>;
<a name="l00252"></a>00252         <a class="code" href="class_d_x_u_t_state.html#p0">m_state</a>.<a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o33">m_CallDefWindowProc</a> = <span class="keyword">true</span>;
<a name="l00253"></a>00253 
<a name="l00254"></a>00254         <span class="comment">// Get proc addresses of multimon APIs if they exist</span>
<a name="l00255"></a>00255         HMODULE hUser32 = GetModuleHandle( L<span class="stringliteral">"USER32"</span> );
<a name="l00256"></a>00256         <span class="keywordflow">if</span> (hUser32 )
<a name="l00257"></a>00257         {
<a name="l00258"></a>00258             OSVERSIONINFOA osvi = {0}; osvi.dwOSVersionInfoSize = <span class="keyword">sizeof</span>(osvi); GetVersionExA((OSVERSIONINFOA*)&amp;osvi);
<a name="l00259"></a>00259             <span class="keywordtype">bool</span> bNT = (VER_PLATFORM_WIN32_NT == osvi.dwPlatformId);    
<a name="l00260"></a>00260 
<a name="l00261"></a>00261             <a class="code" href="class_d_x_u_t_state.html#p0">m_state</a>.<a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o93">m_FnGetSystemMetrics</a>  = (<a class="code" href="_d_x_u_t_8cpp.html#a23">LPGETSYSTEMMETRICS</a>) GetProcAddress(hUser32,<span class="stringliteral">"GetSystemMetrics"</span>);
<a name="l00262"></a>00262             <a class="code" href="class_d_x_u_t_state.html#p0">m_state</a>.<a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o94">m_FnMonitorFromWindow</a> = (<a class="code" href="_d_x_u_t_8cpp.html#a24">LPMONITORFROMWINDOW</a>) GetProcAddress(hUser32,<span class="stringliteral">"MonitorFromWindow"</span>);
<a name="l00263"></a>00263             <a class="code" href="class_d_x_u_t_state.html#p0">m_state</a>.<a class="code" href="struct_d_x_u_t_state_1_1_s_t_a_t_e.html#o95">m_FnGetMonitorInfo</a>    = (<a class="code" href="_d_x_u_t_8cpp.html#a25">LPGETMONITORINFO</a>) (bNT ? GetProcAddress(hUser32,<span class="stringliteral">"GetMonitorInfoW"</span>) : GetProcAddress(hUser32,<span class="stringliteral">"GetMonitorInfoA"</span>));
<a name="l00264"></a>00264         }
<a name="l00265"></a>00265     }
<a name="l00266"></a>00266 
<a name="l00267"></a><a class="code" href="class_d_x_u_t_state.html#a3">00267</a>     <span class="keywordtype">void</span> <a class="code" href="class_d_x_u_t_state.html#a3">Destroy</a>()
<a name="l00268"></a>00268     {
<a name="l00269"></a>00269         <a class="code" href="_d_x_u_t_8cpp.html#a89">DXUTShutdown</a>();
<a name="l00270"></a>00270         DeleteCriticalSection( &amp;<a class="code" href="_d_x_u_t_8cpp.html#a15">g_cs</a> ); 
<a name="l00271"></a>00271     }
<a name="l00272"></a>00272 
<a name="l00273"></a>00273     <span class="comment">// Macros to define access functions for thread safe access into m_state </span>
<a name="l00274"></a>00274     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( IDirect3D9*, D3D );
<a name="l00275"></a>00275 
<a name="l00276"></a>00276     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( IDirect3DDevice9*, D3DDevice );
<a name="l00277"></a>00277     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <a class="code" href="class_c_d3_d_enumeration.html">CD3DEnumeration</a>*, D3DEnumeration );   
<a name="l00278"></a>00278     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <a class="code" href="struct_d_x_u_t_device_settings.html">DXUTDeviceSettings</a>*, CurrentDeviceSettings );   
<a name="l00279"></a>00279     <a class="code" href="class_d_x_u_t_state.html#a8">GETP_SETP_ACCESSOR</a>( D3DSURFACE_DESC, BackBufferSurfaceDesc );
<a name="l00280"></a>00280     <a class="code" href="class_d_x_u_t_state.html#a8">GETP_SETP_ACCESSOR</a>( D3DCAPS9, Caps );
<a name="l00281"></a>00281 
<a name="l00282"></a>00282     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <a class="code" href="_d_x_u_tgui_8cpp.html#a53">HWND</a>, HWNDFocus );
<a name="l00283"></a>00283     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <a class="code" href="_d_x_u_tgui_8cpp.html#a53">HWND</a>, HWNDDeviceFullScreen );
<a name="l00284"></a>00284     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <a class="code" href="_d_x_u_tgui_8cpp.html#a53">HWND</a>, HWNDDeviceWindowed );
<a name="l00285"></a>00285     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( HMONITOR, AdapterMonitor );
<a name="l00286"></a>00286     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( HMENU, Menu );   
<a name="l00287"></a>00287 
<a name="l00288"></a>00288     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <a class="code" href="_d_x_u_tgui_8cpp.html#a45">UINT</a>, FullScreenBackBufferWidthAtModeChange );
<a name="l00289"></a>00289     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <a class="code" href="_d_x_u_tgui_8cpp.html#a45">UINT</a>, FullScreenBackBufferHeightAtModeChange );
<a name="l00290"></a>00290     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <a class="code" href="_d_x_u_tgui_8cpp.html#a45">UINT</a>, WindowBackBufferWidthAtModeChange );
<a name="l00291"></a>00291     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <a class="code" href="_d_x_u_tgui_8cpp.html#a45">UINT</a>, WindowBackBufferHeightAtModeChange );
<a name="l00292"></a>00292     <a class="code" href="class_d_x_u_t_state.html#a8">GETP_SETP_ACCESSOR</a>( WINDOWPLACEMENT, WindowedPlacement );
<a name="l00293"></a>00293     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <a class="code" href="_d_x_u_tgui_8cpp.html#a38">DWORD</a>, WindowedStyleAtModeChange );
<a name="l00294"></a>00294     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <span class="keywordtype">bool</span>, TopmostWhileWindowed );
<a name="l00295"></a>00295     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <span class="keywordtype">bool</span>, Minimized );
<a name="l00296"></a>00296     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <span class="keywordtype">bool</span>, Maximized );
<a name="l00297"></a>00297     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <span class="keywordtype">bool</span>, MinimizedWhileFullscreen );
<a name="l00298"></a>00298     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <span class="keywordtype">bool</span>, IgnoreSizeChange );   
<a name="l00299"></a>00299 
<a name="l00300"></a>00300     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <span class="keywordtype">double</span>, Time );
<a name="l00301"></a>00301     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <span class="keywordtype">float</span>, ElapsedTime );
<a name="l00302"></a>00302 
<a name="l00303"></a>00303     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( HINSTANCE, HInstance );
<a name="l00304"></a>00304     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <span class="keywordtype">double</span>, LastStatsUpdateTime );   
<a name="l00305"></a>00305     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <a class="code" href="_d_x_u_tgui_8cpp.html#a38">DWORD</a>, LastStatsUpdateFrames );   
<a name="l00306"></a>00306     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <span class="keywordtype">float</span>, FPS );    
<a name="l00307"></a>00307     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <span class="keywordtype">int</span>, CurrentFrameNumber );
<a name="l00308"></a>00308     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( HHOOK, KeyboardHook );
<a name="l00309"></a>00309     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <span class="keywordtype">bool</span>, AllowShortcutKeysWhenFullscreen );
<a name="l00310"></a>00310     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <span class="keywordtype">bool</span>, AllowShortcutKeysWhenWindowed );
<a name="l00311"></a>00311     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <span class="keywordtype">bool</span>, AllowShortcutKeys );
<a name="l00312"></a>00312     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <span class="keywordtype">bool</span>, CallDefWindowProc );
<a name="l00313"></a>00313     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( STICKYKEYS, StartupStickyKeys );
<a name="l00314"></a>00314     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( TOGGLEKEYS, StartupToggleKeys );
<a name="l00315"></a>00315     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( FILTERKEYS, StartupFilterKeys );
<a name="l00316"></a>00316 
<a name="l00317"></a>00317     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <span class="keywordtype">bool</span>, HandleDefaultHotkeys );
<a name="l00318"></a>00318     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <span class="keywordtype">bool</span>, HandleAltEnter );
<a name="l00319"></a>00319     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <span class="keywordtype">bool</span>, ShowMsgBoxOnError );
<a name="l00320"></a>00320     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <span class="keywordtype">bool</span>, ClipCursorWhenFullScreen );   
<a name="l00321"></a>00321     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <span class="keywordtype">bool</span>, ShowCursorWhenFullScreen );
<a name="l00322"></a>00322     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <span class="keywordtype">bool</span>, ConstantFrameTime );
<a name="l00323"></a>00323     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <span class="keywordtype">float</span>, TimePerFrame );
<a name="l00324"></a>00324     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <span class="keywordtype">bool</span>, WireframeMode );   
<a name="l00325"></a>00325     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <span class="keywordtype">bool</span>, AutoChangeAdapter );
<a name="l00326"></a>00326     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <span class="keywordtype">bool</span>, WindowCreatedWithDefaultPositions );
<a name="l00327"></a>00327     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <span class="keywordtype">int</span>, ExitCode );
<a name="l00328"></a>00328 
<a name="l00329"></a>00329     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <span class="keywordtype">bool</span>, DXUTInited );
<a name="l00330"></a>00330     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <span class="keywordtype">bool</span>, WindowCreated );
<a name="l00331"></a>00331     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <span class="keywordtype">bool</span>, DeviceCreated );
<a name="l00332"></a>00332     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <span class="keywordtype">bool</span>, DXUTInitCalled );
<a name="l00333"></a>00333     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <span class="keywordtype">bool</span>, WindowCreateCalled );
<a name="l00334"></a>00334     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <span class="keywordtype">bool</span>, DeviceCreateCalled );
<a name="l00335"></a>00335     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <span class="keywordtype">bool</span>, InsideDeviceCallback );
<a name="l00336"></a>00336     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <span class="keywordtype">bool</span>, InsideMainloop );
<a name="l00337"></a>00337     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <span class="keywordtype">bool</span>, DeviceObjectsCreated );
<a name="l00338"></a>00338     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <span class="keywordtype">bool</span>, DeviceObjectsReset );
<a name="l00339"></a>00339     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <span class="keywordtype">bool</span>, Active );
<a name="l00340"></a>00340     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <span class="keywordtype">bool</span>, RenderingPaused );
<a name="l00341"></a>00341     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <span class="keywordtype">bool</span>, TimePaused );
<a name="l00342"></a>00342     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <span class="keywordtype">int</span>, PauseRenderingCount );
<a name="l00343"></a>00343     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <span class="keywordtype">int</span>, PauseTimeCount );
<a name="l00344"></a>00344     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <span class="keywordtype">bool</span>, DeviceLost );
<a name="l00345"></a>00345     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <span class="keywordtype">bool</span>, NotifyOnMouseMove );
<a name="l00346"></a>00346     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <span class="keywordtype">bool</span>, Automation );
<a name="l00347"></a>00347     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <span class="keywordtype">bool</span>, InSizeMove );
<a name="l00348"></a>00348 
<a name="l00349"></a>00349     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <span class="keywordtype">int</span>, OverrideAdapterOrdinal );
<a name="l00350"></a>00350     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <span class="keywordtype">bool</span>, OverrideWindowed );
<a name="l00351"></a>00351     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <span class="keywordtype">bool</span>, OverrideFullScreen );
<a name="l00352"></a>00352     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <span class="keywordtype">int</span>, OverrideStartX );
<a name="l00353"></a>00353     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <span class="keywordtype">int</span>, OverrideStartY );
<a name="l00354"></a>00354     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <span class="keywordtype">int</span>, OverrideWidth );
<a name="l00355"></a>00355     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <span class="keywordtype">int</span>, OverrideHeight );
<a name="l00356"></a>00356     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <span class="keywordtype">bool</span>, OverrideForceHAL );
<a name="l00357"></a>00357     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <span class="keywordtype">bool</span>, OverrideForceREF );
<a name="l00358"></a>00358     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <span class="keywordtype">bool</span>, OverrideForcePureHWVP );
<a name="l00359"></a>00359     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <span class="keywordtype">bool</span>, OverrideForceHWVP );
<a name="l00360"></a>00360     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <span class="keywordtype">bool</span>, OverrideForceSWVP );
<a name="l00361"></a>00361     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <span class="keywordtype">bool</span>, OverrideConstantFrameTime );
<a name="l00362"></a>00362     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <span class="keywordtype">float</span>, OverrideConstantTimePerFrame );
<a name="l00363"></a>00363     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <span class="keywordtype">int</span>, OverrideQuitAfterFrame );
<a name="l00364"></a>00364 
<a name="l00365"></a>00365     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <a class="code" href="_d_x_u_t_8h.html#a9">LPDXUTCALLBACKISDEVICEACCEPTABLE</a>, IsDeviceAcceptableFunc );
<a name="l00366"></a>00366     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <a class="code" href="_d_x_u_t_8h.html#a10">LPDXUTCALLBACKMODIFYDEVICESETTINGS</a>, ModifyDeviceSettingsFunc );
<a name="l00367"></a>00367     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <a class="code" href="_d_x_u_t_8h.html#a11">LPDXUTCALLBACKDEVICECREATED</a>, DeviceCreatedFunc );
<a name="l00368"></a>00368     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <a class="code" href="_d_x_u_t_8h.html#a12">LPDXUTCALLBACKDEVICERESET</a>, DeviceResetFunc );
<a name="l00369"></a>00369     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <a class="code" href="_d_x_u_t_8h.html#a14">LPDXUTCALLBACKDEVICELOST</a>, DeviceLostFunc );
<a name="l00370"></a>00370     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <a class="code" href="_d_x_u_t_8h.html#a13">LPDXUTCALLBACKDEVICEDESTROYED</a>, DeviceDestroyedFunc );
<a name="l00371"></a>00371     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <a class="code" href="_d_x_u_t_8h.html#a15">LPDXUTCALLBACKFRAMEMOVE</a>, FrameMoveFunc );
<a name="l00372"></a>00372     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <a class="code" href="_d_x_u_t_8h.html#a16">LPDXUTCALLBACKFRAMERENDER</a>, FrameRenderFunc );
<a name="l00373"></a>00373     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <a class="code" href="_d_x_u_t_8h.html#a17">LPDXUTCALLBACKKEYBOARD</a>, KeyboardFunc );
<a name="l00374"></a>00374     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <a class="code" href="_d_x_u_t_8h.html#a18">LPDXUTCALLBACKMOUSE</a>, MouseFunc );
<a name="l00375"></a>00375     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <a class="code" href="_d_x_u_t_8h.html#a19">LPDXUTCALLBACKMSGPROC</a>, WindowMsgFunc );
<a name="l00376"></a>00376 
<a name="l00377"></a>00377     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <a class="code" href="_d_x_u_t_8cpp.html#a23">LPGETSYSTEMMETRICS</a>, FnGetSystemMetrics );
<a name="l00378"></a>00378     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <a class="code" href="_d_x_u_t_8cpp.html#a24">LPMONITORFROMWINDOW</a>, FnMonitorFromWindow );
<a name="l00379"></a>00379     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <a class="code" href="_d_x_u_t_8cpp.html#a25">LPGETMONITORINFO</a>, FnGetMonitorInfo );
<a name="l00380"></a>00380 
<a name="l00381"></a>00381     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <span class="keywordtype">void</span>*, IsDeviceAcceptableFuncUserContext );
<a name="l00382"></a>00382     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <span class="keywordtype">void</span>*, ModifyDeviceSettingsFuncUserContext );
<a name="l00383"></a>00383     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <span class="keywordtype">void</span>*, DeviceCreatedFuncUserContext );
<a name="l00384"></a>00384     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <span class="keywordtype">void</span>*, DeviceResetFuncUserContext );
<a name="l00385"></a>00385     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <span class="keywordtype">void</span>*, DeviceLostFuncUserContext );
<a name="l00386"></a>00386     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <span class="keywordtype">void</span>*, DeviceDestroyedFuncUserContext );
<a name="l00387"></a>00387     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <span class="keywordtype">void</span>*, FrameMoveFuncUserContext );
<a name="l00388"></a>00388     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <span class="keywordtype">void</span>*, FrameRenderFuncUserContext );
<a name="l00389"></a>00389     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <span class="keywordtype">void</span>*, KeyboardFuncUserContext );
<a name="l00390"></a>00390     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <span class="keywordtype">void</span>*, MouseFuncUserContext );
<a name="l00391"></a>00391     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <span class="keywordtype">void</span>*, WindowMsgFuncUserContext );
<a name="l00392"></a>00392 
<a name="l00393"></a>00393     <a class="code" href="class_d_x_u_t_state.html#a4">GET_SET_ACCESSOR</a>( <a class="code" href="class_c_growable_array.html">CGrowableArray&lt;DXUT_TIMER&gt;</a>*, TimerList );   
<a name="l00394"></a>00394     <a class="code" href="class_d_x_u_t_state.html#a112">GET_ACCESSOR</a>( <span class="keywordtype">bool</span>*, Keys );
<a name="l00395"></a>00395     <a class="code" href="class_d_x_u_t_state.html#a112">GET_ACCESSOR</a>( <span class="keywordtype">bool</span>*, MouseButtons );
<a name="l00396"></a>00396     <a class="code" href="class_d_x_u_t_state.html#a112">GET_ACCESSOR</a>( WCHAR*, StaticFrameStats );
<a name="l00397"></a>00397     <a class="code" href="class_d_x_u_t_state.html#a112">GET_ACCESSOR</a>( WCHAR*, FrameStats );
<a name="l00398"></a>00398     <a class="code" href="class_d_x_u_t_state.html#a112">GET_ACCESSOR</a>( WCHAR*, DeviceStats );    
<a name="l00399"></a>00399     <a class="code" href="class_d_x_u_t_state.html#a112">GET_ACCESSOR</a>( WCHAR*, WindowTitle );
<a name="l00400"></a>00400 };
<a name="l00401"></a>00401 
<a name="l00402"></a>00402 
<a name="l00403"></a>00403 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l00404"></a>00404 <span class="comment">// Global state class</span>
<a name="l00405"></a>00405 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l00406"></a><a class="code" href="_d_x_u_t_8cpp.html#a31">00406</a> <a class="code" href="class_d_x_u_t_state.html">DXUTState</a>&amp; <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>()
<a name="l00407"></a>00407 {
<a name="l00408"></a>00408     <span class="comment">// Using an accessor function gives control of the construction order</span>
<a name="l00409"></a>00409     <span class="keyword">static</span> <a class="code" href="class_d_x_u_t_state.html">DXUTState</a> state;
<a name="l00410"></a>00410     <span class="keywordflow">return</span> state;
<a name="l00411"></a>00411 }
<a name="l00412"></a>00412 
<a name="l00413"></a>00413 
<a name="l00414"></a>00414 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l00415"></a>00415 <span class="comment">// Internal functions forward declarations</span>
<a name="l00416"></a>00416 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l00417"></a><a class="code" href="_d_x_u_t_8cpp.html#a26">00417</a> <span class="keyword">typedef</span> IDirect3D9* (WINAPI* <a class="code" href="_d_x_u_t_8cpp.html#a26">LPDIRECT3DCREATE9</a>)(<a class="code" href="_d_x_u_tgui_8cpp.html#a45">UINT</a> SDKVersion);
<a name="l00418"></a><a class="code" href="_d_x_u_t_8cpp.html#a27">00418</a> <span class="keyword">typedef</span> DECLSPEC_IMPORT <a class="code" href="_d_x_u_tgui_8cpp.html#a45">UINT</a> (WINAPI* <a class="code" href="_d_x_u_t_8cpp.html#a27">LPTIMEBEGINPERIOD</a>)( <a class="code" href="_d_x_u_tgui_8cpp.html#a45">UINT</a> uPeriod );
<a name="l00419"></a>00419 <span class="keywordtype">int</span>     <a class="code" href="_d_x_u_t_8cpp.html#a32">DXUTMapButtonToArrayIndex</a>( BYTE vButton );
<a name="l00420"></a>00420 <span class="keywordtype">void</span>    <a class="code" href="_d_x_u_t_8cpp.html#a33">DXUTParseCommandLine</a>();
<a name="l00421"></a>00421 <a class="code" href="class_c_d3_d_enumeration.html">CD3DEnumeration</a>* <a class="code" href="_d_x_u_t_8cpp.html#a34">DXUTPrepareEnumerationObject</a>( <span class="keywordtype">bool</span> bEnumerate = <span class="keyword">false</span> );
<a name="l00422"></a>00422 <span class="keywordtype">void</span>    <a class="code" href="_d_x_u_t_8cpp.html#a35">DXUTBuildOptimalDeviceSettings</a>( <a class="code" href="struct_d_x_u_t_device_settings.html">DXUTDeviceSettings</a>* pOptimalDeviceSettings, <a class="code" href="struct_d_x_u_t_device_settings.html">DXUTDeviceSettings</a>* pDeviceSettingsIn, <a class="code" href="struct_d_x_u_t_match_options.html">DXUTMatchOptions</a>* pMatchOptions );
<a name="l00423"></a>00423 <span class="keywordtype">bool</span>    <a class="code" href="_d_x_u_t_8cpp.html#a36">DXUTDoesDeviceComboMatchPreserveOptions</a>( <a class="code" href="struct_c_d3_d_enum_device_settings_combo.html">CD3DEnumDeviceSettingsCombo</a>* pDeviceSettingsCombo, <a class="code" href="struct_d_x_u_t_device_settings.html">DXUTDeviceSettings</a>* pDeviceSettingsIn, <a class="code" href="struct_d_x_u_t_match_options.html">DXUTMatchOptions</a>* pMatchOptions );
<a name="l00424"></a>00424 <span class="keywordtype">float</span>   <a class="code" href="_d_x_u_t_8cpp.html#a37">DXUTRankDeviceCombo</a>( <a class="code" href="struct_c_d3_d_enum_device_settings_combo.html">CD3DEnumDeviceSettingsCombo</a>* pDeviceSettingsCombo, <a class="code" href="struct_d_x_u_t_device_settings.html">DXUTDeviceSettings</a>* pDeviceSettingsIn, D3DDISPLAYMODE* pAdapterDesktopDisplayMode );
<a name="l00425"></a>00425 <span class="keywordtype">void</span>    <a class="code" href="_d_x_u_t_8cpp.html#a38">DXUTBuildValidDeviceSettings</a>( <a class="code" href="struct_d_x_u_t_device_settings.html">DXUTDeviceSettings</a>* pDeviceSettings, <a class="code" href="struct_c_d3_d_enum_device_settings_combo.html">CD3DEnumDeviceSettingsCombo</a>* pBestDeviceSettingsCombo, <a class="code" href="struct_d_x_u_t_device_settings.html">DXUTDeviceSettings</a>* pDeviceSettingsIn, <a class="code" href="struct_d_x_u_t_match_options.html">DXUTMatchOptions</a>* pMatchOptions );
<a name="l00426"></a>00426 <a class="code" href="_d_x_u_tgui_8cpp.html#a51">HRESULT</a> <a class="code" href="_d_x_u_t_8cpp.html#a39">DXUTFindValidResolution</a>( <a class="code" href="struct_c_d3_d_enum_device_settings_combo.html">CD3DEnumDeviceSettingsCombo</a>* pBestDeviceSettingsCombo, D3DDISPLAYMODE displayModeIn, D3DDISPLAYMODE* pBestDisplayMode );
<a name="l00427"></a>00427 <a class="code" href="_d_x_u_tgui_8cpp.html#a51">HRESULT</a> <a class="code" href="_d_x_u_t_8cpp.html#a40">DXUTFindAdapterFormat</a>( <a class="code" href="_d_x_u_tgui_8cpp.html#a45">UINT</a> AdapterOrdinal, D3DDEVTYPE DeviceType, D3DFORMAT BackBufferFormat, <a class="code" href="_d_x_u_tgui_8cpp.html#a39">BOOL</a> Windowed, D3DFORMAT* pAdapterFormat );
<a name="l00428"></a>00428 <a class="code" href="_d_x_u_tgui_8cpp.html#a51">HRESULT</a> <a class="code" href="_d_x_u_t_8cpp.html#a41">DXUTChangeDevice</a>( <a class="code" href="struct_d_x_u_t_device_settings.html">DXUTDeviceSettings</a>* pNewDeviceSettings, IDirect3DDevice9* pd3dDeviceFromApp, <span class="keywordtype">bool</span> bForceRecreate, <span class="keywordtype">bool</span> bClipWindowToSingleAdapter );
<a name="l00429"></a>00429 <span class="keywordtype">void</span>    <a class="code" href="_d_x_u_t_8cpp.html#a42">DXUTUpdateDeviceSettingsWithOverrides</a>( <a class="code" href="struct_d_x_u_t_device_settings.html">DXUTDeviceSettings</a>* pNewDeviceSettings );
<a name="l00430"></a>00430 <a class="code" href="_d_x_u_tgui_8cpp.html#a51">HRESULT</a> <a class="code" href="_d_x_u_t_8cpp.html#a43">DXUTCreate3DEnvironment</a>( IDirect3DDevice9* pd3dDeviceFromApp );
<a name="l00431"></a>00431 <a class="code" href="_d_x_u_tgui_8cpp.html#a51">HRESULT</a> <a class="code" href="_d_x_u_t_8cpp.html#a44">DXUTReset3DEnvironment</a>();
<a name="l00432"></a>00432 <span class="keywordtype">void</span>    <a class="code" href="_d_x_u_t_8cpp.html#a45">DXUTRender3DEnvironment</a>();
<a name="l00433"></a>00433 <span class="keywordtype">void</span>    <a class="code" href="_d_x_u_t_8cpp.html#a46">DXUTCleanup3DEnvironment</a>( <span class="keywordtype">bool</span> bReleaseSettings = <span class="keyword">true</span> );
<a name="l00434"></a>00434 <span class="keywordtype">void</span>    <a class="code" href="_d_x_u_t_8cpp.html#a47">DXUTUpdateFrameStats</a>();
<a name="l00435"></a>00435 <span class="keywordtype">void</span>    <a class="code" href="_d_x_u_t_8cpp.html#a48">DXUTUpdateDeviceStats</a>( D3DDEVTYPE DeviceType, <a class="code" href="_d_x_u_tgui_8cpp.html#a38">DWORD</a> BehaviorFlags, D3DADAPTER_IDENTIFIER9* pAdapterIdentifier );
<a name="l00436"></a>00436 <span class="keywordtype">void</span>    <a class="code" href="_d_x_u_t_8cpp.html#a49">DXUTUpdateStaticFrameStats</a>();
<a name="l00437"></a>00437 <span class="keywordtype">void</span>    <a class="code" href="_d_x_u_t_8cpp.html#a50">DXUTHandleTimers</a>();
<a name="l00438"></a>00438 <span class="keywordtype">bool</span>    <a class="code" href="_d_x_u_t_8cpp.html#a51">DXUTGetCmdParam</a>( WCHAR*&amp; strCmdLine, WCHAR* strFlag, <span class="keywordtype">int</span> nFlagLen );
<a name="l00439"></a>00439 <span class="keywordtype">void</span>    <a class="code" href="_d_x_u_t_8cpp.html#a52">DXUTDisplayErrorMessage</a>( <a class="code" href="_d_x_u_tgui_8cpp.html#a51">HRESULT</a> hr );
<a name="l00440"></a>00440 LRESULT CALLBACK <a class="code" href="_d_x_u_t_8cpp.html#a53">DXUTStaticWndProc</a>( <a class="code" href="_d_x_u_tgui_8cpp.html#a53">HWND</a> hWnd, <a class="code" href="_d_x_u_tgui_8cpp.html#a45">UINT</a> uMsg, WPARAM wParam, LPARAM lParam );
<a name="l00441"></a>00441 <span class="keywordtype">void</span>    <a class="code" href="_d_x_u_t_8cpp.html#a54">DXUTCheckForWindowSizeChange</a>();
<a name="l00442"></a>00442 <span class="keywordtype">void</span>    <a class="code" href="_d_x_u_t_8cpp.html#a55">DXUTCheckForWindowChangingMonitors</a>();
<a name="l00443"></a>00443 <a class="code" href="_d_x_u_tgui_8cpp.html#a45">UINT</a>    <a class="code" href="_d_x_u_t_8cpp.html#a56">DXUTColorChannelBits</a>( D3DFORMAT fmt );
<a name="l00444"></a>00444 <a class="code" href="_d_x_u_tgui_8cpp.html#a45">UINT</a>    <a class="code" href="_d_x_u_t_8cpp.html#a57">DXUTStencilBits</a>( D3DFORMAT fmt );
<a name="l00445"></a>00445 <a class="code" href="_d_x_u_tgui_8cpp.html#a45">UINT</a>    <a class="code" href="_d_x_u_t_8cpp.html#a58">DXUTDepthBits</a>( D3DFORMAT fmt );
<a name="l00446"></a>00446 <a class="code" href="_d_x_u_tgui_8cpp.html#a51">HRESULT</a> <a class="code" href="_d_x_u_t_8cpp.html#a59">DXUTGetAdapterOrdinalFromMonitor</a>( HMONITOR hMonitor, <a class="code" href="_d_x_u_tgui_8cpp.html#a45">UINT</a>* pAdapterOrdinal );
<a name="l00447"></a>00447 <span class="keywordtype">void</span>    <a class="code" href="_d_x_u_t_8cpp.html#a60">DXUTAllowShortcutKeys</a>( <span class="keywordtype">bool</span> bAllowKeys );
<a name="l00448"></a>00448 <span class="keywordtype">void</span>    <a class="code" href="_d_x_u_t_8cpp.html#a61">DXUTUpdateBackBufferDesc</a>();
<a name="l00449"></a>00449 <span class="keywordtype">void</span>    <a class="code" href="_d_x_u_t_8cpp.html#a62">DXUTSetupCursor</a>();
<a name="l00450"></a>00450 <a class="code" href="_d_x_u_tgui_8cpp.html#a51">HRESULT</a> <a class="code" href="_d_x_u_t_8cpp.html#a63">DXUTSetDeviceCursor</a>( IDirect3DDevice9* pd3dDevice, HCURSOR hCursor, <span class="keywordtype">bool</span> bAddWatermark );
<a name="l00451"></a>00451 <span class="keywordtype">void</span>    <a class="code" href="_d_x_u_t_8cpp.html#a64">DXUTGetDesktopResolution</a>( <a class="code" href="_d_x_u_tgui_8cpp.html#a45">UINT</a> AdapterOrdinal, <a class="code" href="_d_x_u_tgui_8cpp.html#a38">DWORD</a>* pdwWidth, <a class="code" href="_d_x_u_tgui_8cpp.html#a38">DWORD</a>* pdwHeight );
<a name="l00452"></a>00452 
<a name="l00453"></a>00453 
<a name="l00454"></a>00454 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l00455"></a>00455 <span class="comment">// External callback setup functions</span>
<a name="l00456"></a>00456 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l00457"></a><a class="code" href="_d_x_u_t_8h.html#a24">00457</a> <span class="keywordtype">void</span> <a class="code" href="_d_x_u_t_8cpp.html#a65">DXUTSetCallbackDeviceCreated</a>( <a class="code" href="_d_x_u_t_8h.html#a11">LPDXUTCALLBACKDEVICECREATED</a> pCallbackDeviceCreated, <span class="keywordtype">void</span>* <a class="code" href="_d_x_u_tgui_8h.html#a14">pUserContext</a> ) { <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetDeviceCreatedFunc( pCallbackDeviceCreated ); <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetDeviceCreatedFuncUserContext( pUserContext ); }
<a name="l00458"></a><a class="code" href="_d_x_u_t_8h.html#a25">00458</a> <span class="keywordtype">void</span> <a class="code" href="_d_x_u_t_8cpp.html#a66">DXUTSetCallbackDeviceReset</a>( <a class="code" href="_d_x_u_t_8h.html#a12">LPDXUTCALLBACKDEVICERESET</a> pCallbackDeviceReset, <span class="keywordtype">void</span>* <a class="code" href="_d_x_u_tgui_8h.html#a14">pUserContext</a> )       { <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetDeviceResetFunc( pCallbackDeviceReset );  <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetDeviceResetFuncUserContext( pUserContext ); }
<a name="l00459"></a><a class="code" href="_d_x_u_t_8h.html#a26">00459</a> <span class="keywordtype">void</span> <a class="code" href="_d_x_u_t_8cpp.html#a67">DXUTSetCallbackDeviceLost</a>( <a class="code" href="_d_x_u_t_8h.html#a14">LPDXUTCALLBACKDEVICELOST</a> pCallbackDeviceLost, <span class="keywordtype">void</span>* <a class="code" href="_d_x_u_tgui_8h.html#a14">pUserContext</a> )          { <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetDeviceLostFunc( pCallbackDeviceLost );  <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetDeviceLostFuncUserContext( pUserContext ); }
<a name="l00460"></a><a class="code" href="_d_x_u_t_8h.html#a27">00460</a> <span class="keywordtype">void</span> <a class="code" href="_d_x_u_t_8cpp.html#a68">DXUTSetCallbackDeviceDestroyed</a>( <a class="code" href="_d_x_u_t_8h.html#a13">LPDXUTCALLBACKDEVICEDESTROYED</a> pCallbackDeviceDestroyed, <span class="keywordtype">void</span>* <a class="code" href="_d_x_u_tgui_8h.html#a14">pUserContext</a> ) { <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetDeviceDestroyedFunc( pCallbackDeviceDestroyed );  <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetDeviceDestroyedFuncUserContext( pUserContext ); }
<a name="l00461"></a><a class="code" href="_d_x_u_t_8h.html#a28">00461</a> <span class="keywordtype">void</span> <a class="code" href="_d_x_u_t_8cpp.html#a69">DXUTSetCallbackDeviceChanging</a>( <a class="code" href="_d_x_u_t_8h.html#a10">LPDXUTCALLBACKMODIFYDEVICESETTINGS</a> pCallbackModifyDeviceSettings, <span class="keywordtype">void</span>* <a class="code" href="_d_x_u_tgui_8h.html#a14">pUserContext</a> ) { <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetModifyDeviceSettingsFunc( pCallbackModifyDeviceSettings );  <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetModifyDeviceSettingsFuncUserContext( pUserContext ); }
<a name="l00462"></a><a class="code" href="_d_x_u_t_8h.html#a29">00462</a> <span class="keywordtype">void</span> <a class="code" href="_d_x_u_t_8cpp.html#a70">DXUTSetCallbackFrameMove</a>( <a class="code" href="_d_x_u_t_8h.html#a15">LPDXUTCALLBACKFRAMEMOVE</a> pCallbackFrameMove, <span class="keywordtype">void</span>* <a class="code" href="_d_x_u_tgui_8h.html#a14">pUserContext</a> ) { <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetFrameMoveFunc( pCallbackFrameMove );  <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetFrameMoveFuncUserContext( pUserContext ); }
<a name="l00463"></a><a class="code" href="_d_x_u_t_8h.html#a30">00463</a> <span class="keywordtype">void</span> <a class="code" href="_d_x_u_t_8cpp.html#a71">DXUTSetCallbackFrameRender</a>( <a class="code" href="_d_x_u_t_8h.html#a16">LPDXUTCALLBACKFRAMERENDER</a> pCallbackFrameRender, <span class="keywordtype">void</span>* <a class="code" href="_d_x_u_tgui_8h.html#a14">pUserContext</a> )       { <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetFrameRenderFunc( pCallbackFrameRender );  <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetFrameRenderFuncUserContext( pUserContext ); }
<a name="l00464"></a><a class="code" href="_d_x_u_t_8h.html#a31">00464</a> <span class="keywordtype">void</span> <a class="code" href="_d_x_u_t_8cpp.html#a72">DXUTSetCallbackKeyboard</a>( <a class="code" href="_d_x_u_t_8h.html#a17">LPDXUTCALLBACKKEYBOARD</a> pCallbackKeyboard, <span class="keywordtype">void</span>* <a class="code" href="_d_x_u_tgui_8h.html#a14">pUserContext</a> )                { <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetKeyboardFunc( pCallbackKeyboard );  <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetKeyboardFuncUserContext( pUserContext ); }
<a name="l00465"></a><a class="code" href="_d_x_u_t_8h.html#a32">00465</a> <span class="keywordtype">void</span> <a class="code" href="_d_x_u_t_8cpp.html#a73">DXUTSetCallbackMouse</a>( <a class="code" href="_d_x_u_t_8h.html#a18">LPDXUTCALLBACKMOUSE</a> pCallbackMouse, <span class="keywordtype">bool</span> bIncludeMouseMove, <span class="keywordtype">void</span>* <a class="code" href="_d_x_u_tgui_8h.html#a14">pUserContext</a> ) { <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetMouseFunc( pCallbackMouse ); <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetNotifyOnMouseMove( bIncludeMouseMove );  <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetMouseFuncUserContext( pUserContext ); }
<a name="l00466"></a><a class="code" href="_d_x_u_t_8h.html#a33">00466</a> <span class="keywordtype">void</span> <a class="code" href="_d_x_u_t_8cpp.html#a74">DXUTSetCallbackMsgProc</a>( <a class="code" href="_d_x_u_t_8h.html#a19">LPDXUTCALLBACKMSGPROC</a> pCallbackMsgProc, <span class="keywordtype">void</span>* <a class="code" href="_d_x_u_tgui_8h.html#a14">pUserContext</a> )                   { <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetWindowMsgFunc( pCallbackMsgProc );  <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetWindowMsgFuncUserContext( pUserContext ); }
<a name="l00467"></a>00467 
<a name="l00468"></a>00468 
<a name="l00469"></a>00469 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l00470"></a>00470 <span class="comment">// Optionally parses the command line and sets if default hotkeys are handled</span>
<a name="l00471"></a>00471 <span class="comment">//</span>
<a name="l00472"></a>00472 <span class="comment">//       Possible command line parameters are:</span>
<a name="l00473"></a>00473 <span class="comment">//          -adapter:#              forces app to use this adapter # (fails if the adapter doesn't exist)</span>
<a name="l00474"></a>00474 <span class="comment">//          -windowed               forces app to start windowed</span>
<a name="l00475"></a>00475 <span class="comment">//          -fullscreen             forces app to start full screen</span>
<a name="l00476"></a>00476 <span class="comment">//          -forcehal               forces app to use HAL (fails if HAL doesn't exist)</span>
<a name="l00477"></a>00477 <span class="comment">//          -forceref               forces app to use REF (fails if REF doesn't exist)</span>
<a name="l00478"></a>00478 <span class="comment">//          -forcepurehwvp          forces app to use pure HWVP (fails if device doesn't support it)</span>
<a name="l00479"></a>00479 <span class="comment">//          -forcehwvp              forces app to use HWVP (fails if device doesn't support it)</span>
<a name="l00480"></a>00480 <span class="comment">//          -forceswvp              forces app to use SWVP </span>
<a name="l00481"></a>00481 <span class="comment">//          -width:#                forces app to use # for width. for full screen, it will pick the closest possible supported mode</span>
<a name="l00482"></a>00482 <span class="comment">//          -height:#               forces app to use # for height. for full screen, it will pick the closest possible supported mode</span>
<a name="l00483"></a>00483 <span class="comment">//          -startx:#               forces app to use # for the x coord of the window position for windowed mode</span>
<a name="l00484"></a>00484 <span class="comment">//          -starty:#               forces app to use # for the y coord of the window position for windowed mode</span>
<a name="l00485"></a>00485 <span class="comment">//          -constantframetime:#    forces app to use constant frame time, where # is the time/frame in seconds</span>
<a name="l00486"></a>00486 <span class="comment">//          -quitafterframe:x       forces app to quit after # frames</span>
<a name="l00487"></a>00487 <span class="comment">//          -noerrormsgboxes        prevents the display of message boxes generated by the framework so the application can be run without user interaction</span>
<a name="l00488"></a>00488 <span class="comment">//          -automation             every CDXUTDialog created will have EnableKeyboardInput(true) called, enabling UI navigation with keyboard</span>
<a name="l00489"></a>00489 <span class="comment">//                                  This is useful when automating application testing.</span>
<a name="l00490"></a>00490 <span class="comment">//</span>
<a name="l00491"></a>00491 <span class="comment">//      Hotkeys handled by default are:</span>
<a name="l00492"></a>00492 <span class="comment">//          Alt-Enter           toggle between full screen &amp; windowed (hotkey always enabled)</span>
<a name="l00493"></a>00493 <span class="comment">//          ESC                 exit app </span>
<a name="l00494"></a>00494 <span class="comment">//          F3                  toggle HAL/REF</span>
<a name="l00495"></a>00495 <span class="comment">//          F8                  toggle wire-frame mode</span>
<a name="l00496"></a>00496 <span class="comment">//          Pause               pause time</span>
<a name="l00497"></a>00497 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l00498"></a><a class="code" href="_d_x_u_t_8h.html#a34">00498</a> <a class="code" href="_d_x_u_tgui_8cpp.html#a51">HRESULT</a> <a class="code" href="_d_x_u_t_8cpp.html#a75">DXUTInit</a>( <span class="keywordtype">bool</span> bParseCommandLine, <span class="keywordtype">bool</span> bHandleDefaultHotkeys, <span class="keywordtype">bool</span> bShowMsgBoxOnError, <span class="keywordtype">bool</span> bHandleAltEnter )
<a name="l00499"></a>00499 {
<a name="l00500"></a>00500     <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetDXUTInitCalled( <span class="keyword">true</span> );
<a name="l00501"></a>00501 
<a name="l00502"></a>00502     <span class="comment">// Not always needed, but lets the app create GDI dialogs</span>
<a name="l00503"></a>00503     InitCommonControls();
<a name="l00504"></a>00504 
<a name="l00505"></a>00505     <span class="comment">// Save the current sticky/toggle/filter key settings so DXUT can restore them later</span>
<a name="l00506"></a>00506     STICKYKEYS sk = {<span class="keyword">sizeof</span>(STICKYKEYS), 0};
<a name="l00507"></a>00507     SystemParametersInfo(SPI_GETSTICKYKEYS, <span class="keyword">sizeof</span>(STICKYKEYS), &amp;sk, 0);
<a name="l00508"></a>00508     <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetStartupStickyKeys( sk );
<a name="l00509"></a>00509 
<a name="l00510"></a>00510     TOGGLEKEYS tk = {<span class="keyword">sizeof</span>(TOGGLEKEYS), 0};
<a name="l00511"></a>00511     SystemParametersInfo(SPI_GETTOGGLEKEYS, <span class="keyword">sizeof</span>(TOGGLEKEYS), &amp;tk, 0);
<a name="l00512"></a>00512     <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetStartupToggleKeys( tk );
<a name="l00513"></a>00513 
<a name="l00514"></a>00514     FILTERKEYS fk = {<span class="keyword">sizeof</span>(FILTERKEYS), 0};
<a name="l00515"></a>00515     SystemParametersInfo(SPI_GETFILTERKEYS, <span class="keyword">sizeof</span>(FILTERKEYS), &amp;fk, 0);
<a name="l00516"></a>00516     <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetStartupFilterKeys( fk );
<a name="l00517"></a>00517 
<a name="l00518"></a>00518     <span class="comment">// Increase the accuracy of Sleep() without needing to link to winmm.lib</span>
<a name="l00519"></a>00519     WCHAR wszPath[MAX_PATH+1];
<a name="l00520"></a>00520     <span class="keywordflow">if</span>( GetSystemDirectory( wszPath, MAX_PATH+1 ) )
<a name="l00521"></a>00521     {
<a name="l00522"></a>00522         StringCchCat( wszPath, MAX_PATH, L<span class="stringliteral">"\\winmm.dll"</span> );
<a name="l00523"></a>00523         HINSTANCE hInstWinMM = LoadLibrary( wszPath );
<a name="l00524"></a>00524         <span class="keywordflow">if</span>( hInstWinMM ) 
<a name="l00525"></a>00525         {
<a name="l00526"></a>00526             <a class="code" href="_d_x_u_t_8cpp.html#a27">LPTIMEBEGINPERIOD</a> pTimeBeginPeriod = (<a class="code" href="_d_x_u_t_8cpp.html#a27">LPTIMEBEGINPERIOD</a>)GetProcAddress( hInstWinMM, <span class="stringliteral">"timeBeginPeriod"</span> );
<a name="l00527"></a>00527             <span class="keywordflow">if</span>( NULL != pTimeBeginPeriod )
<a name="l00528"></a>00528                 pTimeBeginPeriod(1);
<a name="l00529"></a>00529 
<a name="l00530"></a>00530             FreeLibrary(hInstWinMM);
<a name="l00531"></a>00531         }
<a name="l00532"></a>00532     }
<a name="l00533"></a>00533 
<a name="l00534"></a>00534     <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetShowMsgBoxOnError( bShowMsgBoxOnError );
<a name="l00535"></a>00535     <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetHandleDefaultHotkeys( bHandleDefaultHotkeys );
<a name="l00536"></a>00536     <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetHandleAltEnter( bHandleAltEnter );
<a name="l00537"></a>00537 
<a name="l00538"></a>00538     <span class="keywordflow">if</span>( bParseCommandLine )
<a name="l00539"></a>00539         <a class="code" href="_d_x_u_t_8cpp.html#a33">DXUTParseCommandLine</a>();
<a name="l00540"></a>00540 
<a name="l00541"></a>00541     <span class="comment">// Verify D3DX version</span>
<a name="l00542"></a>00542     <span class="keywordflow">if</span>( !D3DXCheckVersion( D3D_SDK_VERSION, D3DX_SDK_VERSION ) )
<a name="l00543"></a>00543     {
<a name="l00544"></a>00544         <a class="code" href="_d_x_u_t_8cpp.html#a52">DXUTDisplayErrorMessage</a>( <a class="code" href="_d_x_u_t_8h.html#a8">DXUTERR_INCORRECTVERSION</a> );
<a name="l00545"></a>00545         <span class="keywordflow">return</span> <a class="code" href="_d_x_u_tmisc_8h.html#a7">DXUT_ERR</a>( L<span class="stringliteral">"D3DXCheckVersion"</span>, <a class="code" href="_d_x_u_t_8h.html#a8">DXUTERR_INCORRECTVERSION</a> );
<a name="l00546"></a>00546     }
<a name="l00547"></a>00547 
<a name="l00548"></a>00548     <span class="comment">// Create a Direct3D object if one has not already been created</span>
<a name="l00549"></a>00549     IDirect3D9* pD3D = <a class="code" href="_d_x_u_t_8cpp.html#a93">DXUTGetD3DObject</a>();
<a name="l00550"></a>00550     <span class="keywordflow">if</span>( pD3D == NULL )
<a name="l00551"></a>00551     {
<a name="l00552"></a>00552         <span class="comment">// This may fail if DirectX 9 isn't installed</span>
<a name="l00553"></a>00553         <span class="comment">// This may fail if the DirectX headers are out of sync with the installed DirectX DLLs</span>
<a name="l00554"></a>00554         pD3D = <a class="code" href="_d_x_u_tmisc_8cpp.html#a32">DXUT_Dynamic_Direct3DCreate9</a>( D3D_SDK_VERSION );
<a name="l00555"></a>00555         <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetD3D( pD3D );
<a name="l00556"></a>00556     }
<a name="l00557"></a>00557 
<a name="l00558"></a>00558     <span class="keywordflow">if</span>( pD3D == NULL )
<a name="l00559"></a>00559     {
<a name="l00560"></a>00560         <span class="comment">// If still NULL, then something went wrong</span>
<a name="l00561"></a>00561         <a class="code" href="_d_x_u_t_8cpp.html#a52">DXUTDisplayErrorMessage</a>( <a class="code" href="_d_x_u_t_8h.html#a0">DXUTERR_NODIRECT3D</a> );
<a name="l00562"></a>00562         <span class="keywordflow">return</span> <a class="code" href="_d_x_u_tmisc_8h.html#a7">DXUT_ERR</a>( L<span class="stringliteral">"Direct3DCreate9"</span>, <a class="code" href="_d_x_u_t_8h.html#a0">DXUTERR_NODIRECT3D</a> );
<a name="l00563"></a>00563     }
<a name="l00564"></a>00564 
<a name="l00565"></a>00565     <span class="comment">// Reset the timer</span>
<a name="l00566"></a>00566     <a class="code" href="_d_x_u_tmisc_8cpp.html#a18">DXUTGetGlobalTimer</a>()-&gt;<a class="code" href="class_c_d_x_u_t_timer.html#a1">Reset</a>();
<a name="l00567"></a>00567 
<a name="l00568"></a>00568     <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetDXUTInited( <span class="keyword">true</span> );
<a name="l00569"></a>00569 
<a name="l00570"></a>00570     <span class="keywordflow">return</span> S_OK;
<a name="l00571"></a>00571 }
<a name="l00572"></a>00572 
<a name="l00573"></a>00573 
<a name="l00574"></a>00574 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l00575"></a>00575 <span class="comment">// Parses the command line for parameters.  See DXUTInit() for list </span>
<a name="l00576"></a>00576 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l00577"></a><a class="code" href="_d_x_u_t_8cpp.html#a33">00577</a> <span class="keywordtype">void</span> <a class="code" href="_d_x_u_t_8cpp.html#a33">DXUTParseCommandLine</a>()
<a name="l00578"></a>00578 {
<a name="l00579"></a>00579     WCHAR* strCmdLine = GetCommandLine();
<a name="l00580"></a>00580 
<a name="l00581"></a>00581     <span class="comment">// Skip past program name (first token in command line).</span>
<a name="l00582"></a>00582     <span class="keywordflow">if</span> (*strCmdLine == L<span class="charliteral">'"'</span>)  <span class="comment">// Check for and handle quoted program name</span>
<a name="l00583"></a>00583     {
<a name="l00584"></a>00584         strCmdLine++;
<a name="l00585"></a>00585 
<a name="l00586"></a>00586         <span class="comment">// Skip over until another double-quote or a null </span>
<a name="l00587"></a>00587         <span class="keywordflow">while</span> (*strCmdLine &amp;&amp; (*strCmdLine != L<span class="charliteral">'"'</span>))
<a name="l00588"></a>00588             strCmdLine++;
<a name="l00589"></a>00589 
<a name="l00590"></a>00590         <span class="comment">// Skip over double-quote</span>
<a name="l00591"></a>00591         <span class="keywordflow">if</span> (*strCmdLine == L<span class="charliteral">'"'</span>)            
<a name="l00592"></a>00592             strCmdLine++;    
<a name="l00593"></a>00593     }
<a name="l00594"></a>00594     <span class="keywordflow">else</span>   
<a name="l00595"></a>00595     {
<a name="l00596"></a>00596         <span class="comment">// First token wasn't a quote</span>
<a name="l00597"></a>00597         <span class="keywordflow">while</span> (*strCmdLine &gt; L<span class="charliteral">' '</span>)
<a name="l00598"></a>00598             strCmdLine++;
<a name="l00599"></a>00599     }
<a name="l00600"></a>00600 
<a name="l00601"></a>00601     <span class="keywordflow">for</span>(;;)
<a name="l00602"></a>00602     {
<a name="l00603"></a>00603         <span class="comment">// Skip past any white space preceding the next token</span>
<a name="l00604"></a>00604         <span class="keywordflow">while</span> (*strCmdLine &amp;&amp; (*strCmdLine &lt;= L<span class="charliteral">' '</span>))
<a name="l00605"></a>00605             strCmdLine++;
<a name="l00606"></a>00606         <span class="keywordflow">if</span>( *strCmdLine == 0 )
<a name="l00607"></a>00607             <span class="keywordflow">break</span>;
<a name="l00608"></a>00608 
<a name="l00609"></a>00609         WCHAR strFlag[256];
<a name="l00610"></a>00610         <span class="keywordtype">int</span> nFlagLen = 0;
<a name="l00611"></a>00611 
<a name="l00612"></a>00612         <span class="comment">// Skip past the flag marker</span>
<a name="l00613"></a>00613         <span class="keywordflow">if</span>( *strCmdLine == L<span class="charliteral">'/'</span> ||
<a name="l00614"></a>00614             *strCmdLine == L<span class="charliteral">'-'</span> )
<a name="l00615"></a>00615             strCmdLine++;
<a name="l00616"></a>00616 
<a name="l00617"></a>00617         <span class="comment">// Compare the first N letters w/o regard to case</span>
<a name="l00618"></a>00618         StringCchCopy( strFlag, 256, L<span class="stringliteral">"adapter"</span> ); nFlagLen = (<a class="code" href="_d_x_u_tgui_8cpp.html#a37">int</a>) wcslen(strFlag);
<a name="l00619"></a>00619         <span class="keywordflow">if</span>( _wcsnicmp( strCmdLine, strFlag, nFlagLen ) == 0 )
<a name="l00620"></a>00620         {
<a name="l00621"></a>00621             <span class="keywordflow">if</span>( <a class="code" href="_d_x_u_t_8cpp.html#a51">DXUTGetCmdParam</a>( strCmdLine, strFlag, nFlagLen ) )
<a name="l00622"></a>00622             {
<a name="l00623"></a>00623                 <span class="keywordtype">int</span> nAdapter = _wtoi(strFlag);
<a name="l00624"></a>00624                 <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetOverrideAdapterOrdinal( nAdapter );
<a name="l00625"></a>00625             }
<a name="l00626"></a>00626             <span class="keywordflow">continue</span>;
<a name="l00627"></a>00627         }
<a name="l00628"></a>00628 
<a name="l00629"></a>00629         StringCchCopy( strFlag, 256, L<span class="stringliteral">"windowed"</span> ); nFlagLen = (<a class="code" href="_d_x_u_tgui_8cpp.html#a37">int</a>) wcslen(strFlag);
<a name="l00630"></a>00630         <span class="keywordflow">if</span>( _wcsnicmp( strCmdLine, strFlag, nFlagLen ) == 0 )
<a name="l00631"></a>00631         {
<a name="l00632"></a>00632             <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetOverrideWindowed( <span class="keyword">true</span> );
<a name="l00633"></a>00633             strCmdLine += nFlagLen;
<a name="l00634"></a>00634             <span class="keywordflow">continue</span>;
<a name="l00635"></a>00635         }
<a name="l00636"></a>00636 
<a name="l00637"></a>00637         StringCchCopy( strFlag, 256, L<span class="stringliteral">"fullscreen"</span> ); nFlagLen = (<a class="code" href="_d_x_u_tgui_8cpp.html#a37">int</a>) wcslen(strFlag);
<a name="l00638"></a>00638         <span class="keywordflow">if</span>( _wcsnicmp( strCmdLine, strFlag, nFlagLen ) == 0 )
<a name="l00639"></a>00639         {
<a name="l00640"></a>00640             <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetOverrideFullScreen( <span class="keyword">true</span> );
<a name="l00641"></a>00641             strCmdLine += nFlagLen;
<a name="l00642"></a>00642             <span class="keywordflow">continue</span>;
<a name="l00643"></a>00643         }
<a name="l00644"></a>00644 
<a name="l00645"></a>00645         StringCchCopy( strFlag, 256, L<span class="stringliteral">"forcehal"</span> ); nFlagLen = (<a class="code" href="_d_x_u_tgui_8cpp.html#a37">int</a>) wcslen(strFlag);
<a name="l00646"></a>00646         <span class="keywordflow">if</span>( _wcsnicmp( strCmdLine, strFlag, nFlagLen ) == 0 )
<a name="l00647"></a>00647         {
<a name="l00648"></a>00648             <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetOverrideForceHAL( <span class="keyword">true</span> );
<a name="l00649"></a>00649             strCmdLine += nFlagLen;
<a name="l00650"></a>00650             <span class="keywordflow">continue</span>;
<a name="l00651"></a>00651         }
<a name="l00652"></a>00652 
<a name="l00653"></a>00653         StringCchCopy( strFlag, 256, L<span class="stringliteral">"forceref"</span> ); nFlagLen = (<a class="code" href="_d_x_u_tgui_8cpp.html#a37">int</a>) wcslen(strFlag);
<a name="l00654"></a>00654         <span class="keywordflow">if</span>( _wcsnicmp( strCmdLine, strFlag, nFlagLen ) == 0 )
<a name="l00655"></a>00655         {
<a name="l00656"></a>00656             <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetOverrideForceREF( <span class="keyword">true</span> );
<a name="l00657"></a>00657             strCmdLine += nFlagLen;
<a name="l00658"></a>00658             <span class="keywordflow">continue</span>;
<a name="l00659"></a>00659         }
<a name="l00660"></a>00660 
<a name="l00661"></a>00661         StringCchCopy( strFlag, 256, L<span class="stringliteral">"forcepurehwvp"</span> ); nFlagLen = (<a class="code" href="_d_x_u_tgui_8cpp.html#a37">int</a>) wcslen(strFlag);
<a name="l00662"></a>00662         <span class="keywordflow">if</span>( _wcsnicmp( strCmdLine, strFlag, nFlagLen ) == 0 )
<a name="l00663"></a>00663         {
<a name="l00664"></a>00664             <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetOverrideForcePureHWVP( <span class="keyword">true</span> );
<a name="l00665"></a>00665             strCmdLine += nFlagLen;
<a name="l00666"></a>00666             <span class="keywordflow">continue</span>;
<a name="l00667"></a>00667         }
<a name="l00668"></a>00668 
<a name="l00669"></a>00669         StringCchCopy( strFlag, 256, L<span class="stringliteral">"forcehwvp"</span> ); nFlagLen = (<a class="code" href="_d_x_u_tgui_8cpp.html#a37">int</a>) wcslen(strFlag);
<a name="l00670"></a>00670         <span class="keywordflow">if</span>( _wcsnicmp( strCmdLine, strFlag, nFlagLen ) == 0 )
<a name="l00671"></a>00671         {
<a name="l00672"></a>00672             <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetOverrideForceHWVP( <span class="keyword">true</span> );
<a name="l00673"></a>00673             strCmdLine += nFlagLen;
<a name="l00674"></a>00674             <span class="keywordflow">continue</span>;
<a name="l00675"></a>00675         }
<a name="l00676"></a>00676 
<a name="l00677"></a>00677         StringCchCopy( strFlag, 256, L<span class="stringliteral">"forceswvp"</span> ); nFlagLen = (<a class="code" href="_d_x_u_tgui_8cpp.html#a37">int</a>) wcslen(strFlag);
<a name="l00678"></a>00678         <span class="keywordflow">if</span>( _wcsnicmp( strCmdLine, strFlag, nFlagLen ) == 0 )
<a name="l00679"></a>00679         {
<a name="l00680"></a>00680             <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetOverrideForceSWVP( <span class="keyword">true</span> );
<a name="l00681"></a>00681             strCmdLine += nFlagLen;
<a name="l00682"></a>00682             <span class="keywordflow">continue</span>;
<a name="l00683"></a>00683         }
<a name="l00684"></a>00684 
<a name="l00685"></a>00685         StringCchCopy( strFlag, 256, L<span class="stringliteral">"width"</span> ); nFlagLen = (<a class="code" href="_d_x_u_tgui_8cpp.html#a37">int</a>) wcslen(strFlag);
<a name="l00686"></a>00686         <span class="keywordflow">if</span>( _wcsnicmp( strCmdLine, strFlag, nFlagLen ) == 0 )
<a name="l00687"></a>00687         {
<a name="l00688"></a>00688             <span class="keywordflow">if</span>( <a class="code" href="_d_x_u_t_8cpp.html#a51">DXUTGetCmdParam</a>( strCmdLine, strFlag, nFlagLen ) )
<a name="l00689"></a>00689             {
<a name="l00690"></a>00690                 <span class="keywordtype">int</span> nWidth = _wtoi(strFlag);
<a name="l00691"></a>00691                 <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetOverrideWidth( nWidth );
<a name="l00692"></a>00692             }
<a name="l00693"></a>00693             <span class="keywordflow">continue</span>;
<a name="l00694"></a>00694         }
<a name="l00695"></a>00695 
<a name="l00696"></a>00696         StringCchCopy( strFlag, 256, L<span class="stringliteral">"height"</span> ); nFlagLen = (<a class="code" href="_d_x_u_tgui_8cpp.html#a37">int</a>) wcslen(strFlag);
<a name="l00697"></a>00697         <span class="keywordflow">if</span>( _wcsnicmp( strCmdLine, strFlag, nFlagLen ) == 0 )
<a name="l00698"></a>00698         {
<a name="l00699"></a>00699             <span class="keywordflow">if</span>( <a class="code" href="_d_x_u_t_8cpp.html#a51">DXUTGetCmdParam</a>( strCmdLine, strFlag, nFlagLen ) )
<a name="l00700"></a>00700             {
<a name="l00701"></a>00701                 <span class="keywordtype">int</span> nHeight = _wtoi(strFlag);
<a name="l00702"></a>00702                 <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetOverrideHeight( nHeight );
<a name="l00703"></a>00703             }
<a name="l00704"></a>00704             <span class="keywordflow">continue</span>;
<a name="l00705"></a>00705         }
<a name="l00706"></a>00706 
<a name="l00707"></a>00707         StringCchCopy( strFlag, 256, L<span class="stringliteral">"startx"</span> );
<a name="l00708"></a>00708         nFlagLen = (<a class="code" href="_d_x_u_tgui_8cpp.html#a37">int</a>) wcslen(strFlag);
<a name="l00709"></a>00709         <span class="keywordflow">if</span>( _wcsnicmp( strCmdLine, strFlag, nFlagLen ) == 0 )
<a name="l00710"></a>00710         {
<a name="l00711"></a>00711             <span class="keywordflow">if</span>( <a class="code" href="_d_x_u_t_8cpp.html#a51">DXUTGetCmdParam</a>( strCmdLine, strFlag, nFlagLen ) )
<a name="l00712"></a>00712             {
<a name="l00713"></a>00713                 <span class="keywordtype">int</span> nX = _wtoi(strFlag);
<a name="l00714"></a>00714                 <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetOverrideStartX( nX );
<a name="l00715"></a>00715             }
<a name="l00716"></a>00716             <span class="keywordflow">continue</span>;
<a name="l00717"></a>00717         }
<a name="l00718"></a>00718 
<a name="l00719"></a>00719         StringCchCopy( strFlag, 256, L<span class="stringliteral">"starty"</span> );
<a name="l00720"></a>00720         nFlagLen = (<a class="code" href="_d_x_u_tgui_8cpp.html#a37">int</a>) wcslen(strFlag);
<a name="l00721"></a>00721         <span class="keywordflow">if</span>( _wcsnicmp( strCmdLine, strFlag, nFlagLen ) == 0 )
<a name="l00722"></a>00722         {
<a name="l00723"></a>00723             <span class="keywordflow">if</span>( <a class="code" href="_d_x_u_t_8cpp.html#a51">DXUTGetCmdParam</a>( strCmdLine, strFlag, nFlagLen ) )
<a name="l00724"></a>00724             {
<a name="l00725"></a>00725                 <span class="keywordtype">int</span> nY = _wtoi(strFlag);
<a name="l00726"></a>00726                 <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetOverrideStartY( nY );
<a name="l00727"></a>00727             }
<a name="l00728"></a>00728             <span class="keywordflow">continue</span>;
<a name="l00729"></a>00729         }
<a name="l00730"></a>00730 
<a name="l00731"></a>00731         StringCchCopy( strFlag, 256, L<span class="stringliteral">"constantframetime"</span> ); nFlagLen = (<a class="code" href="_d_x_u_tgui_8cpp.html#a37">int</a>) wcslen(strFlag);
<a name="l00732"></a>00732         <span class="keywordflow">if</span>( _wcsnicmp( strCmdLine, strFlag, nFlagLen ) == 0 )
<a name="l00733"></a>00733         {
<a name="l00734"></a>00734             <span class="keywordtype">float</span> fTimePerFrame;
<a name="l00735"></a>00735             <span class="keywordflow">if</span>( <a class="code" href="_d_x_u_t_8cpp.html#a51">DXUTGetCmdParam</a>( strCmdLine, strFlag, nFlagLen ) )
<a name="l00736"></a>00736                 fTimePerFrame = (float)wcstod( strFlag, NULL );
<a name="l00737"></a>00737             <span class="keywordflow">else</span>
<a name="l00738"></a>00738                 fTimePerFrame = 0.0333f;
<a name="l00739"></a>00739             <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetOverrideConstantFrameTime( <span class="keyword">true</span> );
<a name="l00740"></a>00740             <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetOverrideConstantTimePerFrame( fTimePerFrame );
<a name="l00741"></a>00741             <a class="code" href="_d_x_u_t_8cpp.html#a123">DXUTSetConstantFrameTime</a>( <span class="keyword">true</span>, fTimePerFrame );
<a name="l00742"></a>00742             <span class="keywordflow">continue</span>;
<a name="l00743"></a>00743         }
<a name="l00744"></a>00744 
<a name="l00745"></a>00745         StringCchCopy( strFlag, 256, L<span class="stringliteral">"quitafterframe"</span> ); nFlagLen = (<a class="code" href="_d_x_u_tgui_8cpp.html#a37">int</a>) wcslen(strFlag);
<a name="l00746"></a>00746         <span class="keywordflow">if</span>( _wcsnicmp( strCmdLine, strFlag, nFlagLen ) == 0 )
<a name="l00747"></a>00747         {
<a name="l00748"></a>00748             <span class="keywordflow">if</span>( <a class="code" href="_d_x_u_t_8cpp.html#a51">DXUTGetCmdParam</a>( strCmdLine, strFlag, nFlagLen ) )
<a name="l00749"></a>00749             {
<a name="l00750"></a>00750                 <span class="keywordtype">int</span> nFrame = _wtoi(strFlag);
<a name="l00751"></a>00751                 <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetOverrideQuitAfterFrame( nFrame );
<a name="l00752"></a>00752             }
<a name="l00753"></a>00753             <span class="keywordflow">continue</span>;
<a name="l00754"></a>00754         }      
<a name="l00755"></a>00755         
<a name="l00756"></a>00756         StringCchCopy( strFlag, 256, L<span class="stringliteral">"noerrormsgboxes"</span> ); nFlagLen = (<a class="code" href="_d_x_u_tgui_8cpp.html#a37">int</a>) wcslen(strFlag);
<a name="l00757"></a>00757         <span class="keywordflow">if</span>( _wcsnicmp( strCmdLine, strFlag, nFlagLen ) == 0 )
<a name="l00758"></a>00758         {
<a name="l00759"></a>00759             <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetShowMsgBoxOnError( <span class="keyword">false</span> );
<a name="l00760"></a>00760             strCmdLine += nFlagLen;
<a name="l00761"></a>00761             <span class="keywordflow">continue</span>;
<a name="l00762"></a>00762         }        
<a name="l00763"></a>00763 
<a name="l00764"></a>00764         StringCchCopy( strFlag, 256, L<span class="stringliteral">"automation"</span> ); nFlagLen = (<a class="code" href="_d_x_u_tgui_8cpp.html#a37">int</a>) wcslen(strFlag);
<a name="l00765"></a>00765         <span class="keywordflow">if</span>( _wcsnicmp( strCmdLine, strFlag, nFlagLen ) == 0 )
<a name="l00766"></a>00766         {
<a name="l00767"></a>00767             <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetAutomation( <span class="keyword">true</span> );
<a name="l00768"></a>00768             strCmdLine += nFlagLen;
<a name="l00769"></a>00769             <span class="keywordflow">continue</span>;
<a name="l00770"></a>00770         }
<a name="l00771"></a>00771 
<a name="l00772"></a>00772         <span class="comment">// Unrecognized flag</span>
<a name="l00773"></a>00773         StringCchCopy( strFlag, 256, strCmdLine ); 
<a name="l00774"></a>00774         WCHAR* strSpace = strFlag;
<a name="l00775"></a>00775         <span class="keywordflow">while</span> (*strSpace &amp;&amp; (*strSpace &gt; L<span class="charliteral">' '</span>))
<a name="l00776"></a>00776             strSpace++;
<a name="l00777"></a>00777         *strSpace = 0;
<a name="l00778"></a>00778 
<a name="l00779"></a>00779         <a class="code" href="_d_x_u_tmisc_8h.html#a6">DXUTOutputDebugString</a>( L<span class="stringliteral">"Unrecognized flag: %s"</span>, strFlag );
<a name="l00780"></a>00780         strCmdLine += wcslen(strFlag);
<a name="l00781"></a>00781     }
<a name="l00782"></a>00782 }
<a name="l00783"></a>00783 
<a name="l00784"></a>00784 
<a name="l00785"></a>00785 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l00786"></a>00786 <span class="comment">// Helper function for DXUTParseCommandLine.  Updates strCmdLine and strFlag </span>
<a name="l00787"></a>00787 <span class="comment">//      Example: if strCmdLine=="-width:1024 -forceref"</span>
<a name="l00788"></a>00788 <span class="comment">// then after: strCmdLine==" -forceref" and strFlag=="1024"</span>
<a name="l00789"></a>00789 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l00790"></a><a class="code" href="_d_x_u_t_8cpp.html#a51">00790</a> <span class="keywordtype">bool</span> <a class="code" href="_d_x_u_t_8cpp.html#a51">DXUTGetCmdParam</a>( WCHAR*&amp; strCmdLine, WCHAR* strFlag, <span class="keywordtype">int</span> nFlagLen )
<a name="l00791"></a>00791 {
<a name="l00792"></a>00792     strCmdLine += nFlagLen;
<a name="l00793"></a>00793     <span class="keywordflow">if</span>( *strCmdLine == L<span class="charliteral">':'</span> )
<a name="l00794"></a>00794     {       
<a name="l00795"></a>00795         strCmdLine++; <span class="comment">// Skip ':'</span>
<a name="l00796"></a>00796 
<a name="l00797"></a>00797         <span class="comment">// Place NULL terminator in strFlag after current token</span>
<a name="l00798"></a>00798         StringCchCopy( strFlag, 256, strCmdLine );
<a name="l00799"></a>00799         WCHAR* strSpace = strFlag;
<a name="l00800"></a>00800         <span class="keywordflow">while</span> (*strSpace &amp;&amp; (*strSpace &gt; L<span class="charliteral">' '</span>))
<a name="l00801"></a>00801             strSpace++;
<a name="l00802"></a>00802         *strSpace = 0;
<a name="l00803"></a>00803     
<a name="l00804"></a>00804         <span class="comment">// Update strCmdLine</span>
<a name="l00805"></a>00805         strCmdLine += wcslen(strFlag);
<a name="l00806"></a>00806         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00807"></a>00807     }
<a name="l00808"></a>00808     <span class="keywordflow">else</span>
<a name="l00809"></a>00809     {
<a name="l00810"></a>00810         strFlag[0] = 0;
<a name="l00811"></a>00811         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00812"></a>00812     }
<a name="l00813"></a>00813 }
<a name="l00814"></a>00814 
<a name="l00815"></a>00815 
<a name="l00816"></a>00816 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l00817"></a>00817 <span class="comment">// Creates a window with the specified window title, icon, menu, and </span>
<a name="l00818"></a>00818 <span class="comment">// starting position.  If DXUTInit() has not already been called, it will</span>
<a name="l00819"></a>00819 <span class="comment">// call it with the default parameters.  Instead of calling this, you can </span>
<a name="l00820"></a>00820 <span class="comment">// call DXUTSetWindow() to use an existing window.  </span>
<a name="l00821"></a>00821 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l00822"></a><a class="code" href="_d_x_u_t_8h.html#a35">00822</a> <a class="code" href="_d_x_u_tgui_8cpp.html#a51">HRESULT</a> <a class="code" href="_d_x_u_t_8cpp.html#a76">DXUTCreateWindow</a>( <span class="keyword">const</span> WCHAR* strWindowTitle, HINSTANCE hInstance, 
<a name="l00823"></a>00823                           HICON hIcon, HMENU hMenu, <span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y )
<a name="l00824"></a>00824 {
<a name="l00825"></a>00825     <a class="code" href="_d_x_u_tgui_8cpp.html#a51">HRESULT</a> hr;
<a name="l00826"></a>00826 
<a name="l00827"></a>00827     <span class="comment">// Not allowed to call this from inside the device callbacks</span>
<a name="l00828"></a>00828     <span class="keywordflow">if</span>( <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetInsideDeviceCallback() )
<a name="l00829"></a>00829         <span class="keywordflow">return</span> <a class="code" href="_d_x_u_tmisc_8h.html#a8">DXUT_ERR_MSGBOX</a>( L<span class="stringliteral">"DXUTCreateWindow"</span>, E_FAIL );
<a name="l00830"></a>00830 
<a name="l00831"></a>00831     <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetWindowCreateCalled( <span class="keyword">true</span> );
<a name="l00832"></a>00832 
<a name="l00833"></a>00833     <span class="keywordflow">if</span>( !<a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetDXUTInited() ) 
<a name="l00834"></a>00834     {
<a name="l00835"></a>00835         <span class="comment">// If DXUTInit() was already called and failed, then fail.</span>
<a name="l00836"></a>00836         <span class="comment">// DXUTInit() must first succeed for this function to succeed</span>
<a name="l00837"></a>00837         <span class="keywordflow">if</span>( <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetDXUTInitCalled() )
<a name="l00838"></a>00838             <span class="keywordflow">return</span> E_FAIL; 
<a name="l00839"></a>00839 
<a name="l00840"></a>00840         <span class="comment">// If DXUTInit() hasn't been called, then automatically call it</span>
<a name="l00841"></a>00841         <span class="comment">// with default params</span>
<a name="l00842"></a>00842         hr = <a class="code" href="_d_x_u_t_8cpp.html#a75">DXUTInit</a>();
<a name="l00843"></a>00843         <span class="keywordflow">if</span>( FAILED(hr) )
<a name="l00844"></a>00844             <span class="keywordflow">return</span> hr;
<a name="l00845"></a>00845     }
<a name="l00846"></a>00846 
<a name="l00847"></a>00847     <span class="keywordflow">if</span>( <a class="code" href="_d_x_u_t_8cpp.html#a99">DXUTGetHWNDFocus</a>() == NULL )
<a name="l00848"></a>00848     {
<a name="l00849"></a>00849         <span class="keywordflow">if</span>( hInstance == NULL ) 
<a name="l00850"></a>00850             hInstance = (HINSTANCE)GetModuleHandle(NULL);
<a name="l00851"></a>00851         <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetHInstance( hInstance );
<a name="l00852"></a>00852 
<a name="l00853"></a>00853         WCHAR szExePath[MAX_PATH];
<a name="l00854"></a>00854         GetModuleFileName( NULL, szExePath, MAX_PATH );
<a name="l00855"></a>00855         <span class="keywordflow">if</span>( hIcon == NULL ) <span class="comment">// If the icon is NULL, then use the first one found in the exe</span>
<a name="l00856"></a>00856             hIcon = ExtractIcon( hInstance, szExePath, 0 ); 
<a name="l00857"></a>00857 
<a name="l00858"></a>00858         <span class="comment">// Register the windows class</span>
<a name="l00859"></a>00859         WNDCLASS wndClass;
<a name="l00860"></a>00860         wndClass.style = CS_DBLCLKS;
<a name="l00861"></a>00861         wndClass.lpfnWndProc = <a class="code" href="_d_x_u_t_8cpp.html#a53">DXUTStaticWndProc</a>;
<a name="l00862"></a>00862         wndClass.cbClsExtra = 0;
<a name="l00863"></a>00863         wndClass.cbWndExtra = 0;
<a name="l00864"></a>00864         wndClass.hInstance = hInstance;
<a name="l00865"></a>00865         wndClass.hIcon = hIcon;
<a name="l00866"></a>00866         wndClass.hCursor = LoadCursor( NULL, IDC_ARROW );
<a name="l00867"></a>00867         wndClass.hbrBackground = (HBRUSH)GetStockObject(BLACK_BRUSH);
<a name="l00868"></a>00868         wndClass.lpszMenuName = NULL;
<a name="l00869"></a>00869         wndClass.lpszClassName = L<span class="stringliteral">"Direct3DWindowClass"</span>;
<a name="l00870"></a>00870 
<a name="l00871"></a>00871         <span class="keywordflow">if</span>( !RegisterClass( &amp;wndClass ) )
<a name="l00872"></a>00872         {
<a name="l00873"></a>00873             <a class="code" href="_d_x_u_tgui_8cpp.html#a38">DWORD</a> dwError = GetLastError();
<a name="l00874"></a>00874             <span class="keywordflow">if</span>( dwError != ERROR_CLASS_ALREADY_EXISTS )
<a name="l00875"></a>00875                 <span class="keywordflow">return</span> <a class="code" href="_d_x_u_tmisc_8h.html#a8">DXUT_ERR_MSGBOX</a>( L<span class="stringliteral">"RegisterClass"</span>, HRESULT_FROM_WIN32(dwError) );
<a name="l00876"></a>00876         }
<a name="l00877"></a>00877 
<a name="l00878"></a>00878         RECT rc;
<a name="l00879"></a>00879         <span class="comment">// Override the window's initial &amp; size position if there were cmd line args</span>
<a name="l00880"></a>00880         <span class="keywordflow">if</span>( <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetOverrideStartX() != -1 )
<a name="l00881"></a>00881             x = <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetOverrideStartX();
<a name="l00882"></a>00882         <span class="keywordflow">if</span>( <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetOverrideStartY() != -1 )
<a name="l00883"></a>00883             y = <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetOverrideStartY();
<a name="l00884"></a>00884 
<a name="l00885"></a>00885         <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetWindowCreatedWithDefaultPositions( <span class="keyword">false</span> );
<a name="l00886"></a>00886         <span class="keywordflow">if</span>( x == CW_USEDEFAULT &amp;&amp; y == CW_USEDEFAULT )
<a name="l00887"></a>00887             <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetWindowCreatedWithDefaultPositions( <span class="keyword">true</span> );
<a name="l00888"></a>00888 
<a name="l00889"></a>00889         <span class="comment">// Find the window's initial size, but it might be changed later</span>
<a name="l00890"></a>00890         <span class="keywordtype">int</span> nDefaultWidth = 640;
<a name="l00891"></a>00891         <span class="keywordtype">int</span> nDefaultHeight = 480;
<a name="l00892"></a>00892         <span class="keywordflow">if</span>( <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetOverrideWidth() != 0 )
<a name="l00893"></a>00893             nDefaultWidth = <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetOverrideWidth();
<a name="l00894"></a>00894         <span class="keywordflow">if</span>( <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetOverrideHeight() != 0 )
<a name="l00895"></a>00895             nDefaultHeight = <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetOverrideHeight();
<a name="l00896"></a>00896         SetRect( &amp;rc, 0, 0, nDefaultWidth, nDefaultHeight );        
<a name="l00897"></a>00897         AdjustWindowRect( &amp;rc, WS_OVERLAPPEDWINDOW, ( hMenu != NULL ) ? <span class="keyword">true</span> : <span class="keyword">false</span> );
<a name="l00898"></a>00898 
<a name="l00899"></a>00899         WCHAR* strCachedWindowTitle = <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetWindowTitle();
<a name="l00900"></a>00900         StringCchCopy( strCachedWindowTitle, 256, strWindowTitle );
<a name="l00901"></a>00901 
<a name="l00902"></a>00902         <span class="comment">// Create the render window</span>
<a name="l00903"></a>00903         <a class="code" href="_d_x_u_tgui_8cpp.html#a53">HWND</a> hWnd = CreateWindow( L<span class="stringliteral">"Direct3DWindowClass"</span>, strWindowTitle, WS_OVERLAPPEDWINDOW,
<a name="l00904"></a>00904                                x, y, (rc.right-rc.left), (rc.bottom-rc.top), 0,
<a name="l00905"></a>00905                                hMenu, hInstance, 0 );
<a name="l00906"></a>00906         <span class="keywordflow">if</span>( hWnd == NULL )
<a name="l00907"></a>00907         {
<a name="l00908"></a>00908             <a class="code" href="_d_x_u_tgui_8cpp.html#a38">DWORD</a> dwError = GetLastError();
<a name="l00909"></a>00909             <span class="keywordflow">return</span> <a class="code" href="_d_x_u_tmisc_8h.html#a8">DXUT_ERR_MSGBOX</a>( L<span class="stringliteral">"CreateWindow"</span>, HRESULT_FROM_WIN32(dwError) );
<a name="l00910"></a>00910         }
<a name="l00911"></a>00911 
<a name="l00912"></a>00912         <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetWindowCreated( <span class="keyword">true</span> );
<a name="l00913"></a>00913         <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetHWNDFocus( hWnd );
<a name="l00914"></a>00914         <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetHWNDDeviceFullScreen( hWnd );
<a name="l00915"></a>00915         <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetHWNDDeviceWindowed( hWnd );
<a name="l00916"></a>00916     }
<a name="l00917"></a>00917 
<a name="l00918"></a>00918     <span class="keywordflow">return</span> S_OK;
<a name="l00919"></a>00919 }
<a name="l00920"></a>00920 
<a name="l00921"></a>00921 
<a name="l00922"></a>00922 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l00923"></a>00923 <span class="comment">// Sets a previously created window for the framework to use.  If DXUTInit() </span>
<a name="l00924"></a>00924 <span class="comment">// has not already been called, it will call it with the default parameters.  </span>
<a name="l00925"></a>00925 <span class="comment">// Instead of calling this, you can call DXUTCreateWindow() to create a new window.  </span>
<a name="l00926"></a>00926 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l00927"></a><a class="code" href="_d_x_u_t_8h.html#a36">00927</a> <a class="code" href="_d_x_u_tgui_8cpp.html#a51">HRESULT</a> <a class="code" href="_d_x_u_t_8cpp.html#a77">DXUTSetWindow</a>( <a class="code" href="_d_x_u_tgui_8cpp.html#a53">HWND</a> hWndFocus, <a class="code" href="_d_x_u_tgui_8cpp.html#a53">HWND</a> hWndDeviceFullScreen, <a class="code" href="_d_x_u_tgui_8cpp.html#a53">HWND</a> hWndDeviceWindowed, <span class="keywordtype">bool</span> bHandleMessages )
<a name="l00928"></a>00928 {
<a name="l00929"></a>00929     <a class="code" href="_d_x_u_tgui_8cpp.html#a51">HRESULT</a> hr;
<a name="l00930"></a>00930  
<a name="l00931"></a>00931     <span class="comment">// Not allowed to call this from inside the device callbacks</span>
<a name="l00932"></a>00932     <span class="keywordflow">if</span>( <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetInsideDeviceCallback() )
<a name="l00933"></a>00933         <span class="keywordflow">return</span> <a class="code" href="_d_x_u_tmisc_8h.html#a8">DXUT_ERR_MSGBOX</a>( L<span class="stringliteral">"DXUTCreateWindow"</span>, E_FAIL );
<a name="l00934"></a>00934 
<a name="l00935"></a>00935     <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetWindowCreateCalled( <span class="keyword">true</span> );
<a name="l00936"></a>00936 
<a name="l00937"></a>00937     <span class="comment">// To avoid confusion, we do not allow any HWND to be NULL here.  The</span>
<a name="l00938"></a>00938     <span class="comment">// caller must pass in valid HWND for all three parameters.  The same</span>
<a name="l00939"></a>00939     <span class="comment">// HWND may be used for more than one parameter.</span>
<a name="l00940"></a>00940     <span class="keywordflow">if</span>( hWndFocus == NULL || hWndDeviceFullScreen == NULL || hWndDeviceWindowed == NULL )
<a name="l00941"></a>00941         <span class="keywordflow">return</span> <a class="code" href="_d_x_u_tmisc_8h.html#a8">DXUT_ERR_MSGBOX</a>( L<span class="stringliteral">"DXUTSetWindow"</span>, E_INVALIDARG );
<a name="l00942"></a>00942 
<a name="l00943"></a>00943     <span class="comment">// If subclassing the window, set the pointer to the local window procedure</span>
<a name="l00944"></a>00944     <span class="keywordflow">if</span>( bHandleMessages )
<a name="l00945"></a>00945     {
<a name="l00946"></a>00946         <span class="comment">// Switch window procedures</span>
<a name="l00947"></a>00947 <span class="preprocessor">#ifdef _WIN64</span>
<a name="l00948"></a>00948 <span class="preprocessor"></span>        LONG_PTR nResult = SetWindowLongPtr( hWndFocus, GWLP_WNDPROC, (LONG_PTR)<a class="code" href="_d_x_u_t_8cpp.html#a53">DXUTStaticWndProc</a> );
<a name="l00949"></a>00949 <span class="preprocessor">#else</span>
<a name="l00950"></a>00950 <span class="preprocessor"></span>        LONG_PTR nResult = SetWindowLongPtr( hWndFocus, GWLP_WNDPROC, (<a class="code" href="_d_x_u_tgui_8cpp.html#a52">LONG</a>)(LONG_PTR)DXUTStaticWndProc );
<a name="l00951"></a>00951 <span class="preprocessor">#endif </span>
<a name="l00952"></a>00952 <span class="preprocessor"></span> 
<a name="l00953"></a>00953         <a class="code" href="_d_x_u_tgui_8cpp.html#a38">DWORD</a> dwError = GetLastError();
<a name="l00954"></a>00954         <span class="keywordflow">if</span>( nResult == 0 )
<a name="l00955"></a>00955             <span class="keywordflow">return</span> <a class="code" href="_d_x_u_tmisc_8h.html#a8">DXUT_ERR_MSGBOX</a>( L<span class="stringliteral">"SetWindowLongPtr"</span>, HRESULT_FROM_WIN32(dwError) );
<a name="l00956"></a>00956     }
<a name="l00957"></a>00957  
<a name="l00958"></a>00958     <span class="keywordflow">if</span>( !<a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetDXUTInited() ) 
<a name="l00959"></a>00959     {
<a name="l00960"></a>00960         <span class="comment">// If DXUTInit() was already called and failed, then fail.</span>
<a name="l00961"></a>00961         <span class="comment">// DXUTInit() must first succeed for this function to succeed</span>
<a name="l00962"></a>00962         <span class="keywordflow">if</span>( <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetDXUTInitCalled() )
<a name="l00963"></a>00963             <span class="keywordflow">return</span> E_FAIL; 
<a name="l00964"></a>00964  
<a name="l00965"></a>00965         <span class="comment">// If DXUTInit() hasn't been called, then automatically call it</span>
<a name="l00966"></a>00966         <span class="comment">// with default params</span>
<a name="l00967"></a>00967         hr = <a class="code" href="_d_x_u_t_8cpp.html#a75">DXUTInit</a>();
<a name="l00968"></a>00968         <span class="keywordflow">if</span>( FAILED(hr) )
<a name="l00969"></a>00969             <span class="keywordflow">return</span> hr;
<a name="l00970"></a>00970     }
<a name="l00971"></a>00971  
<a name="l00972"></a>00972     WCHAR* strCachedWindowTitle = <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetWindowTitle();
<a name="l00973"></a>00973     GetWindowText( hWndFocus, strCachedWindowTitle, 255 );
<a name="l00974"></a>00974     strCachedWindowTitle[255] = 0;
<a name="l00975"></a>00975    
<a name="l00976"></a>00976     HINSTANCE hInstance = (HINSTANCE) (LONG_PTR) GetWindowLongPtr( hWndFocus, GWLP_HINSTANCE ); 
<a name="l00977"></a>00977     <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetHInstance( hInstance );
<a name="l00978"></a>00978     <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetWindowCreatedWithDefaultPositions( <span class="keyword">false</span> );
<a name="l00979"></a>00979     <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetWindowCreated( <span class="keyword">true</span> );
<a name="l00980"></a>00980     <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetHWNDFocus( hWndFocus );
<a name="l00981"></a>00981     <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetHWNDDeviceFullScreen( hWndDeviceFullScreen );
<a name="l00982"></a>00982     <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetHWNDDeviceWindowed( hWndDeviceWindowed );
<a name="l00983"></a>00983 
<a name="l00984"></a>00984     <span class="keywordflow">return</span> S_OK;
<a name="l00985"></a>00985 }
<a name="l00986"></a>00986 
<a name="l00987"></a>00987 
<a name="l00988"></a>00988 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l00989"></a>00989 <span class="comment">// Creates a Direct3D device. If DXUTCreateWindow() or DXUTSetWindow() has not already </span>
<a name="l00990"></a>00990 <span class="comment">// been called, it will call DXUTCreateWindow() with the default parameters.  </span>
<a name="l00991"></a>00991 <span class="comment">// Instead of calling this, you can call DXUTSetDevice() or DXUTCreateDeviceFromSettings() </span>
<a name="l00992"></a>00992 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l00993"></a><a class="code" href="_d_x_u_t_8h.html#a38">00993</a> <a class="code" href="_d_x_u_tgui_8cpp.html#a51">HRESULT</a> <a class="code" href="_d_x_u_t_8cpp.html#a78">DXUTCreateDevice</a>( <a class="code" href="_d_x_u_tgui_8cpp.html#a45">UINT</a> AdapterOrdinal, <span class="keywordtype">bool</span> bWindowed, 
<a name="l00994"></a>00994                           <span class="keywordtype">int</span> nSuggestedWidth, <span class="keywordtype">int</span> nSuggestedHeight,
<a name="l00995"></a>00995                           <a class="code" href="_d_x_u_t_8h.html#a9">LPDXUTCALLBACKISDEVICEACCEPTABLE</a> pCallbackIsDeviceAcceptable,
<a name="l00996"></a>00996                           <a class="code" href="_d_x_u_t_8h.html#a10">LPDXUTCALLBACKMODIFYDEVICESETTINGS</a> pCallbackModifyDeviceSettings,
<a name="l00997"></a>00997                           <span class="keywordtype">void</span>* <a class="code" href="_d_x_u_tgui_8h.html#a14">pUserContext</a> )
<a name="l00998"></a>00998 {
<a name="l00999"></a>00999     <a class="code" href="_d_x_u_tgui_8cpp.html#a51">HRESULT</a> hr;
<a name="l01000"></a>01000 
<a name="l01001"></a>01001     <span class="comment">// Not allowed to call this from inside the device callbacks</span>
<a name="l01002"></a>01002     <span class="keywordflow">if</span>( <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetInsideDeviceCallback() )
<a name="l01003"></a>01003         <span class="keywordflow">return</span> <a class="code" href="_d_x_u_tmisc_8h.html#a8">DXUT_ERR_MSGBOX</a>( L<span class="stringliteral">"DXUTCreateWindow"</span>, E_FAIL );
<a name="l01004"></a>01004 
<a name="l01005"></a>01005     <span class="comment">// Record the function arguments in the global state </span>
<a name="l01006"></a>01006     <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetIsDeviceAcceptableFunc( pCallbackIsDeviceAcceptable );
<a name="l01007"></a>01007     <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetModifyDeviceSettingsFunc( pCallbackModifyDeviceSettings );
<a name="l01008"></a>01008     <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetIsDeviceAcceptableFuncUserContext( pUserContext );
<a name="l01009"></a>01009     <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetModifyDeviceSettingsFuncUserContext( pUserContext );
<a name="l01010"></a>01010 
<a name="l01011"></a>01011     <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetDeviceCreateCalled( <span class="keyword">true</span> );
<a name="l01012"></a>01012 
<a name="l01013"></a>01013     <span class="comment">// If DXUTCreateWindow() or DXUTSetWindow() has not already been called, </span>
<a name="l01014"></a>01014     <span class="comment">// then call DXUTCreateWindow() with the default parameters.         </span>
<a name="l01015"></a>01015     <span class="keywordflow">if</span>( !<a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetWindowCreated() ) 
<a name="l01016"></a>01016     {
<a name="l01017"></a>01017         <span class="comment">// If DXUTCreateWindow() or DXUTSetWindow() was already called and failed, then fail.</span>
<a name="l01018"></a>01018         <span class="comment">// DXUTCreateWindow() or DXUTSetWindow() must first succeed for this function to succeed</span>
<a name="l01019"></a>01019         <span class="keywordflow">if</span>( <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetWindowCreateCalled() )
<a name="l01020"></a>01020             <span class="keywordflow">return</span> E_FAIL; 
<a name="l01021"></a>01021 
<a name="l01022"></a>01022         <span class="comment">// If DXUTCreateWindow() or DXUTSetWindow() hasn't been called, then </span>
<a name="l01023"></a>01023         <span class="comment">// automatically call DXUTCreateWindow() with default params</span>
<a name="l01024"></a>01024         hr = <a class="code" href="_d_x_u_t_8cpp.html#a76">DXUTCreateWindow</a>();
<a name="l01025"></a>01025         <span class="keywordflow">if</span>( FAILED(hr) )
<a name="l01026"></a>01026             <span class="keywordflow">return</span> hr;
<a name="l01027"></a>01027     }
<a name="l01028"></a>01028 
<a name="l01029"></a>01029     <span class="comment">// Force an enumeration with the new IsDeviceAcceptable callback</span>
<a name="l01030"></a>01030     <a class="code" href="_d_x_u_t_8cpp.html#a34">DXUTPrepareEnumerationObject</a>( <span class="keyword">true</span> );
<a name="l01031"></a>01031 
<a name="l01032"></a>01032     <a class="code" href="struct_d_x_u_t_match_options.html">DXUTMatchOptions</a> matchOptions;
<a name="l01033"></a>01033     matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o0">eAdapterOrdinal</a>     = <a class="code" href="_d_x_u_t_8h.html#a87a22">DXUTMT_PRESERVE_INPUT</a>;
<a name="l01034"></a>01034     matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o1">eDeviceType</a>         = <a class="code" href="_d_x_u_t_8h.html#a87a21">DXUTMT_IGNORE_INPUT</a>;
<a name="l01035"></a>01035     matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o2">eWindowed</a>           = <a class="code" href="_d_x_u_t_8h.html#a87a22">DXUTMT_PRESERVE_INPUT</a>;
<a name="l01036"></a>01036     matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o3">eAdapterFormat</a>      = <a class="code" href="_d_x_u_t_8h.html#a87a21">DXUTMT_IGNORE_INPUT</a>;
<a name="l01037"></a>01037     matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o4">eVertexProcessing</a>   = <a class="code" href="_d_x_u_t_8h.html#a87a21">DXUTMT_IGNORE_INPUT</a>;
<a name="l01038"></a>01038     matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o5">eResolution</a>         = <a class="code" href="_d_x_u_t_8h.html#a87a23">DXUTMT_CLOSEST_TO_INPUT</a>;
<a name="l01039"></a>01039     matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o6">eBackBufferFormat</a>   = <a class="code" href="_d_x_u_t_8h.html#a87a21">DXUTMT_IGNORE_INPUT</a>;
<a name="l01040"></a>01040     matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o7">eBackBufferCount</a>    = <a class="code" href="_d_x_u_t_8h.html#a87a21">DXUTMT_IGNORE_INPUT</a>;
<a name="l01041"></a>01041     matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o8">eMultiSample</a>        = <a class="code" href="_d_x_u_t_8h.html#a87a21">DXUTMT_IGNORE_INPUT</a>;
<a name="l01042"></a>01042     matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o9">eSwapEffect</a>         = <a class="code" href="_d_x_u_t_8h.html#a87a21">DXUTMT_IGNORE_INPUT</a>;
<a name="l01043"></a>01043     matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o10">eDepthFormat</a>        = <a class="code" href="_d_x_u_t_8h.html#a87a21">DXUTMT_IGNORE_INPUT</a>;
<a name="l01044"></a>01044     matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o11">eStencilFormat</a>      = <a class="code" href="_d_x_u_t_8h.html#a87a21">DXUTMT_IGNORE_INPUT</a>;
<a name="l01045"></a>01045     matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o12">ePresentFlags</a>       = <a class="code" href="_d_x_u_t_8h.html#a87a21">DXUTMT_IGNORE_INPUT</a>;
<a name="l01046"></a>01046     matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o13">eRefreshRate</a>        = <a class="code" href="_d_x_u_t_8h.html#a87a21">DXUTMT_IGNORE_INPUT</a>;
<a name="l01047"></a>01047     matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o14">ePresentInterval</a>    = <a class="code" href="_d_x_u_t_8h.html#a87a21">DXUTMT_IGNORE_INPUT</a>;
<a name="l01048"></a>01048 
<a name="l01049"></a>01049     <a class="code" href="struct_d_x_u_t_device_settings.html">DXUTDeviceSettings</a> deviceSettings;
<a name="l01050"></a>01050     ZeroMemory( &amp;deviceSettings, <span class="keyword">sizeof</span>(<a class="code" href="struct_d_x_u_t_device_settings.html">DXUTDeviceSettings</a>) );
<a name="l01051"></a>01051     deviceSettings.<a class="code" href="struct_d_x_u_t_device_settings.html#o0">AdapterOrdinal</a>      = AdapterOrdinal;
<a name="l01052"></a>01052     deviceSettings.<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.Windowed         = bWindowed;
<a name="l01053"></a>01053     deviceSettings.<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.BackBufferWidth  = nSuggestedWidth;
<a name="l01054"></a>01054     deviceSettings.<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.BackBufferHeight = nSuggestedHeight;
<a name="l01055"></a>01055 
<a name="l01056"></a>01056     <span class="comment">// Override with settings from the command line</span>
<a name="l01057"></a>01057     <span class="keywordflow">if</span>( <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetOverrideWidth() != 0 )
<a name="l01058"></a>01058         deviceSettings.<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.BackBufferWidth = <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetOverrideWidth();
<a name="l01059"></a>01059     <span class="keywordflow">if</span>( <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetOverrideHeight() != 0 )
<a name="l01060"></a>01060         deviceSettings.<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.BackBufferHeight = <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetOverrideHeight();
<a name="l01061"></a>01061 
<a name="l01062"></a>01062     <span class="keywordflow">if</span>( <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetOverrideAdapterOrdinal() != -1 )
<a name="l01063"></a>01063         deviceSettings.<a class="code" href="struct_d_x_u_t_device_settings.html#o0">AdapterOrdinal</a> = <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetOverrideAdapterOrdinal();
<a name="l01064"></a>01064 
<a name="l01065"></a>01065     <span class="keywordflow">if</span>( <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetOverrideFullScreen() )
<a name="l01066"></a>01066     {
<a name="l01067"></a>01067         deviceSettings.<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.Windowed = FALSE;
<a name="l01068"></a>01068         <span class="keywordflow">if</span>( <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetOverrideWidth() == 0 &amp;&amp; <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetOverrideHeight() == 0 )
<a name="l01069"></a>01069             matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o5">eResolution</a> = <a class="code" href="_d_x_u_t_8h.html#a87a21">DXUTMT_IGNORE_INPUT</a>;
<a name="l01070"></a>01070     }
<a name="l01071"></a>01071     <span class="keywordflow">if</span>( <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetOverrideWindowed() )
<a name="l01072"></a>01072         deviceSettings.<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.Windowed = TRUE;
<a name="l01073"></a>01073 
<a name="l01074"></a>01074     <span class="keywordflow">if</span>( <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetOverrideForceHAL() )
<a name="l01075"></a>01075     {
<a name="l01076"></a>01076         deviceSettings.<a class="code" href="struct_d_x_u_t_device_settings.html#o1">DeviceType</a> = D3DDEVTYPE_HAL;
<a name="l01077"></a>01077         matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o1">eDeviceType</a> = <a class="code" href="_d_x_u_t_8h.html#a87a22">DXUTMT_PRESERVE_INPUT</a>;
<a name="l01078"></a>01078     }
<a name="l01079"></a>01079     <span class="keywordflow">if</span>( <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetOverrideForceREF() )
<a name="l01080"></a>01080     {
<a name="l01081"></a>01081         deviceSettings.<a class="code" href="struct_d_x_u_t_device_settings.html#o1">DeviceType</a> = D3DDEVTYPE_REF;
<a name="l01082"></a>01082         matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o1">eDeviceType</a> = <a class="code" href="_d_x_u_t_8h.html#a87a22">DXUTMT_PRESERVE_INPUT</a>;
<a name="l01083"></a>01083     }
<a name="l01084"></a>01084 
<a name="l01085"></a>01085     <span class="keywordflow">if</span>( <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetOverrideForcePureHWVP() )
<a name="l01086"></a>01086     {
<a name="l01087"></a>01087         deviceSettings.<a class="code" href="struct_d_x_u_t_device_settings.html#o3">BehaviorFlags</a> = D3DCREATE_HARDWARE_VERTEXPROCESSING | D3DCREATE_PUREDEVICE;
<a name="l01088"></a>01088         matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o4">eVertexProcessing</a> = <a class="code" href="_d_x_u_t_8h.html#a87a22">DXUTMT_PRESERVE_INPUT</a>;
<a name="l01089"></a>01089     }
<a name="l01090"></a>01090     <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetOverrideForceHWVP() )
<a name="l01091"></a>01091     {
<a name="l01092"></a>01092         deviceSettings.<a class="code" href="struct_d_x_u_t_device_settings.html#o3">BehaviorFlags</a> = D3DCREATE_HARDWARE_VERTEXPROCESSING;
<a name="l01093"></a>01093         matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o4">eVertexProcessing</a> = <a class="code" href="_d_x_u_t_8h.html#a87a22">DXUTMT_PRESERVE_INPUT</a>;
<a name="l01094"></a>01094     }
<a name="l01095"></a>01095     <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetOverrideForceSWVP() )
<a name="l01096"></a>01096     {
<a name="l01097"></a>01097         deviceSettings.<a class="code" href="struct_d_x_u_t_device_settings.html#o3">BehaviorFlags</a> = D3DCREATE_SOFTWARE_VERTEXPROCESSING;
<a name="l01098"></a>01098         matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o4">eVertexProcessing</a> = <a class="code" href="_d_x_u_t_8h.html#a87a22">DXUTMT_PRESERVE_INPUT</a>;
<a name="l01099"></a>01099     }
<a name="l01100"></a>01100 
<a name="l01101"></a>01101     hr = <a class="code" href="_d_x_u_t_8cpp.html#a83">DXUTFindValidDeviceSettings</a>( &amp;deviceSettings, &amp;deviceSettings, &amp;matchOptions );
<a name="l01102"></a>01102     <span class="keywordflow">if</span>( FAILED(hr) ) <span class="comment">// the call will fail if no valid devices were found</span>
<a name="l01103"></a>01103     {
<a name="l01104"></a>01104         <a class="code" href="_d_x_u_t_8cpp.html#a52">DXUTDisplayErrorMessage</a>( hr );
<a name="l01105"></a>01105         <span class="keywordflow">return</span> <a class="code" href="_d_x_u_tmisc_8h.html#a7">DXUT_ERR</a>( L<span class="stringliteral">"DXUTFindValidDeviceSettings"</span>, hr );
<a name="l01106"></a>01106     }
<a name="l01107"></a>01107 
<a name="l01108"></a>01108     <span class="comment">// Change to a Direct3D device created from the new device settings.  </span>
<a name="l01109"></a>01109     <span class="comment">// If there is an existing device, then either reset or recreated the scene</span>
<a name="l01110"></a>01110     hr = <a class="code" href="_d_x_u_t_8cpp.html#a41">DXUTChangeDevice</a>( &amp;deviceSettings, NULL, <span class="keyword">false</span>, <span class="keyword">true</span> );
<a name="l01111"></a>01111     <span class="keywordflow">if</span>( FAILED(hr) )
<a name="l01112"></a>01112         <span class="keywordflow">return</span> hr;
<a name="l01113"></a>01113 
<a name="l01114"></a>01114     <span class="keywordflow">return</span> S_OK;
<a name="l01115"></a>01115 }
<a name="l01116"></a>01116 
<a name="l01117"></a>01117 
<a name="l01118"></a>01118 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l01119"></a>01119 <span class="comment">// Passes a previously created Direct3D device for use by the framework.  </span>
<a name="l01120"></a>01120 <span class="comment">// If DXUTCreateWindow() has not already been called, it will call it with the </span>
<a name="l01121"></a>01121 <span class="comment">// default parameters.  Instead of calling this, you can call DXUTCreateDevice() or </span>
<a name="l01122"></a>01122 <span class="comment">// DXUTCreateDeviceFromSettings() </span>
<a name="l01123"></a>01123 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l01124"></a><a class="code" href="_d_x_u_t_8h.html#a40">01124</a> <a class="code" href="_d_x_u_tgui_8cpp.html#a51">HRESULT</a> <a class="code" href="_d_x_u_t_8cpp.html#a79">DXUTSetDevice</a>( IDirect3DDevice9* pd3dDevice )
<a name="l01125"></a>01125 {
<a name="l01126"></a>01126     <a class="code" href="_d_x_u_tgui_8cpp.html#a51">HRESULT</a> hr;
<a name="l01127"></a>01127 
<a name="l01128"></a>01128     <span class="keywordflow">if</span>( pd3dDevice == NULL )
<a name="l01129"></a>01129         <span class="keywordflow">return</span> <a class="code" href="_d_x_u_tmisc_8h.html#a8">DXUT_ERR_MSGBOX</a>( L<span class="stringliteral">"DXUTSetDevice"</span>, E_INVALIDARG );
<a name="l01130"></a>01130 
<a name="l01131"></a>01131     <span class="comment">// Not allowed to call this from inside the device callbacks</span>
<a name="l01132"></a>01132     <span class="keywordflow">if</span>( <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetInsideDeviceCallback() )
<a name="l01133"></a>01133         <span class="keywordflow">return</span> <a class="code" href="_d_x_u_tmisc_8h.html#a8">DXUT_ERR_MSGBOX</a>( L<span class="stringliteral">"DXUTCreateWindow"</span>, E_FAIL );
<a name="l01134"></a>01134 
<a name="l01135"></a>01135     <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetDeviceCreateCalled( <span class="keyword">true</span> );
<a name="l01136"></a>01136 
<a name="l01137"></a>01137     <span class="comment">// If DXUTCreateWindow() or DXUTSetWindow() has not already been called, </span>
<a name="l01138"></a>01138     <span class="comment">// then call DXUTCreateWindow() with the default parameters.         </span>
<a name="l01139"></a>01139     <span class="keywordflow">if</span>( !<a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetWindowCreated() ) 
<a name="l01140"></a>01140     {
<a name="l01141"></a>01141         <span class="comment">// If DXUTCreateWindow() or DXUTSetWindow() was already called and failed, then fail.</span>
<a name="l01142"></a>01142         <span class="comment">// DXUTCreateWindow() or DXUTSetWindow() must first succeed for this function to succeed</span>
<a name="l01143"></a>01143         <span class="keywordflow">if</span>( <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetWindowCreateCalled() )
<a name="l01144"></a>01144             <span class="keywordflow">return</span> E_FAIL; 
<a name="l01145"></a>01145 
<a name="l01146"></a>01146         <span class="comment">// If DXUTCreateWindow() or DXUTSetWindow() hasn't been called, then </span>
<a name="l01147"></a>01147         <span class="comment">// automatically call DXUTCreateWindow() with default params</span>
<a name="l01148"></a>01148         hr = <a class="code" href="_d_x_u_t_8cpp.html#a76">DXUTCreateWindow</a>();
<a name="l01149"></a>01149         <span class="keywordflow">if</span>( FAILED(hr) )
<a name="l01150"></a>01150             <span class="keywordflow">return</span> hr;
<a name="l01151"></a>01151     }
<a name="l01152"></a>01152 
<a name="l01153"></a>01153     <a class="code" href="struct_d_x_u_t_device_settings.html">DXUTDeviceSettings</a>* pDeviceSettings = <a class="code" href="dxstdafx_8h.html#a4">DX_NEW</a> <a class="code" href="struct_d_x_u_t_device_settings.html">DXUTDeviceSettings</a>;
<a name="l01154"></a>01154     <span class="keywordflow">if</span>( pDeviceSettings == NULL )
<a name="l01155"></a>01155         <span class="keywordflow">return</span> E_OUTOFMEMORY;
<a name="l01156"></a>01156     ZeroMemory( pDeviceSettings, <span class="keyword">sizeof</span>(DXUTDeviceSettings) );
<a name="l01157"></a>01157 
<a name="l01158"></a>01158     <span class="comment">// Get the present params from the swap chain</span>
<a name="l01159"></a>01159     IDirect3DSurface9* pBackBuffer = NULL;
<a name="l01160"></a>01160     hr = pd3dDevice-&gt;GetBackBuffer( 0, 0, D3DBACKBUFFER_TYPE_MONO, &amp;pBackBuffer );
<a name="l01161"></a>01161     <span class="keywordflow">if</span>( SUCCEEDED(hr) )
<a name="l01162"></a>01162     {
<a name="l01163"></a>01163         IDirect3DSwapChain9* pSwapChain = NULL;
<a name="l01164"></a>01164         hr = pBackBuffer-&gt;GetContainer( IID_IDirect3DSwapChain9, (<span class="keywordtype">void</span>**) &amp;pSwapChain );
<a name="l01165"></a>01165         <span class="keywordflow">if</span>( SUCCEEDED(hr) )
<a name="l01166"></a>01166         {
<a name="l01167"></a>01167             pSwapChain-&gt;GetPresentParameters( &amp;pDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a> );
<a name="l01168"></a>01168             <a class="code" href="dxstdafx_8h.html#a9">SAFE_RELEASE</a>( pSwapChain );
<a name="l01169"></a>01169         }
<a name="l01170"></a>01170 
<a name="l01171"></a>01171         <a class="code" href="dxstdafx_8h.html#a9">SAFE_RELEASE</a>( pBackBuffer );
<a name="l01172"></a>01172     }
<a name="l01173"></a>01173 
<a name="l01174"></a>01174     D3DDEVICE_CREATION_PARAMETERS d3dCreationParams;
<a name="l01175"></a>01175     pd3dDevice-&gt;GetCreationParameters( &amp;d3dCreationParams );
<a name="l01176"></a>01176 
<a name="l01177"></a>01177     <span class="comment">// Fill out the rest of the device settings struct</span>
<a name="l01178"></a>01178     pDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o0">AdapterOrdinal</a> = d3dCreationParams.AdapterOrdinal;
<a name="l01179"></a>01179     pDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o1">DeviceType</a>     = d3dCreationParams.DeviceType;
<a name="l01180"></a>01180     <a class="code" href="_d_x_u_t_8cpp.html#a40">DXUTFindAdapterFormat</a>( pDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o0">AdapterOrdinal</a>, pDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o1">DeviceType</a>, 
<a name="l01181"></a>01181                            pDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.BackBufferFormat, pDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.Windowed, 
<a name="l01182"></a>01182                            &amp;pDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o2">AdapterFormat</a> );
<a name="l01183"></a>01183     pDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o3">BehaviorFlags</a>  = d3dCreationParams.BehaviorFlags;
<a name="l01184"></a>01184 
<a name="l01185"></a>01185     <span class="comment">// Change to the Direct3D device passed in</span>
<a name="l01186"></a>01186     hr = <a class="code" href="_d_x_u_t_8cpp.html#a41">DXUTChangeDevice</a>( pDeviceSettings, pd3dDevice, <span class="keyword">false</span>, <span class="keyword">false</span> );
<a name="l01187"></a>01187     <span class="keywordflow">if</span>( FAILED(hr) ) 
<a name="l01188"></a>01188         <span class="keywordflow">return</span> hr;
<a name="l01189"></a>01189 
<a name="l01190"></a>01190     <span class="keywordflow">return</span> S_OK;
<a name="l01191"></a>01191 }
<a name="l01192"></a>01192 
<a name="l01193"></a>01193 
<a name="l01194"></a>01194 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l01195"></a>01195 <span class="comment">// Tells the framework to change to a device created from the passed in device settings</span>
<a name="l01196"></a>01196 <span class="comment">// If DXUTCreateWindow() has not already been called, it will call it with the </span>
<a name="l01197"></a>01197 <span class="comment">// default parameters.  Instead of calling this, you can call DXUTCreateDevice() </span>
<a name="l01198"></a>01198 <span class="comment">// or DXUTSetDevice() </span>
<a name="l01199"></a>01199 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l01200"></a><a class="code" href="_d_x_u_t_8h.html#a39">01200</a> <a class="code" href="_d_x_u_tgui_8cpp.html#a51">HRESULT</a> <a class="code" href="_d_x_u_t_8cpp.html#a80">DXUTCreateDeviceFromSettings</a>( <a class="code" href="struct_d_x_u_t_device_settings.html">DXUTDeviceSettings</a>* pDeviceSettings, <span class="keywordtype">bool</span> bPreserveInput, <span class="keywordtype">bool</span> bClipWindowToSingleAdapter )
<a name="l01201"></a>01201 {
<a name="l01202"></a>01202     <a class="code" href="_d_x_u_tgui_8cpp.html#a51">HRESULT</a> hr;
<a name="l01203"></a>01203 
<a name="l01204"></a>01204     <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetDeviceCreateCalled( <span class="keyword">true</span> );
<a name="l01205"></a>01205 
<a name="l01206"></a>01206     <span class="comment">// If DXUTCreateWindow() or DXUTSetWindow() has not already been called, </span>
<a name="l01207"></a>01207     <span class="comment">// then call DXUTCreateWindow() with the default parameters.         </span>
<a name="l01208"></a>01208     <span class="keywordflow">if</span>( !<a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetWindowCreated() ) 
<a name="l01209"></a>01209     {
<a name="l01210"></a>01210         <span class="comment">// If DXUTCreateWindow() or DXUTSetWindow() was already called and failed, then fail.</span>
<a name="l01211"></a>01211         <span class="comment">// DXUTCreateWindow() or DXUTSetWindow() must first succeed for this function to succeed</span>
<a name="l01212"></a>01212         <span class="keywordflow">if</span>( <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetWindowCreateCalled() )
<a name="l01213"></a>01213             <span class="keywordflow">return</span> E_FAIL; 
<a name="l01214"></a>01214 
<a name="l01215"></a>01215         <span class="comment">// If DXUTCreateWindow() or DXUTSetWindow() hasn't been called, then </span>
<a name="l01216"></a>01216         <span class="comment">// automatically call DXUTCreateWindow() with default params</span>
<a name="l01217"></a>01217         hr = <a class="code" href="_d_x_u_t_8cpp.html#a76">DXUTCreateWindow</a>();
<a name="l01218"></a>01218         <span class="keywordflow">if</span>( FAILED(hr) )
<a name="l01219"></a>01219             <span class="keywordflow">return</span> hr;
<a name="l01220"></a>01220     }
<a name="l01221"></a>01221 
<a name="l01222"></a>01222     <span class="keywordflow">if</span>( !bPreserveInput )
<a name="l01223"></a>01223     {
<a name="l01224"></a>01224         <span class="comment">// If not preserving the input, then find the closest valid to it</span>
<a name="l01225"></a>01225         <a class="code" href="struct_d_x_u_t_match_options.html">DXUTMatchOptions</a> matchOptions;
<a name="l01226"></a>01226         matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o0">eAdapterOrdinal</a>     = <a class="code" href="_d_x_u_t_8h.html#a87a23">DXUTMT_CLOSEST_TO_INPUT</a>;
<a name="l01227"></a>01227         matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o1">eDeviceType</a>         = <a class="code" href="_d_x_u_t_8h.html#a87a23">DXUTMT_CLOSEST_TO_INPUT</a>;
<a name="l01228"></a>01228         matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o2">eWindowed</a>           = <a class="code" href="_d_x_u_t_8h.html#a87a23">DXUTMT_CLOSEST_TO_INPUT</a>;
<a name="l01229"></a>01229         matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o3">eAdapterFormat</a>      = <a class="code" href="_d_x_u_t_8h.html#a87a23">DXUTMT_CLOSEST_TO_INPUT</a>;
<a name="l01230"></a>01230         matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o4">eVertexProcessing</a>   = <a class="code" href="_d_x_u_t_8h.html#a87a23">DXUTMT_CLOSEST_TO_INPUT</a>;
<a name="l01231"></a>01231         matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o5">eResolution</a>         = <a class="code" href="_d_x_u_t_8h.html#a87a23">DXUTMT_CLOSEST_TO_INPUT</a>;
<a name="l01232"></a>01232         matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o6">eBackBufferFormat</a>   = <a class="code" href="_d_x_u_t_8h.html#a87a23">DXUTMT_CLOSEST_TO_INPUT</a>;
<a name="l01233"></a>01233         matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o7">eBackBufferCount</a>    = <a class="code" href="_d_x_u_t_8h.html#a87a23">DXUTMT_CLOSEST_TO_INPUT</a>;
<a name="l01234"></a>01234         matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o8">eMultiSample</a>        = <a class="code" href="_d_x_u_t_8h.html#a87a23">DXUTMT_CLOSEST_TO_INPUT</a>;
<a name="l01235"></a>01235         matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o9">eSwapEffect</a>         = <a class="code" href="_d_x_u_t_8h.html#a87a23">DXUTMT_CLOSEST_TO_INPUT</a>;
<a name="l01236"></a>01236         matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o10">eDepthFormat</a>        = <a class="code" href="_d_x_u_t_8h.html#a87a23">DXUTMT_CLOSEST_TO_INPUT</a>;
<a name="l01237"></a>01237         matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o11">eStencilFormat</a>      = <a class="code" href="_d_x_u_t_8h.html#a87a23">DXUTMT_CLOSEST_TO_INPUT</a>;
<a name="l01238"></a>01238         matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o12">ePresentFlags</a>       = <a class="code" href="_d_x_u_t_8h.html#a87a23">DXUTMT_CLOSEST_TO_INPUT</a>;
<a name="l01239"></a>01239         matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o13">eRefreshRate</a>        = <a class="code" href="_d_x_u_t_8h.html#a87a23">DXUTMT_CLOSEST_TO_INPUT</a>;
<a name="l01240"></a>01240         matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o14">ePresentInterval</a>    = <a class="code" href="_d_x_u_t_8h.html#a87a23">DXUTMT_CLOSEST_TO_INPUT</a>;
<a name="l01241"></a>01241 
<a name="l01242"></a>01242         hr = <a class="code" href="_d_x_u_t_8cpp.html#a83">DXUTFindValidDeviceSettings</a>( pDeviceSettings, pDeviceSettings, &amp;matchOptions );
<a name="l01243"></a>01243         <span class="keywordflow">if</span>( FAILED(hr) ) <span class="comment">// the call will fail if no valid devices were found</span>
<a name="l01244"></a>01244         {
<a name="l01245"></a>01245             <a class="code" href="_d_x_u_t_8cpp.html#a52">DXUTDisplayErrorMessage</a>( hr );
<a name="l01246"></a>01246             <span class="keywordflow">return</span> <a class="code" href="_d_x_u_tmisc_8h.html#a7">DXUT_ERR</a>( L<span class="stringliteral">"DXUTFindValidDeviceSettings"</span>, hr );
<a name="l01247"></a>01247         }
<a name="l01248"></a>01248     }
<a name="l01249"></a>01249 
<a name="l01250"></a>01250     <span class="comment">// Change to a Direct3D device created from the new device settings.  </span>
<a name="l01251"></a>01251     <span class="comment">// If there is an existing device, then either reset or recreate the scene</span>
<a name="l01252"></a>01252     hr = <a class="code" href="_d_x_u_t_8cpp.html#a41">DXUTChangeDevice</a>( pDeviceSettings, NULL, <span class="keyword">false</span>, bClipWindowToSingleAdapter );
<a name="l01253"></a>01253     <span class="keywordflow">if</span>( FAILED(hr) )
<a name="l01254"></a>01254         <span class="keywordflow">return</span> hr;
<a name="l01255"></a>01255 
<a name="l01256"></a>01256     <span class="keywordflow">return</span> S_OK;
<a name="l01257"></a>01257 }
<a name="l01258"></a>01258 
<a name="l01259"></a>01259 
<a name="l01260"></a>01260 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l01261"></a>01261 <span class="comment">// Toggle between full screen and windowed</span>
<a name="l01262"></a>01262 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l01263"></a><a class="code" href="_d_x_u_t_8h.html#a51">01263</a> <a class="code" href="_d_x_u_tgui_8cpp.html#a51">HRESULT</a> <a class="code" href="_d_x_u_t_8cpp.html#a81">DXUTToggleFullScreen</a>()
<a name="l01264"></a>01264 {
<a name="l01265"></a>01265     <a class="code" href="_d_x_u_tgui_8cpp.html#a51">HRESULT</a> hr;
<a name="l01266"></a>01266 
<a name="l01267"></a>01267     <span class="comment">// Get the current device settings and flip the windowed state then</span>
<a name="l01268"></a>01268     <span class="comment">// find the closest valid device settings with this change</span>
<a name="l01269"></a>01269     <a class="code" href="struct_d_x_u_t_device_settings.html">DXUTDeviceSettings</a> deviceSettings = <a class="code" href="_d_x_u_t_8cpp.html#a126">DXUTGetDeviceSettings</a>();
<a name="l01270"></a>01270     deviceSettings.<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.Windowed = !deviceSettings.<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.Windowed;
<a name="l01271"></a>01271 
<a name="l01272"></a>01272     <a class="code" href="struct_d_x_u_t_match_options.html">DXUTMatchOptions</a> matchOptions;
<a name="l01273"></a>01273     matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o0">eAdapterOrdinal</a>     = <a class="code" href="_d_x_u_t_8h.html#a87a22">DXUTMT_PRESERVE_INPUT</a>;
<a name="l01274"></a>01274     matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o1">eDeviceType</a>         = <a class="code" href="_d_x_u_t_8h.html#a87a23">DXUTMT_CLOSEST_TO_INPUT</a>;
<a name="l01275"></a>01275     matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o2">eWindowed</a>           = <a class="code" href="_d_x_u_t_8h.html#a87a22">DXUTMT_PRESERVE_INPUT</a>;
<a name="l01276"></a>01276     matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o3">eAdapterFormat</a>      = <a class="code" href="_d_x_u_t_8h.html#a87a21">DXUTMT_IGNORE_INPUT</a>;
<a name="l01277"></a>01277     matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o4">eVertexProcessing</a>   = <a class="code" href="_d_x_u_t_8h.html#a87a23">DXUTMT_CLOSEST_TO_INPUT</a>;
<a name="l01278"></a>01278     matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o6">eBackBufferFormat</a>   = <a class="code" href="_d_x_u_t_8h.html#a87a21">DXUTMT_IGNORE_INPUT</a>;
<a name="l01279"></a>01279     matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o7">eBackBufferCount</a>    = <a class="code" href="_d_x_u_t_8h.html#a87a23">DXUTMT_CLOSEST_TO_INPUT</a>;
<a name="l01280"></a>01280     matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o8">eMultiSample</a>        = <a class="code" href="_d_x_u_t_8h.html#a87a23">DXUTMT_CLOSEST_TO_INPUT</a>;
<a name="l01281"></a>01281     matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o9">eSwapEffect</a>         = <a class="code" href="_d_x_u_t_8h.html#a87a23">DXUTMT_CLOSEST_TO_INPUT</a>;
<a name="l01282"></a>01282     matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o10">eDepthFormat</a>        = <a class="code" href="_d_x_u_t_8h.html#a87a23">DXUTMT_CLOSEST_TO_INPUT</a>;
<a name="l01283"></a>01283     matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o11">eStencilFormat</a>      = <a class="code" href="_d_x_u_t_8h.html#a87a23">DXUTMT_CLOSEST_TO_INPUT</a>;
<a name="l01284"></a>01284     matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o12">ePresentFlags</a>       = <a class="code" href="_d_x_u_t_8h.html#a87a23">DXUTMT_CLOSEST_TO_INPUT</a>;
<a name="l01285"></a>01285     matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o13">eRefreshRate</a>        = <a class="code" href="_d_x_u_t_8h.html#a87a21">DXUTMT_IGNORE_INPUT</a>;
<a name="l01286"></a>01286     matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o14">ePresentInterval</a>    = <a class="code" href="_d_x_u_t_8h.html#a87a21">DXUTMT_IGNORE_INPUT</a>;
<a name="l01287"></a>01287 
<a name="l01288"></a>01288     <span class="comment">// Go back to previous state</span>
<a name="l01289"></a>01289 
<a name="l01290"></a>01290     <a class="code" href="_d_x_u_tgui_8cpp.html#a45">UINT</a> nWidth  = ( deviceSettings.<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.Windowed ) ? <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetWindowBackBufferWidthAtModeChange() : <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetFullScreenBackBufferWidthAtModeChange();
<a name="l01291"></a>01291     <a class="code" href="_d_x_u_tgui_8cpp.html#a45">UINT</a> nHeight = ( deviceSettings.<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.Windowed ) ? <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetWindowBackBufferHeightAtModeChange() : <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetFullScreenBackBufferHeightAtModeChange();
<a name="l01292"></a>01292     <span class="keywordflow">if</span>( nWidth &gt; 0 &amp;&amp; nHeight &gt; 0 )
<a name="l01293"></a>01293     {
<a name="l01294"></a>01294         matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o5">eResolution</a> = <a class="code" href="_d_x_u_t_8h.html#a87a23">DXUTMT_CLOSEST_TO_INPUT</a>;
<a name="l01295"></a>01295         deviceSettings.<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.BackBufferWidth = nWidth;
<a name="l01296"></a>01296         deviceSettings.<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.BackBufferHeight = nHeight;
<a name="l01297"></a>01297     }
<a name="l01298"></a>01298     <span class="keywordflow">else</span>
<a name="l01299"></a>01299     {
<a name="l01300"></a>01300         <span class="comment">// No previous data, so just switch to defaults</span>
<a name="l01301"></a>01301         matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o5">eResolution</a> = <a class="code" href="_d_x_u_t_8h.html#a87a21">DXUTMT_IGNORE_INPUT</a>;
<a name="l01302"></a>01302     }
<a name="l01303"></a>01303     
<a name="l01304"></a>01304     hr = <a class="code" href="_d_x_u_t_8cpp.html#a83">DXUTFindValidDeviceSettings</a>( &amp;deviceSettings, &amp;deviceSettings, &amp;matchOptions );
<a name="l01305"></a>01305     <span class="keywordflow">if</span>( SUCCEEDED(hr) ) 
<a name="l01306"></a>01306     {
<a name="l01307"></a>01307         <span class="comment">// Create a Direct3D device using the new device settings.  </span>
<a name="l01308"></a>01308         <span class="comment">// If there is an existing device, then it will either reset or recreate the scene.</span>
<a name="l01309"></a>01309         hr = <a class="code" href="_d_x_u_t_8cpp.html#a41">DXUTChangeDevice</a>( &amp;deviceSettings, NULL, <span class="keyword">false</span>, <span class="keyword">false</span> );
<a name="l01310"></a>01310 
<a name="l01311"></a>01311         <span class="comment">// If hr == E_ABORT, this means the app rejected the device settings in the ModifySettingsCallback so nothing changed</span>
<a name="l01312"></a>01312         <span class="keywordflow">if</span>( FAILED(hr) &amp;&amp; (hr != E_ABORT) )
<a name="l01313"></a>01313         {
<a name="l01314"></a>01314             <span class="comment">// Failed creating device, try to switch back.</span>
<a name="l01315"></a>01315             deviceSettings.<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.Windowed = !deviceSettings.<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.Windowed;
<a name="l01316"></a>01316             <a class="code" href="_d_x_u_tgui_8cpp.html#a45">UINT</a> nWidth  = ( deviceSettings.<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.Windowed ) ? <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetWindowBackBufferWidthAtModeChange() : <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetFullScreenBackBufferWidthAtModeChange();
<a name="l01317"></a>01317             <a class="code" href="_d_x_u_tgui_8cpp.html#a45">UINT</a> nHeight = ( deviceSettings.<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.Windowed ) ? <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetWindowBackBufferHeightAtModeChange() : <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetFullScreenBackBufferHeightAtModeChange();
<a name="l01318"></a>01318             <span class="keywordflow">if</span>( nWidth &gt; 0 &amp;&amp; nHeight &gt; 0 )
<a name="l01319"></a>01319             {
<a name="l01320"></a>01320                 matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o5">eResolution</a> = <a class="code" href="_d_x_u_t_8h.html#a87a23">DXUTMT_CLOSEST_TO_INPUT</a>;
<a name="l01321"></a>01321                 deviceSettings.<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.BackBufferWidth = nWidth;
<a name="l01322"></a>01322                 deviceSettings.<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.BackBufferHeight = nHeight;
<a name="l01323"></a>01323             }
<a name="l01324"></a>01324             <span class="keywordflow">else</span>
<a name="l01325"></a>01325             {
<a name="l01326"></a>01326                 matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o5">eResolution</a> = <a class="code" href="_d_x_u_t_8h.html#a87a21">DXUTMT_IGNORE_INPUT</a>;
<a name="l01327"></a>01327             }
<a name="l01328"></a>01328             
<a name="l01329"></a>01329             <a class="code" href="_d_x_u_t_8cpp.html#a83">DXUTFindValidDeviceSettings</a>( &amp;deviceSettings, &amp;deviceSettings, &amp;matchOptions );
<a name="l01330"></a>01330 
<a name="l01331"></a>01331             <a class="code" href="_d_x_u_tgui_8cpp.html#a51">HRESULT</a> hr2 = <a class="code" href="_d_x_u_t_8cpp.html#a41">DXUTChangeDevice</a>( &amp;deviceSettings, NULL, <span class="keyword">false</span>, <span class="keyword">false</span> );
<a name="l01332"></a>01332             <span class="keywordflow">if</span>( FAILED(hr2) )
<a name="l01333"></a>01333             {
<a name="l01334"></a>01334                 <span class="comment">// If this failed, then shutdown</span>
<a name="l01335"></a>01335                 <a class="code" href="_d_x_u_t_8cpp.html#a89">DXUTShutdown</a>();
<a name="l01336"></a>01336             }
<a name="l01337"></a>01337         }
<a name="l01338"></a>01338     }
<a name="l01339"></a>01339 
<a name="l01340"></a>01340     <span class="keywordflow">return</span> hr;
<a name="l01341"></a>01341 }
<a name="l01342"></a>01342 
<a name="l01343"></a>01343 
<a name="l01344"></a>01344 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l01345"></a>01345 <span class="comment">// Toggle between HAL and REF</span>
<a name="l01346"></a>01346 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l01347"></a><a class="code" href="_d_x_u_t_8h.html#a52">01347</a> <a class="code" href="_d_x_u_tgui_8cpp.html#a51">HRESULT</a> <a class="code" href="_d_x_u_t_8cpp.html#a82">DXUTToggleREF</a>()
<a name="l01348"></a>01348 {
<a name="l01349"></a>01349     <a class="code" href="_d_x_u_tgui_8cpp.html#a51">HRESULT</a> hr;
<a name="l01350"></a>01350 
<a name="l01351"></a>01351     <a class="code" href="struct_d_x_u_t_device_settings.html">DXUTDeviceSettings</a> deviceSettings = <a class="code" href="_d_x_u_t_8cpp.html#a126">DXUTGetDeviceSettings</a>();
<a name="l01352"></a>01352     <span class="keywordflow">if</span>( deviceSettings.<a class="code" href="struct_d_x_u_t_device_settings.html#o1">DeviceType</a> == D3DDEVTYPE_HAL )
<a name="l01353"></a>01353         deviceSettings.<a class="code" href="struct_d_x_u_t_device_settings.html#o1">DeviceType</a> = D3DDEVTYPE_REF;
<a name="l01354"></a>01354     <span class="keywordflow">else</span> <span class="keywordflow">if</span>( deviceSettings.<a class="code" href="struct_d_x_u_t_device_settings.html#o1">DeviceType</a> == D3DDEVTYPE_REF )
<a name="l01355"></a>01355         deviceSettings.<a class="code" href="struct_d_x_u_t_device_settings.html#o1">DeviceType</a> = D3DDEVTYPE_HAL;
<a name="l01356"></a>01356 
<a name="l01357"></a>01357     <a class="code" href="struct_d_x_u_t_match_options.html">DXUTMatchOptions</a> matchOptions;
<a name="l01358"></a>01358     matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o0">eAdapterOrdinal</a>     = <a class="code" href="_d_x_u_t_8h.html#a87a22">DXUTMT_PRESERVE_INPUT</a>;
<a name="l01359"></a>01359     matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o1">eDeviceType</a>         = <a class="code" href="_d_x_u_t_8h.html#a87a22">DXUTMT_PRESERVE_INPUT</a>;
<a name="l01360"></a>01360     matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o2">eWindowed</a>           = <a class="code" href="_d_x_u_t_8h.html#a87a23">DXUTMT_CLOSEST_TO_INPUT</a>;
<a name="l01361"></a>01361     matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o3">eAdapterFormat</a>      = <a class="code" href="_d_x_u_t_8h.html#a87a23">DXUTMT_CLOSEST_TO_INPUT</a>;
<a name="l01362"></a>01362     matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o4">eVertexProcessing</a>   = <a class="code" href="_d_x_u_t_8h.html#a87a23">DXUTMT_CLOSEST_TO_INPUT</a>;
<a name="l01363"></a>01363     matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o5">eResolution</a>         = <a class="code" href="_d_x_u_t_8h.html#a87a23">DXUTMT_CLOSEST_TO_INPUT</a>;
<a name="l01364"></a>01364     matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o6">eBackBufferFormat</a>   = <a class="code" href="_d_x_u_t_8h.html#a87a23">DXUTMT_CLOSEST_TO_INPUT</a>;
<a name="l01365"></a>01365     matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o7">eBackBufferCount</a>    = <a class="code" href="_d_x_u_t_8h.html#a87a23">DXUTMT_CLOSEST_TO_INPUT</a>;
<a name="l01366"></a>01366     matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o8">eMultiSample</a>        = <a class="code" href="_d_x_u_t_8h.html#a87a23">DXUTMT_CLOSEST_TO_INPUT</a>;
<a name="l01367"></a>01367     matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o9">eSwapEffect</a>         = <a class="code" href="_d_x_u_t_8h.html#a87a23">DXUTMT_CLOSEST_TO_INPUT</a>;
<a name="l01368"></a>01368     matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o10">eDepthFormat</a>        = <a class="code" href="_d_x_u_t_8h.html#a87a23">DXUTMT_CLOSEST_TO_INPUT</a>;
<a name="l01369"></a>01369     matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o11">eStencilFormat</a>      = <a class="code" href="_d_x_u_t_8h.html#a87a23">DXUTMT_CLOSEST_TO_INPUT</a>;
<a name="l01370"></a>01370     matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o12">ePresentFlags</a>       = <a class="code" href="_d_x_u_t_8h.html#a87a23">DXUTMT_CLOSEST_TO_INPUT</a>;
<a name="l01371"></a>01371     matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o13">eRefreshRate</a>        = <a class="code" href="_d_x_u_t_8h.html#a87a23">DXUTMT_CLOSEST_TO_INPUT</a>;
<a name="l01372"></a>01372     matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o14">ePresentInterval</a>    = <a class="code" href="_d_x_u_t_8h.html#a87a23">DXUTMT_CLOSEST_TO_INPUT</a>;
<a name="l01373"></a>01373     
<a name="l01374"></a>01374     hr = <a class="code" href="_d_x_u_t_8cpp.html#a83">DXUTFindValidDeviceSettings</a>( &amp;deviceSettings, &amp;deviceSettings, &amp;matchOptions );
<a name="l01375"></a>01375     <span class="keywordflow">if</span>( SUCCEEDED(hr) ) 
<a name="l01376"></a>01376     {
<a name="l01377"></a>01377         <span class="comment">// Create a Direct3D device using the new device settings.  </span>
<a name="l01378"></a>01378         <span class="comment">// If there is an existing device, then it will either reset or recreate the scene.</span>
<a name="l01379"></a>01379         hr = <a class="code" href="_d_x_u_t_8cpp.html#a41">DXUTChangeDevice</a>( &amp;deviceSettings, NULL, <span class="keyword">false</span>, <span class="keyword">false</span> );
<a name="l01380"></a>01380 
<a name="l01381"></a>01381         <span class="comment">// If hr == E_ABORT, this means the app rejected the device settings in the ModifySettingsCallback so nothing changed</span>
<a name="l01382"></a>01382         <span class="keywordflow">if</span>( FAILED( hr ) &amp;&amp; (hr != E_ABORT) )
<a name="l01383"></a>01383         {
<a name="l01384"></a>01384             <span class="comment">// Failed creating device, try to switch back.</span>
<a name="l01385"></a>01385             <span class="keywordflow">if</span>( deviceSettings.<a class="code" href="struct_d_x_u_t_device_settings.html#o1">DeviceType</a> == D3DDEVTYPE_HAL )
<a name="l01386"></a>01386                 deviceSettings.<a class="code" href="struct_d_x_u_t_device_settings.html#o1">DeviceType</a> = D3DDEVTYPE_REF;
<a name="l01387"></a>01387             <span class="keywordflow">else</span> <span class="keywordflow">if</span>( deviceSettings.<a class="code" href="struct_d_x_u_t_device_settings.html#o1">DeviceType</a> == D3DDEVTYPE_REF )
<a name="l01388"></a>01388                 deviceSettings.<a class="code" href="struct_d_x_u_t_device_settings.html#o1">DeviceType</a> = D3DDEVTYPE_HAL;
<a name="l01389"></a>01389 
<a name="l01390"></a>01390             <a class="code" href="_d_x_u_t_8cpp.html#a83">DXUTFindValidDeviceSettings</a>( &amp;deviceSettings, &amp;deviceSettings, &amp;matchOptions );
<a name="l01391"></a>01391 
<a name="l01392"></a>01392             <a class="code" href="_d_x_u_tgui_8cpp.html#a51">HRESULT</a> hr2 = <a class="code" href="_d_x_u_t_8cpp.html#a41">DXUTChangeDevice</a>( &amp;deviceSettings, NULL, <span class="keyword">false</span>, <span class="keyword">false</span> );
<a name="l01393"></a>01393             <span class="keywordflow">if</span>( FAILED(hr2) )
<a name="l01394"></a>01394             {
<a name="l01395"></a>01395                 <span class="comment">// If this failed, then shutdown</span>
<a name="l01396"></a>01396                 <a class="code" href="_d_x_u_t_8cpp.html#a89">DXUTShutdown</a>();
<a name="l01397"></a>01397             }
<a name="l01398"></a>01398         }
<a name="l01399"></a>01399     }
<a name="l01400"></a>01400 
<a name="l01401"></a>01401     <span class="keywordflow">return</span> hr;
<a name="l01402"></a>01402 }
<a name="l01403"></a>01403 
<a name="l01404"></a>01404 
<a name="l01405"></a>01405 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l01406"></a>01406 <span class="comment">// Internal helper function to prepare the enumeration object by creating it if it </span>
<a name="l01407"></a>01407 <span class="comment">// didn't already exist and enumerating if desired.</span>
<a name="l01408"></a>01408 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l01409"></a><a class="code" href="_d_x_u_t_8cpp.html#a34">01409</a> <a class="code" href="class_c_d3_d_enumeration.html">CD3DEnumeration</a>* <a class="code" href="_d_x_u_t_8cpp.html#a34">DXUTPrepareEnumerationObject</a>( <span class="keywordtype">bool</span> bEnumerate )
<a name="l01410"></a>01410 {
<a name="l01411"></a>01411     <span class="comment">// Create a new CD3DEnumeration object and enumerate all devices unless its already been done</span>
<a name="l01412"></a>01412     <a class="code" href="class_c_d3_d_enumeration.html">CD3DEnumeration</a>* pd3dEnum = <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetD3DEnumeration();
<a name="l01413"></a>01413     <span class="keywordflow">if</span>( pd3dEnum == NULL )
<a name="l01414"></a>01414     {
<a name="l01415"></a>01415         pd3dEnum = <a class="code" href="_d_x_u_tenum_8cpp.html#a5">DXUTGetEnumeration</a>(); 
<a name="l01416"></a>01416         <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetD3DEnumeration( pd3dEnum );
<a name="l01417"></a>01417 
<a name="l01418"></a>01418         bEnumerate = <span class="keyword">true</span>;
<a name="l01419"></a>01419     }
<a name="l01420"></a>01420 
<a name="l01421"></a>01421     <span class="keywordflow">if</span>( bEnumerate )
<a name="l01422"></a>01422     {
<a name="l01423"></a>01423         <span class="comment">// Enumerate for each adapter all of the supported display modes, </span>
<a name="l01424"></a>01424         <span class="comment">// device types, adapter formats, back buffer formats, window/full screen support, </span>
<a name="l01425"></a>01425         <span class="comment">// depth stencil formats, multisampling types/qualities, and presentations intervals.</span>
<a name="l01426"></a>01426         <span class="comment">//</span>
<a name="l01427"></a>01427         <span class="comment">// For each combination of device type (HAL/REF), adapter format, back buffer format, and</span>
<a name="l01428"></a>01428         <span class="comment">// IsWindowed it will call the app's ConfirmDevice callback.  This allows the app</span>
<a name="l01429"></a>01429         <span class="comment">// to reject or allow that combination based on its caps/etc.  It also allows the </span>
<a name="l01430"></a>01430         <span class="comment">// app to change the BehaviorFlags.  The BehaviorFlags defaults non-pure HWVP </span>
<a name="l01431"></a>01431         <span class="comment">// if supported otherwise it will default to SWVP, however the app can change this </span>
<a name="l01432"></a>01432         <span class="comment">// through the ConfirmDevice callback.</span>
<a name="l01433"></a>01433         IDirect3D9* pD3D = <a class="code" href="_d_x_u_t_8cpp.html#a93">DXUTGetD3DObject</a>();
<a name="l01434"></a>01434         pd3dEnum-&gt;<a class="code" href="class_c_d3_d_enumeration.html#a12">Enumerate</a>( pD3D, <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetIsDeviceAcceptableFunc(), <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetIsDeviceAcceptableFuncUserContext() );
<a name="l01435"></a>01435     }
<a name="l01436"></a>01436     
<a name="l01437"></a>01437     <span class="keywordflow">return</span> pd3dEnum;
<a name="l01438"></a>01438 }
<a name="l01439"></a>01439 
<a name="l01440"></a>01440 
<a name="l01441"></a>01441 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l01442"></a>01442 <span class="comment">// This function tries to find valid device settings based upon the input device settings </span>
<a name="l01443"></a>01443 <span class="comment">// struct and the match options.  For each device setting a match option in the </span>
<a name="l01444"></a>01444 <span class="comment">// DXUTMatchOptions struct specifies how the function makes decisions.  For example, if </span>
<a name="l01445"></a>01445 <span class="comment">// the caller wants a HAL device with a back buffer format of D3DFMT_A2B10G10R10 but the </span>
<a name="l01446"></a>01446 <span class="comment">// HAL device on the system does not support D3DFMT_A2B10G10R10 however a REF device is </span>
<a name="l01447"></a>01447 <span class="comment">// installed that does, then the function has a choice to either use REF or to change to </span>
<a name="l01448"></a>01448 <span class="comment">// a back buffer format to compatible with the HAL device.  The match options lets the </span>
<a name="l01449"></a>01449 <span class="comment">// caller control how these choices are made.</span>
<a name="l01450"></a>01450 <span class="comment">//</span>
<a name="l01451"></a>01451 <span class="comment">// Each match option must be one of the following types: </span>
<a name="l01452"></a>01452 <span class="comment">//      DXUTMT_IGNORE_INPUT: Uses the closest valid value to a default </span>
<a name="l01453"></a>01453 <span class="comment">//      DXUTMT_PRESERVE_INPUT: Uses the input without change, but may cause no valid device to be found</span>
<a name="l01454"></a>01454 <span class="comment">//      DXUTMT_CLOSEST_TO_INPUT: Uses the closest valid value to the input </span>
<a name="l01455"></a>01455 <span class="comment">//</span>
<a name="l01456"></a>01456 <span class="comment">// If pMatchOptions is NULL then, all of the match options are assumed to be DXUTMT_IGNORE_INPUT.  </span>
<a name="l01457"></a>01457 <span class="comment">// The function returns failure if no valid device settings can be found otherwise </span>
<a name="l01458"></a>01458 <span class="comment">// the function returns success and the valid device settings are written to pOut.</span>
<a name="l01459"></a>01459 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l01460"></a><a class="code" href="_d_x_u_t_8h.html#a43">01460</a> <a class="code" href="_d_x_u_tgui_8cpp.html#a51">HRESULT</a> <a class="code" href="_d_x_u_t_8cpp.html#a83">DXUTFindValidDeviceSettings</a>( <a class="code" href="struct_d_x_u_t_device_settings.html">DXUTDeviceSettings</a>* pOut, <a class="code" href="struct_d_x_u_t_device_settings.html">DXUTDeviceSettings</a>* pIn, 
<a name="l01461"></a>01461                                      <a class="code" href="struct_d_x_u_t_match_options.html">DXUTMatchOptions</a>* pMatchOptions )
<a name="l01462"></a>01462 {
<a name="l01463"></a>01463     <span class="keywordflow">if</span>( pOut == NULL )
<a name="l01464"></a>01464         <span class="keywordflow">return</span> <a class="code" href="_d_x_u_tmisc_8h.html#a8">DXUT_ERR_MSGBOX</a>( L<span class="stringliteral">"DXUTFindValidDeviceSettings"</span>, E_INVALIDARG );
<a name="l01465"></a>01465 
<a name="l01466"></a>01466     <a class="code" href="class_c_d3_d_enumeration.html">CD3DEnumeration</a>* pd3dEnum = <a class="code" href="_d_x_u_t_8cpp.html#a34">DXUTPrepareEnumerationObject</a>( <span class="keyword">false</span> );
<a name="l01467"></a>01467     IDirect3D9*      pD3D     = <a class="code" href="_d_x_u_t_8cpp.html#a93">DXUTGetD3DObject</a>();
<a name="l01468"></a>01468 
<a name="l01469"></a>01469     <span class="comment">// Default to DXUTMT_IGNORE_INPUT for everything unless pMatchOptions isn't NULL</span>
<a name="l01470"></a>01470     <a class="code" href="struct_d_x_u_t_match_options.html">DXUTMatchOptions</a> defaultMatchOptions;
<a name="l01471"></a>01471     <span class="keywordflow">if</span>( NULL == pMatchOptions )
<a name="l01472"></a>01472     {
<a name="l01473"></a>01473         ZeroMemory( &amp;defaultMatchOptions, <span class="keyword">sizeof</span>(<a class="code" href="struct_d_x_u_t_match_options.html">DXUTMatchOptions</a>) );
<a name="l01474"></a>01474         pMatchOptions = &amp;defaultMatchOptions;
<a name="l01475"></a>01475     }
<a name="l01476"></a>01476 
<a name="l01477"></a>01477     <span class="comment">// Build an optimal device settings structure based upon the match </span>
<a name="l01478"></a>01478     <span class="comment">// options.  If the match option is set to ignore, then a optimal default value is used.</span>
<a name="l01479"></a>01479     <span class="comment">// The default value may not exist on the system, but later this will be taken </span>
<a name="l01480"></a>01480     <span class="comment">// into account.</span>
<a name="l01481"></a>01481     <a class="code" href="struct_d_x_u_t_device_settings.html">DXUTDeviceSettings</a> optimalDeviceSettings;
<a name="l01482"></a>01482     <a class="code" href="_d_x_u_t_8cpp.html#a35">DXUTBuildOptimalDeviceSettings</a>( &amp;optimalDeviceSettings, pIn, pMatchOptions );
<a name="l01483"></a>01483 
<a name="l01484"></a>01484     <span class="comment">// Find the best combination of:</span>
<a name="l01485"></a>01485     <span class="comment">//      Adapter Ordinal</span>
<a name="l01486"></a>01486     <span class="comment">//      Device Type</span>
<a name="l01487"></a>01487     <span class="comment">//      Adapter Format</span>
<a name="l01488"></a>01488     <span class="comment">//      Back Buffer Format</span>
<a name="l01489"></a>01489     <span class="comment">//      Windowed</span>
<a name="l01490"></a>01490     <span class="comment">// given what's available on the system and the match options combined with the device settings input.</span>
<a name="l01491"></a>01491     <span class="comment">// This combination of settings is encapsulated by the CD3DEnumDeviceSettingsCombo class.</span>
<a name="l01492"></a>01492     <span class="keywordtype">float</span> fBestRanking = -1.0f;
<a name="l01493"></a>01493     <a class="code" href="struct_c_d3_d_enum_device_settings_combo.html">CD3DEnumDeviceSettingsCombo</a>* pBestDeviceSettingsCombo = NULL;
<a name="l01494"></a>01494     D3DDISPLAYMODE adapterDesktopDisplayMode;
<a name="l01495"></a>01495 
<a name="l01496"></a>01496     <a class="code" href="class_c_growable_array.html">CGrowableArray&lt;CD3DEnumAdapterInfo*&gt;</a>* pAdapterList = pd3dEnum-&gt;<a class="code" href="class_c_d3_d_enumeration.html#a13">GetAdapterInfoList</a>();
<a name="l01497"></a>01497     <span class="keywordflow">for</span>( <span class="keywordtype">int</span> iAdapter=0; iAdapter&lt;pAdapterList-&gt;<a class="code" href="class_c_growable_array.html#a11">GetSize</a>(); iAdapter++ )
<a name="l01498"></a>01498     {
<a name="l01499"></a>01499         <a class="code" href="class_c_d3_d_enum_adapter_info.html">CD3DEnumAdapterInfo</a>* pAdapterInfo = pAdapterList-&gt;<a class="code" href="class_c_growable_array.html#a10">GetAt</a>(iAdapter);
<a name="l01500"></a>01500 
<a name="l01501"></a>01501         <span class="comment">// Get the desktop display mode of adapter </span>
<a name="l01502"></a>01502         pD3D-&gt;GetAdapterDisplayMode( pAdapterInfo-&gt;<a class="code" href="class_c_d3_d_enum_adapter_info.html#o0">AdapterOrdinal</a>, &amp;adapterDesktopDisplayMode );
<a name="l01503"></a>01503 
<a name="l01504"></a>01504         <span class="comment">// Enum all the device types supported by this adapter to find the best device settings</span>
<a name="l01505"></a>01505         <span class="keywordflow">for</span>( <span class="keywordtype">int</span> iDeviceInfo=0; iDeviceInfo&lt;pAdapterInfo-&gt;<a class="code" href="class_c_d3_d_enum_adapter_info.html#o4">deviceInfoList</a>.<a class="code" href="class_c_growable_array.html#a11">GetSize</a>(); iDeviceInfo++ )
<a name="l01506"></a>01506         {
<a name="l01507"></a>01507             <a class="code" href="class_c_d3_d_enum_device_info.html">CD3DEnumDeviceInfo</a>* pDeviceInfo = pAdapterInfo-&gt;<a class="code" href="class_c_d3_d_enum_adapter_info.html#o4">deviceInfoList</a>.<a class="code" href="class_c_growable_array.html#a10">GetAt</a>(iDeviceInfo);
<a name="l01508"></a>01508 
<a name="l01509"></a>01509             <span class="comment">// Enum all the device settings combinations.  A device settings combination is </span>
<a name="l01510"></a>01510             <span class="comment">// a unique set of an adapter format, back buffer format, and IsWindowed.</span>
<a name="l01511"></a>01511             <span class="keywordflow">for</span>( <span class="keywordtype">int</span> iDeviceCombo=0; iDeviceCombo&lt;pDeviceInfo-&gt;<a class="code" href="class_c_d3_d_enum_device_info.html#o3">deviceSettingsComboList</a>.<a class="code" href="class_c_growable_array.html#a11">GetSize</a>(); iDeviceCombo++ )
<a name="l01512"></a>01512             {
<a name="l01513"></a>01513                 <a class="code" href="struct_c_d3_d_enum_device_settings_combo.html">CD3DEnumDeviceSettingsCombo</a>* pDeviceSettingsCombo = pDeviceInfo-&gt;<a class="code" href="class_c_d3_d_enum_device_info.html#o3">deviceSettingsComboList</a>.<a class="code" href="class_c_growable_array.html#a10">GetAt</a>(iDeviceCombo);
<a name="l01514"></a>01514 
<a name="l01515"></a>01515                 <span class="comment">// If windowed mode the adapter format has to be the same as the desktop </span>
<a name="l01516"></a>01516                 <span class="comment">// display mode format so skip any that don't match</span>
<a name="l01517"></a>01517                 <span class="keywordflow">if</span> (pDeviceSettingsCombo-&gt;<a class="code" href="struct_c_d3_d_enum_device_settings_combo.html#o4">Windowed</a> &amp;&amp; (pDeviceSettingsCombo-&gt;<a class="code" href="struct_c_d3_d_enum_device_settings_combo.html#o2">AdapterFormat</a> != adapterDesktopDisplayMode.Format))
<a name="l01518"></a>01518                     <span class="keywordflow">continue</span>;
<a name="l01519"></a>01519 
<a name="l01520"></a>01520                 <span class="comment">// Skip any combo that doesn't meet the preserve match options</span>
<a name="l01521"></a>01521                 <span class="keywordflow">if</span>( <span class="keyword">false</span> == <a class="code" href="_d_x_u_t_8cpp.html#a36">DXUTDoesDeviceComboMatchPreserveOptions</a>( pDeviceSettingsCombo, pIn, pMatchOptions ) )
<a name="l01522"></a>01522                     <span class="keywordflow">continue</span>;           
<a name="l01523"></a>01523 
<a name="l01524"></a>01524                 <span class="comment">// Get a ranking number that describes how closely this device combo matches the optimal combo</span>
<a name="l01525"></a>01525                 <span class="keywordtype">float</span> fCurRanking = <a class="code" href="_d_x_u_t_8cpp.html#a37">DXUTRankDeviceCombo</a>( pDeviceSettingsCombo, &amp;optimalDeviceSettings, &amp;adapterDesktopDisplayMode );
<a name="l01526"></a>01526 
<a name="l01527"></a>01527                 <span class="comment">// If this combo better matches the input device settings then save it</span>
<a name="l01528"></a>01528                 <span class="keywordflow">if</span>( fCurRanking &gt; fBestRanking )
<a name="l01529"></a>01529                 {
<a name="l01530"></a>01530                     pBestDeviceSettingsCombo = pDeviceSettingsCombo;
<a name="l01531"></a>01531                     fBestRanking = fCurRanking;
<a name="l01532"></a>01532                 }                
<a name="l01533"></a>01533             }
<a name="l01534"></a>01534         }
<a name="l01535"></a>01535     }
<a name="l01536"></a>01536 
<a name="l01537"></a>01537     <span class="comment">// If no best device combination was found then fail</span>
<a name="l01538"></a>01538     <span class="keywordflow">if</span>( pBestDeviceSettingsCombo == NULL ) 
<a name="l01539"></a>01539         <span class="keywordflow">return</span> <a class="code" href="_d_x_u_t_8h.html#a1">DXUTERR_NOCOMPATIBLEDEVICES</a>;
<a name="l01540"></a>01540 
<a name="l01541"></a>01541     <span class="comment">// Using the best device settings combo found, build valid device settings taking heed of </span>
<a name="l01542"></a>01542     <span class="comment">// the match options and the input device settings</span>
<a name="l01543"></a>01543     <a class="code" href="struct_d_x_u_t_device_settings.html">DXUTDeviceSettings</a> validDeviceSettings;
<a name="l01544"></a>01544     <a class="code" href="_d_x_u_t_8cpp.html#a38">DXUTBuildValidDeviceSettings</a>( &amp;validDeviceSettings, pBestDeviceSettingsCombo, pIn, pMatchOptions );
<a name="l01545"></a>01545     *pOut = validDeviceSettings;
<a name="l01546"></a>01546 
<a name="l01547"></a>01547     <span class="keywordflow">return</span> S_OK;
<a name="l01548"></a>01548 }
<a name="l01549"></a>01549 
<a name="l01550"></a>01550 
<a name="l01551"></a>01551 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l01552"></a>01552 <span class="comment">// Internal helper function to build a device settings structure based upon the match </span>
<a name="l01553"></a>01553 <span class="comment">// options.  If the match option is set to ignore, then a optimal default value is used.</span>
<a name="l01554"></a>01554 <span class="comment">// The default value may not exist on the system, but later this will be taken </span>
<a name="l01555"></a>01555 <span class="comment">// into account.</span>
<a name="l01556"></a>01556 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l01557"></a><a class="code" href="_d_x_u_t_8cpp.html#a35">01557</a> <span class="keywordtype">void</span> <a class="code" href="_d_x_u_t_8cpp.html#a35">DXUTBuildOptimalDeviceSettings</a>( <a class="code" href="struct_d_x_u_t_device_settings.html">DXUTDeviceSettings</a>* pOptimalDeviceSettings, 
<a name="l01558"></a>01558                                      <a class="code" href="struct_d_x_u_t_device_settings.html">DXUTDeviceSettings</a>* pDeviceSettingsIn, 
<a name="l01559"></a>01559                                      <a class="code" href="struct_d_x_u_t_match_options.html">DXUTMatchOptions</a>* pMatchOptions )
<a name="l01560"></a>01560 {
<a name="l01561"></a>01561     IDirect3D9* pD3D = <a class="code" href="_d_x_u_t_8cpp.html#a93">DXUTGetD3DObject</a>();
<a name="l01562"></a>01562     D3DDISPLAYMODE adapterDesktopDisplayMode;
<a name="l01563"></a>01563 
<a name="l01564"></a>01564     ZeroMemory( pOptimalDeviceSettings, <span class="keyword">sizeof</span>(<a class="code" href="struct_d_x_u_t_device_settings.html">DXUTDeviceSettings</a>) ); 
<a name="l01565"></a>01565 
<a name="l01566"></a>01566     <span class="comment">//---------------------</span>
<a name="l01567"></a>01567     <span class="comment">// Adapter ordinal</span>
<a name="l01568"></a>01568     <span class="comment">//---------------------    </span>
<a name="l01569"></a>01569     <span class="keywordflow">if</span>( pMatchOptions-&gt;<a class="code" href="struct_d_x_u_t_match_options.html#o0">eAdapterOrdinal</a> == <a class="code" href="_d_x_u_t_8h.html#a87a21">DXUTMT_IGNORE_INPUT</a> )
<a name="l01570"></a>01570         pOptimalDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o0">AdapterOrdinal</a> = D3DADAPTER_DEFAULT; 
<a name="l01571"></a>01571     <span class="keywordflow">else</span>
<a name="l01572"></a>01572         pOptimalDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o0">AdapterOrdinal</a> = pDeviceSettingsIn-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o0">AdapterOrdinal</a>;      
<a name="l01573"></a>01573 
<a name="l01574"></a>01574     <span class="comment">//---------------------</span>
<a name="l01575"></a>01575     <span class="comment">// Device type</span>
<a name="l01576"></a>01576     <span class="comment">//---------------------</span>
<a name="l01577"></a>01577     <span class="keywordflow">if</span>( pMatchOptions-&gt;<a class="code" href="struct_d_x_u_t_match_options.html#o1">eDeviceType</a> == <a class="code" href="_d_x_u_t_8h.html#a87a21">DXUTMT_IGNORE_INPUT</a> )
<a name="l01578"></a>01578         pOptimalDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o1">DeviceType</a> = D3DDEVTYPE_HAL; 
<a name="l01579"></a>01579     <span class="keywordflow">else</span>
<a name="l01580"></a>01580         pOptimalDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o1">DeviceType</a> = pDeviceSettingsIn-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o1">DeviceType</a>;
<a name="l01581"></a>01581 
<a name="l01582"></a>01582     <span class="comment">//---------------------</span>
<a name="l01583"></a>01583     <span class="comment">// Windowed</span>
<a name="l01584"></a>01584     <span class="comment">//---------------------</span>
<a name="l01585"></a>01585     <span class="keywordflow">if</span>( pMatchOptions-&gt;<a class="code" href="struct_d_x_u_t_match_options.html#o2">eWindowed</a> == <a class="code" href="_d_x_u_t_8h.html#a87a21">DXUTMT_IGNORE_INPUT</a> )
<a name="l01586"></a>01586         pOptimalDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.Windowed = TRUE; 
<a name="l01587"></a>01587     <span class="keywordflow">else</span>
<a name="l01588"></a>01588         pOptimalDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.Windowed = pDeviceSettingsIn-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.Windowed;
<a name="l01589"></a>01589 
<a name="l01590"></a>01590     <span class="comment">//---------------------</span>
<a name="l01591"></a>01591     <span class="comment">// Adapter format</span>
<a name="l01592"></a>01592     <span class="comment">//---------------------</span>
<a name="l01593"></a>01593     <span class="keywordflow">if</span>( pMatchOptions-&gt;<a class="code" href="struct_d_x_u_t_match_options.html#o3">eAdapterFormat</a> == <a class="code" href="_d_x_u_t_8h.html#a87a21">DXUTMT_IGNORE_INPUT</a> )
<a name="l01594"></a>01594     {
<a name="l01595"></a>01595         <span class="comment">// If windowed, default to the desktop display mode</span>
<a name="l01596"></a>01596         <span class="comment">// If fullscreen, default to the desktop display mode for quick mode change or </span>
<a name="l01597"></a>01597         <span class="comment">// default to D3DFMT_X8R8G8B8 if the desktop display mode is &lt; 32bit</span>
<a name="l01598"></a>01598         pD3D-&gt;GetAdapterDisplayMode( pOptimalDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o0">AdapterOrdinal</a>, &amp;adapterDesktopDisplayMode );
<a name="l01599"></a>01599         <span class="keywordflow">if</span>( pOptimalDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.Windowed || <a class="code" href="_d_x_u_t_8cpp.html#a56">DXUTColorChannelBits</a>(adapterDesktopDisplayMode.Format) &gt;= 8 )
<a name="l01600"></a>01600             pOptimalDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o2">AdapterFormat</a> = adapterDesktopDisplayMode.Format;
<a name="l01601"></a>01601         <span class="keywordflow">else</span>
<a name="l01602"></a>01602             pOptimalDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o2">AdapterFormat</a> = D3DFMT_X8R8G8B8;
<a name="l01603"></a>01603     }
<a name="l01604"></a>01604     <span class="keywordflow">else</span>
<a name="l01605"></a>01605     {
<a name="l01606"></a>01606         pOptimalDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o2">AdapterFormat</a> = pDeviceSettingsIn-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o2">AdapterFormat</a>;
<a name="l01607"></a>01607     }
<a name="l01608"></a>01608 
<a name="l01609"></a>01609     <span class="comment">//---------------------</span>
<a name="l01610"></a>01610     <span class="comment">// Vertex processing</span>
<a name="l01611"></a>01611     <span class="comment">//---------------------</span>
<a name="l01612"></a>01612     <span class="keywordflow">if</span>( pMatchOptions-&gt;<a class="code" href="struct_d_x_u_t_match_options.html#o4">eVertexProcessing</a> == <a class="code" href="_d_x_u_t_8h.html#a87a21">DXUTMT_IGNORE_INPUT</a> )
<a name="l01613"></a>01613         pOptimalDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o3">BehaviorFlags</a> = D3DCREATE_HARDWARE_VERTEXPROCESSING; 
<a name="l01614"></a>01614     <span class="keywordflow">else</span>
<a name="l01615"></a>01615         pOptimalDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o3">BehaviorFlags</a> = pDeviceSettingsIn-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o3">BehaviorFlags</a>;
<a name="l01616"></a>01616 
<a name="l01617"></a>01617     <span class="comment">//---------------------</span>
<a name="l01618"></a>01618     <span class="comment">// Resolution</span>
<a name="l01619"></a>01619     <span class="comment">//---------------------</span>
<a name="l01620"></a>01620     <span class="keywordflow">if</span>( pMatchOptions-&gt;<a class="code" href="struct_d_x_u_t_match_options.html#o5">eResolution</a> == <a class="code" href="_d_x_u_t_8h.html#a87a21">DXUTMT_IGNORE_INPUT</a> )
<a name="l01621"></a>01621     {
<a name="l01622"></a>01622         <span class="comment">// If windowed, default to 640x480</span>
<a name="l01623"></a>01623         <span class="comment">// If fullscreen, default to the desktop res for quick mode change</span>
<a name="l01624"></a>01624         <span class="keywordflow">if</span>( pOptimalDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.Windowed )
<a name="l01625"></a>01625         {
<a name="l01626"></a>01626             pOptimalDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.BackBufferWidth = 640;
<a name="l01627"></a>01627             pOptimalDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.BackBufferHeight = 480;
<a name="l01628"></a>01628         }
<a name="l01629"></a>01629         <span class="keywordflow">else</span>
<a name="l01630"></a>01630         {
<a name="l01631"></a>01631             pD3D-&gt;GetAdapterDisplayMode( pOptimalDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o0">AdapterOrdinal</a>, &amp;adapterDesktopDisplayMode );
<a name="l01632"></a>01632             pOptimalDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.BackBufferWidth = adapterDesktopDisplayMode.Width;
<a name="l01633"></a>01633             pOptimalDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.BackBufferHeight = adapterDesktopDisplayMode.Height;
<a name="l01634"></a>01634         }
<a name="l01635"></a>01635     }
<a name="l01636"></a>01636     <span class="keywordflow">else</span>
<a name="l01637"></a>01637     {
<a name="l01638"></a>01638         pOptimalDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.BackBufferWidth = pDeviceSettingsIn-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.BackBufferWidth;
<a name="l01639"></a>01639         pOptimalDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.BackBufferHeight = pDeviceSettingsIn-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.BackBufferHeight;
<a name="l01640"></a>01640     }
<a name="l01641"></a>01641 
<a name="l01642"></a>01642     <span class="comment">//---------------------</span>
<a name="l01643"></a>01643     <span class="comment">// Back buffer format</span>
<a name="l01644"></a>01644     <span class="comment">//---------------------</span>
<a name="l01645"></a>01645     <span class="keywordflow">if</span>( pMatchOptions-&gt;<a class="code" href="struct_d_x_u_t_match_options.html#o6">eBackBufferFormat</a> == <a class="code" href="_d_x_u_t_8h.html#a87a21">DXUTMT_IGNORE_INPUT</a> )
<a name="l01646"></a>01646         pOptimalDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.BackBufferFormat = pOptimalDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o2">AdapterFormat</a>; <span class="comment">// Default to match the adapter format</span>
<a name="l01647"></a>01647     <span class="keywordflow">else</span>
<a name="l01648"></a>01648         pOptimalDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.BackBufferFormat = pDeviceSettingsIn-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.BackBufferFormat;
<a name="l01649"></a>01649 
<a name="l01650"></a>01650     <span class="comment">//---------------------</span>
<a name="l01651"></a>01651     <span class="comment">// Back buffer count</span>
<a name="l01652"></a>01652     <span class="comment">//---------------------</span>
<a name="l01653"></a>01653     <span class="keywordflow">if</span>( pMatchOptions-&gt;<a class="code" href="struct_d_x_u_t_match_options.html#o7">eBackBufferCount</a> == <a class="code" href="_d_x_u_t_8h.html#a87a21">DXUTMT_IGNORE_INPUT</a> )
<a name="l01654"></a>01654         pOptimalDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.BackBufferCount = 2; <span class="comment">// Default to triple buffering for perf gain</span>
<a name="l01655"></a>01655     <span class="keywordflow">else</span>
<a name="l01656"></a>01656         pOptimalDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.BackBufferCount = pDeviceSettingsIn-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.BackBufferCount;
<a name="l01657"></a>01657    
<a name="l01658"></a>01658     <span class="comment">//---------------------</span>
<a name="l01659"></a>01659     <span class="comment">// Multisample</span>
<a name="l01660"></a>01660     <span class="comment">//---------------------</span>
<a name="l01661"></a>01661     <span class="keywordflow">if</span>( pMatchOptions-&gt;<a class="code" href="struct_d_x_u_t_match_options.html#o8">eMultiSample</a> == <a class="code" href="_d_x_u_t_8h.html#a87a21">DXUTMT_IGNORE_INPUT</a> )
<a name="l01662"></a>01662     {
<a name="l01663"></a>01663         <span class="comment">// Default to no multisampling </span>
<a name="l01664"></a>01664         pOptimalDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.MultiSampleType = D3DMULTISAMPLE_NONE;
<a name="l01665"></a>01665         pOptimalDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.MultiSampleQuality = 0; 
<a name="l01666"></a>01666     }
<a name="l01667"></a>01667     <span class="keywordflow">else</span>
<a name="l01668"></a>01668     {
<a name="l01669"></a>01669         pOptimalDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.MultiSampleType = pDeviceSettingsIn-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.MultiSampleType;
<a name="l01670"></a>01670         pOptimalDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.MultiSampleQuality = pDeviceSettingsIn-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.MultiSampleQuality;
<a name="l01671"></a>01671     }
<a name="l01672"></a>01672 
<a name="l01673"></a>01673     <span class="comment">//---------------------</span>
<a name="l01674"></a>01674     <span class="comment">// Swap effect</span>
<a name="l01675"></a>01675     <span class="comment">//---------------------</span>
<a name="l01676"></a>01676     <span class="keywordflow">if</span>( pMatchOptions-&gt;<a class="code" href="struct_d_x_u_t_match_options.html#o9">eSwapEffect</a> == <a class="code" href="_d_x_u_t_8h.html#a87a21">DXUTMT_IGNORE_INPUT</a> )
<a name="l01677"></a>01677         pOptimalDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.SwapEffect = D3DSWAPEFFECT_DISCARD; 
<a name="l01678"></a>01678     <span class="keywordflow">else</span>
<a name="l01679"></a>01679         pOptimalDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.SwapEffect = pDeviceSettingsIn-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.SwapEffect;
<a name="l01680"></a>01680 
<a name="l01681"></a>01681     <span class="comment">//---------------------</span>
<a name="l01682"></a>01682     <span class="comment">// Depth stencil </span>
<a name="l01683"></a>01683     <span class="comment">//---------------------</span>
<a name="l01684"></a>01684     <span class="keywordflow">if</span>( pMatchOptions-&gt;<a class="code" href="struct_d_x_u_t_match_options.html#o10">eDepthFormat</a> == <a class="code" href="_d_x_u_t_8h.html#a87a21">DXUTMT_IGNORE_INPUT</a> &amp;&amp;
<a name="l01685"></a>01685         pMatchOptions-&gt;<a class="code" href="struct_d_x_u_t_match_options.html#o11">eStencilFormat</a> == <a class="code" href="_d_x_u_t_8h.html#a87a21">DXUTMT_IGNORE_INPUT</a> )
<a name="l01686"></a>01686     {
<a name="l01687"></a>01687         <a class="code" href="_d_x_u_tgui_8cpp.html#a45">UINT</a> nBackBufferBits = <a class="code" href="_d_x_u_t_8cpp.html#a56">DXUTColorChannelBits</a>( pOptimalDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.BackBufferFormat );
<a name="l01688"></a>01688         <span class="keywordflow">if</span>( nBackBufferBits &gt;= 8 )
<a name="l01689"></a>01689             pOptimalDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.AutoDepthStencilFormat = D3DFMT_D32; 
<a name="l01690"></a>01690         <span class="keywordflow">else</span>
<a name="l01691"></a>01691             pOptimalDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.AutoDepthStencilFormat = D3DFMT_D16; 
<a name="l01692"></a>01692     }
<a name="l01693"></a>01693     <span class="keywordflow">else</span>
<a name="l01694"></a>01694     {
<a name="l01695"></a>01695         pOptimalDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.AutoDepthStencilFormat = pDeviceSettingsIn-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.AutoDepthStencilFormat;
<a name="l01696"></a>01696     }
<a name="l01697"></a>01697 
<a name="l01698"></a>01698     <span class="comment">//---------------------</span>
<a name="l01699"></a>01699     <span class="comment">// Present flags</span>
<a name="l01700"></a>01700     <span class="comment">//---------------------</span>
<a name="l01701"></a>01701     <span class="keywordflow">if</span>( pMatchOptions-&gt;<a class="code" href="struct_d_x_u_t_match_options.html#o12">ePresentFlags</a> == <a class="code" href="_d_x_u_t_8h.html#a87a21">DXUTMT_IGNORE_INPUT</a> )
<a name="l01702"></a>01702         pOptimalDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.Flags = D3DPRESENTFLAG_DISCARD_DEPTHSTENCIL;
<a name="l01703"></a>01703     <span class="keywordflow">else</span>
<a name="l01704"></a>01704         pOptimalDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.Flags = pDeviceSettingsIn-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.Flags;
<a name="l01705"></a>01705 
<a name="l01706"></a>01706     <span class="comment">//---------------------</span>
<a name="l01707"></a>01707     <span class="comment">// Refresh rate</span>
<a name="l01708"></a>01708     <span class="comment">//---------------------</span>
<a name="l01709"></a>01709     <span class="keywordflow">if</span>( pMatchOptions-&gt;<a class="code" href="struct_d_x_u_t_match_options.html#o13">eRefreshRate</a> == <a class="code" href="_d_x_u_t_8h.html#a87a21">DXUTMT_IGNORE_INPUT</a> )
<a name="l01710"></a>01710         pOptimalDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.FullScreen_RefreshRateInHz = 0;
<a name="l01711"></a>01711     <span class="keywordflow">else</span>
<a name="l01712"></a>01712         pOptimalDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.FullScreen_RefreshRateInHz = pDeviceSettingsIn-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.FullScreen_RefreshRateInHz;
<a name="l01713"></a>01713 
<a name="l01714"></a>01714     <span class="comment">//---------------------</span>
<a name="l01715"></a>01715     <span class="comment">// Present interval</span>
<a name="l01716"></a>01716     <span class="comment">//---------------------</span>
<a name="l01717"></a>01717     <span class="keywordflow">if</span>( pMatchOptions-&gt;<a class="code" href="struct_d_x_u_t_match_options.html#o14">ePresentInterval</a> == <a class="code" href="_d_x_u_t_8h.html#a87a21">DXUTMT_IGNORE_INPUT</a> )
<a name="l01718"></a>01718     {
<a name="l01719"></a>01719         <span class="comment">// For windowed, default to D3DPRESENT_INTERVAL_IMMEDIATE</span>
<a name="l01720"></a>01720         <span class="comment">// which will wait not for the vertical retrace period to prevent tearing, </span>
<a name="l01721"></a>01721         <span class="comment">// but may introduce tearing.</span>
<a name="l01722"></a>01722         <span class="comment">// For full screen, default to D3DPRESENT_INTERVAL_DEFAULT </span>
<a name="l01723"></a>01723         <span class="comment">// which will wait for the vertical retrace period to prevent tearing.</span>
<a name="l01724"></a>01724         <span class="keywordflow">if</span>( pOptimalDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.Windowed )
<a name="l01725"></a>01725             pOptimalDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.PresentationInterval = D3DPRESENT_INTERVAL_IMMEDIATE;
<a name="l01726"></a>01726         <span class="keywordflow">else</span>
<a name="l01727"></a>01727             pOptimalDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.PresentationInterval = D3DPRESENT_INTERVAL_DEFAULT;
<a name="l01728"></a>01728     }
<a name="l01729"></a>01729     <span class="keywordflow">else</span>
<a name="l01730"></a>01730     {
<a name="l01731"></a>01731         pOptimalDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.PresentationInterval = pDeviceSettingsIn-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.PresentationInterval;
<a name="l01732"></a>01732     }
<a name="l01733"></a>01733 }
<a name="l01734"></a>01734 
<a name="l01735"></a>01735 
<a name="l01736"></a>01736 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l01737"></a>01737 <span class="comment">// Returns false for any CD3DEnumDeviceSettingsCombo that doesn't meet the preserve </span>
<a name="l01738"></a>01738 <span class="comment">// match options against the input pDeviceSettingsIn.</span>
<a name="l01739"></a>01739 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l01740"></a><a class="code" href="_d_x_u_t_8cpp.html#a36">01740</a> <span class="keywordtype">bool</span> <a class="code" href="_d_x_u_t_8cpp.html#a36">DXUTDoesDeviceComboMatchPreserveOptions</a>( <a class="code" href="struct_c_d3_d_enum_device_settings_combo.html">CD3DEnumDeviceSettingsCombo</a>* pDeviceSettingsCombo, 
<a name="l01741"></a>01741                                                  <a class="code" href="struct_d_x_u_t_device_settings.html">DXUTDeviceSettings</a>* pDeviceSettingsIn, 
<a name="l01742"></a>01742                                                  <a class="code" href="struct_d_x_u_t_match_options.html">DXUTMatchOptions</a>* pMatchOptions )
<a name="l01743"></a>01743 {
<a name="l01744"></a>01744     <span class="comment">//---------------------</span>
<a name="l01745"></a>01745     <span class="comment">// Adapter ordinal</span>
<a name="l01746"></a>01746     <span class="comment">//---------------------</span>
<a name="l01747"></a>01747     <span class="keywordflow">if</span>( pMatchOptions-&gt;<a class="code" href="struct_d_x_u_t_match_options.html#o0">eAdapterOrdinal</a> == <a class="code" href="_d_x_u_t_8h.html#a87a22">DXUTMT_PRESERVE_INPUT</a> &amp;&amp; 
<a name="l01748"></a>01748         (pDeviceSettingsCombo-&gt;<a class="code" href="struct_c_d3_d_enum_device_settings_combo.html#o0">AdapterOrdinal</a> != pDeviceSettingsIn-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o0">AdapterOrdinal</a>) )
<a name="l01749"></a>01749         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01750"></a>01750 
<a name="l01751"></a>01751     <span class="comment">//---------------------</span>
<a name="l01752"></a>01752     <span class="comment">// Device type</span>
<a name="l01753"></a>01753     <span class="comment">//---------------------</span>
<a name="l01754"></a>01754     <span class="keywordflow">if</span>( pMatchOptions-&gt;<a class="code" href="struct_d_x_u_t_match_options.html#o1">eDeviceType</a> == <a class="code" href="_d_x_u_t_8h.html#a87a22">DXUTMT_PRESERVE_INPUT</a> &amp;&amp; 
<a name="l01755"></a>01755         (pDeviceSettingsCombo-&gt;<a class="code" href="struct_c_d3_d_enum_device_settings_combo.html#o1">DeviceType</a> != pDeviceSettingsIn-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o1">DeviceType</a>) )
<a name="l01756"></a>01756         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01757"></a>01757 
<a name="l01758"></a>01758     <span class="comment">//---------------------</span>
<a name="l01759"></a>01759     <span class="comment">// Windowed</span>
<a name="l01760"></a>01760     <span class="comment">//---------------------</span>
<a name="l01761"></a>01761     <span class="keywordflow">if</span>( pMatchOptions-&gt;<a class="code" href="struct_d_x_u_t_match_options.html#o2">eWindowed</a> == <a class="code" href="_d_x_u_t_8h.html#a87a22">DXUTMT_PRESERVE_INPUT</a> &amp;&amp; 
<a name="l01762"></a>01762         (pDeviceSettingsCombo-&gt;<a class="code" href="struct_c_d3_d_enum_device_settings_combo.html#o4">Windowed</a> != pDeviceSettingsIn-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.Windowed) )
<a name="l01763"></a>01763         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01764"></a>01764 
<a name="l01765"></a>01765     <span class="comment">//---------------------</span>
<a name="l01766"></a>01766     <span class="comment">// Adapter format</span>
<a name="l01767"></a>01767     <span class="comment">//---------------------</span>
<a name="l01768"></a>01768     <span class="keywordflow">if</span>( pMatchOptions-&gt;<a class="code" href="struct_d_x_u_t_match_options.html#o3">eAdapterFormat</a> == <a class="code" href="_d_x_u_t_8h.html#a87a22">DXUTMT_PRESERVE_INPUT</a> &amp;&amp; 
<a name="l01769"></a>01769         (pDeviceSettingsCombo-&gt;<a class="code" href="struct_c_d3_d_enum_device_settings_combo.html#o2">AdapterFormat</a> != pDeviceSettingsIn-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o2">AdapterFormat</a>) )
<a name="l01770"></a>01770         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01771"></a>01771 
<a name="l01772"></a>01772     <span class="comment">//---------------------</span>
<a name="l01773"></a>01773     <span class="comment">// Vertex processing</span>
<a name="l01774"></a>01774     <span class="comment">//---------------------</span>
<a name="l01775"></a>01775     <span class="comment">// If keep VP and input has HWVP, then skip if this combo doesn't have HWTL </span>
<a name="l01776"></a>01776     <span class="keywordflow">if</span>( pMatchOptions-&gt;<a class="code" href="struct_d_x_u_t_match_options.html#o4">eVertexProcessing</a> == <a class="code" href="_d_x_u_t_8h.html#a87a22">DXUTMT_PRESERVE_INPUT</a> &amp;&amp; 
<a name="l01777"></a>01777         ((pDeviceSettingsIn-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o3">BehaviorFlags</a> &amp; D3DCREATE_HARDWARE_VERTEXPROCESSING) != 0) &amp;&amp; 
<a name="l01778"></a>01778         ((pDeviceSettingsCombo-&gt;<a class="code" href="struct_c_d3_d_enum_device_settings_combo.html#o11">pDeviceInfo</a>-&gt;<a class="code" href="class_c_d3_d_enum_device_info.html#o2">Caps</a>.DevCaps &amp; D3DDEVCAPS_HWTRANSFORMANDLIGHT) == 0) )
<a name="l01779"></a>01779         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01780"></a>01780 
<a name="l01781"></a>01781     <span class="comment">//---------------------</span>
<a name="l01782"></a>01782     <span class="comment">// Resolution</span>
<a name="l01783"></a>01783     <span class="comment">//---------------------</span>
<a name="l01784"></a>01784     <span class="comment">// If keep resolution then check that width and height supported by this combo</span>
<a name="l01785"></a>01785     <span class="keywordflow">if</span>( pMatchOptions-&gt;<a class="code" href="struct_d_x_u_t_match_options.html#o5">eResolution</a> == <a class="code" href="_d_x_u_t_8h.html#a87a22">DXUTMT_PRESERVE_INPUT</a> )
<a name="l01786"></a>01786     {
<a name="l01787"></a>01787         <span class="keywordtype">bool</span> bFound = <span class="keyword">false</span>;
<a name="l01788"></a>01788         <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=0; i&lt; pDeviceSettingsCombo-&gt;<a class="code" href="struct_c_d3_d_enum_device_settings_combo.html#o10">pAdapterInfo</a>-&gt;<a class="code" href="class_c_d3_d_enum_adapter_info.html#o3">displayModeList</a>.<a class="code" href="class_c_growable_array.html#a11">GetSize</a>(); i++ )
<a name="l01789"></a>01789         {
<a name="l01790"></a>01790             D3DDISPLAYMODE displayMode = pDeviceSettingsCombo-&gt;<a class="code" href="struct_c_d3_d_enum_device_settings_combo.html#o10">pAdapterInfo</a>-&gt;<a class="code" href="class_c_d3_d_enum_adapter_info.html#o3">displayModeList</a>.<a class="code" href="class_c_growable_array.html#a10">GetAt</a>( i );
<a name="l01791"></a>01791             <span class="keywordflow">if</span>( displayMode.Format != pDeviceSettingsCombo-&gt;<a class="code" href="struct_c_d3_d_enum_device_settings_combo.html#o2">AdapterFormat</a> )
<a name="l01792"></a>01792                 <span class="keywordflow">continue</span>; <span class="comment">// Skip this display mode if it doesn't match the combo's adapter format</span>
<a name="l01793"></a>01793 
<a name="l01794"></a>01794             <span class="keywordflow">if</span>( displayMode.Width == pDeviceSettingsIn-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.BackBufferWidth &amp;&amp;
<a name="l01795"></a>01795                 displayMode.Height == pDeviceSettingsIn-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.BackBufferHeight )
<a name="l01796"></a>01796             {
<a name="l01797"></a>01797                 bFound = <span class="keyword">true</span>;
<a name="l01798"></a>01798                 <span class="keywordflow">break</span>;
<a name="l01799"></a>01799             }
<a name="l01800"></a>01800         }
<a name="l01801"></a>01801 
<a name="l01802"></a>01802         <span class="comment">// If the width and height are not supported by this combo, return false</span>
<a name="l01803"></a>01803         <span class="keywordflow">if</span>( !bFound )
<a name="l01804"></a>01804             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01805"></a>01805     }
<a name="l01806"></a>01806 
<a name="l01807"></a>01807     <span class="comment">//---------------------</span>
<a name="l01808"></a>01808     <span class="comment">// Back buffer format</span>
<a name="l01809"></a>01809     <span class="comment">//---------------------</span>
<a name="l01810"></a>01810     <span class="keywordflow">if</span>( pMatchOptions-&gt;<a class="code" href="struct_d_x_u_t_match_options.html#o6">eBackBufferFormat</a> == <a class="code" href="_d_x_u_t_8h.html#a87a22">DXUTMT_PRESERVE_INPUT</a> &amp;&amp; 
<a name="l01811"></a>01811         pDeviceSettingsCombo-&gt;<a class="code" href="struct_c_d3_d_enum_device_settings_combo.html#o3">BackBufferFormat</a> != pDeviceSettingsIn-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.BackBufferFormat )
<a name="l01812"></a>01812         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01813"></a>01813 
<a name="l01814"></a>01814     <span class="comment">//---------------------</span>
<a name="l01815"></a>01815     <span class="comment">// Back buffer count</span>
<a name="l01816"></a>01816     <span class="comment">//---------------------</span>
<a name="l01817"></a>01817     <span class="comment">// No caps for the back buffer count</span>
<a name="l01818"></a>01818 
<a name="l01819"></a>01819     <span class="comment">//---------------------</span>
<a name="l01820"></a>01820     <span class="comment">// Multisample</span>
<a name="l01821"></a>01821     <span class="comment">//---------------------</span>
<a name="l01822"></a>01822     <span class="keywordflow">if</span>( pMatchOptions-&gt;<a class="code" href="struct_d_x_u_t_match_options.html#o8">eMultiSample</a> == <a class="code" href="_d_x_u_t_8h.html#a87a22">DXUTMT_PRESERVE_INPUT</a> )
<a name="l01823"></a>01823     {
<a name="l01824"></a>01824         <span class="keywordtype">bool</span> bFound = <span class="keyword">false</span>;
<a name="l01825"></a>01825         <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=0; i&lt;pDeviceSettingsCombo-&gt;<a class="code" href="struct_c_d3_d_enum_device_settings_combo.html#o6">multiSampleTypeList</a>.<a class="code" href="class_c_growable_array.html#a11">GetSize</a>(); i++ )
<a name="l01826"></a>01826         {
<a name="l01827"></a>01827             D3DMULTISAMPLE_TYPE msType = pDeviceSettingsCombo-&gt;<a class="code" href="struct_c_d3_d_enum_device_settings_combo.html#o6">multiSampleTypeList</a>.<a class="code" href="class_c_growable_array.html#a10">GetAt</a>(i);
<a name="l01828"></a>01828             <a class="code" href="_d_x_u_tgui_8cpp.html#a38">DWORD</a> msQuality  = pDeviceSettingsCombo-&gt;<a class="code" href="struct_c_d3_d_enum_device_settings_combo.html#o7">multiSampleQualityList</a>.<a class="code" href="class_c_growable_array.html#a10">GetAt</a>(i);
<a name="l01829"></a>01829 
<a name="l01830"></a>01830             <span class="keywordflow">if</span>( msType == pDeviceSettingsIn-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.MultiSampleType &amp;&amp;
<a name="l01831"></a>01831                 msQuality &gt;= pDeviceSettingsIn-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.MultiSampleQuality )
<a name="l01832"></a>01832             {
<a name="l01833"></a>01833                 bFound = <span class="keyword">true</span>;
<a name="l01834"></a>01834                 <span class="keywordflow">break</span>;
<a name="l01835"></a>01835             }
<a name="l01836"></a>01836         }
<a name="l01837"></a>01837 
<a name="l01838"></a>01838         <span class="comment">// If multisample type/quality not supported by this combo, then return false</span>
<a name="l01839"></a>01839         <span class="keywordflow">if</span>( !bFound )
<a name="l01840"></a>01840             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01841"></a>01841     }
<a name="l01842"></a>01842         
<a name="l01843"></a>01843     <span class="comment">//---------------------</span>
<a name="l01844"></a>01844     <span class="comment">// Swap effect</span>
<a name="l01845"></a>01845     <span class="comment">//---------------------</span>
<a name="l01846"></a>01846     <span class="comment">// No caps for swap effects</span>
<a name="l01847"></a>01847 
<a name="l01848"></a>01848     <span class="comment">//---------------------</span>
<a name="l01849"></a>01849     <span class="comment">// Depth stencil </span>
<a name="l01850"></a>01850     <span class="comment">//---------------------</span>
<a name="l01851"></a>01851     <span class="comment">// If keep depth stencil format then check that the depth stencil format is supported by this combo</span>
<a name="l01852"></a>01852     <span class="keywordflow">if</span>( pMatchOptions-&gt;<a class="code" href="struct_d_x_u_t_match_options.html#o10">eDepthFormat</a> == <a class="code" href="_d_x_u_t_8h.html#a87a22">DXUTMT_PRESERVE_INPUT</a> &amp;&amp;
<a name="l01853"></a>01853         pMatchOptions-&gt;<a class="code" href="struct_d_x_u_t_match_options.html#o11">eStencilFormat</a> == <a class="code" href="_d_x_u_t_8h.html#a87a22">DXUTMT_PRESERVE_INPUT</a> )
<a name="l01854"></a>01854     {
<a name="l01855"></a>01855         <span class="keywordflow">if</span>( pDeviceSettingsIn-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.AutoDepthStencilFormat != D3DFMT_UNKNOWN &amp;&amp;
<a name="l01856"></a>01856             !pDeviceSettingsCombo-&gt;<a class="code" href="struct_c_d3_d_enum_device_settings_combo.html#o5">depthStencilFormatList</a>.<a class="code" href="class_c_growable_array.html#a13">Contains</a>( pDeviceSettingsIn-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.AutoDepthStencilFormat ) )
<a name="l01857"></a>01857             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01858"></a>01858     }
<a name="l01859"></a>01859 
<a name="l01860"></a>01860     <span class="comment">// If keep depth format then check that the depth format is supported by this combo</span>
<a name="l01861"></a>01861     <span class="keywordflow">if</span>( pMatchOptions-&gt;<a class="code" href="struct_d_x_u_t_match_options.html#o10">eDepthFormat</a> == <a class="code" href="_d_x_u_t_8h.html#a87a22">DXUTMT_PRESERVE_INPUT</a> &amp;&amp;
<a name="l01862"></a>01862         pDeviceSettingsIn-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.AutoDepthStencilFormat != D3DFMT_UNKNOWN )
<a name="l01863"></a>01863     {
<a name="l01864"></a>01864         <span class="keywordtype">bool</span> bFound = <span class="keyword">false</span>;
<a name="l01865"></a>01865         <a class="code" href="_d_x_u_tgui_8cpp.html#a45">UINT</a> dwDepthBits = <a class="code" href="_d_x_u_t_8cpp.html#a58">DXUTDepthBits</a>( pDeviceSettingsIn-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.AutoDepthStencilFormat );
<a name="l01866"></a>01866         <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=0; i&lt;pDeviceSettingsCombo-&gt;<a class="code" href="struct_c_d3_d_enum_device_settings_combo.html#o5">depthStencilFormatList</a>.<a class="code" href="class_c_growable_array.html#a11">GetSize</a>(); i++ )
<a name="l01867"></a>01867         {
<a name="l01868"></a>01868             D3DFORMAT depthStencilFmt = pDeviceSettingsCombo-&gt;<a class="code" href="struct_c_d3_d_enum_device_settings_combo.html#o5">depthStencilFormatList</a>.<a class="code" href="class_c_growable_array.html#a10">GetAt</a>(i);
<a name="l01869"></a>01869             <a class="code" href="_d_x_u_tgui_8cpp.html#a45">UINT</a> dwCurDepthBits = <a class="code" href="_d_x_u_t_8cpp.html#a58">DXUTDepthBits</a>( depthStencilFmt );
<a name="l01870"></a>01870             <span class="keywordflow">if</span>( dwCurDepthBits - dwDepthBits == 0)
<a name="l01871"></a>01871                 bFound = <span class="keyword">true</span>;
<a name="l01872"></a>01872         }
<a name="l01873"></a>01873 
<a name="l01874"></a>01874         <span class="keywordflow">if</span>( !bFound )
<a name="l01875"></a>01875             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01876"></a>01876     }
<a name="l01877"></a>01877 
<a name="l01878"></a>01878     <span class="comment">// If keep depth format then check that the depth format is supported by this combo</span>
<a name="l01879"></a>01879     <span class="keywordflow">if</span>( pMatchOptions-&gt;<a class="code" href="struct_d_x_u_t_match_options.html#o11">eStencilFormat</a> == <a class="code" href="_d_x_u_t_8h.html#a87a22">DXUTMT_PRESERVE_INPUT</a> &amp;&amp;
<a name="l01880"></a>01880         pDeviceSettingsIn-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.AutoDepthStencilFormat != D3DFMT_UNKNOWN )
<a name="l01881"></a>01881     {
<a name="l01882"></a>01882         <span class="keywordtype">bool</span> bFound = <span class="keyword">false</span>;
<a name="l01883"></a>01883         <a class="code" href="_d_x_u_tgui_8cpp.html#a45">UINT</a> dwStencilBits = <a class="code" href="_d_x_u_t_8cpp.html#a57">DXUTStencilBits</a>( pDeviceSettingsIn-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.AutoDepthStencilFormat );
<a name="l01884"></a>01884         <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=0; i&lt;pDeviceSettingsCombo-&gt;<a class="code" href="struct_c_d3_d_enum_device_settings_combo.html#o5">depthStencilFormatList</a>.<a class="code" href="class_c_growable_array.html#a11">GetSize</a>(); i++ )
<a name="l01885"></a>01885         {
<a name="l01886"></a>01886             D3DFORMAT depthStencilFmt = pDeviceSettingsCombo-&gt;<a class="code" href="struct_c_d3_d_enum_device_settings_combo.html#o5">depthStencilFormatList</a>.<a class="code" href="class_c_growable_array.html#a10">GetAt</a>(i);
<a name="l01887"></a>01887             <a class="code" href="_d_x_u_tgui_8cpp.html#a45">UINT</a> dwCurStencilBits = <a class="code" href="_d_x_u_t_8cpp.html#a57">DXUTStencilBits</a>( depthStencilFmt );
<a name="l01888"></a>01888             <span class="keywordflow">if</span>( dwCurStencilBits - dwStencilBits == 0)
<a name="l01889"></a>01889                 bFound = <span class="keyword">true</span>;
<a name="l01890"></a>01890         }
<a name="l01891"></a>01891 
<a name="l01892"></a>01892         <span class="keywordflow">if</span>( !bFound )
<a name="l01893"></a>01893             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01894"></a>01894     }
<a name="l01895"></a>01895 
<a name="l01896"></a>01896     <span class="comment">//---------------------</span>
<a name="l01897"></a>01897     <span class="comment">// Present flags</span>
<a name="l01898"></a>01898     <span class="comment">//---------------------</span>
<a name="l01899"></a>01899     <span class="comment">// No caps for the present flags</span>
<a name="l01900"></a>01900 
<a name="l01901"></a>01901     <span class="comment">//---------------------</span>
<a name="l01902"></a>01902     <span class="comment">// Refresh rate</span>
<a name="l01903"></a>01903     <span class="comment">//---------------------</span>
<a name="l01904"></a>01904     <span class="comment">// If keep refresh rate then check that the resolution is supported by this combo</span>
<a name="l01905"></a>01905     <span class="keywordflow">if</span>( pMatchOptions-&gt;<a class="code" href="struct_d_x_u_t_match_options.html#o13">eRefreshRate</a> == <a class="code" href="_d_x_u_t_8h.html#a87a22">DXUTMT_PRESERVE_INPUT</a> )
<a name="l01906"></a>01906     {
<a name="l01907"></a>01907         <span class="keywordtype">bool</span> bFound = <span class="keyword">false</span>;
<a name="l01908"></a>01908         <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=0; i&lt;pDeviceSettingsCombo-&gt;<a class="code" href="struct_c_d3_d_enum_device_settings_combo.html#o10">pAdapterInfo</a>-&gt;<a class="code" href="class_c_d3_d_enum_adapter_info.html#o3">displayModeList</a>.<a class="code" href="class_c_growable_array.html#a11">GetSize</a>(); i++ )
<a name="l01909"></a>01909         {
<a name="l01910"></a>01910             D3DDISPLAYMODE displayMode = pDeviceSettingsCombo-&gt;<a class="code" href="struct_c_d3_d_enum_device_settings_combo.html#o10">pAdapterInfo</a>-&gt;<a class="code" href="class_c_d3_d_enum_adapter_info.html#o3">displayModeList</a>.<a class="code" href="class_c_growable_array.html#a10">GetAt</a>( i );
<a name="l01911"></a>01911             <span class="keywordflow">if</span>( displayMode.Format != pDeviceSettingsCombo-&gt;<a class="code" href="struct_c_d3_d_enum_device_settings_combo.html#o2">AdapterFormat</a> )
<a name="l01912"></a>01912                 <span class="keywordflow">continue</span>;
<a name="l01913"></a>01913             <span class="keywordflow">if</span>( displayMode.RefreshRate == pDeviceSettingsIn-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.FullScreen_RefreshRateInHz )
<a name="l01914"></a>01914             {
<a name="l01915"></a>01915                 bFound = <span class="keyword">true</span>;
<a name="l01916"></a>01916                 <span class="keywordflow">break</span>;
<a name="l01917"></a>01917             }
<a name="l01918"></a>01918         }
<a name="l01919"></a>01919 
<a name="l01920"></a>01920         <span class="comment">// If refresh rate not supported by this combo, then return false</span>
<a name="l01921"></a>01921         <span class="keywordflow">if</span>( !bFound )
<a name="l01922"></a>01922             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01923"></a>01923     }
<a name="l01924"></a>01924 
<a name="l01925"></a>01925     <span class="comment">//---------------------</span>
<a name="l01926"></a>01926     <span class="comment">// Present interval</span>
<a name="l01927"></a>01927     <span class="comment">//---------------------</span>
<a name="l01928"></a>01928     <span class="comment">// If keep present interval then check that the present interval is supported by this combo</span>
<a name="l01929"></a>01929     <span class="keywordflow">if</span>( pMatchOptions-&gt;<a class="code" href="struct_d_x_u_t_match_options.html#o14">ePresentInterval</a> == <a class="code" href="_d_x_u_t_8h.html#a87a22">DXUTMT_PRESERVE_INPUT</a> &amp;&amp;
<a name="l01930"></a>01930         !pDeviceSettingsCombo-&gt;<a class="code" href="struct_c_d3_d_enum_device_settings_combo.html#o8">presentIntervalList</a>.<a class="code" href="class_c_growable_array.html#a13">Contains</a>( pDeviceSettingsIn-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.PresentationInterval ) )
<a name="l01931"></a>01931         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01932"></a>01932 
<a name="l01933"></a>01933     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01934"></a>01934 }
<a name="l01935"></a>01935 
<a name="l01936"></a>01936 
<a name="l01937"></a>01937 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l01938"></a>01938 <span class="comment">// Returns a ranking number that describes how closely this device </span>
<a name="l01939"></a>01939 <span class="comment">// combo matches the optimal combo based on the match options and the optimal device settings</span>
<a name="l01940"></a>01940 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l01941"></a><a class="code" href="_d_x_u_t_8cpp.html#a37">01941</a> <span class="keywordtype">float</span> <a class="code" href="_d_x_u_t_8cpp.html#a37">DXUTRankDeviceCombo</a>( <a class="code" href="struct_c_d3_d_enum_device_settings_combo.html">CD3DEnumDeviceSettingsCombo</a>* pDeviceSettingsCombo, 
<a name="l01942"></a>01942                            <a class="code" href="struct_d_x_u_t_device_settings.html">DXUTDeviceSettings</a>* pOptimalDeviceSettings,
<a name="l01943"></a>01943                            D3DDISPLAYMODE* pAdapterDesktopDisplayMode )
<a name="l01944"></a>01944 {
<a name="l01945"></a>01945     <span class="keywordtype">float</span> fCurRanking = 0.0f; 
<a name="l01946"></a>01946 
<a name="l01947"></a>01947     <span class="comment">// Arbitrary weights.  Gives preference to the ordinal, device type, and windowed</span>
<a name="l01948"></a>01948     <span class="keyword">const</span> <span class="keywordtype">float</span> fAdapterOrdinalWeight   = 1000.0f;
<a name="l01949"></a>01949     <span class="keyword">const</span> <span class="keywordtype">float</span> fDeviceTypeWeight       = 100.0f;
<a name="l01950"></a>01950     <span class="keyword">const</span> <span class="keywordtype">float</span> fWindowWeight           = 10.0f;
<a name="l01951"></a>01951     <span class="keyword">const</span> <span class="keywordtype">float</span> fAdapterFormatWeight    = 1.0f;
<a name="l01952"></a>01952     <span class="keyword">const</span> <span class="keywordtype">float</span> fVertexProcessingWeight = 1.0f;
<a name="l01953"></a>01953     <span class="keyword">const</span> <span class="keywordtype">float</span> fResolutionWeight       = 1.0f;
<a name="l01954"></a>01954     <span class="keyword">const</span> <span class="keywordtype">float</span> fBackBufferFormatWeight = 1.0f;
<a name="l01955"></a>01955     <span class="keyword">const</span> <span class="keywordtype">float</span> fMultiSampleWeight      = 1.0f;
<a name="l01956"></a>01956     <span class="keyword">const</span> <span class="keywordtype">float</span> fDepthStencilWeight     = 1.0f;
<a name="l01957"></a>01957     <span class="keyword">const</span> <span class="keywordtype">float</span> fRefreshRateWeight      = 1.0f;
<a name="l01958"></a>01958     <span class="keyword">const</span> <span class="keywordtype">float</span> fPresentIntervalWeight  = 1.0f;
<a name="l01959"></a>01959 
<a name="l01960"></a>01960     <span class="comment">//---------------------</span>
<a name="l01961"></a>01961     <span class="comment">// Adapter ordinal</span>
<a name="l01962"></a>01962     <span class="comment">//---------------------</span>
<a name="l01963"></a>01963     <span class="keywordflow">if</span>( pDeviceSettingsCombo-&gt;<a class="code" href="struct_c_d3_d_enum_device_settings_combo.html#o0">AdapterOrdinal</a> == pOptimalDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o0">AdapterOrdinal</a> )
<a name="l01964"></a>01964         fCurRanking += fAdapterOrdinalWeight;
<a name="l01965"></a>01965 
<a name="l01966"></a>01966     <span class="comment">//---------------------</span>
<a name="l01967"></a>01967     <span class="comment">// Device type</span>
<a name="l01968"></a>01968     <span class="comment">//---------------------</span>
<a name="l01969"></a>01969     <span class="keywordflow">if</span>( pDeviceSettingsCombo-&gt;<a class="code" href="struct_c_d3_d_enum_device_settings_combo.html#o1">DeviceType</a> == pOptimalDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o1">DeviceType</a> )
<a name="l01970"></a>01970         fCurRanking += fDeviceTypeWeight;
<a name="l01971"></a>01971     <span class="comment">// Slightly prefer HAL </span>
<a name="l01972"></a>01972     <span class="keywordflow">if</span>( pDeviceSettingsCombo-&gt;<a class="code" href="struct_c_d3_d_enum_device_settings_combo.html#o1">DeviceType</a> == D3DDEVTYPE_HAL )
<a name="l01973"></a>01973         fCurRanking += 0.1f; 
<a name="l01974"></a>01974 
<a name="l01975"></a>01975     <span class="comment">//---------------------</span>
<a name="l01976"></a>01976     <span class="comment">// Windowed</span>
<a name="l01977"></a>01977     <span class="comment">//---------------------</span>
<a name="l01978"></a>01978     <span class="keywordflow">if</span>( pDeviceSettingsCombo-&gt;<a class="code" href="struct_c_d3_d_enum_device_settings_combo.html#o4">Windowed</a> == pOptimalDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.Windowed )
<a name="l01979"></a>01979         fCurRanking += fWindowWeight;
<a name="l01980"></a>01980 
<a name="l01981"></a>01981     <span class="comment">//---------------------</span>
<a name="l01982"></a>01982     <span class="comment">// Adapter format</span>
<a name="l01983"></a>01983     <span class="comment">//---------------------</span>
<a name="l01984"></a>01984     <span class="keywordflow">if</span>( pDeviceSettingsCombo-&gt;<a class="code" href="struct_c_d3_d_enum_device_settings_combo.html#o2">AdapterFormat</a> == pOptimalDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o2">AdapterFormat</a> )
<a name="l01985"></a>01985     {
<a name="l01986"></a>01986         fCurRanking += fAdapterFormatWeight;
<a name="l01987"></a>01987     }
<a name="l01988"></a>01988     <span class="keywordflow">else</span>
<a name="l01989"></a>01989     {
<a name="l01990"></a>01990         <span class="keywordtype">int</span> nBitDepthDelta = abs( (<span class="keywordtype">long</span>) <a class="code" href="_d_x_u_t_8cpp.html#a56">DXUTColorChannelBits</a>(pDeviceSettingsCombo-&gt;<a class="code" href="struct_c_d3_d_enum_device_settings_combo.html#o2">AdapterFormat</a>) -
<a name="l01991"></a>01991                                   (<span class="keywordtype">long</span>) <a class="code" href="_d_x_u_t_8cpp.html#a56">DXUTColorChannelBits</a>(pOptimalDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o2">AdapterFormat</a>) );
<a name="l01992"></a>01992         <span class="keywordtype">float</span> fScale = __max(0.9f - (<span class="keywordtype">float</span>)nBitDepthDelta*0.2f, 0.0f);
<a name="l01993"></a>01993         fCurRanking += fScale * fAdapterFormatWeight;
<a name="l01994"></a>01994     }
<a name="l01995"></a>01995 
<a name="l01996"></a>01996     <span class="keywordflow">if</span>( !pDeviceSettingsCombo-&gt;<a class="code" href="struct_c_d3_d_enum_device_settings_combo.html#o4">Windowed</a> )
<a name="l01997"></a>01997     {
<a name="l01998"></a>01998         <span class="comment">// Slightly prefer when it matches the desktop format or is D3DFMT_X8R8G8B8</span>
<a name="l01999"></a>01999         <span class="keywordtype">bool</span> bAdapterOptimalMatch;
<a name="l02000"></a>02000         <span class="keywordflow">if</span>( <a class="code" href="_d_x_u_t_8cpp.html#a56">DXUTColorChannelBits</a>(pAdapterDesktopDisplayMode-&gt;Format) &gt;= 8 )
<a name="l02001"></a>02001             bAdapterOptimalMatch = (pDeviceSettingsCombo-&gt;<a class="code" href="struct_c_d3_d_enum_device_settings_combo.html#o2">AdapterFormat</a> == pAdapterDesktopDisplayMode-&gt;Format);
<a name="l02002"></a>02002         <span class="keywordflow">else</span>
<a name="l02003"></a>02003             bAdapterOptimalMatch = (pDeviceSettingsCombo-&gt;<a class="code" href="struct_c_d3_d_enum_device_settings_combo.html#o2">AdapterFormat</a> == D3DFMT_X8R8G8B8);
<a name="l02004"></a>02004 
<a name="l02005"></a>02005         <span class="keywordflow">if</span>( bAdapterOptimalMatch )
<a name="l02006"></a>02006             fCurRanking += 0.1f;
<a name="l02007"></a>02007     }
<a name="l02008"></a>02008 
<a name="l02009"></a>02009     <span class="comment">//---------------------</span>
<a name="l02010"></a>02010     <span class="comment">// Vertex processing</span>
<a name="l02011"></a>02011     <span class="comment">//---------------------</span>
<a name="l02012"></a>02012     <span class="keywordflow">if</span>( (pOptimalDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o3">BehaviorFlags</a> &amp; D3DCREATE_HARDWARE_VERTEXPROCESSING) != 0 || 
<a name="l02013"></a>02013         (pOptimalDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o3">BehaviorFlags</a> &amp; D3DCREATE_MIXED_VERTEXPROCESSING) != 0 )
<a name="l02014"></a>02014     {
<a name="l02015"></a>02015         <span class="keywordflow">if</span>( (pDeviceSettingsCombo-&gt;<a class="code" href="struct_c_d3_d_enum_device_settings_combo.html#o11">pDeviceInfo</a>-&gt;<a class="code" href="class_c_d3_d_enum_device_info.html#o2">Caps</a>.DevCaps &amp; D3DDEVCAPS_HWTRANSFORMANDLIGHT) != 0 )
<a name="l02016"></a>02016             fCurRanking += fVertexProcessingWeight;
<a name="l02017"></a>02017     }
<a name="l02018"></a>02018     <span class="comment">// Slightly prefer HW T&amp;L</span>
<a name="l02019"></a>02019     <span class="keywordflow">if</span>( (pDeviceSettingsCombo-&gt;<a class="code" href="struct_c_d3_d_enum_device_settings_combo.html#o11">pDeviceInfo</a>-&gt;<a class="code" href="class_c_d3_d_enum_device_info.html#o2">Caps</a>.DevCaps &amp; D3DDEVCAPS_HWTRANSFORMANDLIGHT) != 0 )
<a name="l02020"></a>02020         fCurRanking += 0.1f;
<a name="l02021"></a>02021 
<a name="l02022"></a>02022     <span class="comment">//---------------------</span>
<a name="l02023"></a>02023     <span class="comment">// Resolution</span>
<a name="l02024"></a>02024     <span class="comment">//---------------------</span>
<a name="l02025"></a>02025     <span class="keywordtype">bool</span> bResolutionFound = <span class="keyword">false</span>;
<a name="l02026"></a>02026     <span class="keywordflow">for</span>( <span class="keywordtype">int</span> idm = 0; idm &lt; pDeviceSettingsCombo-&gt;<a class="code" href="struct_c_d3_d_enum_device_settings_combo.html#o10">pAdapterInfo</a>-&gt;<a class="code" href="class_c_d3_d_enum_adapter_info.html#o3">displayModeList</a>.<a class="code" href="class_c_growable_array.html#a11">GetSize</a>(); idm++ )
<a name="l02027"></a>02027     {
<a name="l02028"></a>02028         D3DDISPLAYMODE displayMode = pDeviceSettingsCombo-&gt;<a class="code" href="struct_c_d3_d_enum_device_settings_combo.html#o10">pAdapterInfo</a>-&gt;<a class="code" href="class_c_d3_d_enum_adapter_info.html#o3">displayModeList</a>.<a class="code" href="class_c_growable_array.html#a10">GetAt</a>( idm );
<a name="l02029"></a>02029         <span class="keywordflow">if</span>( displayMode.Format != pDeviceSettingsCombo-&gt;<a class="code" href="struct_c_d3_d_enum_device_settings_combo.html#o2">AdapterFormat</a> )
<a name="l02030"></a>02030             <span class="keywordflow">continue</span>;
<a name="l02031"></a>02031         <span class="keywordflow">if</span>( displayMode.Width == pOptimalDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.BackBufferWidth &amp;&amp;
<a name="l02032"></a>02032             displayMode.Height == pOptimalDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.BackBufferHeight )
<a name="l02033"></a>02033             bResolutionFound = <span class="keyword">true</span>;
<a name="l02034"></a>02034     }
<a name="l02035"></a>02035     <span class="keywordflow">if</span>( bResolutionFound )
<a name="l02036"></a>02036         fCurRanking += fResolutionWeight;
<a name="l02037"></a>02037 
<a name="l02038"></a>02038     <span class="comment">//---------------------</span>
<a name="l02039"></a>02039     <span class="comment">// Back buffer format</span>
<a name="l02040"></a>02040     <span class="comment">//---------------------</span>
<a name="l02041"></a>02041     <span class="keywordflow">if</span>( pDeviceSettingsCombo-&gt;<a class="code" href="struct_c_d3_d_enum_device_settings_combo.html#o3">BackBufferFormat</a> == pOptimalDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.BackBufferFormat )
<a name="l02042"></a>02042     {
<a name="l02043"></a>02043         fCurRanking += fBackBufferFormatWeight;
<a name="l02044"></a>02044     }
<a name="l02045"></a>02045     <span class="keywordflow">else</span>
<a name="l02046"></a>02046     {
<a name="l02047"></a>02047         <span class="keywordtype">int</span> nBitDepthDelta = abs( (<span class="keywordtype">long</span>) <a class="code" href="_d_x_u_t_8cpp.html#a56">DXUTColorChannelBits</a>(pDeviceSettingsCombo-&gt;<a class="code" href="struct_c_d3_d_enum_device_settings_combo.html#o3">BackBufferFormat</a>) -
<a name="l02048"></a>02048                                   (<span class="keywordtype">long</span>) <a class="code" href="_d_x_u_t_8cpp.html#a56">DXUTColorChannelBits</a>(pOptimalDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.BackBufferFormat) );
<a name="l02049"></a>02049         <span class="keywordtype">float</span> fScale = __max(0.9f - (<span class="keywordtype">float</span>)nBitDepthDelta*0.2f, 0.0f);
<a name="l02050"></a>02050         fCurRanking += fScale * fBackBufferFormatWeight;
<a name="l02051"></a>02051     }
<a name="l02052"></a>02052 
<a name="l02053"></a>02053     <span class="comment">// Check if this back buffer format is the same as </span>
<a name="l02054"></a>02054     <span class="comment">// the adapter format since this is preferred.</span>
<a name="l02055"></a>02055     <span class="keywordtype">bool</span> bAdapterMatchesBB = (pDeviceSettingsCombo-&gt;<a class="code" href="struct_c_d3_d_enum_device_settings_combo.html#o3">BackBufferFormat</a> == pDeviceSettingsCombo-&gt;<a class="code" href="struct_c_d3_d_enum_device_settings_combo.html#o2">AdapterFormat</a>);
<a name="l02056"></a>02056     <span class="keywordflow">if</span>( bAdapterMatchesBB )
<a name="l02057"></a>02057         fCurRanking += 0.1f;
<a name="l02058"></a>02058 
<a name="l02059"></a>02059     <span class="comment">//---------------------</span>
<a name="l02060"></a>02060     <span class="comment">// Back buffer count</span>
<a name="l02061"></a>02061     <span class="comment">//---------------------</span>
<a name="l02062"></a>02062     <span class="comment">// No caps for the back buffer count</span>
<a name="l02063"></a>02063 
<a name="l02064"></a>02064     <span class="comment">//---------------------</span>
<a name="l02065"></a>02065     <span class="comment">// Multisample</span>
<a name="l02066"></a>02066     <span class="comment">//---------------------</span>
<a name="l02067"></a>02067     <span class="keywordtype">bool</span> bMultiSampleFound = <span class="keyword">false</span>;
<a name="l02068"></a>02068     <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=0; i&lt;pDeviceSettingsCombo-&gt;<a class="code" href="struct_c_d3_d_enum_device_settings_combo.html#o6">multiSampleTypeList</a>.<a class="code" href="class_c_growable_array.html#a11">GetSize</a>(); i++ )
<a name="l02069"></a>02069     {
<a name="l02070"></a>02070         D3DMULTISAMPLE_TYPE msType = pDeviceSettingsCombo-&gt;<a class="code" href="struct_c_d3_d_enum_device_settings_combo.html#o6">multiSampleTypeList</a>.<a class="code" href="class_c_growable_array.html#a10">GetAt</a>(i);
<a name="l02071"></a>02071         <a class="code" href="_d_x_u_tgui_8cpp.html#a38">DWORD</a> msQuality  = pDeviceSettingsCombo-&gt;<a class="code" href="struct_c_d3_d_enum_device_settings_combo.html#o7">multiSampleQualityList</a>.<a class="code" href="class_c_growable_array.html#a10">GetAt</a>(i);
<a name="l02072"></a>02072 
<a name="l02073"></a>02073         <span class="keywordflow">if</span>( msType == pOptimalDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.MultiSampleType &amp;&amp;
<a name="l02074"></a>02074             msQuality &gt;= pOptimalDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.MultiSampleQuality )
<a name="l02075"></a>02075         {
<a name="l02076"></a>02076             bMultiSampleFound = <span class="keyword">true</span>;
<a name="l02077"></a>02077             <span class="keywordflow">break</span>;
<a name="l02078"></a>02078         }
<a name="l02079"></a>02079     }
<a name="l02080"></a>02080     <span class="keywordflow">if</span>( bMultiSampleFound )
<a name="l02081"></a>02081         fCurRanking += fMultiSampleWeight;
<a name="l02082"></a>02082         
<a name="l02083"></a>02083     <span class="comment">//---------------------</span>
<a name="l02084"></a>02084     <span class="comment">// Swap effect</span>
<a name="l02085"></a>02085     <span class="comment">//---------------------</span>
<a name="l02086"></a>02086     <span class="comment">// No caps for swap effects</span>
<a name="l02087"></a>02087 
<a name="l02088"></a>02088     <span class="comment">//---------------------</span>
<a name="l02089"></a>02089     <span class="comment">// Depth stencil </span>
<a name="l02090"></a>02090     <span class="comment">//---------------------</span>
<a name="l02091"></a>02091     <span class="keywordflow">if</span>( pDeviceSettingsCombo-&gt;<a class="code" href="struct_c_d3_d_enum_device_settings_combo.html#o5">depthStencilFormatList</a>.<a class="code" href="class_c_growable_array.html#a13">Contains</a>( pOptimalDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.AutoDepthStencilFormat ) )
<a name="l02092"></a>02092         fCurRanking += fDepthStencilWeight;
<a name="l02093"></a>02093 
<a name="l02094"></a>02094     <span class="comment">//---------------------</span>
<a name="l02095"></a>02095     <span class="comment">// Present flags</span>
<a name="l02096"></a>02096     <span class="comment">//---------------------</span>
<a name="l02097"></a>02097     <span class="comment">// No caps for the present flags</span>
<a name="l02098"></a>02098 
<a name="l02099"></a>02099     <span class="comment">//---------------------</span>
<a name="l02100"></a>02100     <span class="comment">// Refresh rate</span>
<a name="l02101"></a>02101     <span class="comment">//---------------------</span>
<a name="l02102"></a>02102     <span class="keywordtype">bool</span> bRefreshFound = <span class="keyword">false</span>;
<a name="l02103"></a>02103     <span class="keywordflow">for</span>( <span class="keywordtype">int</span> idm = 0; idm &lt; pDeviceSettingsCombo-&gt;<a class="code" href="struct_c_d3_d_enum_device_settings_combo.html#o10">pAdapterInfo</a>-&gt;<a class="code" href="class_c_d3_d_enum_adapter_info.html#o3">displayModeList</a>.<a class="code" href="class_c_growable_array.html#a11">GetSize</a>(); idm++ )
<a name="l02104"></a>02104     {
<a name="l02105"></a>02105         D3DDISPLAYMODE displayMode = pDeviceSettingsCombo-&gt;<a class="code" href="struct_c_d3_d_enum_device_settings_combo.html#o10">pAdapterInfo</a>-&gt;<a class="code" href="class_c_d3_d_enum_adapter_info.html#o3">displayModeList</a>.<a class="code" href="class_c_growable_array.html#a10">GetAt</a>( idm );
<a name="l02106"></a>02106         <span class="keywordflow">if</span>( displayMode.Format != pDeviceSettingsCombo-&gt;<a class="code" href="struct_c_d3_d_enum_device_settings_combo.html#o2">AdapterFormat</a> )
<a name="l02107"></a>02107             <span class="keywordflow">continue</span>;
<a name="l02108"></a>02108         <span class="keywordflow">if</span>( displayMode.RefreshRate == pOptimalDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.FullScreen_RefreshRateInHz )
<a name="l02109"></a>02109             bRefreshFound = <span class="keyword">true</span>;
<a name="l02110"></a>02110     }
<a name="l02111"></a>02111     <span class="keywordflow">if</span>( bRefreshFound )
<a name="l02112"></a>02112         fCurRanking += fRefreshRateWeight;
<a name="l02113"></a>02113 
<a name="l02114"></a>02114     <span class="comment">//---------------------</span>
<a name="l02115"></a>02115     <span class="comment">// Present interval</span>
<a name="l02116"></a>02116     <span class="comment">//---------------------</span>
<a name="l02117"></a>02117     <span class="comment">// If keep present interval then check that the present interval is supported by this combo</span>
<a name="l02118"></a>02118     <span class="keywordflow">if</span>( pDeviceSettingsCombo-&gt;<a class="code" href="struct_c_d3_d_enum_device_settings_combo.html#o8">presentIntervalList</a>.<a class="code" href="class_c_growable_array.html#a13">Contains</a>( pOptimalDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.PresentationInterval ) )
<a name="l02119"></a>02119         fCurRanking += fPresentIntervalWeight;
<a name="l02120"></a>02120 
<a name="l02121"></a>02121     <span class="keywordflow">return</span> fCurRanking;
<a name="l02122"></a>02122 }
<a name="l02123"></a>02123 
<a name="l02124"></a>02124 
<a name="l02125"></a>02125 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l02126"></a>02126 <span class="comment">// Builds valid device settings using the match options, the input device settings, and the </span>
<a name="l02127"></a>02127 <span class="comment">// best device settings combo found.</span>
<a name="l02128"></a>02128 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l02129"></a><a class="code" href="_d_x_u_t_8cpp.html#a38">02129</a> <span class="keywordtype">void</span> <a class="code" href="_d_x_u_t_8cpp.html#a38">DXUTBuildValidDeviceSettings</a>( <a class="code" href="struct_d_x_u_t_device_settings.html">DXUTDeviceSettings</a>* pValidDeviceSettings, 
<a name="l02130"></a>02130                                    <a class="code" href="struct_c_d3_d_enum_device_settings_combo.html">CD3DEnumDeviceSettingsCombo</a>* pBestDeviceSettingsCombo, 
<a name="l02131"></a>02131                                    <a class="code" href="struct_d_x_u_t_device_settings.html">DXUTDeviceSettings</a>* pDeviceSettingsIn, 
<a name="l02132"></a>02132                                    <a class="code" href="struct_d_x_u_t_match_options.html">DXUTMatchOptions</a>* pMatchOptions )
<a name="l02133"></a>02133 {
<a name="l02134"></a>02134     IDirect3D9* pD3D = <a class="code" href="_d_x_u_t_8cpp.html#a93">DXUTGetD3DObject</a>();
<a name="l02135"></a>02135     D3DDISPLAYMODE adapterDesktopDisplayMode;
<a name="l02136"></a>02136     pD3D-&gt;GetAdapterDisplayMode( pBestDeviceSettingsCombo-&gt;<a class="code" href="struct_c_d3_d_enum_device_settings_combo.html#o0">AdapterOrdinal</a>, &amp;adapterDesktopDisplayMode );
<a name="l02137"></a>02137 
<a name="l02138"></a>02138     <span class="comment">// For each setting pick the best, taking into account the match options and </span>
<a name="l02139"></a>02139     <span class="comment">// what's supported by the device</span>
<a name="l02140"></a>02140 
<a name="l02141"></a>02141     <span class="comment">//---------------------</span>
<a name="l02142"></a>02142     <span class="comment">// Adapter Ordinal</span>
<a name="l02143"></a>02143     <span class="comment">//---------------------</span>
<a name="l02144"></a>02144     <span class="comment">// Just using pBestDeviceSettingsCombo-&gt;AdapterOrdinal</span>
<a name="l02145"></a>02145 
<a name="l02146"></a>02146     <span class="comment">//---------------------</span>
<a name="l02147"></a>02147     <span class="comment">// Device Type</span>
<a name="l02148"></a>02148     <span class="comment">//---------------------</span>
<a name="l02149"></a>02149     <span class="comment">// Just using pBestDeviceSettingsCombo-&gt;DeviceType</span>
<a name="l02150"></a>02150 
<a name="l02151"></a>02151     <span class="comment">//---------------------</span>
<a name="l02152"></a>02152     <span class="comment">// Windowed </span>
<a name="l02153"></a>02153     <span class="comment">//---------------------</span>
<a name="l02154"></a>02154     <span class="comment">// Just using pBestDeviceSettingsCombo-&gt;Windowed</span>
<a name="l02155"></a>02155 
<a name="l02156"></a>02156     <span class="comment">//---------------------</span>
<a name="l02157"></a>02157     <span class="comment">// Adapter Format</span>
<a name="l02158"></a>02158     <span class="comment">//---------------------</span>
<a name="l02159"></a>02159     <span class="comment">// Just using pBestDeviceSettingsCombo-&gt;AdapterFormat</span>
<a name="l02160"></a>02160 
<a name="l02161"></a>02161     <span class="comment">//---------------------</span>
<a name="l02162"></a>02162     <span class="comment">// Vertex processing</span>
<a name="l02163"></a>02163     <span class="comment">//---------------------</span>
<a name="l02164"></a>02164     <a class="code" href="_d_x_u_tgui_8cpp.html#a38">DWORD</a> dwBestBehaviorFlags = 0;
<a name="l02165"></a>02165     <span class="keywordflow">if</span>( pMatchOptions-&gt;<a class="code" href="struct_d_x_u_t_match_options.html#o4">eVertexProcessing</a> == <a class="code" href="_d_x_u_t_8h.html#a87a22">DXUTMT_PRESERVE_INPUT</a> )   
<a name="l02166"></a>02166     {
<a name="l02167"></a>02167         dwBestBehaviorFlags = pDeviceSettingsIn-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o3">BehaviorFlags</a>;
<a name="l02168"></a>02168     }
<a name="l02169"></a>02169     <span class="keywordflow">else</span> <span class="keywordflow">if</span>( pMatchOptions-&gt;<a class="code" href="struct_d_x_u_t_match_options.html#o4">eVertexProcessing</a> == <a class="code" href="_d_x_u_t_8h.html#a87a21">DXUTMT_IGNORE_INPUT</a> )    
<a name="l02170"></a>02170     {
<a name="l02171"></a>02171         <span class="comment">// The framework defaults to HWVP if available otherwise use SWVP</span>
<a name="l02172"></a>02172         <span class="keywordflow">if</span> ((pBestDeviceSettingsCombo-&gt;<a class="code" href="struct_c_d3_d_enum_device_settings_combo.html#o11">pDeviceInfo</a>-&gt;<a class="code" href="class_c_d3_d_enum_device_info.html#o2">Caps</a>.DevCaps &amp; D3DDEVCAPS_HWTRANSFORMANDLIGHT) != 0)
<a name="l02173"></a>02173             dwBestBehaviorFlags |= D3DCREATE_HARDWARE_VERTEXPROCESSING;
<a name="l02174"></a>02174         <span class="keywordflow">else</span>
<a name="l02175"></a>02175             dwBestBehaviorFlags |= D3DCREATE_SOFTWARE_VERTEXPROCESSING;
<a name="l02176"></a>02176     }
<a name="l02177"></a>02177     <span class="keywordflow">else</span> <span class="comment">// if( pMatchOptions-&gt;eVertexProcessing == DXUTMT_CLOSEST_TO_INPUT )    </span>
<a name="l02178"></a>02178     {
<a name="l02179"></a>02179         <span class="comment">// Default to input, and fallback to SWVP if HWVP not available </span>
<a name="l02180"></a>02180         dwBestBehaviorFlags = pDeviceSettingsIn-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o3">BehaviorFlags</a>;
<a name="l02181"></a>02181         <span class="keywordflow">if</span> ((pBestDeviceSettingsCombo-&gt;<a class="code" href="struct_c_d3_d_enum_device_settings_combo.html#o11">pDeviceInfo</a>-&gt;<a class="code" href="class_c_d3_d_enum_device_info.html#o2">Caps</a>.DevCaps &amp; D3DDEVCAPS_HWTRANSFORMANDLIGHT) == 0 &amp;&amp; 
<a name="l02182"></a>02182             ( (dwBestBehaviorFlags &amp; D3DCREATE_HARDWARE_VERTEXPROCESSING) != 0 || 
<a name="l02183"></a>02183               (dwBestBehaviorFlags &amp; D3DCREATE_MIXED_VERTEXPROCESSING) != 0) )
<a name="l02184"></a>02184         {
<a name="l02185"></a>02185             dwBestBehaviorFlags &amp;= ~D3DCREATE_HARDWARE_VERTEXPROCESSING;
<a name="l02186"></a>02186             dwBestBehaviorFlags &amp;= ~D3DCREATE_MIXED_VERTEXPROCESSING;
<a name="l02187"></a>02187             dwBestBehaviorFlags |= D3DCREATE_SOFTWARE_VERTEXPROCESSING;
<a name="l02188"></a>02188         }
<a name="l02189"></a>02189 
<a name="l02190"></a>02190         <span class="comment">// One of these must be selected</span>
<a name="l02191"></a>02191         <span class="keywordflow">if</span>( (dwBestBehaviorFlags &amp; D3DCREATE_HARDWARE_VERTEXPROCESSING) == 0 &amp;&amp;
<a name="l02192"></a>02192             (dwBestBehaviorFlags &amp; D3DCREATE_MIXED_VERTEXPROCESSING) == 0 &amp;&amp;
<a name="l02193"></a>02193             (dwBestBehaviorFlags &amp; D3DCREATE_SOFTWARE_VERTEXPROCESSING) == 0 )
<a name="l02194"></a>02194         {
<a name="l02195"></a>02195             <span class="keywordflow">if</span> ((pBestDeviceSettingsCombo-&gt;<a class="code" href="struct_c_d3_d_enum_device_settings_combo.html#o11">pDeviceInfo</a>-&gt;<a class="code" href="class_c_d3_d_enum_device_info.html#o2">Caps</a>.DevCaps &amp; D3DDEVCAPS_HWTRANSFORMANDLIGHT) != 0)
<a name="l02196"></a>02196                 dwBestBehaviorFlags |= D3DCREATE_HARDWARE_VERTEXPROCESSING;
<a name="l02197"></a>02197             <span class="keywordflow">else</span>
<a name="l02198"></a>02198                 dwBestBehaviorFlags |= D3DCREATE_SOFTWARE_VERTEXPROCESSING;
<a name="l02199"></a>02199         }
<a name="l02200"></a>02200     }
<a name="l02201"></a>02201 
<a name="l02202"></a>02202     <span class="comment">//---------------------</span>
<a name="l02203"></a>02203     <span class="comment">// Resolution</span>
<a name="l02204"></a>02204     <span class="comment">//---------------------</span>
<a name="l02205"></a>02205     D3DDISPLAYMODE bestDisplayMode;  
<a name="l02206"></a>02206     <span class="keywordflow">if</span>( pMatchOptions-&gt;<a class="code" href="struct_d_x_u_t_match_options.html#o5">eResolution</a> == <a class="code" href="_d_x_u_t_8h.html#a87a22">DXUTMT_PRESERVE_INPUT</a> )   
<a name="l02207"></a>02207     {
<a name="l02208"></a>02208         bestDisplayMode.Width = pDeviceSettingsIn-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.BackBufferWidth;
<a name="l02209"></a>02209         bestDisplayMode.Height = pDeviceSettingsIn-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.BackBufferHeight;
<a name="l02210"></a>02210     }
<a name="l02211"></a>02211     <span class="keywordflow">else</span> 
<a name="l02212"></a>02212     {
<a name="l02213"></a>02213         D3DDISPLAYMODE displayModeIn;  
<a name="l02214"></a>02214         <span class="keywordflow">if</span>( pMatchOptions-&gt;<a class="code" href="struct_d_x_u_t_match_options.html#o5">eResolution</a> == <a class="code" href="_d_x_u_t_8h.html#a87a23">DXUTMT_CLOSEST_TO_INPUT</a> &amp;&amp;
<a name="l02215"></a>02215             pDeviceSettingsIn )   
<a name="l02216"></a>02216         {
<a name="l02217"></a>02217             displayModeIn.Width = pDeviceSettingsIn-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.BackBufferWidth;
<a name="l02218"></a>02218             displayModeIn.Height = pDeviceSettingsIn-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.BackBufferHeight;
<a name="l02219"></a>02219         }
<a name="l02220"></a>02220         <span class="keywordflow">else</span> <span class="comment">// if( pMatchOptions-&gt;eResolution == DXUTMT_IGNORE_INPUT )   </span>
<a name="l02221"></a>02221         {
<a name="l02222"></a>02222             <span class="keywordflow">if</span>( pBestDeviceSettingsCombo-&gt;<a class="code" href="struct_c_d3_d_enum_device_settings_combo.html#o4">Windowed</a> )
<a name="l02223"></a>02223             {
<a name="l02224"></a>02224                 <span class="comment">// The framework defaults to 640x480 for windowed</span>
<a name="l02225"></a>02225                 displayModeIn.Width = 640;
<a name="l02226"></a>02226                 displayModeIn.Height = 480;
<a name="l02227"></a>02227             }
<a name="l02228"></a>02228             <span class="keywordflow">else</span>
<a name="l02229"></a>02229             {
<a name="l02230"></a>02230                 <span class="comment">// The framework defaults to desktop resolution for fullscreen to try to avoid slow mode change</span>
<a name="l02231"></a>02231                 displayModeIn.Width = adapterDesktopDisplayMode.Width;
<a name="l02232"></a>02232                 displayModeIn.Height = adapterDesktopDisplayMode.Height;
<a name="l02233"></a>02233             }
<a name="l02234"></a>02234         }
<a name="l02235"></a>02235 
<a name="l02236"></a>02236         <span class="comment">// Call a helper function to find the closest valid display mode to the optimal </span>
<a name="l02237"></a>02237         <a class="code" href="_d_x_u_t_8cpp.html#a39">DXUTFindValidResolution</a>( pBestDeviceSettingsCombo, displayModeIn, &amp;bestDisplayMode );
<a name="l02238"></a>02238     }
<a name="l02239"></a>02239 
<a name="l02240"></a>02240     <span class="comment">//---------------------</span>
<a name="l02241"></a>02241     <span class="comment">// Back Buffer Format</span>
<a name="l02242"></a>02242     <span class="comment">//---------------------</span>
<a name="l02243"></a>02243     <span class="comment">// Just using pBestDeviceSettingsCombo-&gt;BackBufferFormat</span>
<a name="l02244"></a>02244 
<a name="l02245"></a>02245     <span class="comment">//---------------------</span>
<a name="l02246"></a>02246     <span class="comment">// Back buffer count</span>
<a name="l02247"></a>02247     <span class="comment">//---------------------</span>
<a name="l02248"></a>02248     <a class="code" href="_d_x_u_tgui_8cpp.html#a45">UINT</a> bestBackBufferCount;
<a name="l02249"></a>02249     <span class="keywordflow">if</span>( pMatchOptions-&gt;<a class="code" href="struct_d_x_u_t_match_options.html#o7">eBackBufferCount</a> == <a class="code" href="_d_x_u_t_8h.html#a87a22">DXUTMT_PRESERVE_INPUT</a> )   
<a name="l02250"></a>02250     {
<a name="l02251"></a>02251         bestBackBufferCount = pDeviceSettingsIn-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.BackBufferCount;
<a name="l02252"></a>02252     }
<a name="l02253"></a>02253     <span class="keywordflow">else</span> <span class="keywordflow">if</span>( pMatchOptions-&gt;<a class="code" href="struct_d_x_u_t_match_options.html#o7">eBackBufferCount</a> == <a class="code" href="_d_x_u_t_8h.html#a87a21">DXUTMT_IGNORE_INPUT</a> )   
<a name="l02254"></a>02254     {
<a name="l02255"></a>02255         <span class="comment">// The framework defaults to triple buffering </span>
<a name="l02256"></a>02256         bestBackBufferCount = 2;
<a name="l02257"></a>02257     }
<a name="l02258"></a>02258     <span class="keywordflow">else</span> <span class="comment">// if( pMatchOptions-&gt;eBackBufferCount == DXUTMT_CLOSEST_TO_INPUT )   </span>
<a name="l02259"></a>02259     {
<a name="l02260"></a>02260         bestBackBufferCount = pDeviceSettingsIn-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.BackBufferCount;
<a name="l02261"></a>02261         <span class="keywordflow">if</span>( bestBackBufferCount &gt; 3 )
<a name="l02262"></a>02262             bestBackBufferCount = 3;
<a name="l02263"></a>02263         <span class="keywordflow">if</span>( bestBackBufferCount &lt; 1 )
<a name="l02264"></a>02264             bestBackBufferCount = 1;
<a name="l02265"></a>02265     }
<a name="l02266"></a>02266     
<a name="l02267"></a>02267     <span class="comment">//---------------------</span>
<a name="l02268"></a>02268     <span class="comment">// Multisample</span>
<a name="l02269"></a>02269     <span class="comment">//---------------------</span>
<a name="l02270"></a>02270     D3DMULTISAMPLE_TYPE bestMultiSampleType;
<a name="l02271"></a>02271     <a class="code" href="_d_x_u_tgui_8cpp.html#a38">DWORD</a> bestMultiSampleQuality;
<a name="l02272"></a>02272     <span class="keywordflow">if</span>( pDeviceSettingsIn &amp;&amp; pDeviceSettingsIn-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.SwapEffect != D3DSWAPEFFECT_DISCARD )
<a name="l02273"></a>02273     {
<a name="l02274"></a>02274         <span class="comment">// Swap effect is not set to discard so multisampling has to off</span>
<a name="l02275"></a>02275         bestMultiSampleType = D3DMULTISAMPLE_NONE;
<a name="l02276"></a>02276         bestMultiSampleQuality = 0;
<a name="l02277"></a>02277     }
<a name="l02278"></a>02278     <span class="keywordflow">else</span>
<a name="l02279"></a>02279     {
<a name="l02280"></a>02280         <span class="keywordflow">if</span>( pMatchOptions-&gt;<a class="code" href="struct_d_x_u_t_match_options.html#o8">eMultiSample</a> == <a class="code" href="_d_x_u_t_8h.html#a87a22">DXUTMT_PRESERVE_INPUT</a> )   
<a name="l02281"></a>02281         {
<a name="l02282"></a>02282             bestMultiSampleType    = pDeviceSettingsIn-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.MultiSampleType;
<a name="l02283"></a>02283             bestMultiSampleQuality = pDeviceSettingsIn-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.MultiSampleQuality;
<a name="l02284"></a>02284         }
<a name="l02285"></a>02285         <span class="keywordflow">else</span> <span class="keywordflow">if</span>( pMatchOptions-&gt;<a class="code" href="struct_d_x_u_t_match_options.html#o8">eMultiSample</a> == <a class="code" href="_d_x_u_t_8h.html#a87a21">DXUTMT_IGNORE_INPUT</a> )   
<a name="l02286"></a>02286         {
<a name="l02287"></a>02287             <span class="comment">// Default to no multisampling (always supported)</span>
<a name="l02288"></a>02288             bestMultiSampleType = D3DMULTISAMPLE_NONE;
<a name="l02289"></a>02289             bestMultiSampleQuality = 0;
<a name="l02290"></a>02290         }
<a name="l02291"></a>02291         <span class="keywordflow">else</span> <span class="keywordflow">if</span>( pMatchOptions-&gt;<a class="code" href="struct_d_x_u_t_match_options.html#o8">eMultiSample</a> == <a class="code" href="_d_x_u_t_8h.html#a87a23">DXUTMT_CLOSEST_TO_INPUT</a> )   
<a name="l02292"></a>02292         {
<a name="l02293"></a>02293             <span class="comment">// Default to no multisampling (always supported)</span>
<a name="l02294"></a>02294             bestMultiSampleType = D3DMULTISAMPLE_NONE;
<a name="l02295"></a>02295             bestMultiSampleQuality = 0;
<a name="l02296"></a>02296 
<a name="l02297"></a>02297             <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=0; i &lt; pBestDeviceSettingsCombo-&gt;<a class="code" href="struct_c_d3_d_enum_device_settings_combo.html#o6">multiSampleTypeList</a>.<a class="code" href="class_c_growable_array.html#a11">GetSize</a>(); i++ )
<a name="l02298"></a>02298             {
<a name="l02299"></a>02299                 D3DMULTISAMPLE_TYPE type = pBestDeviceSettingsCombo-&gt;<a class="code" href="struct_c_d3_d_enum_device_settings_combo.html#o6">multiSampleTypeList</a>.<a class="code" href="class_c_growable_array.html#a10">GetAt</a>(i);
<a name="l02300"></a>02300                 <a class="code" href="_d_x_u_tgui_8cpp.html#a38">DWORD</a> qualityLevels = pBestDeviceSettingsCombo-&gt;<a class="code" href="struct_c_d3_d_enum_device_settings_combo.html#o7">multiSampleQualityList</a>.<a class="code" href="class_c_growable_array.html#a10">GetAt</a>(i);
<a name="l02301"></a>02301                 
<a name="l02302"></a>02302                 <span class="comment">// Check whether supported type is closer to the input than our current best</span>
<a name="l02303"></a>02303                 <span class="keywordflow">if</span>( abs(type - pDeviceSettingsIn-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.MultiSampleType) &lt; abs(bestMultiSampleType - pDeviceSettingsIn-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.MultiSampleType) )
<a name="l02304"></a>02304                 {
<a name="l02305"></a>02305                     bestMultiSampleType = type; 
<a name="l02306"></a>02306                     bestMultiSampleQuality = __min( qualityLevels-1, pDeviceSettingsIn-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.MultiSampleQuality );
<a name="l02307"></a>02307                 }
<a name="l02308"></a>02308             }
<a name="l02309"></a>02309         }
<a name="l02310"></a>02310         <span class="keywordflow">else</span>
<a name="l02311"></a>02311         {
<a name="l02312"></a>02312             <span class="comment">// Error case</span>
<a name="l02313"></a>02313             bestMultiSampleType = D3DMULTISAMPLE_NONE;
<a name="l02314"></a>02314             bestMultiSampleQuality = 0;
<a name="l02315"></a>02315         }
<a name="l02316"></a>02316     }
<a name="l02317"></a>02317 
<a name="l02318"></a>02318     <span class="comment">//---------------------</span>
<a name="l02319"></a>02319     <span class="comment">// Swap effect</span>
<a name="l02320"></a>02320     <span class="comment">//---------------------</span>
<a name="l02321"></a>02321     D3DSWAPEFFECT bestSwapEffect;
<a name="l02322"></a>02322     <span class="keywordflow">if</span>( pMatchOptions-&gt;<a class="code" href="struct_d_x_u_t_match_options.html#o9">eSwapEffect</a> == <a class="code" href="_d_x_u_t_8h.html#a87a22">DXUTMT_PRESERVE_INPUT</a> )   
<a name="l02323"></a>02323     {
<a name="l02324"></a>02324         bestSwapEffect = pDeviceSettingsIn-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.SwapEffect;
<a name="l02325"></a>02325     }
<a name="l02326"></a>02326     <span class="keywordflow">else</span> <span class="keywordflow">if</span>( pMatchOptions-&gt;<a class="code" href="struct_d_x_u_t_match_options.html#o9">eSwapEffect</a> == <a class="code" href="_d_x_u_t_8h.html#a87a21">DXUTMT_IGNORE_INPUT</a> )   
<a name="l02327"></a>02327     {
<a name="l02328"></a>02328         bestSwapEffect = D3DSWAPEFFECT_DISCARD;
<a name="l02329"></a>02329     }
<a name="l02330"></a>02330     <span class="keywordflow">else</span> <span class="comment">// if( pMatchOptions-&gt;eSwapEffect == DXUTMT_CLOSEST_TO_INPUT )   </span>
<a name="l02331"></a>02331     {
<a name="l02332"></a>02332         bestSwapEffect = pDeviceSettingsIn-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.SwapEffect;
<a name="l02333"></a>02333 
<a name="l02334"></a>02334         <span class="comment">// Swap effect has to be one of these 3</span>
<a name="l02335"></a>02335         <span class="keywordflow">if</span>( bestSwapEffect != D3DSWAPEFFECT_DISCARD &amp;&amp;
<a name="l02336"></a>02336             bestSwapEffect != D3DSWAPEFFECT_FLIP &amp;&amp;
<a name="l02337"></a>02337             bestSwapEffect != D3DSWAPEFFECT_COPY )
<a name="l02338"></a>02338         {
<a name="l02339"></a>02339             bestSwapEffect = D3DSWAPEFFECT_DISCARD;
<a name="l02340"></a>02340         }
<a name="l02341"></a>02341     }
<a name="l02342"></a>02342 
<a name="l02343"></a>02343     <span class="comment">//---------------------</span>
<a name="l02344"></a>02344     <span class="comment">// Depth stencil </span>
<a name="l02345"></a>02345     <span class="comment">//---------------------</span>
<a name="l02346"></a>02346     D3DFORMAT bestDepthStencilFormat;
<a name="l02347"></a>02347     <a class="code" href="_d_x_u_tgui_8cpp.html#a39">BOOL</a> bestEnableAutoDepthStencil;
<a name="l02348"></a>02348 
<a name="l02349"></a>02349     <a class="code" href="class_c_growable_array.html">CGrowableArray&lt; int &gt;</a> depthStencilRanking;
<a name="l02350"></a>02350     depthStencilRanking.<a class="code" href="class_c_growable_array.html#a6">SetSize</a>( pBestDeviceSettingsCombo-&gt;<a class="code" href="struct_c_d3_d_enum_device_settings_combo.html#o5">depthStencilFormatList</a>.<a class="code" href="class_c_growable_array.html#a11">GetSize</a>() );
<a name="l02351"></a>02351 
<a name="l02352"></a>02352     <a class="code" href="_d_x_u_tgui_8cpp.html#a45">UINT</a> dwBackBufferBitDepth = <a class="code" href="_d_x_u_t_8cpp.html#a56">DXUTColorChannelBits</a>( pBestDeviceSettingsCombo-&gt;<a class="code" href="struct_c_d3_d_enum_device_settings_combo.html#o3">BackBufferFormat</a> );       
<a name="l02353"></a>02353     <a class="code" href="_d_x_u_tgui_8cpp.html#a45">UINT</a> dwInputDepthBitDepth = 0;
<a name="l02354"></a>02354     <span class="keywordflow">if</span>( pDeviceSettingsIn )
<a name="l02355"></a>02355         dwInputDepthBitDepth = <a class="code" href="_d_x_u_t_8cpp.html#a58">DXUTDepthBits</a>( pDeviceSettingsIn-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.AutoDepthStencilFormat );
<a name="l02356"></a>02356 
<a name="l02357"></a>02357     <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=0; i&lt;pBestDeviceSettingsCombo-&gt;<a class="code" href="struct_c_d3_d_enum_device_settings_combo.html#o5">depthStencilFormatList</a>.<a class="code" href="class_c_growable_array.html#a11">GetSize</a>(); i++ )
<a name="l02358"></a>02358     {
<a name="l02359"></a>02359         D3DFORMAT curDepthStencilFmt = pBestDeviceSettingsCombo-&gt;<a class="code" href="struct_c_d3_d_enum_device_settings_combo.html#o5">depthStencilFormatList</a>.<a class="code" href="class_c_growable_array.html#a10">GetAt</a>(i);
<a name="l02360"></a>02360         <a class="code" href="_d_x_u_tgui_8cpp.html#a38">DWORD</a> dwCurDepthBitDepth = <a class="code" href="_d_x_u_t_8cpp.html#a58">DXUTDepthBits</a>( curDepthStencilFmt );
<a name="l02361"></a>02361         <span class="keywordtype">int</span> nRanking;
<a name="l02362"></a>02362 
<a name="l02363"></a>02363         <span class="keywordflow">if</span>( pMatchOptions-&gt;<a class="code" href="struct_d_x_u_t_match_options.html#o10">eDepthFormat</a> == <a class="code" href="_d_x_u_t_8h.html#a87a22">DXUTMT_PRESERVE_INPUT</a> )
<a name="l02364"></a>02364         {                       
<a name="l02365"></a>02365             <span class="comment">// Need to match bit depth of input</span>
<a name="l02366"></a>02366             <span class="keywordflow">if</span>(dwCurDepthBitDepth == dwInputDepthBitDepth)
<a name="l02367"></a>02367                 nRanking = 0;
<a name="l02368"></a>02368             <span class="keywordflow">else</span>
<a name="l02369"></a>02369                 nRanking = 10000;
<a name="l02370"></a>02370         }
<a name="l02371"></a>02371         <span class="keywordflow">else</span> <span class="keywordflow">if</span>( pMatchOptions-&gt;<a class="code" href="struct_d_x_u_t_match_options.html#o10">eDepthFormat</a> == <a class="code" href="_d_x_u_t_8h.html#a87a21">DXUTMT_IGNORE_INPUT</a> )
<a name="l02372"></a>02372         {
<a name="l02373"></a>02373             <span class="comment">// Prefer match of backbuffer bit depth</span>
<a name="l02374"></a>02374             nRanking = abs((<span class="keywordtype">int</span>)dwCurDepthBitDepth - (<span class="keywordtype">int</span>)dwBackBufferBitDepth*4);
<a name="l02375"></a>02375         }
<a name="l02376"></a>02376         <span class="keywordflow">else</span> <span class="comment">// if( pMatchOptions-&gt;eDepthFormat == DXUTMT_CLOSEST_TO_INPUT )</span>
<a name="l02377"></a>02377         {
<a name="l02378"></a>02378             <span class="comment">// Prefer match of input depth format bit depth</span>
<a name="l02379"></a>02379             nRanking = abs((<span class="keywordtype">int</span>)dwCurDepthBitDepth - (<span class="keywordtype">int</span>)dwInputDepthBitDepth);
<a name="l02380"></a>02380         }
<a name="l02381"></a>02381 
<a name="l02382"></a>02382         depthStencilRanking.<a class="code" href="class_c_growable_array.html#a7">Add</a>( nRanking );
<a name="l02383"></a>02383     }
<a name="l02384"></a>02384 
<a name="l02385"></a>02385     <a class="code" href="_d_x_u_tgui_8cpp.html#a45">UINT</a> dwInputStencilBitDepth = 0;
<a name="l02386"></a>02386     <span class="keywordflow">if</span>( pDeviceSettingsIn )
<a name="l02387"></a>02387         dwInputStencilBitDepth = <a class="code" href="_d_x_u_t_8cpp.html#a57">DXUTStencilBits</a>( pDeviceSettingsIn-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.AutoDepthStencilFormat );
<a name="l02388"></a>02388 
<a name="l02389"></a>02389     <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=0; i&lt;pBestDeviceSettingsCombo-&gt;<a class="code" href="struct_c_d3_d_enum_device_settings_combo.html#o5">depthStencilFormatList</a>.<a class="code" href="class_c_growable_array.html#a11">GetSize</a>(); i++ )
<a name="l02390"></a>02390     {
<a name="l02391"></a>02391         D3DFORMAT curDepthStencilFmt = pBestDeviceSettingsCombo-&gt;<a class="code" href="struct_c_d3_d_enum_device_settings_combo.html#o5">depthStencilFormatList</a>.<a class="code" href="class_c_growable_array.html#a10">GetAt</a>(i);
<a name="l02392"></a>02392         <span class="keywordtype">int</span> nRanking = depthStencilRanking.<a class="code" href="class_c_growable_array.html#a10">GetAt</a>(i);
<a name="l02393"></a>02393         <a class="code" href="_d_x_u_tgui_8cpp.html#a38">DWORD</a> dwCurStencilBitDepth = <a class="code" href="_d_x_u_t_8cpp.html#a57">DXUTStencilBits</a>( curDepthStencilFmt );
<a name="l02394"></a>02394 
<a name="l02395"></a>02395         <span class="keywordflow">if</span>( pMatchOptions-&gt;<a class="code" href="struct_d_x_u_t_match_options.html#o11">eStencilFormat</a> == <a class="code" href="_d_x_u_t_8h.html#a87a22">DXUTMT_PRESERVE_INPUT</a> )
<a name="l02396"></a>02396         {                       
<a name="l02397"></a>02397             <span class="comment">// Need to match bit depth of input</span>
<a name="l02398"></a>02398             <span class="keywordflow">if</span>(dwCurStencilBitDepth == dwInputStencilBitDepth)
<a name="l02399"></a>02399                 nRanking += 0;
<a name="l02400"></a>02400             <span class="keywordflow">else</span>
<a name="l02401"></a>02401                 nRanking += 10000;
<a name="l02402"></a>02402         }
<a name="l02403"></a>02403         <span class="keywordflow">else</span> <span class="keywordflow">if</span>( pMatchOptions-&gt;<a class="code" href="struct_d_x_u_t_match_options.html#o11">eStencilFormat</a> == <a class="code" href="_d_x_u_t_8h.html#a87a21">DXUTMT_IGNORE_INPUT</a> )
<a name="l02404"></a>02404         {
<a name="l02405"></a>02405             <span class="comment">// Prefer 0 stencil bit depth</span>
<a name="l02406"></a>02406             nRanking += dwCurStencilBitDepth;
<a name="l02407"></a>02407         }
<a name="l02408"></a>02408         <span class="keywordflow">else</span> <span class="comment">// if( pMatchOptions-&gt;eStencilFormat == DXUTMT_CLOSEST_TO_INPUT )</span>
<a name="l02409"></a>02409         {
<a name="l02410"></a>02410             <span class="comment">// Prefer match of input stencil format bit depth</span>
<a name="l02411"></a>02411             nRanking += abs((<span class="keywordtype">int</span>)dwCurStencilBitDepth - (<span class="keywordtype">int</span>)dwInputStencilBitDepth);
<a name="l02412"></a>02412         }
<a name="l02413"></a>02413 
<a name="l02414"></a>02414         depthStencilRanking.<a class="code" href="class_c_growable_array.html#a9">SetAt</a>( i, nRanking );
<a name="l02415"></a>02415     }
<a name="l02416"></a>02416 
<a name="l02417"></a>02417     <span class="keywordtype">int</span> nBestRanking = 100000;
<a name="l02418"></a>02418     <span class="keywordtype">int</span> nBestIndex = -1;
<a name="l02419"></a>02419     <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=0; i&lt;pBestDeviceSettingsCombo-&gt;<a class="code" href="struct_c_d3_d_enum_device_settings_combo.html#o5">depthStencilFormatList</a>.<a class="code" href="class_c_growable_array.html#a11">GetSize</a>(); i++ )
<a name="l02420"></a>02420     {
<a name="l02421"></a>02421         <span class="keywordtype">int</span> nRanking = depthStencilRanking.<a class="code" href="class_c_growable_array.html#a10">GetAt</a>(i);
<a name="l02422"></a>02422         <span class="keywordflow">if</span>( nRanking &lt; nBestRanking )
<a name="l02423"></a>02423         {
<a name="l02424"></a>02424             nBestRanking = nRanking;
<a name="l02425"></a>02425             nBestIndex = i;
<a name="l02426"></a>02426         }
<a name="l02427"></a>02427     }
<a name="l02428"></a>02428 
<a name="l02429"></a>02429     <span class="keywordflow">if</span>( nBestIndex &gt;= 0 )
<a name="l02430"></a>02430     {
<a name="l02431"></a>02431         bestDepthStencilFormat = pBestDeviceSettingsCombo-&gt;<a class="code" href="struct_c_d3_d_enum_device_settings_combo.html#o5">depthStencilFormatList</a>.<a class="code" href="class_c_growable_array.html#a10">GetAt</a>(nBestIndex);
<a name="l02432"></a>02432         bestEnableAutoDepthStencil = <span class="keyword">true</span>;
<a name="l02433"></a>02433     }
<a name="l02434"></a>02434     <span class="keywordflow">else</span>
<a name="l02435"></a>02435     {
<a name="l02436"></a>02436         bestDepthStencilFormat = D3DFMT_UNKNOWN;
<a name="l02437"></a>02437         bestEnableAutoDepthStencil = <span class="keyword">false</span>;
<a name="l02438"></a>02438     }
<a name="l02439"></a>02439 
<a name="l02440"></a>02440 
<a name="l02441"></a>02441     <span class="comment">//---------------------</span>
<a name="l02442"></a>02442     <span class="comment">// Present flags</span>
<a name="l02443"></a>02443     <span class="comment">//---------------------</span>
<a name="l02444"></a>02444     <a class="code" href="_d_x_u_tgui_8cpp.html#a38">DWORD</a> dwBestFlags;
<a name="l02445"></a>02445     <span class="keywordflow">if</span>( pMatchOptions-&gt;<a class="code" href="struct_d_x_u_t_match_options.html#o12">ePresentFlags</a> == <a class="code" href="_d_x_u_t_8h.html#a87a22">DXUTMT_PRESERVE_INPUT</a> )   
<a name="l02446"></a>02446     {
<a name="l02447"></a>02447         dwBestFlags = pDeviceSettingsIn-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.Flags;
<a name="l02448"></a>02448     }
<a name="l02449"></a>02449     <span class="keywordflow">else</span> <span class="keywordflow">if</span>( pMatchOptions-&gt;<a class="code" href="struct_d_x_u_t_match_options.html#o12">ePresentFlags</a> == <a class="code" href="_d_x_u_t_8h.html#a87a21">DXUTMT_IGNORE_INPUT</a> )   
<a name="l02450"></a>02450     {
<a name="l02451"></a>02451         dwBestFlags = 0;
<a name="l02452"></a>02452         <span class="keywordflow">if</span>( bestEnableAutoDepthStencil )
<a name="l02453"></a>02453             dwBestFlags = D3DPRESENTFLAG_DISCARD_DEPTHSTENCIL;            
<a name="l02454"></a>02454     }
<a name="l02455"></a>02455     <span class="keywordflow">else</span> <span class="comment">// if( pMatchOptions-&gt;ePresentFlags == DXUTMT_CLOSEST_TO_INPUT )   </span>
<a name="l02456"></a>02456     {
<a name="l02457"></a>02457         dwBestFlags = pDeviceSettingsIn-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.Flags;
<a name="l02458"></a>02458         <span class="keywordflow">if</span>( bestEnableAutoDepthStencil )
<a name="l02459"></a>02459             dwBestFlags |= D3DPRESENTFLAG_DISCARD_DEPTHSTENCIL;
<a name="l02460"></a>02460     }
<a name="l02461"></a>02461 
<a name="l02462"></a>02462     <span class="comment">//---------------------</span>
<a name="l02463"></a>02463     <span class="comment">// Refresh rate</span>
<a name="l02464"></a>02464     <span class="comment">//---------------------</span>
<a name="l02465"></a>02465     <span class="keywordflow">if</span>( pBestDeviceSettingsCombo-&gt;<a class="code" href="struct_c_d3_d_enum_device_settings_combo.html#o4">Windowed</a> )
<a name="l02466"></a>02466     {
<a name="l02467"></a>02467         <span class="comment">// Must be 0 for windowed</span>
<a name="l02468"></a>02468         bestDisplayMode.RefreshRate = 0;
<a name="l02469"></a>02469     }
<a name="l02470"></a>02470     <span class="keywordflow">else</span>
<a name="l02471"></a>02471     {
<a name="l02472"></a>02472         <span class="keywordflow">if</span>( pMatchOptions-&gt;<a class="code" href="struct_d_x_u_t_match_options.html#o13">eRefreshRate</a> == <a class="code" href="_d_x_u_t_8h.html#a87a22">DXUTMT_PRESERVE_INPUT</a> )   
<a name="l02473"></a>02473         {
<a name="l02474"></a>02474             bestDisplayMode.RefreshRate = pDeviceSettingsIn-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.FullScreen_RefreshRateInHz;
<a name="l02475"></a>02475         }
<a name="l02476"></a>02476         <span class="keywordflow">else</span> 
<a name="l02477"></a>02477         {
<a name="l02478"></a>02478             <a class="code" href="_d_x_u_tgui_8cpp.html#a45">UINT</a> refreshRateMatch;
<a name="l02479"></a>02479             <span class="keywordflow">if</span>( pMatchOptions-&gt;<a class="code" href="struct_d_x_u_t_match_options.html#o13">eRefreshRate</a> == <a class="code" href="_d_x_u_t_8h.html#a87a23">DXUTMT_CLOSEST_TO_INPUT</a> )   
<a name="l02480"></a>02480             {
<a name="l02481"></a>02481                 refreshRateMatch = pDeviceSettingsIn-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.FullScreen_RefreshRateInHz;
<a name="l02482"></a>02482             }
<a name="l02483"></a>02483             <span class="keywordflow">else</span> <span class="comment">// if( pMatchOptions-&gt;eRefreshRate == DXUTMT_IGNORE_INPUT )   </span>
<a name="l02484"></a>02484             {
<a name="l02485"></a>02485                 refreshRateMatch = adapterDesktopDisplayMode.RefreshRate;
<a name="l02486"></a>02486             }
<a name="l02487"></a>02487 
<a name="l02488"></a>02488             bestDisplayMode.RefreshRate = 0;
<a name="l02489"></a>02489 
<a name="l02490"></a>02490             <span class="keywordflow">if</span>( refreshRateMatch != 0 )
<a name="l02491"></a>02491             {
<a name="l02492"></a>02492                 <span class="keywordtype">int</span> nBestRefreshRanking = 100000;
<a name="l02493"></a>02493                 <a class="code" href="class_c_growable_array.html">CGrowableArray&lt;D3DDISPLAYMODE&gt;</a>* pDisplayModeList = &amp;pBestDeviceSettingsCombo-&gt;<a class="code" href="struct_c_d3_d_enum_device_settings_combo.html#o10">pAdapterInfo</a>-&gt;<a class="code" href="class_c_d3_d_enum_adapter_info.html#o3">displayModeList</a>;
<a name="l02494"></a>02494                 <span class="keywordflow">for</span>( <span class="keywordtype">int</span> iDisplayMode=0; iDisplayMode&lt;pDisplayModeList-&gt;<a class="code" href="class_c_growable_array.html#a11">GetSize</a>(); iDisplayMode++ )
<a name="l02495"></a>02495                 {
<a name="l02496"></a>02496                     D3DDISPLAYMODE displayMode = pDisplayModeList-&gt;<a class="code" href="class_c_growable_array.html#a10">GetAt</a>(iDisplayMode);                
<a name="l02497"></a>02497                     <span class="keywordflow">if</span>( displayMode.Format != pBestDeviceSettingsCombo-&gt;<a class="code" href="struct_c_d3_d_enum_device_settings_combo.html#o2">AdapterFormat</a> || 
<a name="l02498"></a>02498                         displayMode.Height != bestDisplayMode.Height ||
<a name="l02499"></a>02499                         displayMode.Width != bestDisplayMode.Width )
<a name="l02500"></a>02500                         <span class="keywordflow">continue</span>; <span class="comment">// Skip display modes that don't match </span>
<a name="l02501"></a>02501 
<a name="l02502"></a>02502                     <span class="comment">// Find the delta between the current refresh rate and the optimal refresh rate </span>
<a name="l02503"></a>02503                     <span class="keywordtype">int</span> nCurRanking = abs((<span class="keywordtype">int</span>)displayMode.RefreshRate - (<span class="keywordtype">int</span>)refreshRateMatch);
<a name="l02504"></a>02504                                         
<a name="l02505"></a>02505                     <span class="keywordflow">if</span>( nCurRanking &lt; nBestRefreshRanking )
<a name="l02506"></a>02506                     {
<a name="l02507"></a>02507                         bestDisplayMode.RefreshRate = displayMode.RefreshRate;
<a name="l02508"></a>02508                         nBestRefreshRanking = nCurRanking;
<a name="l02509"></a>02509 
<a name="l02510"></a>02510                         <span class="comment">// Stop if perfect match found</span>
<a name="l02511"></a>02511                         <span class="keywordflow">if</span>( nBestRefreshRanking == 0 )
<a name="l02512"></a>02512                             <span class="keywordflow">break</span>;
<a name="l02513"></a>02513                     }
<a name="l02514"></a>02514                 }
<a name="l02515"></a>02515             }
<a name="l02516"></a>02516         }
<a name="l02517"></a>02517     }
<a name="l02518"></a>02518 
<a name="l02519"></a>02519     <span class="comment">//---------------------</span>
<a name="l02520"></a>02520     <span class="comment">// Present interval</span>
<a name="l02521"></a>02521     <span class="comment">//---------------------</span>
<a name="l02522"></a>02522     <a class="code" href="_d_x_u_tgui_8cpp.html#a45">UINT</a> bestPresentInterval;
<a name="l02523"></a>02523     <span class="keywordflow">if</span>( pMatchOptions-&gt;<a class="code" href="struct_d_x_u_t_match_options.html#o14">ePresentInterval</a> == <a class="code" href="_d_x_u_t_8h.html#a87a22">DXUTMT_PRESERVE_INPUT</a> )   
<a name="l02524"></a>02524     {
<a name="l02525"></a>02525         bestPresentInterval = pDeviceSettingsIn-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.PresentationInterval;
<a name="l02526"></a>02526     }
<a name="l02527"></a>02527     <span class="keywordflow">else</span> <span class="keywordflow">if</span>( pMatchOptions-&gt;<a class="code" href="struct_d_x_u_t_match_options.html#o14">ePresentInterval</a> == <a class="code" href="_d_x_u_t_8h.html#a87a21">DXUTMT_IGNORE_INPUT</a> )   
<a name="l02528"></a>02528     {
<a name="l02529"></a>02529         <span class="keywordflow">if</span>( pBestDeviceSettingsCombo-&gt;<a class="code" href="struct_c_d3_d_enum_device_settings_combo.html#o4">Windowed</a> )
<a name="l02530"></a>02530         {
<a name="l02531"></a>02531             <span class="comment">// For windowed, the framework defaults to D3DPRESENT_INTERVAL_IMMEDIATE</span>
<a name="l02532"></a>02532             <span class="comment">// which will wait not for the vertical retrace period to prevent tearing, </span>
<a name="l02533"></a>02533             <span class="comment">// but may introduce tearing</span>
<a name="l02534"></a>02534             bestPresentInterval = D3DPRESENT_INTERVAL_IMMEDIATE;
<a name="l02535"></a>02535         }
<a name="l02536"></a>02536         <span class="keywordflow">else</span>
<a name="l02537"></a>02537         {
<a name="l02538"></a>02538             <span class="comment">// For full screen, the framework defaults to D3DPRESENT_INTERVAL_DEFAULT </span>
<a name="l02539"></a>02539             <span class="comment">// which will wait for the vertical retrace period to prevent tearing</span>
<a name="l02540"></a>02540             bestPresentInterval = D3DPRESENT_INTERVAL_DEFAULT;
<a name="l02541"></a>02541         }
<a name="l02542"></a>02542     }
<a name="l02543"></a>02543     <span class="keywordflow">else</span> <span class="comment">// if( pMatchOptions-&gt;ePresentInterval == DXUTMT_CLOSEST_TO_INPUT )   </span>
<a name="l02544"></a>02544     {
<a name="l02545"></a>02545         <span class="keywordflow">if</span>( pBestDeviceSettingsCombo-&gt;<a class="code" href="struct_c_d3_d_enum_device_settings_combo.html#o8">presentIntervalList</a>.<a class="code" href="class_c_growable_array.html#a13">Contains</a>( pDeviceSettingsIn-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.PresentationInterval ) )
<a name="l02546"></a>02546         {
<a name="l02547"></a>02547             bestPresentInterval = pDeviceSettingsIn-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.PresentationInterval;
<a name="l02548"></a>02548         }
<a name="l02549"></a>02549         <span class="keywordflow">else</span>
<a name="l02550"></a>02550         {
<a name="l02551"></a>02551             <span class="keywordflow">if</span>( pBestDeviceSettingsCombo-&gt;<a class="code" href="struct_c_d3_d_enum_device_settings_combo.html#o4">Windowed</a> )
<a name="l02552"></a>02552                 bestPresentInterval = D3DPRESENT_INTERVAL_IMMEDIATE;
<a name="l02553"></a>02553             <span class="keywordflow">else</span>
<a name="l02554"></a>02554                 bestPresentInterval = D3DPRESENT_INTERVAL_DEFAULT;
<a name="l02555"></a>02555         }
<a name="l02556"></a>02556     }
<a name="l02557"></a>02557 
<a name="l02558"></a>02558     <span class="comment">// Fill the device settings struct</span>
<a name="l02559"></a>02559     ZeroMemory( pValidDeviceSettings, <span class="keyword">sizeof</span>(<a class="code" href="struct_d_x_u_t_device_settings.html">DXUTDeviceSettings</a>) );
<a name="l02560"></a>02560     pValidDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o0">AdapterOrdinal</a>                 = pBestDeviceSettingsCombo-&gt;<a class="code" href="struct_c_d3_d_enum_device_settings_combo.html#o0">AdapterOrdinal</a>;
<a name="l02561"></a>02561     pValidDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o1">DeviceType</a>                     = pBestDeviceSettingsCombo-&gt;<a class="code" href="struct_c_d3_d_enum_device_settings_combo.html#o1">DeviceType</a>;
<a name="l02562"></a>02562     pValidDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o2">AdapterFormat</a>                  = pBestDeviceSettingsCombo-&gt;<a class="code" href="struct_c_d3_d_enum_device_settings_combo.html#o2">AdapterFormat</a>;
<a name="l02563"></a>02563     pValidDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o3">BehaviorFlags</a>                  = dwBestBehaviorFlags;
<a name="l02564"></a>02564     pValidDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.BackBufferWidth             = bestDisplayMode.Width;
<a name="l02565"></a>02565     pValidDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.BackBufferHeight            = bestDisplayMode.Height;
<a name="l02566"></a>02566     pValidDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.BackBufferFormat            = pBestDeviceSettingsCombo-&gt;<a class="code" href="struct_c_d3_d_enum_device_settings_combo.html#o3">BackBufferFormat</a>;
<a name="l02567"></a>02567     pValidDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.BackBufferCount             = bestBackBufferCount;
<a name="l02568"></a>02568     pValidDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.MultiSampleType             = bestMultiSampleType;  
<a name="l02569"></a>02569     pValidDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.MultiSampleQuality          = bestMultiSampleQuality;
<a name="l02570"></a>02570     pValidDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.SwapEffect                  = bestSwapEffect;
<a name="l02571"></a>02571     pValidDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.hDeviceWindow               = pBestDeviceSettingsCombo-&gt;<a class="code" href="struct_c_d3_d_enum_device_settings_combo.html#o4">Windowed</a> ? <a class="code" href="_d_x_u_t_8cpp.html#a101">DXUTGetHWNDDeviceWindowed</a>() : <a class="code" href="_d_x_u_t_8cpp.html#a100">DXUTGetHWNDDeviceFullScreen</a>();
<a name="l02572"></a>02572     pValidDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.Windowed                    = pBestDeviceSettingsCombo-&gt;<a class="code" href="struct_c_d3_d_enum_device_settings_combo.html#o4">Windowed</a>;
<a name="l02573"></a>02573     pValidDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.EnableAutoDepthStencil      = bestEnableAutoDepthStencil;  
<a name="l02574"></a>02574     pValidDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.AutoDepthStencilFormat      = bestDepthStencilFormat;
<a name="l02575"></a>02575     pValidDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.Flags                       = dwBestFlags;                   
<a name="l02576"></a>02576     pValidDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.FullScreen_RefreshRateInHz  = bestDisplayMode.RefreshRate;
<a name="l02577"></a>02577     pValidDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.PresentationInterval        = bestPresentInterval;
<a name="l02578"></a>02578 }
<a name="l02579"></a>02579 
<a name="l02580"></a>02580 
<a name="l02581"></a>02581 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l02582"></a>02582 <span class="comment">// Internal helper function to find the closest allowed display mode to the optimal </span>
<a name="l02583"></a>02583 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l02584"></a><a class="code" href="_d_x_u_t_8cpp.html#a39">02584</a> <a class="code" href="_d_x_u_tgui_8cpp.html#a51">HRESULT</a> <a class="code" href="_d_x_u_t_8cpp.html#a39">DXUTFindValidResolution</a>( <a class="code" href="struct_c_d3_d_enum_device_settings_combo.html">CD3DEnumDeviceSettingsCombo</a>* pBestDeviceSettingsCombo, 
<a name="l02585"></a>02585                                 D3DDISPLAYMODE displayModeIn, D3DDISPLAYMODE* pBestDisplayMode )
<a name="l02586"></a>02586 {
<a name="l02587"></a>02587     D3DDISPLAYMODE bestDisplayMode;
<a name="l02588"></a>02588     ZeroMemory( &amp;bestDisplayMode, <span class="keyword">sizeof</span>(D3DDISPLAYMODE) );
<a name="l02589"></a>02589     
<a name="l02590"></a>02590     <span class="keywordflow">if</span>( pBestDeviceSettingsCombo-&gt;<a class="code" href="struct_c_d3_d_enum_device_settings_combo.html#o4">Windowed</a> )
<a name="l02591"></a>02591     {
<a name="l02592"></a>02592         <span class="comment">// In windowed mode, all resolutions are valid but restritions still apply </span>
<a name="l02593"></a>02593         <span class="comment">// on the size of the window.  See DXUTChangeDevice() for details</span>
<a name="l02594"></a>02594         *pBestDisplayMode = displayModeIn;
<a name="l02595"></a>02595     }
<a name="l02596"></a>02596     <span class="keywordflow">else</span>
<a name="l02597"></a>02597     {
<a name="l02598"></a>02598         <span class="keywordtype">int</span> nBestRanking = 100000;
<a name="l02599"></a>02599         <span class="keywordtype">int</span> nCurRanking;
<a name="l02600"></a>02600         <a class="code" href="class_c_growable_array.html">CGrowableArray&lt;D3DDISPLAYMODE&gt;</a>* pDisplayModeList = &amp;pBestDeviceSettingsCombo-&gt;<a class="code" href="struct_c_d3_d_enum_device_settings_combo.html#o10">pAdapterInfo</a>-&gt;<a class="code" href="class_c_d3_d_enum_adapter_info.html#o3">displayModeList</a>;
<a name="l02601"></a>02601         <span class="keywordflow">for</span>( <span class="keywordtype">int</span> iDisplayMode=0; iDisplayMode&lt;pDisplayModeList-&gt;<a class="code" href="class_c_growable_array.html#a11">GetSize</a>(); iDisplayMode++ )
<a name="l02602"></a>02602         {
<a name="l02603"></a>02603             D3DDISPLAYMODE displayMode = pDisplayModeList-&gt;<a class="code" href="class_c_growable_array.html#a10">GetAt</a>(iDisplayMode);
<a name="l02604"></a>02604 
<a name="l02605"></a>02605             <span class="comment">// Skip display modes that don't match the combo's adapter format</span>
<a name="l02606"></a>02606             <span class="keywordflow">if</span>( displayMode.Format != pBestDeviceSettingsCombo-&gt;<a class="code" href="struct_c_d3_d_enum_device_settings_combo.html#o2">AdapterFormat</a> )
<a name="l02607"></a>02607                 <span class="keywordflow">continue</span>;
<a name="l02608"></a>02608 
<a name="l02609"></a>02609             <span class="comment">// Find the delta between the current width/height and the optimal width/height</span>
<a name="l02610"></a>02610             nCurRanking = abs((<span class="keywordtype">int</span>)displayMode.Width - (<span class="keywordtype">int</span>)displayModeIn.Width) + 
<a name="l02611"></a>02611                           abs((<span class="keywordtype">int</span>)displayMode.Height- (<span class="keywordtype">int</span>)displayModeIn.Height);
<a name="l02612"></a>02612 
<a name="l02613"></a>02613             <span class="keywordflow">if</span>( nCurRanking &lt; nBestRanking )
<a name="l02614"></a>02614             {
<a name="l02615"></a>02615                 bestDisplayMode = displayMode;
<a name="l02616"></a>02616                 nBestRanking = nCurRanking;
<a name="l02617"></a>02617 
<a name="l02618"></a>02618                 <span class="comment">// Stop if perfect match found</span>
<a name="l02619"></a>02619                 <span class="keywordflow">if</span>( nBestRanking == 0 )
<a name="l02620"></a>02620                     <span class="keywordflow">break</span>;
<a name="l02621"></a>02621             }
<a name="l02622"></a>02622         }
<a name="l02623"></a>02623 
<a name="l02624"></a>02624         <span class="keywordflow">if</span>( bestDisplayMode.Width == 0 )
<a name="l02625"></a>02625         {
<a name="l02626"></a>02626             *pBestDisplayMode = displayModeIn;
<a name="l02627"></a>02627             <span class="keywordflow">return</span> E_FAIL; <span class="comment">// No valid display modes found</span>
<a name="l02628"></a>02628         }
<a name="l02629"></a>02629 
<a name="l02630"></a>02630         *pBestDisplayMode = bestDisplayMode;
<a name="l02631"></a>02631     }
<a name="l02632"></a>02632 
<a name="l02633"></a>02633     <span class="keywordflow">return</span> S_OK;
<a name="l02634"></a>02634 }
<a name="l02635"></a>02635 
<a name="l02636"></a>02636 
<a name="l02637"></a>02637 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l02638"></a>02638 <span class="comment">// Internal helper function to return the adapter format from the first device settings </span>
<a name="l02639"></a>02639 <span class="comment">// combo that matches the passed adapter ordinal, device type, backbuffer format, and windowed.  </span>
<a name="l02640"></a>02640 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l02641"></a><a class="code" href="_d_x_u_t_8cpp.html#a40">02641</a> <a class="code" href="_d_x_u_tgui_8cpp.html#a51">HRESULT</a> <a class="code" href="_d_x_u_t_8cpp.html#a40">DXUTFindAdapterFormat</a>( <a class="code" href="_d_x_u_tgui_8cpp.html#a45">UINT</a> AdapterOrdinal, D3DDEVTYPE DeviceType, D3DFORMAT BackBufferFormat, 
<a name="l02642"></a>02642                                <a class="code" href="_d_x_u_tgui_8cpp.html#a39">BOOL</a> Windowed, D3DFORMAT* pAdapterFormat )
<a name="l02643"></a>02643 {
<a name="l02644"></a>02644     <a class="code" href="class_c_d3_d_enumeration.html">CD3DEnumeration</a>* pd3dEnum = <a class="code" href="_d_x_u_t_8cpp.html#a34">DXUTPrepareEnumerationObject</a>();
<a name="l02645"></a>02645     <a class="code" href="class_c_d3_d_enum_device_info.html">CD3DEnumDeviceInfo</a>* pDeviceInfo = pd3dEnum-&gt;<a class="code" href="class_c_d3_d_enumeration.html#a15">GetDeviceInfo</a>( AdapterOrdinal, DeviceType );
<a name="l02646"></a>02646     <span class="keywordflow">if</span>( pDeviceInfo )
<a name="l02647"></a>02647     {
<a name="l02648"></a>02648         <span class="keywordflow">for</span>( <span class="keywordtype">int</span> iDeviceCombo=0; iDeviceCombo&lt;pDeviceInfo-&gt;<a class="code" href="class_c_d3_d_enum_device_info.html#o3">deviceSettingsComboList</a>.<a class="code" href="class_c_growable_array.html#a11">GetSize</a>(); iDeviceCombo++ )
<a name="l02649"></a>02649         {
<a name="l02650"></a>02650             <a class="code" href="struct_c_d3_d_enum_device_settings_combo.html">CD3DEnumDeviceSettingsCombo</a>* pDeviceSettingsCombo = pDeviceInfo-&gt;<a class="code" href="class_c_d3_d_enum_device_info.html#o3">deviceSettingsComboList</a>.<a class="code" href="class_c_growable_array.html#a10">GetAt</a>(iDeviceCombo);
<a name="l02651"></a>02651             <span class="keywordflow">if</span>( pDeviceSettingsCombo-&gt;<a class="code" href="struct_c_d3_d_enum_device_settings_combo.html#o3">BackBufferFormat</a> == BackBufferFormat &amp;&amp;
<a name="l02652"></a>02652                 pDeviceSettingsCombo-&gt;<a class="code" href="struct_c_d3_d_enum_device_settings_combo.html#o4">Windowed</a> == Windowed )
<a name="l02653"></a>02653             {
<a name="l02654"></a>02654                 <span class="comment">// Return the adapter format from the first match</span>
<a name="l02655"></a>02655                 *pAdapterFormat = pDeviceSettingsCombo-&gt;<a class="code" href="struct_c_d3_d_enum_device_settings_combo.html#o2">AdapterFormat</a>;
<a name="l02656"></a>02656                 <span class="keywordflow">return</span> S_OK;
<a name="l02657"></a>02657             }
<a name="l02658"></a>02658         }
<a name="l02659"></a>02659     }
<a name="l02660"></a>02660 
<a name="l02661"></a>02661     *pAdapterFormat = BackBufferFormat;
<a name="l02662"></a>02662     <span class="keywordflow">return</span> E_FAIL;
<a name="l02663"></a>02663 }
<a name="l02664"></a>02664 
<a name="l02665"></a>02665 
<a name="l02666"></a>02666 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l02667"></a>02667 <span class="comment">// Change to a Direct3D device created from the device settings or passed in.</span>
<a name="l02668"></a>02668 <span class="comment">// The framework will only reset if the device is similar to the previous device </span>
<a name="l02669"></a>02669 <span class="comment">// otherwise it will cleanup the previous device (if there is one) and recreate the </span>
<a name="l02670"></a>02670 <span class="comment">// scene using the app's device callbacks.</span>
<a name="l02671"></a>02671 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l02672"></a><a class="code" href="_d_x_u_t_8cpp.html#a41">02672</a> <a class="code" href="_d_x_u_tgui_8cpp.html#a51">HRESULT</a> <a class="code" href="_d_x_u_t_8cpp.html#a41">DXUTChangeDevice</a>( <a class="code" href="struct_d_x_u_t_device_settings.html">DXUTDeviceSettings</a>* pNewDeviceSettings, IDirect3DDevice9* pd3dDeviceFromApp, <span class="keywordtype">bool</span> bForceRecreate, <span class="keywordtype">bool</span> bClipWindowToSingleAdapter )
<a name="l02673"></a>02673 {
<a name="l02674"></a>02674     <a class="code" href="_d_x_u_tgui_8cpp.html#a51">HRESULT</a> hr;
<a name="l02675"></a>02675     <a class="code" href="struct_d_x_u_t_device_settings.html">DXUTDeviceSettings</a>* pOldDeviceSettings = <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetCurrentDeviceSettings();
<a name="l02676"></a>02676 
<a name="l02677"></a>02677     <span class="keywordflow">if</span>( <a class="code" href="_d_x_u_t_8cpp.html#a93">DXUTGetD3DObject</a>() == NULL )
<a name="l02678"></a>02678         <span class="keywordflow">return</span> S_FALSE;
<a name="l02679"></a>02679 
<a name="l02680"></a>02680     <span class="comment">// Make a copy of the pNewDeviceSettings on the heap</span>
<a name="l02681"></a>02681     <a class="code" href="struct_d_x_u_t_device_settings.html">DXUTDeviceSettings</a>* pNewDeviceSettingsOnHeap = <a class="code" href="dxstdafx_8h.html#a4">DX_NEW</a> <a class="code" href="struct_d_x_u_t_device_settings.html">DXUTDeviceSettings</a>;
<a name="l02682"></a>02682     <span class="keywordflow">if</span>( pNewDeviceSettingsOnHeap == NULL )
<a name="l02683"></a>02683         <span class="keywordflow">return</span> E_OUTOFMEMORY;
<a name="l02684"></a>02684     memcpy( pNewDeviceSettingsOnHeap, pNewDeviceSettings, <span class="keyword">sizeof</span>(DXUTDeviceSettings) );
<a name="l02685"></a>02685     pNewDeviceSettings = pNewDeviceSettingsOnHeap;
<a name="l02686"></a>02686 
<a name="l02687"></a>02687     <span class="comment">// If the ModifyDeviceSettings callback is non-NULL, then call it to let the app </span>
<a name="l02688"></a>02688     <span class="comment">// change the settings or reject the device change by returning false.</span>
<a name="l02689"></a>02689     <a class="code" href="_d_x_u_t_8h.html#a10">LPDXUTCALLBACKMODIFYDEVICESETTINGS</a> pCallbackModifyDeviceSettings = <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetModifyDeviceSettingsFunc();
<a name="l02690"></a>02690     <span class="keywordflow">if</span>( pCallbackModifyDeviceSettings )
<a name="l02691"></a>02691     {
<a name="l02692"></a>02692         D3DCAPS9 caps;
<a name="l02693"></a>02693         IDirect3D9* pD3D = <a class="code" href="_d_x_u_t_8cpp.html#a93">DXUTGetD3DObject</a>();
<a name="l02694"></a>02694         pD3D-&gt;GetDeviceCaps( pNewDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o0">AdapterOrdinal</a>, pNewDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o1">DeviceType</a>, &amp;caps );
<a name="l02695"></a>02695 
<a name="l02696"></a>02696         <span class="keywordtype">bool</span> bContinue = pCallbackModifyDeviceSettings( pNewDeviceSettings, &amp;caps, <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetModifyDeviceSettingsFuncUserContext() );
<a name="l02697"></a>02697         <span class="keywordflow">if</span>( !bContinue )
<a name="l02698"></a>02698         {
<a name="l02699"></a>02699             <span class="comment">// The app rejected the device change by returning false, so just use the current device if there is one.</span>
<a name="l02700"></a>02700             <span class="keywordflow">if</span>( pOldDeviceSettings == NULL )
<a name="l02701"></a>02701                 <a class="code" href="_d_x_u_t_8cpp.html#a52">DXUTDisplayErrorMessage</a>( <a class="code" href="_d_x_u_t_8h.html#a1">DXUTERR_NOCOMPATIBLEDEVICES</a> );
<a name="l02702"></a>02702             <a class="code" href="dxstdafx_8h.html#a7">SAFE_DELETE</a>( pNewDeviceSettings );
<a name="l02703"></a>02703             <span class="keywordflow">return</span> E_ABORT;
<a name="l02704"></a>02704         }
<a name="l02705"></a>02705         <span class="keywordflow">if</span>( <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetD3D() == NULL )
<a name="l02706"></a>02706         {
<a name="l02707"></a>02707             <a class="code" href="dxstdafx_8h.html#a7">SAFE_DELETE</a>( pNewDeviceSettings );
<a name="l02708"></a>02708             <span class="keywordflow">return</span> S_FALSE;
<a name="l02709"></a>02709         }
<a name="l02710"></a>02710     }
<a name="l02711"></a>02711 
<a name="l02712"></a>02712     <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetCurrentDeviceSettings( pNewDeviceSettings );
<a name="l02713"></a>02713 
<a name="l02714"></a>02714     <a class="code" href="_d_x_u_t_8cpp.html#a86">DXUTPause</a>( <span class="keyword">true</span>, <span class="keyword">true</span> );
<a name="l02715"></a>02715 
<a name="l02716"></a>02716     <span class="comment">// When a WM_SIZE message is received, it calls DXUTCheckForWindowSizeChange().</span>
<a name="l02717"></a>02717     <span class="comment">// A WM_SIZE message might be sent when adjusting the window, so tell </span>
<a name="l02718"></a>02718     <span class="comment">// DXUTCheckForWindowSizeChange() to ignore size changes temporarily</span>
<a name="l02719"></a>02719     <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetIgnoreSizeChange( <span class="keyword">true</span> );
<a name="l02720"></a>02720 
<a name="l02721"></a>02721     <span class="comment">// Update thread safety on/off depending on Direct3D device's thread safety</span>
<a name="l02722"></a>02722     <a class="code" href="_d_x_u_t_8cpp.html#a16">g_bThreadSafe</a> = ((pNewDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o3">BehaviorFlags</a> &amp; D3DCREATE_MULTITHREADED) != 0 );
<a name="l02723"></a>02723 
<a name="l02724"></a>02724     <span class="comment">// Only apply the cmd line overrides if this is the first device created</span>
<a name="l02725"></a>02725     <span class="comment">// and DXUTSetDevice() isn't used</span>
<a name="l02726"></a>02726     <span class="keywordflow">if</span>( NULL == pd3dDeviceFromApp &amp;&amp; NULL == pOldDeviceSettings )
<a name="l02727"></a>02727     {
<a name="l02728"></a>02728         <span class="comment">// Updates the device settings struct based on the cmd line args.  </span>
<a name="l02729"></a>02729         <span class="comment">// Warning: if the device doesn't support these new settings then CreateDevice() will fail.</span>
<a name="l02730"></a>02730         <a class="code" href="_d_x_u_t_8cpp.html#a42">DXUTUpdateDeviceSettingsWithOverrides</a>( pNewDeviceSettings );
<a name="l02731"></a>02731     }
<a name="l02732"></a>02732 
<a name="l02733"></a>02733     <span class="comment">// Take note if the backbuffer width &amp; height are 0 now as they will change after pd3dDevice-&gt;Reset()</span>
<a name="l02734"></a>02734     <span class="keywordtype">bool</span> bKeepCurrentWindowSize = <span class="keyword">false</span>;
<a name="l02735"></a>02735     <span class="keywordflow">if</span>( pNewDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.BackBufferWidth == 0 &amp;&amp; pNewDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.BackBufferHeight == 0 )
<a name="l02736"></a>02736         bKeepCurrentWindowSize = <span class="keyword">true</span>;
<a name="l02737"></a>02737 
<a name="l02739"></a>02739     <span class="comment">// Before reset</span>
<a name="l02741"></a>02741 <span class="comment"></span>    <span class="keywordflow">if</span>( pNewDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.Windowed )
<a name="l02742"></a>02742     {
<a name="l02743"></a>02743         <span class="comment">// Going to windowed mode</span>
<a name="l02744"></a>02744 
<a name="l02745"></a>02745         <span class="keywordflow">if</span>( pOldDeviceSettings &amp;&amp; !pOldDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.Windowed )
<a name="l02746"></a>02746         {
<a name="l02747"></a>02747             <span class="comment">// Going from fullscreen -&gt; windowed</span>
<a name="l02748"></a>02748             <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetFullScreenBackBufferWidthAtModeChange( pOldDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.BackBufferWidth );
<a name="l02749"></a>02749             <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetFullScreenBackBufferHeightAtModeChange( pOldDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.BackBufferHeight );
<a name="l02750"></a>02750 
<a name="l02751"></a>02751             <span class="comment">// Restore windowed mode style</span>
<a name="l02752"></a>02752             SetWindowLong( <a class="code" href="_d_x_u_t_8cpp.html#a101">DXUTGetHWNDDeviceWindowed</a>(), GWL_STYLE, <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetWindowedStyleAtModeChange() );
<a name="l02753"></a>02753         }
<a name="l02754"></a>02754 
<a name="l02755"></a>02755         <span class="comment">// If different device windows are used for windowed mode and fullscreen mode,</span>
<a name="l02756"></a>02756         <span class="comment">// hide the fullscreen window so that it doesn't obscure the screen.</span>
<a name="l02757"></a>02757         <span class="keywordflow">if</span>( <a class="code" href="_d_x_u_t_8cpp.html#a100">DXUTGetHWNDDeviceFullScreen</a>() != <a class="code" href="_d_x_u_t_8cpp.html#a101">DXUTGetHWNDDeviceWindowed</a>() )
<a name="l02758"></a>02758             ShowWindow( <a class="code" href="_d_x_u_t_8cpp.html#a100">DXUTGetHWNDDeviceFullScreen</a>(), SW_HIDE );
<a name="l02759"></a>02759 
<a name="l02760"></a>02760         <span class="comment">// If using the same window for windowed and fullscreen mode, reattach menu if one exists</span>
<a name="l02761"></a>02761         <span class="keywordflow">if</span>( <a class="code" href="_d_x_u_t_8cpp.html#a100">DXUTGetHWNDDeviceFullScreen</a>() == <a class="code" href="_d_x_u_t_8cpp.html#a101">DXUTGetHWNDDeviceWindowed</a>() )
<a name="l02762"></a>02762         {
<a name="l02763"></a>02763             <span class="keywordflow">if</span>( <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetMenu() != NULL )
<a name="l02764"></a>02764                 SetMenu( <a class="code" href="_d_x_u_t_8cpp.html#a101">DXUTGetHWNDDeviceWindowed</a>(), <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetMenu() );
<a name="l02765"></a>02765         }
<a name="l02766"></a>02766     }
<a name="l02767"></a>02767     <span class="keywordflow">else</span> 
<a name="l02768"></a>02768     {
<a name="l02769"></a>02769         <span class="comment">// Going to fullscreen mode</span>
<a name="l02770"></a>02770 
<a name="l02771"></a>02771         <span class="keywordflow">if</span>( pOldDeviceSettings == NULL || (pOldDeviceSettings &amp;&amp; pOldDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.Windowed) )
<a name="l02772"></a>02772         {
<a name="l02773"></a>02773             <span class="comment">// Transistioning to full screen mode from a standard window so </span>
<a name="l02774"></a>02774             <span class="comment">// save current window position/size/style now in case the user toggles to windowed mode later </span>
<a name="l02775"></a>02775             WINDOWPLACEMENT* pwp = <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetWindowedPlacement();
<a name="l02776"></a>02776             ZeroMemory( pwp, <span class="keyword">sizeof</span>(WINDOWPLACEMENT) );
<a name="l02777"></a>02777             pwp-&gt;length = <span class="keyword">sizeof</span>(WINDOWPLACEMENT);
<a name="l02778"></a>02778             GetWindowPlacement( <a class="code" href="_d_x_u_t_8cpp.html#a101">DXUTGetHWNDDeviceWindowed</a>(), pwp );
<a name="l02779"></a>02779             <span class="keywordtype">bool</span> bIsTopmost = ( (GetWindowLong(<a class="code" href="_d_x_u_t_8cpp.html#a101">DXUTGetHWNDDeviceWindowed</a>(),GWL_EXSTYLE) &amp; WS_EX_TOPMOST) != 0); 
<a name="l02780"></a>02780             <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetTopmostWhileWindowed( bIsTopmost );
<a name="l02781"></a>02781             <a class="code" href="_d_x_u_tgui_8cpp.html#a38">DWORD</a> dwStyle = GetWindowLong( <a class="code" href="_d_x_u_t_8cpp.html#a101">DXUTGetHWNDDeviceWindowed</a>(), GWL_STYLE );
<a name="l02782"></a>02782             dwStyle &amp;= ~WS_MAXIMIZE &amp; ~WS_MINIMIZE; <span class="comment">// remove minimize/maximize style</span>
<a name="l02783"></a>02783             <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetWindowedStyleAtModeChange( dwStyle );
<a name="l02784"></a>02784             <span class="keywordflow">if</span>( pOldDeviceSettings )
<a name="l02785"></a>02785             {
<a name="l02786"></a>02786                 <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetWindowBackBufferWidthAtModeChange( pOldDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.BackBufferWidth );
<a name="l02787"></a>02787                 <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetWindowBackBufferHeightAtModeChange( pOldDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.BackBufferHeight );
<a name="l02788"></a>02788             }
<a name="l02789"></a>02789         }
<a name="l02790"></a>02790 
<a name="l02791"></a>02791         <span class="comment">// Hide the window to avoid animation of blank windows</span>
<a name="l02792"></a>02792         ShowWindow( <a class="code" href="_d_x_u_t_8cpp.html#a100">DXUTGetHWNDDeviceFullScreen</a>(), SW_HIDE );
<a name="l02793"></a>02793 
<a name="l02794"></a>02794         <span class="comment">// Set FS window style</span>
<a name="l02795"></a>02795         SetWindowLong( <a class="code" href="_d_x_u_t_8cpp.html#a100">DXUTGetHWNDDeviceFullScreen</a>(), GWL_STYLE, WS_POPUP|WS_SYSMENU );
<a name="l02796"></a>02796 
<a name="l02797"></a>02797         <span class="comment">// If using the same window for windowed and fullscreen mode, save and remove menu </span>
<a name="l02798"></a>02798         <span class="keywordflow">if</span>( <a class="code" href="_d_x_u_t_8cpp.html#a100">DXUTGetHWNDDeviceFullScreen</a>() == <a class="code" href="_d_x_u_t_8cpp.html#a101">DXUTGetHWNDDeviceWindowed</a>() )
<a name="l02799"></a>02799         {
<a name="l02800"></a>02800             HMENU hMenu = GetMenu( <a class="code" href="_d_x_u_t_8cpp.html#a100">DXUTGetHWNDDeviceFullScreen</a>() );
<a name="l02801"></a>02801             <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetMenu( hMenu );
<a name="l02802"></a>02802             SetMenu( <a class="code" href="_d_x_u_t_8cpp.html#a100">DXUTGetHWNDDeviceFullScreen</a>(), NULL );
<a name="l02803"></a>02803         }
<a name="l02804"></a>02804 
<a name="l02805"></a>02805         <span class="comment">// Restore the window to normal.  Note that if the window was maximized then minimized, the</span>
<a name="l02806"></a>02806         <span class="comment">// WPF_RESTORETOMAXIMIZED flag will be set which will cause SW_RESTORE to restore the </span>
<a name="l02807"></a>02807         <span class="comment">// window from minimized to maxmized which isn't what we want right now.</span>
<a name="l02808"></a>02808         WINDOWPLACEMENT wpFullscreen;
<a name="l02809"></a>02809         ZeroMemory( &amp;wpFullscreen, <span class="keyword">sizeof</span>(WINDOWPLACEMENT) );
<a name="l02810"></a>02810         wpFullscreen.length = <span class="keyword">sizeof</span>(WINDOWPLACEMENT);
<a name="l02811"></a>02811         GetWindowPlacement( <a class="code" href="_d_x_u_t_8cpp.html#a100">DXUTGetHWNDDeviceFullScreen</a>(), &amp;wpFullscreen );
<a name="l02812"></a>02812         wpFullscreen.flags &amp;= ~WPF_RESTORETOMAXIMIZED;
<a name="l02813"></a>02813         wpFullscreen.showCmd = SW_RESTORE;
<a name="l02814"></a>02814         SetWindowPlacement( <a class="code" href="_d_x_u_t_8cpp.html#a100">DXUTGetHWNDDeviceFullScreen</a>(), &amp;wpFullscreen );
<a name="l02815"></a>02815     }
<a name="l02816"></a>02816 
<a name="l02817"></a>02817     <span class="comment">// If AdapterOrdinal and DeviceType are the same, we can just do a Reset().</span>
<a name="l02818"></a>02818     <span class="comment">// If they've changed, we need to do a complete device tear down/rebuild.</span>
<a name="l02819"></a>02819     <span class="comment">// Also only allow a reset if pd3dDevice is the same as the current device </span>
<a name="l02820"></a>02820     <span class="keywordflow">if</span>( !bForceRecreate &amp;&amp; 
<a name="l02821"></a>02821         (pd3dDeviceFromApp == NULL || pd3dDeviceFromApp == <a class="code" href="_d_x_u_t_8cpp.html#a94">DXUTGetD3DDevice</a>()) &amp;&amp; 
<a name="l02822"></a>02822         pOldDeviceSettings &amp;&amp;
<a name="l02823"></a>02823         pOldDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o0">AdapterOrdinal</a> == pNewDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o0">AdapterOrdinal</a> &amp;&amp;
<a name="l02824"></a>02824         pOldDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o1">DeviceType</a> == pNewDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o1">DeviceType</a> &amp;&amp;
<a name="l02825"></a>02825         pOldDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o3">BehaviorFlags</a> == pNewDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o3">BehaviorFlags</a> )
<a name="l02826"></a>02826     {
<a name="l02827"></a>02827         <span class="comment">// Reset the Direct3D device and call the app's device callbacks</span>
<a name="l02828"></a>02828         hr = <a class="code" href="_d_x_u_t_8cpp.html#a44">DXUTReset3DEnvironment</a>();
<a name="l02829"></a>02829         <span class="keywordflow">if</span>( FAILED(hr) )
<a name="l02830"></a>02830         {
<a name="l02831"></a>02831             <span class="keywordflow">if</span>( D3DERR_DEVICELOST == hr )
<a name="l02832"></a>02832             {
<a name="l02833"></a>02833                 <span class="comment">// The device is lost, just mark it as so and continue on with </span>
<a name="l02834"></a>02834                 <span class="comment">// capturing the state and resizing the window/etc.</span>
<a name="l02835"></a>02835                 <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetDeviceLost( <span class="keyword">true</span> );
<a name="l02836"></a>02836             }
<a name="l02837"></a>02837             <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="_d_x_u_t_8h.html#a7">DXUTERR_RESETTINGDEVICEOBJECTS</a> == hr || 
<a name="l02838"></a>02838                      <a class="code" href="_d_x_u_t_8h.html#a2">DXUTERR_MEDIANOTFOUND</a> == hr )
<a name="l02839"></a>02839             {
<a name="l02840"></a>02840                 <span class="comment">// Something bad happened in the app callbacks</span>
<a name="l02841"></a>02841                 <a class="code" href="dxstdafx_8h.html#a7">SAFE_DELETE</a>( pOldDeviceSettings );
<a name="l02842"></a>02842                 <a class="code" href="_d_x_u_t_8cpp.html#a52">DXUTDisplayErrorMessage</a>( hr );
<a name="l02843"></a>02843                 <a class="code" href="_d_x_u_t_8cpp.html#a89">DXUTShutdown</a>();
<a name="l02844"></a>02844                 <span class="keywordflow">return</span> hr;
<a name="l02845"></a>02845             }
<a name="l02846"></a>02846             <span class="keywordflow">else</span> <span class="comment">// DXUTERR_RESETTINGDEVICE</span>
<a name="l02847"></a>02847             {
<a name="l02848"></a>02848                 <span class="comment">// Reset failed and the device wasn't lost and it wasn't the apps fault, </span>
<a name="l02849"></a>02849                 <span class="comment">// so recreate the device to try to recover</span>
<a name="l02850"></a>02850                 <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetCurrentDeviceSettings( pOldDeviceSettings );
<a name="l02851"></a>02851                 <span class="keywordflow">if</span>( FAILED( <a class="code" href="_d_x_u_t_8cpp.html#a41">DXUTChangeDevice</a>( pNewDeviceSettings, pd3dDeviceFromApp, <span class="keyword">true</span>, bClipWindowToSingleAdapter ) ) )
<a name="l02852"></a>02852                 {
<a name="l02853"></a>02853                     <span class="comment">// If that fails, then shutdown</span>
<a name="l02854"></a>02854                     <a class="code" href="dxstdafx_8h.html#a7">SAFE_DELETE</a>( pOldDeviceSettings );
<a name="l02855"></a>02855                     <a class="code" href="_d_x_u_t_8cpp.html#a89">DXUTShutdown</a>();
<a name="l02856"></a>02856                     <span class="keywordflow">return</span> <a class="code" href="_d_x_u_t_8h.html#a4">DXUTERR_CREATINGDEVICE</a>;
<a name="l02857"></a>02857                 }
<a name="l02858"></a>02858                 <span class="keywordflow">else</span>
<a name="l02859"></a>02859                 {
<a name="l02860"></a>02860                     <a class="code" href="dxstdafx_8h.html#a7">SAFE_DELETE</a>( pOldDeviceSettings );
<a name="l02861"></a>02861                     <span class="keywordflow">return</span> S_OK;
<a name="l02862"></a>02862                 }
<a name="l02863"></a>02863             }
<a name="l02864"></a>02864         }
<a name="l02865"></a>02865     }
<a name="l02866"></a>02866     <span class="keywordflow">else</span>
<a name="l02867"></a>02867     {
<a name="l02868"></a>02868         <span class="comment">// Cleanup if not first device created</span>
<a name="l02869"></a>02869         <span class="keywordflow">if</span>( pOldDeviceSettings )
<a name="l02870"></a>02870             <a class="code" href="_d_x_u_t_8cpp.html#a46">DXUTCleanup3DEnvironment</a>( <span class="keyword">false</span> );
<a name="l02871"></a>02871 
<a name="l02872"></a>02872         <span class="comment">// Create the D3D device and call the app's device callbacks</span>
<a name="l02873"></a>02873         hr = <a class="code" href="_d_x_u_t_8cpp.html#a43">DXUTCreate3DEnvironment</a>( pd3dDeviceFromApp );
<a name="l02874"></a>02874         <span class="keywordflow">if</span>( FAILED(hr) )
<a name="l02875"></a>02875         {
<a name="l02876"></a>02876             <a class="code" href="dxstdafx_8h.html#a7">SAFE_DELETE</a>( pOldDeviceSettings );
<a name="l02877"></a>02877             <a class="code" href="_d_x_u_t_8cpp.html#a46">DXUTCleanup3DEnvironment</a>();
<a name="l02878"></a>02878             <a class="code" href="_d_x_u_t_8cpp.html#a52">DXUTDisplayErrorMessage</a>( hr );
<a name="l02879"></a>02879             <a class="code" href="_d_x_u_t_8cpp.html#a86">DXUTPause</a>( <span class="keyword">false</span>, <span class="keyword">false</span> );
<a name="l02880"></a>02880             <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetIgnoreSizeChange( <span class="keyword">false</span> );
<a name="l02881"></a>02881             <span class="keywordflow">return</span> hr;
<a name="l02882"></a>02882         }
<a name="l02883"></a>02883     }
<a name="l02884"></a>02884 
<a name="l02885"></a>02885     <span class="comment">// Enable/disable StickKeys shortcut, ToggleKeys shortcut, FilterKeys shortcut, and Windows key </span>
<a name="l02886"></a>02886     <span class="comment">// to prevent accidental task switching</span>
<a name="l02887"></a>02887     <a class="code" href="_d_x_u_t_8cpp.html#a60">DXUTAllowShortcutKeys</a>( ( pNewDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.Windowed  ) ? <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetAllowShortcutKeysWhenWindowed() : <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetAllowShortcutKeysWhenFullscreen() );
<a name="l02888"></a>02888 
<a name="l02889"></a>02889     IDirect3D9* pD3D = <a class="code" href="_d_x_u_t_8cpp.html#a93">DXUTGetD3DObject</a>();
<a name="l02890"></a>02890     HMONITOR hAdapterMonitor = pD3D-&gt;GetAdapterMonitor( pNewDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o0">AdapterOrdinal</a> );
<a name="l02891"></a>02891     <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetAdapterMonitor( hAdapterMonitor );
<a name="l02892"></a>02892 
<a name="l02893"></a>02893     <span class="comment">// Update the device stats text</span>
<a name="l02894"></a>02894     <a class="code" href="_d_x_u_t_8cpp.html#a49">DXUTUpdateStaticFrameStats</a>();
<a name="l02895"></a>02895 
<a name="l02896"></a>02896     <span class="keywordflow">if</span>( pOldDeviceSettings &amp;&amp; !pOldDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.Windowed &amp;&amp; pNewDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.Windowed )
<a name="l02897"></a>02897     {
<a name="l02898"></a>02898         <span class="comment">// Going from fullscreen -&gt; windowed</span>
<a name="l02899"></a>02899 
<a name="l02900"></a>02900         <span class="comment">// Restore the show state, and positions/size of the window to what it was</span>
<a name="l02901"></a>02901         <span class="comment">// It is important to adjust the window size </span>
<a name="l02902"></a>02902         <span class="comment">// after resetting the device rather than beforehand to ensure </span>
<a name="l02903"></a>02903         <span class="comment">// that the monitor resolution is correct and does not limit the size of the new window.</span>
<a name="l02904"></a>02904         WINDOWPLACEMENT* pwp = <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetWindowedPlacement();
<a name="l02905"></a>02905         SetWindowPlacement( <a class="code" href="_d_x_u_t_8cpp.html#a101">DXUTGetHWNDDeviceWindowed</a>(), pwp );
<a name="l02906"></a>02906 
<a name="l02907"></a>02907         <span class="comment">// Also restore the z-order of window to previous state</span>
<a name="l02908"></a>02908         <a class="code" href="_d_x_u_tgui_8cpp.html#a53">HWND</a> hWndInsertAfter = <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetTopmostWhileWindowed() ? HWND_TOPMOST : HWND_NOTOPMOST;
<a name="l02909"></a>02909         SetWindowPos( <a class="code" href="_d_x_u_t_8cpp.html#a101">DXUTGetHWNDDeviceWindowed</a>(), hWndInsertAfter, 0, 0, 0, 0, SWP_NOMOVE|SWP_NOREDRAW|SWP_NOSIZE );
<a name="l02910"></a>02910     }
<a name="l02911"></a>02911 
<a name="l02912"></a>02912     <span class="comment">// Check to see if the window needs to be resized.  </span>
<a name="l02913"></a>02913     <span class="comment">// Handle cases where the window is minimized and maxmimized as well.</span>
<a name="l02914"></a>02914     <span class="keywordtype">bool</span> bNeedToResize = <span class="keyword">false</span>;
<a name="l02915"></a>02915     <span class="keywordflow">if</span>( pNewDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.Windowed &amp;&amp; <span class="comment">// only resize if in windowed mode</span>
<a name="l02916"></a>02916         !bKeepCurrentWindowSize )          <span class="comment">// only resize if pp.BackbufferWidth/Height were not 0</span>
<a name="l02917"></a>02917     {
<a name="l02918"></a>02918         <a class="code" href="_d_x_u_tgui_8cpp.html#a45">UINT</a> nClientWidth;
<a name="l02919"></a>02919         <a class="code" href="_d_x_u_tgui_8cpp.html#a45">UINT</a> nClientHeight;    
<a name="l02920"></a>02920         <span class="keywordflow">if</span>( IsIconic(<a class="code" href="_d_x_u_t_8cpp.html#a101">DXUTGetHWNDDeviceWindowed</a>()) )
<a name="l02921"></a>02921         {
<a name="l02922"></a>02922             <span class="comment">// Window is currently minimized. To tell if it needs to resize, </span>
<a name="l02923"></a>02923             <span class="comment">// get the client rect of window when its restored the </span>
<a name="l02924"></a>02924             <span class="comment">// hard way using GetWindowPlacement()</span>
<a name="l02925"></a>02925             WINDOWPLACEMENT wp;
<a name="l02926"></a>02926             ZeroMemory( &amp;wp, <span class="keyword">sizeof</span>(WINDOWPLACEMENT) );
<a name="l02927"></a>02927             wp.length = <span class="keyword">sizeof</span>(WINDOWPLACEMENT);
<a name="l02928"></a>02928             GetWindowPlacement( <a class="code" href="_d_x_u_t_8cpp.html#a101">DXUTGetHWNDDeviceWindowed</a>(), &amp;wp );
<a name="l02929"></a>02929 
<a name="l02930"></a>02930             <span class="keywordflow">if</span>( (wp.flags &amp; WPF_RESTORETOMAXIMIZED) != 0 &amp;&amp; wp.showCmd == SW_SHOWMINIMIZED )
<a name="l02931"></a>02931             {
<a name="l02932"></a>02932                 <span class="comment">// WPF_RESTORETOMAXIMIZED means that when the window is restored it will</span>
<a name="l02933"></a>02933                 <span class="comment">// be maximized.  So maximize the window temporarily to get the client rect </span>
<a name="l02934"></a>02934                 <span class="comment">// when the window is maximized.  GetSystemMetrics( SM_CXMAXIMIZED ) will give this </span>
<a name="l02935"></a>02935                 <span class="comment">// information if the window is on the primary but this will work on multimon.</span>
<a name="l02936"></a>02936                 ShowWindow( <a class="code" href="_d_x_u_t_8cpp.html#a101">DXUTGetHWNDDeviceWindowed</a>(), SW_RESTORE );
<a name="l02937"></a>02937                 RECT rcClient;
<a name="l02938"></a>02938                 GetClientRect( <a class="code" href="_d_x_u_t_8cpp.html#a101">DXUTGetHWNDDeviceWindowed</a>(), &amp;rcClient );
<a name="l02939"></a>02939                 nClientWidth  = (<a class="code" href="_d_x_u_tgui_8cpp.html#a45">UINT</a>)(rcClient.right - rcClient.left);
<a name="l02940"></a>02940                 nClientHeight = (<a class="code" href="_d_x_u_tgui_8cpp.html#a45">UINT</a>)(rcClient.bottom - rcClient.top);
<a name="l02941"></a>02941                 ShowWindow( <a class="code" href="_d_x_u_t_8cpp.html#a101">DXUTGetHWNDDeviceWindowed</a>(), SW_MINIMIZE );
<a name="l02942"></a>02942             }
<a name="l02943"></a>02943             <span class="keywordflow">else</span>
<a name="l02944"></a>02944             {
<a name="l02945"></a>02945                 <span class="comment">// Use wp.rcNormalPosition to get the client rect, but wp.rcNormalPosition </span>
<a name="l02946"></a>02946                 <span class="comment">// includes the window frame so subtract it</span>
<a name="l02947"></a>02947                 RECT rcFrame = {0};
<a name="l02948"></a>02948                 AdjustWindowRect( &amp;rcFrame, <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetWindowedStyleAtModeChange(), <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetMenu() != NULL );
<a name="l02949"></a>02949                 <a class="code" href="_d_x_u_tgui_8cpp.html#a52">LONG</a> nFrameWidth = rcFrame.right - rcFrame.left;
<a name="l02950"></a>02950                 <a class="code" href="_d_x_u_tgui_8cpp.html#a52">LONG</a> nFrameHeight = rcFrame.bottom - rcFrame.top;
<a name="l02951"></a>02951                 nClientWidth  = (<a class="code" href="_d_x_u_tgui_8cpp.html#a45">UINT</a>)(wp.rcNormalPosition.right - wp.rcNormalPosition.left - nFrameWidth);
<a name="l02952"></a>02952                 nClientHeight = (<a class="code" href="_d_x_u_tgui_8cpp.html#a45">UINT</a>)(wp.rcNormalPosition.bottom - wp.rcNormalPosition.top - nFrameHeight);
<a name="l02953"></a>02953             }
<a name="l02954"></a>02954         }
<a name="l02955"></a>02955         <span class="keywordflow">else</span>
<a name="l02956"></a>02956         {
<a name="l02957"></a>02957             <span class="comment">// Window is restored or maximized so just get its client rect</span>
<a name="l02958"></a>02958             RECT rcClient;
<a name="l02959"></a>02959             GetClientRect( <a class="code" href="_d_x_u_t_8cpp.html#a101">DXUTGetHWNDDeviceWindowed</a>(), &amp;rcClient );
<a name="l02960"></a>02960             nClientWidth  = (<a class="code" href="_d_x_u_tgui_8cpp.html#a45">UINT</a>)(rcClient.right - rcClient.left);
<a name="l02961"></a>02961             nClientHeight = (<a class="code" href="_d_x_u_tgui_8cpp.html#a45">UINT</a>)(rcClient.bottom - rcClient.top);
<a name="l02962"></a>02962         }
<a name="l02963"></a>02963 
<a name="l02964"></a>02964         <span class="comment">// Now that we know the client rect, compare it against the back buffer size</span>
<a name="l02965"></a>02965         <span class="comment">// to see if the client rect is already the right size</span>
<a name="l02966"></a>02966         <span class="keywordflow">if</span>( nClientWidth  != pNewDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.BackBufferWidth ||
<a name="l02967"></a>02967             nClientHeight != pNewDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.BackBufferHeight )
<a name="l02968"></a>02968         {
<a name="l02969"></a>02969             bNeedToResize = <span class="keyword">true</span>;
<a name="l02970"></a>02970         }       
<a name="l02971"></a>02971 
<a name="l02972"></a>02972         <span class="keywordflow">if</span>( bClipWindowToSingleAdapter &amp;&amp; !IsIconic(<a class="code" href="_d_x_u_t_8cpp.html#a101">DXUTGetHWNDDeviceWindowed</a>()) )
<a name="l02973"></a>02973         {
<a name="l02974"></a>02974             <span class="comment">// Get the rect of the monitor attached to the adapter</span>
<a name="l02975"></a>02975             <a class="code" href="structtag_m_o_n_i_t_o_r_i_n_f_o.html">MONITORINFO</a> miAdapter;
<a name="l02976"></a>02976             miAdapter.<a class="code" href="structtag_m_o_n_i_t_o_r_i_n_f_o.html#o0">cbSize</a> = <span class="keyword">sizeof</span>(<a class="code" href="structtag_m_o_n_i_t_o_r_i_n_f_o.html">MONITORINFO</a>);
<a name="l02977"></a>02977             HMONITOR hAdapterMonitor = <a class="code" href="_d_x_u_t_8cpp.html#a93">DXUTGetD3DObject</a>()-&gt;GetAdapterMonitor( pNewDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o0">AdapterOrdinal</a> );
<a name="l02978"></a>02978             <a class="code" href="_d_x_u_t_8cpp.html#a30">DXUT_GetMonitorInfo</a>( hAdapterMonitor, &amp;miAdapter );
<a name="l02979"></a>02979             HMONITOR hWindowMonitor = <a class="code" href="_d_x_u_t_8cpp.html#a28">DXUT_MonitorFromWindow</a>( <a class="code" href="_d_x_u_t_8cpp.html#a98">DXUTGetHWND</a>(), <a class="code" href="_d_x_u_t_8cpp.html#a9">MONITOR_DEFAULTTOPRIMARY</a> );
<a name="l02980"></a>02980 
<a name="l02981"></a>02981             <span class="comment">// Get the rect of the window</span>
<a name="l02982"></a>02982             RECT rcWindow;
<a name="l02983"></a>02983             GetWindowRect( <a class="code" href="_d_x_u_t_8cpp.html#a101">DXUTGetHWNDDeviceWindowed</a>(), &amp;rcWindow );
<a name="l02984"></a>02984 
<a name="l02985"></a>02985             <span class="comment">// Check if the window rect is fully inside the adapter's vitural screen rect</span>
<a name="l02986"></a>02986             <span class="keywordflow">if</span>( (rcWindow.left   &lt; miAdapter.<a class="code" href="structtag_m_o_n_i_t_o_r_i_n_f_o.html#o2">rcWork</a>.left  ||
<a name="l02987"></a>02987                  rcWindow.right  &gt; miAdapter.<a class="code" href="structtag_m_o_n_i_t_o_r_i_n_f_o.html#o2">rcWork</a>.right ||
<a name="l02988"></a>02988                  rcWindow.top    &lt; miAdapter.<a class="code" href="structtag_m_o_n_i_t_o_r_i_n_f_o.html#o2">rcWork</a>.top   ||
<a name="l02989"></a>02989                  rcWindow.bottom &gt; miAdapter.<a class="code" href="structtag_m_o_n_i_t_o_r_i_n_f_o.html#o2">rcWork</a>.bottom) )
<a name="l02990"></a>02990             {
<a name="l02991"></a>02991                 <span class="keywordflow">if</span>( hWindowMonitor == hAdapterMonitor &amp;&amp; IsZoomed(<a class="code" href="_d_x_u_t_8cpp.html#a101">DXUTGetHWNDDeviceWindowed</a>()) )
<a name="l02992"></a>02992                 {
<a name="l02993"></a>02993                     <span class="comment">// If the window is maximized and on the same monitor as the adapter, then </span>
<a name="l02994"></a>02994                     <span class="comment">// no need to clip to single adapter as the window is already clipped </span>
<a name="l02995"></a>02995                     <span class="comment">// even though the rcWindow rect is outside of the miAdapter.rcWork</span>
<a name="l02996"></a>02996                 }
<a name="l02997"></a>02997                 <span class="keywordflow">else</span>
<a name="l02998"></a>02998                 {
<a name="l02999"></a>02999                     bNeedToResize = <span class="keyword">true</span>;
<a name="l03000"></a>03000                 }
<a name="l03001"></a>03001             }
<a name="l03002"></a>03002         }
<a name="l03003"></a>03003     }
<a name="l03004"></a>03004 
<a name="l03005"></a>03005     <span class="comment">// Only resize window if needed </span>
<a name="l03006"></a>03006     <span class="keywordflow">if</span>( bNeedToResize ) 
<a name="l03007"></a>03007     {
<a name="l03008"></a>03008         <span class="comment">// Need to resize, so if window is maximized or minimized then restore the window</span>
<a name="l03009"></a>03009         <span class="keywordflow">if</span>( IsIconic(<a class="code" href="_d_x_u_t_8cpp.html#a101">DXUTGetHWNDDeviceWindowed</a>()) ) 
<a name="l03010"></a>03010             ShowWindow( <a class="code" href="_d_x_u_t_8cpp.html#a101">DXUTGetHWNDDeviceWindowed</a>(), SW_RESTORE );
<a name="l03011"></a>03011         <span class="keywordflow">if</span>( IsZoomed(<a class="code" href="_d_x_u_t_8cpp.html#a101">DXUTGetHWNDDeviceWindowed</a>()) ) <span class="comment">// doing the IsIconic() check first also handles the WPF_RESTORETOMAXIMIZED case</span>
<a name="l03012"></a>03012             ShowWindow( <a class="code" href="_d_x_u_t_8cpp.html#a101">DXUTGetHWNDDeviceWindowed</a>(), SW_RESTORE );
<a name="l03013"></a>03013 
<a name="l03014"></a>03014         <span class="keywordflow">if</span>( bClipWindowToSingleAdapter )
<a name="l03015"></a>03015         {
<a name="l03016"></a>03016             <span class="comment">// Get the rect of the monitor attached to the adapter</span>
<a name="l03017"></a>03017             <a class="code" href="structtag_m_o_n_i_t_o_r_i_n_f_o.html">MONITORINFO</a> miAdapter;
<a name="l03018"></a>03018             miAdapter.<a class="code" href="structtag_m_o_n_i_t_o_r_i_n_f_o.html#o0">cbSize</a> = <span class="keyword">sizeof</span>(<a class="code" href="structtag_m_o_n_i_t_o_r_i_n_f_o.html">MONITORINFO</a>);
<a name="l03019"></a>03019             <a class="code" href="_d_x_u_t_8cpp.html#a30">DXUT_GetMonitorInfo</a>( <a class="code" href="_d_x_u_t_8cpp.html#a93">DXUTGetD3DObject</a>()-&gt;GetAdapterMonitor( pNewDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o0">AdapterOrdinal</a> ), &amp;miAdapter );
<a name="l03020"></a>03020 
<a name="l03021"></a>03021             <span class="comment">// Get the rect of the monitor attached to the window</span>
<a name="l03022"></a>03022             <a class="code" href="structtag_m_o_n_i_t_o_r_i_n_f_o.html">MONITORINFO</a> miWindow;
<a name="l03023"></a>03023             miWindow.<a class="code" href="structtag_m_o_n_i_t_o_r_i_n_f_o.html#o0">cbSize</a> = <span class="keyword">sizeof</span>(<a class="code" href="structtag_m_o_n_i_t_o_r_i_n_f_o.html">MONITORINFO</a>);
<a name="l03024"></a>03024             <a class="code" href="_d_x_u_t_8cpp.html#a30">DXUT_GetMonitorInfo</a>( <a class="code" href="_d_x_u_t_8cpp.html#a28">DXUT_MonitorFromWindow</a>( <a class="code" href="_d_x_u_t_8cpp.html#a98">DXUTGetHWND</a>(), <a class="code" href="_d_x_u_t_8cpp.html#a9">MONITOR_DEFAULTTOPRIMARY</a> ), &amp;miWindow );
<a name="l03025"></a>03025 
<a name="l03026"></a>03026             <span class="comment">// Do something reasonable if the BackBuffer size is greater than the monitor size</span>
<a name="l03027"></a>03027             <span class="keywordtype">int</span> nAdapterMonitorWidth = miAdapter.<a class="code" href="structtag_m_o_n_i_t_o_r_i_n_f_o.html#o2">rcWork</a>.right - miAdapter.<a class="code" href="structtag_m_o_n_i_t_o_r_i_n_f_o.html#o2">rcWork</a>.left;
<a name="l03028"></a>03028             <span class="keywordtype">int</span> nAdapterMonitorHeight = miAdapter.<a class="code" href="structtag_m_o_n_i_t_o_r_i_n_f_o.html#o2">rcWork</a>.bottom - miAdapter.<a class="code" href="structtag_m_o_n_i_t_o_r_i_n_f_o.html#o2">rcWork</a>.top;
<a name="l03029"></a>03029 
<a name="l03030"></a>03030             <span class="keywordtype">int</span> nClientWidth = pNewDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.BackBufferWidth;
<a name="l03031"></a>03031             <span class="keywordtype">int</span> nClientHeight = pNewDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.BackBufferHeight;
<a name="l03032"></a>03032 
<a name="l03033"></a>03033             <span class="comment">// Get the rect of the window</span>
<a name="l03034"></a>03034             RECT rcWindow;
<a name="l03035"></a>03035             GetWindowRect( <a class="code" href="_d_x_u_t_8cpp.html#a101">DXUTGetHWNDDeviceWindowed</a>(), &amp;rcWindow );
<a name="l03036"></a>03036 
<a name="l03037"></a>03037             <span class="comment">// Make a window rect with a client rect that is the same size as the backbuffer</span>
<a name="l03038"></a>03038             RECT rcResizedWindow;
<a name="l03039"></a>03039             rcResizedWindow.left = 0;
<a name="l03040"></a>03040             rcResizedWindow.right = nClientWidth;
<a name="l03041"></a>03041             rcResizedWindow.top = 0;
<a name="l03042"></a>03042             rcResizedWindow.bottom = nClientHeight;
<a name="l03043"></a>03043             AdjustWindowRect( &amp;rcResizedWindow, GetWindowLong( <a class="code" href="_d_x_u_t_8cpp.html#a101">DXUTGetHWNDDeviceWindowed</a>(), GWL_STYLE ), <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetMenu() != NULL );
<a name="l03044"></a>03044 
<a name="l03045"></a>03045             <span class="keywordtype">int</span> nWindowWidth = rcResizedWindow.right - rcResizedWindow.left;
<a name="l03046"></a>03046             <span class="keywordtype">int</span> nWindowHeight = rcResizedWindow.bottom - rcResizedWindow.top;
<a name="l03047"></a>03047 
<a name="l03048"></a>03048             <span class="keywordflow">if</span>( nWindowWidth &gt; nAdapterMonitorWidth )
<a name="l03049"></a>03049                 nWindowWidth = (nAdapterMonitorWidth - 0);
<a name="l03050"></a>03050             <span class="keywordflow">if</span>( nWindowHeight &gt; nAdapterMonitorHeight )
<a name="l03051"></a>03051                 nWindowHeight = (nAdapterMonitorHeight - 0);
<a name="l03052"></a>03052 
<a name="l03053"></a>03053             <span class="keywordflow">if</span>( rcResizedWindow.left &lt; miAdapter.<a class="code" href="structtag_m_o_n_i_t_o_r_i_n_f_o.html#o2">rcWork</a>.left ||
<a name="l03054"></a>03054                 rcResizedWindow.top &lt; miAdapter.<a class="code" href="structtag_m_o_n_i_t_o_r_i_n_f_o.html#o2">rcWork</a>.top ||
<a name="l03055"></a>03055                 rcResizedWindow.right &gt; miAdapter.<a class="code" href="structtag_m_o_n_i_t_o_r_i_n_f_o.html#o2">rcWork</a>.right ||
<a name="l03056"></a>03056                 rcResizedWindow.bottom &gt; miAdapter.<a class="code" href="structtag_m_o_n_i_t_o_r_i_n_f_o.html#o2">rcWork</a>.bottom )
<a name="l03057"></a>03057             {
<a name="l03058"></a>03058                 <span class="keywordtype">int</span> nWindowOffsetX = (nAdapterMonitorWidth - nWindowWidth) / 2;
<a name="l03059"></a>03059                 <span class="keywordtype">int</span> nWindowOffsetY = (nAdapterMonitorHeight - nWindowHeight) / 2;
<a name="l03060"></a>03060 
<a name="l03061"></a>03061                 rcResizedWindow.left = miAdapter.<a class="code" href="structtag_m_o_n_i_t_o_r_i_n_f_o.html#o2">rcWork</a>.left + nWindowOffsetX;
<a name="l03062"></a>03062                 rcResizedWindow.top = miAdapter.<a class="code" href="structtag_m_o_n_i_t_o_r_i_n_f_o.html#o2">rcWork</a>.top + nWindowOffsetY;
<a name="l03063"></a>03063                 rcResizedWindow.right = miAdapter.<a class="code" href="structtag_m_o_n_i_t_o_r_i_n_f_o.html#o2">rcWork</a>.left + nWindowOffsetX + nWindowWidth;
<a name="l03064"></a>03064                 rcResizedWindow.bottom = miAdapter.<a class="code" href="structtag_m_o_n_i_t_o_r_i_n_f_o.html#o2">rcWork</a>.top + nWindowOffsetY + nWindowHeight;
<a name="l03065"></a>03065             }
<a name="l03066"></a>03066 
<a name="l03067"></a>03067             <span class="comment">// Resize the window.  It is important to adjust the window size </span>
<a name="l03068"></a>03068             <span class="comment">// after resetting the device rather than beforehand to ensure </span>
<a name="l03069"></a>03069             <span class="comment">// that the monitor resolution is correct and does not limit the size of the new window.</span>
<a name="l03070"></a>03070             SetWindowPos( <a class="code" href="_d_x_u_t_8cpp.html#a101">DXUTGetHWNDDeviceWindowed</a>(), 0, rcResizedWindow.left, rcResizedWindow.top, nWindowWidth, nWindowHeight, SWP_NOZORDER );
<a name="l03071"></a>03071         }        
<a name="l03072"></a>03072         <span class="keywordflow">else</span>
<a name="l03073"></a>03073         {      
<a name="l03074"></a>03074             <span class="comment">// Make a window rect with a client rect that is the same size as the backbuffer</span>
<a name="l03075"></a>03075             RECT rcWindow = {0};
<a name="l03076"></a>03076             rcWindow.right = (<a class="code" href="ioapi_8h.html#a25">long</a>)(pNewDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.BackBufferWidth);
<a name="l03077"></a>03077             rcWindow.bottom = (<a class="code" href="ioapi_8h.html#a25">long</a>)(pNewDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.BackBufferHeight);
<a name="l03078"></a>03078             AdjustWindowRect( &amp;rcWindow, GetWindowLong( <a class="code" href="_d_x_u_t_8cpp.html#a101">DXUTGetHWNDDeviceWindowed</a>(), GWL_STYLE ), <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetMenu() != NULL );
<a name="l03079"></a>03079 
<a name="l03080"></a>03080             <span class="comment">// Resize the window.  It is important to adjust the window size </span>
<a name="l03081"></a>03081             <span class="comment">// after resetting the device rather than beforehand to ensure </span>
<a name="l03082"></a>03082             <span class="comment">// that the monitor resolution is correct and does not limit the size of the new window.</span>
<a name="l03083"></a>03083             <span class="keywordtype">int</span> cx = (<a class="code" href="_d_x_u_tgui_8cpp.html#a37">int</a>)(rcWindow.right - rcWindow.left);
<a name="l03084"></a>03084             <span class="keywordtype">int</span> cy = (<a class="code" href="_d_x_u_tgui_8cpp.html#a37">int</a>)(rcWindow.bottom - rcWindow.top);
<a name="l03085"></a>03085             SetWindowPos( <a class="code" href="_d_x_u_t_8cpp.html#a101">DXUTGetHWNDDeviceWindowed</a>(), 0, 0, 0, cx, cy, SWP_NOZORDER|SWP_NOMOVE );
<a name="l03086"></a>03086         }
<a name="l03087"></a>03087 
<a name="l03088"></a>03088         <span class="comment">// Its possible that the new window size is not what we asked for.  </span>
<a name="l03089"></a>03089         <span class="comment">// No window can be sized larger than the desktop, so see see if the Windows OS resized the </span>
<a name="l03090"></a>03090         <span class="comment">// window to something smaller to fit on the desktop.  Also if WM_GETMINMAXINFO</span>
<a name="l03091"></a>03091         <span class="comment">// will put a limit on the smallest/largest window size.</span>
<a name="l03092"></a>03092         RECT rcClient;
<a name="l03093"></a>03093         GetClientRect( <a class="code" href="_d_x_u_t_8cpp.html#a101">DXUTGetHWNDDeviceWindowed</a>(), &amp;rcClient );
<a name="l03094"></a>03094         <a class="code" href="_d_x_u_tgui_8cpp.html#a45">UINT</a> nClientWidth  = (<a class="code" href="_d_x_u_tgui_8cpp.html#a45">UINT</a>)(rcClient.right - rcClient.left);
<a name="l03095"></a>03095         <a class="code" href="_d_x_u_tgui_8cpp.html#a45">UINT</a> nClientHeight = (<a class="code" href="_d_x_u_tgui_8cpp.html#a45">UINT</a>)(rcClient.bottom - rcClient.top);
<a name="l03096"></a>03096         <span class="keywordflow">if</span>( nClientWidth  != pNewDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.BackBufferWidth ||
<a name="l03097"></a>03097             nClientHeight != pNewDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.BackBufferHeight )
<a name="l03098"></a>03098         {
<a name="l03099"></a>03099             <span class="comment">// If its different, then resize the backbuffer again.  This time create a backbuffer that matches the </span>
<a name="l03100"></a>03100             <span class="comment">// client rect of the current window w/o resizing the window.</span>
<a name="l03101"></a>03101             DXUTDeviceSettings deviceSettings = <a class="code" href="_d_x_u_t_8cpp.html#a126">DXUTGetDeviceSettings</a>();
<a name="l03102"></a>03102             deviceSettings.<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.BackBufferWidth  = 0; 
<a name="l03103"></a>03103             deviceSettings.<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.BackBufferHeight = 0;
<a name="l03104"></a>03104             hr = <a class="code" href="_d_x_u_t_8cpp.html#a41">DXUTChangeDevice</a>( &amp;deviceSettings, NULL, <span class="keyword">false</span>, bClipWindowToSingleAdapter );
<a name="l03105"></a>03105             <span class="keywordflow">if</span>( FAILED( hr ) )
<a name="l03106"></a>03106             {
<a name="l03107"></a>03107                 <a class="code" href="dxstdafx_8h.html#a7">SAFE_DELETE</a>( pOldDeviceSettings );
<a name="l03108"></a>03108                 <a class="code" href="_d_x_u_t_8cpp.html#a46">DXUTCleanup3DEnvironment</a>();
<a name="l03109"></a>03109                 <a class="code" href="_d_x_u_t_8cpp.html#a86">DXUTPause</a>( <span class="keyword">false</span>, <span class="keyword">false</span> );
<a name="l03110"></a>03110                 <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetIgnoreSizeChange( <span class="keyword">false</span> );
<a name="l03111"></a>03111                 <span class="keywordflow">return</span> hr;
<a name="l03112"></a>03112             }
<a name="l03113"></a>03113         }
<a name="l03114"></a>03114     }
<a name="l03115"></a>03115 
<a name="l03116"></a>03116     <span class="comment">// Make the window visible</span>
<a name="l03117"></a>03117     <span class="keywordflow">if</span>( !IsWindowVisible( <a class="code" href="_d_x_u_t_8cpp.html#a98">DXUTGetHWND</a>() ) )
<a name="l03118"></a>03118         ShowWindow( <a class="code" href="_d_x_u_t_8cpp.html#a98">DXUTGetHWND</a>(), SW_SHOW );
<a name="l03119"></a>03119 
<a name="l03120"></a>03120         <span class="comment">// Setup cursor based on current settings (window/fullscreen mode, show cursor state, clip cursor state)</span>
<a name="l03121"></a>03121         <a class="code" href="_d_x_u_t_8cpp.html#a62">DXUTSetupCursor</a>();
<a name="l03122"></a>03122 
<a name="l03123"></a>03123     <a class="code" href="dxstdafx_8h.html#a7">SAFE_DELETE</a>( pOldDeviceSettings );
<a name="l03124"></a>03124     <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetIgnoreSizeChange( <span class="keyword">false</span> );
<a name="l03125"></a>03125     <a class="code" href="_d_x_u_t_8cpp.html#a86">DXUTPause</a>( <span class="keyword">false</span>, <span class="keyword">false</span> );
<a name="l03126"></a>03126     <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetDeviceCreated( <span class="keyword">true</span> );
<a name="l03127"></a>03127 
<a name="l03128"></a>03128     <span class="keywordflow">return</span> S_OK;
<a name="l03129"></a>03129 }
<a name="l03130"></a>03130 
<a name="l03131"></a>03131 
<a name="l03132"></a>03132 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l03133"></a>03133 <span class="comment">// Low level keyboard hook to disable Windows key to prevent accidental task switching.  </span>
<a name="l03134"></a>03134 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l03135"></a><a class="code" href="_d_x_u_t_8cpp.html#a84">03135</a> LRESULT CALLBACK <a class="code" href="_d_x_u_t_8cpp.html#a84">LowLevelKeyboardProc</a>( <span class="keywordtype">int</span> nCode, WPARAM wParam, LPARAM lParam )
<a name="l03136"></a>03136 {
<a name="l03137"></a>03137     <span class="keywordflow">if</span> (nCode &lt; 0 || nCode != HC_ACTION)  <span class="comment">// do not process message </span>
<a name="l03138"></a>03138         <span class="keywordflow">return</span> CallNextHookEx( <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetKeyboardHook(), nCode, wParam, lParam); 
<a name="l03139"></a>03139 
<a name="l03140"></a>03140     <span class="keywordtype">bool</span> bEatKeystroke = <span class="keyword">false</span>;
<a name="l03141"></a>03141     KBDLLHOOKSTRUCT* p = (KBDLLHOOKSTRUCT*)lParam;
<a name="l03142"></a>03142     <span class="keywordflow">switch</span> (wParam) 
<a name="l03143"></a>03143     {
<a name="l03144"></a>03144         <span class="keywordflow">case</span> WM_KEYDOWN:  
<a name="l03145"></a>03145         <span class="keywordflow">case</span> WM_KEYUP:    
<a name="l03146"></a>03146         {
<a name="l03147"></a>03147             bEatKeystroke = ( !<a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetAllowShortcutKeys() &amp;&amp; 
<a name="l03148"></a>03148                             (p-&gt;vkCode == VK_LWIN || p-&gt;vkCode == VK_RWIN) );
<a name="l03149"></a>03149             <span class="keywordflow">break</span>;
<a name="l03150"></a>03150         }
<a name="l03151"></a>03151     }
<a name="l03152"></a>03152 
<a name="l03153"></a>03153     <span class="keywordflow">if</span>( bEatKeystroke )
<a name="l03154"></a>03154         <span class="keywordflow">return</span> 1;
<a name="l03155"></a>03155     <span class="keywordflow">else</span>
<a name="l03156"></a>03156         <span class="keywordflow">return</span> CallNextHookEx( <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetKeyboardHook(), nCode, wParam, lParam );
<a name="l03157"></a>03157 }
<a name="l03158"></a>03158 
<a name="l03159"></a>03159 
<a name="l03160"></a>03160 
<a name="l03161"></a>03161 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l03162"></a>03162 <span class="comment">// Controls how DXUT behaves when fullscreen and windowed mode with regard to </span>
<a name="l03163"></a>03163 <span class="comment">// shortcut keys (Windows keys, StickyKeys shortcut, ToggleKeys shortcut, FilterKeys shortcut) </span>
<a name="l03164"></a>03164 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l03165"></a><a class="code" href="_d_x_u_t_8h.html#a46">03165</a> <span class="keywordtype">void</span> <a class="code" href="_d_x_u_t_8cpp.html#a85">DXUTSetShortcutKeySettings</a>( <span class="keywordtype">bool</span> bAllowWhenFullscreen, <span class="keywordtype">bool</span> bAllowWhenWindowed )
<a name="l03166"></a>03166 {
<a name="l03167"></a>03167     <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetAllowShortcutKeysWhenWindowed( bAllowWhenWindowed );
<a name="l03168"></a>03168     <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetAllowShortcutKeysWhenFullscreen( bAllowWhenFullscreen );
<a name="l03169"></a>03169 
<a name="l03170"></a>03170     <span class="comment">// DXUTInit() records initial accessibility states so don't change them until then</span>
<a name="l03171"></a>03171     <span class="keywordflow">if</span>( <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetDXUTInited() )
<a name="l03172"></a>03172     {
<a name="l03173"></a>03173         <span class="keywordflow">if</span>( <a class="code" href="_d_x_u_t_8cpp.html#a124">DXUTIsWindowed</a>() )
<a name="l03174"></a>03174             <a class="code" href="_d_x_u_t_8cpp.html#a60">DXUTAllowShortcutKeys</a>( <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetAllowShortcutKeysWhenWindowed() );
<a name="l03175"></a>03175         <span class="keywordflow">else</span>
<a name="l03176"></a>03176             <a class="code" href="_d_x_u_t_8cpp.html#a60">DXUTAllowShortcutKeys</a>( <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetAllowShortcutKeysWhenFullscreen() );
<a name="l03177"></a>03177     }
<a name="l03178"></a>03178 }
<a name="l03179"></a>03179 
<a name="l03180"></a>03180 
<a name="l03181"></a>03181 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l03182"></a>03182 <span class="comment">// Enables/disables Windows keys, and disables or restores the StickyKeys/ToggleKeys/FilterKeys </span>
<a name="l03183"></a>03183 <span class="comment">// shortcut to help prevent accidental task switching</span>
<a name="l03184"></a>03184 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l03185"></a><a class="code" href="_d_x_u_t_8cpp.html#a60">03185</a> <span class="keywordtype">void</span> <a class="code" href="_d_x_u_t_8cpp.html#a60">DXUTAllowShortcutKeys</a>( <span class="keywordtype">bool</span> bAllowKeys )
<a name="l03186"></a>03186 {
<a name="l03187"></a>03187     <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetAllowShortcutKeys( bAllowKeys );
<a name="l03188"></a>03188 
<a name="l03189"></a>03189     <span class="keywordflow">if</span>( bAllowKeys )
<a name="l03190"></a>03190     {
<a name="l03191"></a>03191         <span class="comment">// Restore StickyKeys/etc to original state and enable Windows key      </span>
<a name="l03192"></a>03192         STICKYKEYS sk = <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetStartupStickyKeys();
<a name="l03193"></a>03193         TOGGLEKEYS tk = <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetStartupToggleKeys();
<a name="l03194"></a>03194         FILTERKEYS fk = <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetStartupFilterKeys();
<a name="l03195"></a>03195         
<a name="l03196"></a>03196         SystemParametersInfo(SPI_SETSTICKYKEYS, <span class="keyword">sizeof</span>(STICKYKEYS), &amp;sk, 0);
<a name="l03197"></a>03197         SystemParametersInfo(SPI_SETTOGGLEKEYS, <span class="keyword">sizeof</span>(TOGGLEKEYS), &amp;tk, 0);
<a name="l03198"></a>03198         SystemParametersInfo(SPI_SETFILTERKEYS, <span class="keyword">sizeof</span>(FILTERKEYS), &amp;fk, 0);
<a name="l03199"></a>03199 
<a name="l03200"></a>03200         <span class="comment">// Remove the keyboard hoook when it isn't needed to prevent any slow down of other apps</span>
<a name="l03201"></a>03201         <span class="keywordflow">if</span>( <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetKeyboardHook() )
<a name="l03202"></a>03202         {
<a name="l03203"></a>03203             UnhookWindowsHookEx( <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetKeyboardHook() );
<a name="l03204"></a>03204             <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetKeyboardHook( NULL );
<a name="l03205"></a>03205         }                
<a name="l03206"></a>03206     }
<a name="l03207"></a>03207     <span class="keywordflow">else</span>
<a name="l03208"></a>03208     {
<a name="l03209"></a>03209         <span class="comment">// Set low level keyboard hook if haven't already</span>
<a name="l03210"></a>03210         <span class="keywordflow">if</span>( <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetKeyboardHook() == NULL )
<a name="l03211"></a>03211         {
<a name="l03212"></a>03212             <span class="comment">// Set the low-level hook procedure.  Only works on Windows 2000 and above</span>
<a name="l03213"></a>03213             OSVERSIONINFO OSVersionInfo;
<a name="l03214"></a>03214             OSVersionInfo.dwOSVersionInfoSize = <span class="keyword">sizeof</span>(OSVersionInfo);
<a name="l03215"></a>03215             GetVersionEx(&amp;OSVersionInfo);
<a name="l03216"></a>03216             <span class="keywordflow">if</span>( OSVersionInfo.dwPlatformId == VER_PLATFORM_WIN32_NT &amp;&amp; OSVersionInfo.dwMajorVersion &gt; 4 )
<a name="l03217"></a>03217             {
<a name="l03218"></a>03218                 HHOOK hKeyboardHook = SetWindowsHookEx( WH_KEYBOARD_LL, <a class="code" href="_d_x_u_t_8cpp.html#a84">LowLevelKeyboardProc</a>, GetModuleHandle(NULL), 0 );
<a name="l03219"></a>03219                 <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetKeyboardHook( hKeyboardHook );
<a name="l03220"></a>03220             }
<a name="l03221"></a>03221         }
<a name="l03222"></a>03222 
<a name="l03223"></a>03223         <span class="comment">// Disable StickyKeys/etc shortcuts but if the accessibility feature is on, </span>
<a name="l03224"></a>03224         <span class="comment">// then leave the settings alone as its probably being usefully used</span>
<a name="l03225"></a>03225 
<a name="l03226"></a>03226         STICKYKEYS skOff = <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetStartupStickyKeys();
<a name="l03227"></a>03227         <span class="keywordflow">if</span>( (skOff.dwFlags &amp; SKF_STICKYKEYSON) == 0 )
<a name="l03228"></a>03228         {
<a name="l03229"></a>03229             <span class="comment">// Disable the hotkey and the confirmation</span>
<a name="l03230"></a>03230             skOff.dwFlags &amp;= ~SKF_HOTKEYACTIVE;
<a name="l03231"></a>03231             skOff.dwFlags &amp;= ~SKF_CONFIRMHOTKEY;
<a name="l03232"></a>03232 
<a name="l03233"></a>03233             SystemParametersInfo(SPI_SETSTICKYKEYS, <span class="keyword">sizeof</span>(STICKYKEYS), &amp;skOff, 0);
<a name="l03234"></a>03234         }
<a name="l03235"></a>03235 
<a name="l03236"></a>03236         TOGGLEKEYS tkOff = <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetStartupToggleKeys();
<a name="l03237"></a>03237         <span class="keywordflow">if</span>( (tkOff.dwFlags &amp; TKF_TOGGLEKEYSON) == 0 )
<a name="l03238"></a>03238         {
<a name="l03239"></a>03239             <span class="comment">// Disable the hotkey and the confirmation</span>
<a name="l03240"></a>03240             tkOff.dwFlags &amp;= ~TKF_HOTKEYACTIVE;
<a name="l03241"></a>03241             tkOff.dwFlags &amp;= ~TKF_CONFIRMHOTKEY;
<a name="l03242"></a>03242 
<a name="l03243"></a>03243             SystemParametersInfo(SPI_SETTOGGLEKEYS, <span class="keyword">sizeof</span>(TOGGLEKEYS), &amp;tkOff, 0);
<a name="l03244"></a>03244         }
<a name="l03245"></a>03245 
<a name="l03246"></a>03246         FILTERKEYS fkOff = <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetStartupFilterKeys();
<a name="l03247"></a>03247         <span class="keywordflow">if</span>( (fkOff.dwFlags &amp; FKF_FILTERKEYSON) == 0 )
<a name="l03248"></a>03248         {
<a name="l03249"></a>03249             <span class="comment">// Disable the hotkey and the confirmation</span>
<a name="l03250"></a>03250             fkOff.dwFlags &amp;= ~FKF_HOTKEYACTIVE;
<a name="l03251"></a>03251             fkOff.dwFlags &amp;= ~FKF_CONFIRMHOTKEY;
<a name="l03252"></a>03252 
<a name="l03253"></a>03253             SystemParametersInfo(SPI_SETFILTERKEYS, <span class="keyword">sizeof</span>(FILTERKEYS), &amp;fkOff, 0);
<a name="l03254"></a>03254         }
<a name="l03255"></a>03255     }
<a name="l03256"></a>03256 }
<a name="l03257"></a>03257 
<a name="l03258"></a>03258 
<a name="l03259"></a>03259 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l03260"></a>03260 <span class="comment">// Updates the device settings struct based on the cmd line args.  </span>
<a name="l03261"></a>03261 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l03262"></a><a class="code" href="_d_x_u_t_8cpp.html#a42">03262</a> <span class="keywordtype">void</span> <a class="code" href="_d_x_u_t_8cpp.html#a42">DXUTUpdateDeviceSettingsWithOverrides</a>( <a class="code" href="struct_d_x_u_t_device_settings.html">DXUTDeviceSettings</a>* pDeviceSettings )
<a name="l03263"></a>03263 {
<a name="l03264"></a>03264     <span class="keywordflow">if</span>( <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetOverrideAdapterOrdinal() != -1 )
<a name="l03265"></a>03265         pDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o0">AdapterOrdinal</a> = <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetOverrideAdapterOrdinal();
<a name="l03266"></a>03266 
<a name="l03267"></a>03267     <span class="keywordflow">if</span>( <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetOverrideFullScreen() )
<a name="l03268"></a>03268         pDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.Windowed = <span class="keyword">false</span>;
<a name="l03269"></a>03269     <span class="keywordflow">if</span>( <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetOverrideWindowed() )
<a name="l03270"></a>03270         pDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.Windowed = <span class="keyword">true</span>;
<a name="l03271"></a>03271 
<a name="l03272"></a>03272     <span class="keywordflow">if</span>( <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetOverrideForceREF() )
<a name="l03273"></a>03273         pDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o1">DeviceType</a> = D3DDEVTYPE_REF;
<a name="l03274"></a>03274     <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetOverrideForceHAL() )
<a name="l03275"></a>03275         pDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o1">DeviceType</a> = D3DDEVTYPE_HAL;
<a name="l03276"></a>03276 
<a name="l03277"></a>03277     <span class="keywordflow">if</span>( <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetOverrideWidth() != 0 )
<a name="l03278"></a>03278         pDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.BackBufferWidth = <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetOverrideWidth();
<a name="l03279"></a>03279     <span class="keywordflow">if</span>( <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetOverrideHeight() != 0 )
<a name="l03280"></a>03280         pDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.BackBufferHeight = <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetOverrideHeight();
<a name="l03281"></a>03281 
<a name="l03282"></a>03282     <span class="keywordflow">if</span>( <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetOverrideForcePureHWVP() )
<a name="l03283"></a>03283     {
<a name="l03284"></a>03284         pDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o3">BehaviorFlags</a> &amp;= ~D3DCREATE_SOFTWARE_VERTEXPROCESSING;
<a name="l03285"></a>03285         pDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o3">BehaviorFlags</a> |= D3DCREATE_HARDWARE_VERTEXPROCESSING;
<a name="l03286"></a>03286         pDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o3">BehaviorFlags</a> |= D3DCREATE_PUREDEVICE;
<a name="l03287"></a>03287     }
<a name="l03288"></a>03288     <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetOverrideForceHWVP() )
<a name="l03289"></a>03289     {
<a name="l03290"></a>03290         pDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o3">BehaviorFlags</a> &amp;= ~D3DCREATE_SOFTWARE_VERTEXPROCESSING;
<a name="l03291"></a>03291         pDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o3">BehaviorFlags</a> &amp;= ~D3DCREATE_PUREDEVICE;
<a name="l03292"></a>03292         pDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o3">BehaviorFlags</a> |= D3DCREATE_HARDWARE_VERTEXPROCESSING;
<a name="l03293"></a>03293     }
<a name="l03294"></a>03294     <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetOverrideForceSWVP() )
<a name="l03295"></a>03295     {
<a name="l03296"></a>03296         pDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o3">BehaviorFlags</a> &amp;= ~D3DCREATE_HARDWARE_VERTEXPROCESSING;
<a name="l03297"></a>03297         pDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o3">BehaviorFlags</a> &amp;= ~D3DCREATE_PUREDEVICE;
<a name="l03298"></a>03298         pDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o3">BehaviorFlags</a> |= D3DCREATE_SOFTWARE_VERTEXPROCESSING;
<a name="l03299"></a>03299     }
<a name="l03300"></a>03300 }
<a name="l03301"></a>03301 
<a name="l03302"></a>03302 
<a name="l03303"></a>03303 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l03304"></a>03304 <span class="comment">// Creates the 3D environment</span>
<a name="l03305"></a>03305 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l03306"></a><a class="code" href="_d_x_u_t_8cpp.html#a43">03306</a> <a class="code" href="_d_x_u_tgui_8cpp.html#a51">HRESULT</a> <a class="code" href="_d_x_u_t_8cpp.html#a43">DXUTCreate3DEnvironment</a>( IDirect3DDevice9* pd3dDeviceFromApp )
<a name="l03307"></a>03307 {
<a name="l03308"></a>03308     <a class="code" href="_d_x_u_tgui_8cpp.html#a51">HRESULT</a> hr = S_OK;
<a name="l03309"></a>03309 
<a name="l03310"></a>03310     IDirect3DDevice9* pd3dDevice = NULL;
<a name="l03311"></a>03311     <a class="code" href="struct_d_x_u_t_device_settings.html">DXUTDeviceSettings</a>* pNewDeviceSettings = <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetCurrentDeviceSettings();
<a name="l03312"></a>03312 
<a name="l03313"></a>03313     <span class="comment">// Only create a Direct3D device if one hasn't been supplied by the app</span>
<a name="l03314"></a>03314     <span class="keywordflow">if</span>( pd3dDeviceFromApp == NULL )
<a name="l03315"></a>03315     {
<a name="l03316"></a>03316         <span class="comment">// Try to create the device with the chosen settings</span>
<a name="l03317"></a>03317         IDirect3D9* pD3D = <a class="code" href="_d_x_u_t_8cpp.html#a93">DXUTGetD3DObject</a>();
<a name="l03318"></a>03318         hr = pD3D-&gt;CreateDevice( pNewDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o0">AdapterOrdinal</a>, pNewDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o1">DeviceType</a>, 
<a name="l03319"></a>03319                                 <a class="code" href="_d_x_u_t_8cpp.html#a99">DXUTGetHWNDFocus</a>(), pNewDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o3">BehaviorFlags</a>,
<a name="l03320"></a>03320                                 &amp;pNewDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>, &amp;pd3dDevice );
<a name="l03321"></a>03321         <span class="keywordflow">if</span>( FAILED(hr) )
<a name="l03322"></a>03322         {
<a name="l03323"></a>03323             <a class="code" href="_d_x_u_tmisc_8h.html#a7">DXUT_ERR</a>( L<span class="stringliteral">"CreateDevice"</span>, hr );
<a name="l03324"></a>03324             <span class="keywordflow">return</span> <a class="code" href="_d_x_u_t_8h.html#a4">DXUTERR_CREATINGDEVICE</a>;
<a name="l03325"></a>03325         }
<a name="l03326"></a>03326     }
<a name="l03327"></a>03327     <span class="keywordflow">else</span>
<a name="l03328"></a>03328     {
<a name="l03329"></a>03329         pd3dDeviceFromApp-&gt;AddRef();
<a name="l03330"></a>03330         pd3dDevice = pd3dDeviceFromApp;
<a name="l03331"></a>03331     }
<a name="l03332"></a>03332 
<a name="l03333"></a>03333     <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetD3DDevice( pd3dDevice );
<a name="l03334"></a>03334 
<a name="l03335"></a>03335     <span class="comment">// If switching to REF, set the exit code to 11.  If switching to HAL and exit code was 11, then set it back to 0.</span>
<a name="l03336"></a>03336     <span class="keywordflow">if</span>( pNewDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o1">DeviceType</a> == D3DDEVTYPE_REF &amp;&amp; <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetExitCode() == 0 )
<a name="l03337"></a>03337         <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetExitCode(11);
<a name="l03338"></a>03338     <span class="keywordflow">else</span> <span class="keywordflow">if</span>( pNewDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o1">DeviceType</a> == D3DDEVTYPE_HAL &amp;&amp; <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetExitCode() == 11 )
<a name="l03339"></a>03339         <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetExitCode(0);
<a name="l03340"></a>03340 
<a name="l03341"></a>03341     <span class="comment">// Update back buffer desc before calling app's device callbacks</span>
<a name="l03342"></a>03342     <a class="code" href="_d_x_u_t_8cpp.html#a61">DXUTUpdateBackBufferDesc</a>();
<a name="l03343"></a>03343 
<a name="l03344"></a>03344     <span class="comment">// Update GetDXUTState()'s copy of D3D caps </span>
<a name="l03345"></a>03345     D3DCAPS9* pd3dCaps = <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetCaps();
<a name="l03346"></a>03346     <a class="code" href="_d_x_u_t_8cpp.html#a94">DXUTGetD3DDevice</a>()-&gt;GetDeviceCaps( pd3dCaps );
<a name="l03347"></a>03347 
<a name="l03348"></a>03348     <span class="comment">// Update the device stats text</span>
<a name="l03349"></a>03349     <a class="code" href="class_c_d3_d_enumeration.html">CD3DEnumeration</a>* pd3dEnum = <a class="code" href="_d_x_u_t_8cpp.html#a34">DXUTPrepareEnumerationObject</a>();
<a name="l03350"></a>03350     <a class="code" href="class_c_d3_d_enum_adapter_info.html">CD3DEnumAdapterInfo</a>* pAdapterInfo = pd3dEnum-&gt;<a class="code" href="class_c_d3_d_enumeration.html#a14">GetAdapterInfo</a>( pNewDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o0">AdapterOrdinal</a> );
<a name="l03351"></a>03351     <a class="code" href="_d_x_u_t_8cpp.html#a48">DXUTUpdateDeviceStats</a>( pNewDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o1">DeviceType</a>, 
<a name="l03352"></a>03352                         pNewDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o3">BehaviorFlags</a>, 
<a name="l03353"></a>03353                         &amp;pAdapterInfo-&gt;<a class="code" href="class_c_d3_d_enum_adapter_info.html#o1">AdapterIdentifier</a> );
<a name="l03354"></a>03354 
<a name="l03355"></a>03355     <span class="comment">// Call the resource cache created function</span>
<a name="l03356"></a>03356     hr = <a class="code" href="_d_x_u_tmisc_8cpp.html#a17">DXUTGetGlobalResourceCache</a>().<a class="code" href="class_c_d_x_u_t_resource_cache.html#a17">OnCreateDevice</a>( pd3dDevice );
<a name="l03357"></a>03357     <span class="keywordflow">if</span>( FAILED(hr) )
<a name="l03358"></a>03358         <span class="keywordflow">return</span> <a class="code" href="_d_x_u_tmisc_8h.html#a7">DXUT_ERR</a>( L<span class="stringliteral">"OnCreateDevice"</span>, ( hr == <a class="code" href="_d_x_u_t_8h.html#a2">DXUTERR_MEDIANOTFOUND</a> ) ? <a class="code" href="_d_x_u_t_8h.html#a2">DXUTERR_MEDIANOTFOUND</a> : <a class="code" href="_d_x_u_t_8h.html#a6">DXUTERR_CREATINGDEVICEOBJECTS</a> );
<a name="l03359"></a>03359 
<a name="l03360"></a>03360     <span class="comment">// Call the app's device created callback if non-NULL</span>
<a name="l03361"></a>03361     <span class="keyword">const</span> D3DSURFACE_DESC* pbackBufferSurfaceDesc = <a class="code" href="_d_x_u_t_8cpp.html#a95">DXUTGetBackBufferSurfaceDesc</a>();
<a name="l03362"></a>03362     <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetInsideDeviceCallback( <span class="keyword">true</span> );
<a name="l03363"></a>03363     <a class="code" href="_d_x_u_t_8h.html#a11">LPDXUTCALLBACKDEVICECREATED</a> pCallbackDeviceCreated = <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetDeviceCreatedFunc();
<a name="l03364"></a>03364     hr = S_OK;
<a name="l03365"></a>03365     <span class="keywordflow">if</span>( pCallbackDeviceCreated != NULL )
<a name="l03366"></a>03366         hr = pCallbackDeviceCreated( <a class="code" href="_d_x_u_t_8cpp.html#a94">DXUTGetD3DDevice</a>(), pbackBufferSurfaceDesc, <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetDeviceCreatedFuncUserContext() );
<a name="l03367"></a>03367     <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetInsideDeviceCallback( <span class="keyword">false</span> );
<a name="l03368"></a>03368     <span class="keywordflow">if</span>( <a class="code" href="_d_x_u_t_8cpp.html#a94">DXUTGetD3DDevice</a>() == NULL ) <span class="comment">// Handle DXUTShutdown from inside callback</span>
<a name="l03369"></a>03369         <span class="keywordflow">return</span> E_FAIL;
<a name="l03370"></a>03370     <span class="keywordflow">if</span>( FAILED(hr) )  
<a name="l03371"></a>03371     {
<a name="l03372"></a>03372         <a class="code" href="_d_x_u_tmisc_8h.html#a7">DXUT_ERR</a>( L<span class="stringliteral">"DeviceCreated callback"</span>, hr );        
<a name="l03373"></a>03373         <span class="keywordflow">return</span> ( hr == <a class="code" href="_d_x_u_t_8h.html#a2">DXUTERR_MEDIANOTFOUND</a> ) ? <a class="code" href="_d_x_u_t_8h.html#a2">DXUTERR_MEDIANOTFOUND</a> : DXUTERR_CREATINGDEVICEOBJECTS;
<a name="l03374"></a>03374     }
<a name="l03375"></a>03375     <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetDeviceObjectsCreated( <span class="keyword">true</span> );
<a name="l03376"></a>03376 
<a name="l03377"></a>03377     <span class="comment">// Call the resource cache device reset function</span>
<a name="l03378"></a>03378     hr = <a class="code" href="_d_x_u_tmisc_8cpp.html#a17">DXUTGetGlobalResourceCache</a>().<a class="code" href="class_c_d_x_u_t_resource_cache.html#a18">OnResetDevice</a>( pd3dDevice );
<a name="l03379"></a>03379     <span class="keywordflow">if</span>( FAILED(hr) )
<a name="l03380"></a>03380         <span class="keywordflow">return</span> <a class="code" href="_d_x_u_tmisc_8h.html#a7">DXUT_ERR</a>( L<span class="stringliteral">"OnResetDevice"</span>, <a class="code" href="_d_x_u_t_8h.html#a7">DXUTERR_RESETTINGDEVICEOBJECTS</a> );
<a name="l03381"></a>03381 
<a name="l03382"></a>03382     <span class="comment">// Call the app's device reset callback if non-NULL</span>
<a name="l03383"></a>03383     <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetInsideDeviceCallback( <span class="keyword">true</span> );
<a name="l03384"></a>03384     <a class="code" href="_d_x_u_t_8h.html#a12">LPDXUTCALLBACKDEVICERESET</a> pCallbackDeviceReset = <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetDeviceResetFunc();
<a name="l03385"></a>03385     hr = S_OK;
<a name="l03386"></a>03386     <span class="keywordflow">if</span>( pCallbackDeviceReset != NULL )
<a name="l03387"></a>03387         hr = pCallbackDeviceReset( <a class="code" href="_d_x_u_t_8cpp.html#a94">DXUTGetD3DDevice</a>(), pbackBufferSurfaceDesc, <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetDeviceResetFuncUserContext() );
<a name="l03388"></a>03388     <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetInsideDeviceCallback( <span class="keyword">false</span> );
<a name="l03389"></a>03389     <span class="keywordflow">if</span>( <a class="code" href="_d_x_u_t_8cpp.html#a94">DXUTGetD3DDevice</a>() == NULL ) <span class="comment">// Handle DXUTShutdown from inside callback</span>
<a name="l03390"></a>03390         <span class="keywordflow">return</span> E_FAIL;
<a name="l03391"></a>03391     <span class="keywordflow">if</span>( FAILED(hr) )
<a name="l03392"></a>03392     {
<a name="l03393"></a>03393         <a class="code" href="_d_x_u_tmisc_8h.html#a7">DXUT_ERR</a>( L<span class="stringliteral">"DeviceReset callback"</span>, hr );
<a name="l03394"></a>03394         <span class="keywordflow">return</span> ( hr == <a class="code" href="_d_x_u_t_8h.html#a2">DXUTERR_MEDIANOTFOUND</a> ) ? <a class="code" href="_d_x_u_t_8h.html#a2">DXUTERR_MEDIANOTFOUND</a> : <a class="code" href="_d_x_u_t_8h.html#a7">DXUTERR_RESETTINGDEVICEOBJECTS</a>;
<a name="l03395"></a>03395     }
<a name="l03396"></a>03396     <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetDeviceObjectsReset( <span class="keyword">true</span> );
<a name="l03397"></a>03397 
<a name="l03398"></a>03398     <span class="keywordflow">return</span> S_OK;
<a name="l03399"></a>03399 }
<a name="l03400"></a>03400 
<a name="l03401"></a>03401 
<a name="l03402"></a>03402 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l03403"></a>03403 <span class="comment">// Resets the 3D environment by:</span>
<a name="l03404"></a>03404 <span class="comment">//      - Calls the device lost callback </span>
<a name="l03405"></a>03405 <span class="comment">//      - Resets the device</span>
<a name="l03406"></a>03406 <span class="comment">//      - Stores the back buffer description</span>
<a name="l03407"></a>03407 <span class="comment">//      - Sets up the full screen Direct3D cursor if requested</span>
<a name="l03408"></a>03408 <span class="comment">//      - Calls the device reset callback </span>
<a name="l03409"></a>03409 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l03410"></a><a class="code" href="_d_x_u_t_8cpp.html#a44">03410</a> <a class="code" href="_d_x_u_tgui_8cpp.html#a51">HRESULT</a> <a class="code" href="_d_x_u_t_8cpp.html#a44">DXUTReset3DEnvironment</a>()
<a name="l03411"></a>03411 {
<a name="l03412"></a>03412     <a class="code" href="_d_x_u_tgui_8cpp.html#a51">HRESULT</a> hr;
<a name="l03413"></a>03413 
<a name="l03414"></a>03414     IDirect3DDevice9* pd3dDevice = <a class="code" href="_d_x_u_t_8cpp.html#a94">DXUTGetD3DDevice</a>();
<a name="l03415"></a>03415     assert( pd3dDevice != NULL );
<a name="l03416"></a>03416 
<a name="l03417"></a>03417     <span class="comment">// Call the app's device lost callback</span>
<a name="l03418"></a>03418     <span class="keywordflow">if</span>( <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetDeviceObjectsReset() == true )
<a name="l03419"></a>03419     {
<a name="l03420"></a>03420         <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetInsideDeviceCallback( <span class="keyword">true</span> );
<a name="l03421"></a>03421         <a class="code" href="_d_x_u_t_8h.html#a14">LPDXUTCALLBACKDEVICELOST</a> pCallbackDeviceLost = <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetDeviceLostFunc();
<a name="l03422"></a>03422         <span class="keywordflow">if</span>( pCallbackDeviceLost != NULL )
<a name="l03423"></a>03423             pCallbackDeviceLost( <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetDeviceLostFuncUserContext() );
<a name="l03424"></a>03424         <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetDeviceObjectsReset( <span class="keyword">false</span> );
<a name="l03425"></a>03425         <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetInsideDeviceCallback( <span class="keyword">false</span> );
<a name="l03426"></a>03426 
<a name="l03427"></a>03427         <span class="comment">// Call the resource cache device lost function</span>
<a name="l03428"></a>03428         <a class="code" href="_d_x_u_tmisc_8cpp.html#a17">DXUTGetGlobalResourceCache</a>().<a class="code" href="class_c_d_x_u_t_resource_cache.html#a19">OnLostDevice</a>();
<a name="l03429"></a>03429     }
<a name="l03430"></a>03430 
<a name="l03431"></a>03431     <span class="comment">// Reset the device</span>
<a name="l03432"></a>03432     <a class="code" href="struct_d_x_u_t_device_settings.html">DXUTDeviceSettings</a>* pDeviceSettings = <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetCurrentDeviceSettings();
<a name="l03433"></a>03433     hr = pd3dDevice-&gt;Reset( &amp;pDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a> );
<a name="l03434"></a>03434     <span class="keywordflow">if</span>( FAILED(hr) )  
<a name="l03435"></a>03435     {
<a name="l03436"></a>03436         <span class="keywordflow">if</span>( hr == D3DERR_DEVICELOST )
<a name="l03437"></a>03437             <span class="keywordflow">return</span> D3DERR_DEVICELOST; <span class="comment">// Reset could legitimately fail if the device is lost</span>
<a name="l03438"></a>03438         <span class="keywordflow">else</span>
<a name="l03439"></a>03439             <span class="keywordflow">return</span> <a class="code" href="_d_x_u_tmisc_8h.html#a7">DXUT_ERR</a>( L<span class="stringliteral">"Reset"</span>, <a class="code" href="_d_x_u_t_8h.html#a5">DXUTERR_RESETTINGDEVICE</a> );
<a name="l03440"></a>03440     }
<a name="l03441"></a>03441 
<a name="l03442"></a>03442     <span class="comment">// Update back buffer desc before calling app's device callbacks</span>
<a name="l03443"></a>03443     <a class="code" href="_d_x_u_t_8cpp.html#a61">DXUTUpdateBackBufferDesc</a>();
<a name="l03444"></a>03444 
<a name="l03445"></a>03445     hr = <a class="code" href="_d_x_u_tmisc_8cpp.html#a17">DXUTGetGlobalResourceCache</a>().<a class="code" href="class_c_d_x_u_t_resource_cache.html#a18">OnResetDevice</a>( pd3dDevice );
<a name="l03446"></a>03446     <span class="keywordflow">if</span>( FAILED(hr) )
<a name="l03447"></a>03447         <span class="keywordflow">return</span> <a class="code" href="_d_x_u_tmisc_8h.html#a7">DXUT_ERR</a>( L<span class="stringliteral">"OnResetDevice"</span>, <a class="code" href="_d_x_u_t_8h.html#a7">DXUTERR_RESETTINGDEVICEOBJECTS</a> );
<a name="l03448"></a>03448 
<a name="l03449"></a>03449     <span class="comment">// Call the app's OnDeviceReset callback</span>
<a name="l03450"></a>03450     <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetInsideDeviceCallback( <span class="keyword">true</span> );
<a name="l03451"></a>03451     <span class="keyword">const</span> D3DSURFACE_DESC* pbackBufferSurfaceDesc = <a class="code" href="_d_x_u_t_8cpp.html#a95">DXUTGetBackBufferSurfaceDesc</a>();
<a name="l03452"></a>03452     <a class="code" href="_d_x_u_t_8h.html#a12">LPDXUTCALLBACKDEVICERESET</a> pCallbackDeviceReset = <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetDeviceResetFunc();
<a name="l03453"></a>03453     hr = S_OK;
<a name="l03454"></a>03454     <span class="keywordflow">if</span>( pCallbackDeviceReset != NULL )
<a name="l03455"></a>03455         hr = pCallbackDeviceReset( pd3dDevice, pbackBufferSurfaceDesc, <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetDeviceResetFuncUserContext() );
<a name="l03456"></a>03456     <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetInsideDeviceCallback( <span class="keyword">false</span> );
<a name="l03457"></a>03457     <span class="keywordflow">if</span>( FAILED(hr) )
<a name="l03458"></a>03458     {
<a name="l03459"></a>03459         <span class="comment">// If callback failed, cleanup</span>
<a name="l03460"></a>03460         <a class="code" href="_d_x_u_tmisc_8h.html#a7">DXUT_ERR</a>( L<span class="stringliteral">"DeviceResetCallback"</span>, hr );
<a name="l03461"></a>03461         <span class="keywordflow">if</span>( hr != <a class="code" href="_d_x_u_t_8h.html#a2">DXUTERR_MEDIANOTFOUND</a> )
<a name="l03462"></a>03462             hr = <a class="code" href="_d_x_u_t_8h.html#a7">DXUTERR_RESETTINGDEVICEOBJECTS</a>;
<a name="l03463"></a>03463 
<a name="l03464"></a>03464         <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetInsideDeviceCallback( <span class="keyword">true</span> );
<a name="l03465"></a>03465         <a class="code" href="_d_x_u_t_8h.html#a14">LPDXUTCALLBACKDEVICELOST</a> pCallbackDeviceLost = <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetDeviceLostFunc();
<a name="l03466"></a>03466         <span class="keywordflow">if</span>( pCallbackDeviceLost != NULL )
<a name="l03467"></a>03467             pCallbackDeviceLost( <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetDeviceLostFuncUserContext() );
<a name="l03468"></a>03468         <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetInsideDeviceCallback( <span class="keyword">false</span> );
<a name="l03469"></a>03469 
<a name="l03470"></a>03470         <a class="code" href="_d_x_u_tmisc_8cpp.html#a17">DXUTGetGlobalResourceCache</a>().<a class="code" href="class_c_d_x_u_t_resource_cache.html#a19">OnLostDevice</a>();       
<a name="l03471"></a>03471         <span class="keywordflow">return</span> hr;
<a name="l03472"></a>03472     }
<a name="l03473"></a>03473 
<a name="l03474"></a>03474     <span class="comment">// Success</span>
<a name="l03475"></a>03475     <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetDeviceObjectsReset( <span class="keyword">true</span> );
<a name="l03476"></a>03476 
<a name="l03477"></a>03477     <span class="keywordflow">return</span> S_OK;
<a name="l03478"></a>03478 }
<a name="l03479"></a>03479 
<a name="l03480"></a>03480 
<a name="l03481"></a>03481 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l03482"></a>03482 <span class="comment">// Pauses time or rendering.  Keeps a ref count so pausing can be layered</span>
<a name="l03483"></a>03483 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l03484"></a><a class="code" href="_d_x_u_t_8h.html#a53">03484</a> <span class="keywordtype">void</span> <a class="code" href="_d_x_u_t_8cpp.html#a86">DXUTPause</a>( <span class="keywordtype">bool</span> bPauseTime, <span class="keywordtype">bool</span> bPauseRendering )
<a name="l03485"></a>03485 {
<a name="l03486"></a>03486     <span class="keywordtype">int</span> nPauseTimeCount = <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetPauseTimeCount();
<a name="l03487"></a>03487     nPauseTimeCount += ( bPauseTime ? +1 : -1 );
<a name="l03488"></a>03488     <span class="keywordflow">if</span>( nPauseTimeCount &lt; 0 )
<a name="l03489"></a>03489         nPauseTimeCount = 0;
<a name="l03490"></a>03490     <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetPauseTimeCount( nPauseTimeCount );
<a name="l03491"></a>03491 
<a name="l03492"></a>03492     <span class="keywordtype">int</span> nPauseRenderingCount = <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetPauseRenderingCount();
<a name="l03493"></a>03493     nPauseRenderingCount += ( bPauseRendering ? +1 : -1 );
<a name="l03494"></a>03494     <span class="keywordflow">if</span>( nPauseRenderingCount &lt; 0 )
<a name="l03495"></a>03495         nPauseRenderingCount = 0;
<a name="l03496"></a>03496     <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetPauseRenderingCount( nPauseRenderingCount );
<a name="l03497"></a>03497 
<a name="l03498"></a>03498     <span class="keywordflow">if</span>( nPauseTimeCount &gt; 0 )
<a name="l03499"></a>03499     {
<a name="l03500"></a>03500         <span class="comment">// Stop the scene from animating</span>
<a name="l03501"></a>03501         <a class="code" href="_d_x_u_tmisc_8cpp.html#a18">DXUTGetGlobalTimer</a>()-&gt;<a class="code" href="class_c_d_x_u_t_timer.html#a3">Stop</a>();
<a name="l03502"></a>03502     }
<a name="l03503"></a>03503     <span class="keywordflow">else</span>
<a name="l03504"></a>03504     {
<a name="l03505"></a>03505         <span class="comment">// Restart the timer</span>
<a name="l03506"></a>03506         <a class="code" href="_d_x_u_tmisc_8cpp.html#a18">DXUTGetGlobalTimer</a>()-&gt;<a class="code" href="class_c_d_x_u_t_timer.html#a2">Start</a>();
<a name="l03507"></a>03507     }
<a name="l03508"></a>03508 
<a name="l03509"></a>03509     <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetRenderingPaused( nPauseRenderingCount &gt; 0 );
<a name="l03510"></a>03510     <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetTimePaused( nPauseTimeCount &gt; 0 );
<a name="l03511"></a>03511 }
<a name="l03512"></a>03512 
<a name="l03513"></a>03513 
<a name="l03514"></a>03514 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l03515"></a>03515 <span class="comment">// Checks if the window client rect has changed and if it has, then reset the device</span>
<a name="l03516"></a>03516 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l03517"></a><a class="code" href="_d_x_u_t_8cpp.html#a54">03517</a> <span class="keywordtype">void</span> <a class="code" href="_d_x_u_t_8cpp.html#a54">DXUTCheckForWindowSizeChange</a>()
<a name="l03518"></a>03518 {
<a name="l03519"></a>03519     <span class="comment">// Skip the check for various reasons</span>
<a name="l03520"></a>03520     <span class="keywordflow">if</span>( <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetIgnoreSizeChange() || 
<a name="l03521"></a>03521         !<a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetDeviceCreated() || 
<a name="l03522"></a>03522         !<a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetCurrentDeviceSettings()-&gt;pp.Windowed )
<a name="l03523"></a>03523         <span class="keywordflow">return</span>;
<a name="l03524"></a>03524 
<a name="l03525"></a>03525     RECT rcCurrentClient;
<a name="l03526"></a>03526     GetClientRect( <a class="code" href="_d_x_u_t_8cpp.html#a98">DXUTGetHWND</a>(), &amp;rcCurrentClient );
<a name="l03527"></a>03527     
<a name="l03528"></a>03528     <span class="keywordflow">if</span>( (<a class="code" href="_d_x_u_tgui_8cpp.html#a45">UINT</a>)rcCurrentClient.right != <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetCurrentDeviceSettings()-&gt;pp.BackBufferWidth ||
<a name="l03529"></a>03529         (<a class="code" href="_d_x_u_tgui_8cpp.html#a45">UINT</a>)rcCurrentClient.bottom != <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetCurrentDeviceSettings()-&gt;pp.BackBufferHeight )
<a name="l03530"></a>03530     {
<a name="l03531"></a>03531         <span class="comment">// A new window size will require a new backbuffer size</span>
<a name="l03532"></a>03532         <span class="comment">// size, so the device must be reset and the D3D structures updated accordingly.</span>
<a name="l03533"></a>03533 
<a name="l03534"></a>03534         <span class="comment">// Tell DXUTChangeDevice and D3D to size according to the HWND's client rect</span>
<a name="l03535"></a>03535         <a class="code" href="struct_d_x_u_t_device_settings.html">DXUTDeviceSettings</a> deviceSettings = <a class="code" href="_d_x_u_t_8cpp.html#a126">DXUTGetDeviceSettings</a>();
<a name="l03536"></a>03536         deviceSettings.<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.BackBufferWidth  = 0; 
<a name="l03537"></a>03537         deviceSettings.<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.BackBufferHeight = 0;
<a name="l03538"></a>03538         <a class="code" href="_d_x_u_t_8cpp.html#a41">DXUTChangeDevice</a>( &amp;deviceSettings, NULL, <span class="keyword">false</span>, <span class="keyword">false</span> );
<a name="l03539"></a>03539     }
<a name="l03540"></a>03540 }
<a name="l03541"></a>03541 
<a name="l03542"></a>03542 
<a name="l03543"></a>03543 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l03544"></a>03544 <span class="comment">// Handles app's message loop and rendering when idle.  If DXUTCreateDevice*() or DXUTSetDevice() </span>
<a name="l03545"></a>03545 <span class="comment">// has not already been called, it will call DXUTCreateWindow() with the default parameters.  </span>
<a name="l03546"></a>03546 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l03547"></a><a class="code" href="_d_x_u_t_8h.html#a41">03547</a> <a class="code" href="_d_x_u_tgui_8cpp.html#a51">HRESULT</a> <a class="code" href="_d_x_u_t_8cpp.html#a87">DXUTMainLoop</a>( HACCEL hAccel )
<a name="l03548"></a>03548 {
<a name="l03549"></a>03549     <a class="code" href="_d_x_u_tgui_8cpp.html#a51">HRESULT</a> hr;
<a name="l03550"></a>03550 
<a name="l03551"></a>03551     <span class="comment">// Not allowed to call this from inside the device callbacks or reenter</span>
<a name="l03552"></a>03552     <span class="keywordflow">if</span>( <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetInsideDeviceCallback() || <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetInsideMainloop() )
<a name="l03553"></a>03553     {
<a name="l03554"></a>03554         <span class="keywordflow">if</span>( (<a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetExitCode() == 0) || (<a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetExitCode() == 11) )
<a name="l03555"></a>03555             <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetExitCode(1);
<a name="l03556"></a>03556         <span class="keywordflow">return</span> <a class="code" href="_d_x_u_tmisc_8h.html#a8">DXUT_ERR_MSGBOX</a>( L<span class="stringliteral">"DXUTMainLoop"</span>, E_FAIL );
<a name="l03557"></a>03557     }
<a name="l03558"></a>03558 
<a name="l03559"></a>03559     <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetInsideMainloop( <span class="keyword">true</span> );
<a name="l03560"></a>03560 
<a name="l03561"></a>03561     <span class="comment">// If DXUTCreateDevice*() or DXUTSetDevice() has not already been called, </span>
<a name="l03562"></a>03562     <span class="comment">// then call DXUTCreateDevice() with the default parameters.         </span>
<a name="l03563"></a>03563     <span class="keywordflow">if</span>( !<a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetDeviceCreated() ) 
<a name="l03564"></a>03564     {
<a name="l03565"></a>03565         <span class="keywordflow">if</span>( <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetDeviceCreateCalled() )
<a name="l03566"></a>03566         {
<a name="l03567"></a>03567             <span class="keywordflow">if</span>( (<a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetExitCode() == 0) || (<a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetExitCode() == 11) )
<a name="l03568"></a>03568                 <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetExitCode(1);
<a name="l03569"></a>03569             <span class="keywordflow">return</span> E_FAIL; <span class="comment">// DXUTCreateDevice() must first succeed for this function to succeed</span>
<a name="l03570"></a>03570         }
<a name="l03571"></a>03571 
<a name="l03572"></a>03572         hr = <a class="code" href="_d_x_u_t_8cpp.html#a78">DXUTCreateDevice</a>();
<a name="l03573"></a>03573         <span class="keywordflow">if</span>( FAILED(hr) )
<a name="l03574"></a>03574         {
<a name="l03575"></a>03575             <span class="keywordflow">if</span>( (<a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetExitCode() == 0) || (<a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetExitCode() == 11) )
<a name="l03576"></a>03576                 <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetExitCode(1);
<a name="l03577"></a>03577             <span class="keywordflow">return</span> hr;
<a name="l03578"></a>03578         }
<a name="l03579"></a>03579     }
<a name="l03580"></a>03580 
<a name="l03581"></a>03581     <a class="code" href="_d_x_u_tgui_8cpp.html#a53">HWND</a> hWnd = <a class="code" href="_d_x_u_t_8cpp.html#a98">DXUTGetHWND</a>();
<a name="l03582"></a>03582 
<a name="l03583"></a>03583     <span class="comment">// DXUTInit() must have been called and succeeded for this function to proceed</span>
<a name="l03584"></a>03584     <span class="comment">// DXUTCreateWindow() or DXUTSetWindow() must have been called and succeeded for this function to proceed</span>
<a name="l03585"></a>03585     <span class="comment">// DXUTCreateDevice() or DXUTCreateDeviceFromSettings() or DXUTSetDevice() must have been called and succeeded for this function to proceed</span>
<a name="l03586"></a>03586     <span class="keywordflow">if</span>( !<a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetDXUTInited() || !<a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetWindowCreated() || !<a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetDeviceCreated() )
<a name="l03587"></a>03587     {
<a name="l03588"></a>03588         <span class="keywordflow">if</span>( (<a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetExitCode() == 0) || (<a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetExitCode() == 11) )
<a name="l03589"></a>03589             <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetExitCode(1);
<a name="l03590"></a>03590         <span class="keywordflow">return</span> <a class="code" href="_d_x_u_tmisc_8h.html#a8">DXUT_ERR_MSGBOX</a>( L<span class="stringliteral">"DXUTMainLoop"</span>, E_FAIL );
<a name="l03591"></a>03591     }
<a name="l03592"></a>03592 
<a name="l03593"></a>03593     <span class="comment">// Now we're ready to receive and process Windows messages.</span>
<a name="l03594"></a>03594     <span class="keywordtype">bool</span> bGotMsg;
<a name="l03595"></a>03595     MSG  msg;
<a name="l03596"></a>03596     msg.message = WM_NULL;
<a name="l03597"></a>03597     PeekMessage( &amp;msg, NULL, 0U, 0U, PM_NOREMOVE );
<a name="l03598"></a>03598 
<a name="l03599"></a>03599     <span class="keywordflow">while</span>( WM_QUIT != msg.message  )
<a name="l03600"></a>03600     {
<a name="l03601"></a>03601         <span class="comment">// Use PeekMessage() so we can use idle time to render the scene. </span>
<a name="l03602"></a>03602         bGotMsg = ( PeekMessage( &amp;msg, NULL, 0U, 0U, PM_REMOVE ) != 0 );
<a name="l03603"></a>03603 
<a name="l03604"></a>03604         <span class="keywordflow">if</span>( bGotMsg )
<a name="l03605"></a>03605         {
<a name="l03606"></a>03606             <span class="comment">// Translate and dispatch the message</span>
<a name="l03607"></a>03607             <span class="keywordflow">if</span>( hAccel == NULL || hWnd == NULL || 
<a name="l03608"></a>03608                 0 == TranslateAccelerator( hWnd, hAccel, &amp;msg ) )
<a name="l03609"></a>03609             {
<a name="l03610"></a>03610                 TranslateMessage( &amp;msg );
<a name="l03611"></a>03611                 DispatchMessage( &amp;msg );
<a name="l03612"></a>03612             }
<a name="l03613"></a>03613         }
<a name="l03614"></a>03614         <span class="keywordflow">else</span>
<a name="l03615"></a>03615         {
<a name="l03616"></a>03616             <span class="comment">// Render a frame during idle time (no messages are waiting)</span>
<a name="l03617"></a>03617             <a class="code" href="_d_x_u_t_8cpp.html#a45">DXUTRender3DEnvironment</a>();
<a name="l03618"></a>03618         }
<a name="l03619"></a>03619     }
<a name="l03620"></a>03620 
<a name="l03621"></a>03621     <span class="comment">// Cleanup the accelerator table</span>
<a name="l03622"></a>03622     <span class="keywordflow">if</span>( hAccel != NULL )
<a name="l03623"></a>03623         DestroyAcceleratorTable( hAccel );
<a name="l03624"></a>03624 
<a name="l03625"></a>03625     <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetInsideMainloop( <span class="keyword">false</span> );
<a name="l03626"></a>03626 
<a name="l03627"></a>03627     <span class="keywordflow">return</span> S_OK;
<a name="l03628"></a>03628 }
<a name="l03629"></a>03629 
<a name="l03630"></a>03630 
<a name="l03631"></a>03631 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l03632"></a>03632 <span class="comment">// Render the 3D environment by:</span>
<a name="l03633"></a>03633 <span class="comment">//      - Checking if the device is lost and trying to reset it if it is</span>
<a name="l03634"></a>03634 <span class="comment">//      - Get the elapsed time since the last frame</span>
<a name="l03635"></a>03635 <span class="comment">//      - Calling the app's framemove and render callback</span>
<a name="l03636"></a>03636 <span class="comment">//      - Calling Present()</span>
<a name="l03637"></a>03637 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l03638"></a><a class="code" href="_d_x_u_t_8cpp.html#a45">03638</a> <span class="keywordtype">void</span> <a class="code" href="_d_x_u_t_8cpp.html#a45">DXUTRender3DEnvironment</a>()
<a name="l03639"></a>03639 {
<a name="l03640"></a>03640     <a class="code" href="_d_x_u_tgui_8cpp.html#a51">HRESULT</a> hr;
<a name="l03641"></a>03641    
<a name="l03642"></a>03642     IDirect3DDevice9* pd3dDevice = <a class="code" href="_d_x_u_t_8cpp.html#a94">DXUTGetD3DDevice</a>();
<a name="l03643"></a>03643     <span class="keywordflow">if</span>( NULL == pd3dDevice )
<a name="l03644"></a>03644         <span class="keywordflow">return</span>;
<a name="l03645"></a>03645  
<a name="l03646"></a>03646     <span class="keywordflow">if</span>( <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetDeviceLost() || <a class="code" href="_d_x_u_t_8cpp.html#a111">DXUTIsRenderingPaused</a>() || !<a class="code" href="_d_x_u_t_8cpp.html#a113">DXUTIsActive</a>() )
<a name="l03647"></a>03647     {
<a name="l03648"></a>03648         <span class="comment">// Window is minimized or paused so yield CPU time to other processes</span>
<a name="l03649"></a>03649         Sleep( 50 ); 
<a name="l03650"></a>03650     }
<a name="l03651"></a>03651 
<a name="l03652"></a>03652     <span class="keywordflow">if</span>( <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetDeviceLost() &amp;&amp; !<a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetRenderingPaused() )
<a name="l03653"></a>03653     {
<a name="l03654"></a>03654         <span class="comment">// Test the cooperative level to see if it's okay to render</span>
<a name="l03655"></a>03655         <span class="keywordflow">if</span>( FAILED( hr = pd3dDevice-&gt;TestCooperativeLevel() ) )
<a name="l03656"></a>03656         {
<a name="l03657"></a>03657             <span class="keywordflow">if</span>( D3DERR_DEVICELOST == hr )
<a name="l03658"></a>03658             {
<a name="l03659"></a>03659                 <span class="comment">// The device has been lost but cannot be reset at this time.  </span>
<a name="l03660"></a>03660                                 <span class="comment">// So wait until it can be reset.</span>
<a name="l03661"></a>03661                 <span class="keywordflow">return</span>;
<a name="l03662"></a>03662             }
<a name="l03663"></a>03663 
<a name="l03664"></a>03664             <span class="comment">// If we are windowed, read the desktop format and </span>
<a name="l03665"></a>03665             <span class="comment">// ensure that the Direct3D device is using the same format </span>
<a name="l03666"></a>03666             <span class="comment">// since the user could have changed the desktop bitdepth </span>
<a name="l03667"></a>03667             <span class="keywordflow">if</span>( <a class="code" href="_d_x_u_t_8cpp.html#a124">DXUTIsWindowed</a>() )
<a name="l03668"></a>03668             {
<a name="l03669"></a>03669                 D3DDISPLAYMODE adapterDesktopDisplayMode;
<a name="l03670"></a>03670                 IDirect3D9* pD3D = <a class="code" href="_d_x_u_t_8cpp.html#a93">DXUTGetD3DObject</a>();
<a name="l03671"></a>03671                 <a class="code" href="struct_d_x_u_t_device_settings.html">DXUTDeviceSettings</a>* pDeviceSettings = <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetCurrentDeviceSettings();
<a name="l03672"></a>03672                 pD3D-&gt;GetAdapterDisplayMode( pDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o0">AdapterOrdinal</a>, &amp;adapterDesktopDisplayMode );
<a name="l03673"></a>03673                 <span class="keywordflow">if</span>( pDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o2">AdapterFormat</a> != adapterDesktopDisplayMode.Format )
<a name="l03674"></a>03674                 {
<a name="l03675"></a>03675                     <a class="code" href="struct_d_x_u_t_match_options.html">DXUTMatchOptions</a> matchOptions;
<a name="l03676"></a>03676                     matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o0">eAdapterOrdinal</a>     = <a class="code" href="_d_x_u_t_8h.html#a87a22">DXUTMT_PRESERVE_INPUT</a>;
<a name="l03677"></a>03677                     matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o1">eDeviceType</a>         = <a class="code" href="_d_x_u_t_8h.html#a87a22">DXUTMT_PRESERVE_INPUT</a>;
<a name="l03678"></a>03678                     matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o2">eWindowed</a>           = <a class="code" href="_d_x_u_t_8h.html#a87a22">DXUTMT_PRESERVE_INPUT</a>;
<a name="l03679"></a>03679                     matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o3">eAdapterFormat</a>      = <a class="code" href="_d_x_u_t_8h.html#a87a22">DXUTMT_PRESERVE_INPUT</a>;
<a name="l03680"></a>03680                     matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o4">eVertexProcessing</a>   = <a class="code" href="_d_x_u_t_8h.html#a87a23">DXUTMT_CLOSEST_TO_INPUT</a>;
<a name="l03681"></a>03681                     matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o5">eResolution</a>         = <a class="code" href="_d_x_u_t_8h.html#a87a23">DXUTMT_CLOSEST_TO_INPUT</a>;
<a name="l03682"></a>03682                     matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o6">eBackBufferFormat</a>   = <a class="code" href="_d_x_u_t_8h.html#a87a23">DXUTMT_CLOSEST_TO_INPUT</a>;
<a name="l03683"></a>03683                     matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o7">eBackBufferCount</a>    = <a class="code" href="_d_x_u_t_8h.html#a87a23">DXUTMT_CLOSEST_TO_INPUT</a>;
<a name="l03684"></a>03684                     matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o8">eMultiSample</a>        = <a class="code" href="_d_x_u_t_8h.html#a87a23">DXUTMT_CLOSEST_TO_INPUT</a>;
<a name="l03685"></a>03685                     matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o9">eSwapEffect</a>         = <a class="code" href="_d_x_u_t_8h.html#a87a23">DXUTMT_CLOSEST_TO_INPUT</a>;
<a name="l03686"></a>03686                     matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o10">eDepthFormat</a>        = <a class="code" href="_d_x_u_t_8h.html#a87a23">DXUTMT_CLOSEST_TO_INPUT</a>;
<a name="l03687"></a>03687                     matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o11">eStencilFormat</a>      = <a class="code" href="_d_x_u_t_8h.html#a87a23">DXUTMT_CLOSEST_TO_INPUT</a>;
<a name="l03688"></a>03688                     matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o12">ePresentFlags</a>       = <a class="code" href="_d_x_u_t_8h.html#a87a23">DXUTMT_CLOSEST_TO_INPUT</a>;
<a name="l03689"></a>03689                     matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o13">eRefreshRate</a>        = <a class="code" href="_d_x_u_t_8h.html#a87a23">DXUTMT_CLOSEST_TO_INPUT</a>;
<a name="l03690"></a>03690                     matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o14">ePresentInterval</a>    = <a class="code" href="_d_x_u_t_8h.html#a87a23">DXUTMT_CLOSEST_TO_INPUT</a>;
<a name="l03691"></a>03691 
<a name="l03692"></a>03692                     <a class="code" href="struct_d_x_u_t_device_settings.html">DXUTDeviceSettings</a> deviceSettings = <a class="code" href="_d_x_u_t_8cpp.html#a126">DXUTGetDeviceSettings</a>();
<a name="l03693"></a>03693                     deviceSettings.<a class="code" href="struct_d_x_u_t_device_settings.html#o2">AdapterFormat</a> = adapterDesktopDisplayMode.Format;
<a name="l03694"></a>03694 
<a name="l03695"></a>03695                     hr = <a class="code" href="_d_x_u_t_8cpp.html#a83">DXUTFindValidDeviceSettings</a>( &amp;deviceSettings, &amp;deviceSettings, &amp;matchOptions );
<a name="l03696"></a>03696                     <span class="keywordflow">if</span>( FAILED(hr) ) <span class="comment">// the call will fail if no valid devices were found</span>
<a name="l03697"></a>03697                     {
<a name="l03698"></a>03698                         <a class="code" href="_d_x_u_t_8cpp.html#a52">DXUTDisplayErrorMessage</a>( <a class="code" href="_d_x_u_t_8h.html#a1">DXUTERR_NOCOMPATIBLEDEVICES</a> );
<a name="l03699"></a>03699                         <a class="code" href="_d_x_u_t_8cpp.html#a89">DXUTShutdown</a>();
<a name="l03700"></a>03700                     }
<a name="l03701"></a>03701 
<a name="l03702"></a>03702                     <span class="comment">// Change to a Direct3D device created from the new device settings.  </span>
<a name="l03703"></a>03703                     <span class="comment">// If there is an existing device, then either reset or recreate the scene</span>
<a name="l03704"></a>03704                     hr = <a class="code" href="_d_x_u_t_8cpp.html#a41">DXUTChangeDevice</a>( &amp;deviceSettings, NULL, <span class="keyword">false</span>, <span class="keyword">false</span> );
<a name="l03705"></a>03705                     <span class="keywordflow">if</span>( FAILED(hr) )  
<a name="l03706"></a>03706                     {
<a name="l03707"></a>03707                         <span class="comment">// If this fails, try to go fullscreen and if this fails also shutdown.</span>
<a name="l03708"></a>03708                         <span class="keywordflow">if</span>( FAILED(<a class="code" href="_d_x_u_t_8cpp.html#a81">DXUTToggleFullScreen</a>()) )
<a name="l03709"></a>03709                             <a class="code" href="_d_x_u_t_8cpp.html#a89">DXUTShutdown</a>();
<a name="l03710"></a>03710                     }
<a name="l03711"></a>03711 
<a name="l03712"></a>03712                     <span class="keywordflow">return</span>;
<a name="l03713"></a>03713                 }
<a name="l03714"></a>03714             }
<a name="l03715"></a>03715 
<a name="l03716"></a>03716             <span class="comment">// Try to reset the device</span>
<a name="l03717"></a>03717             <span class="keywordflow">if</span>( FAILED( hr = <a class="code" href="_d_x_u_t_8cpp.html#a44">DXUTReset3DEnvironment</a>() ) )
<a name="l03718"></a>03718             {
<a name="l03719"></a>03719                 <span class="keywordflow">if</span>( D3DERR_DEVICELOST == hr )
<a name="l03720"></a>03720                 {
<a name="l03721"></a>03721                     <span class="comment">// The device was lost again, so continue waiting until it can be reset.</span>
<a name="l03722"></a>03722                     <span class="keywordflow">return</span>;
<a name="l03723"></a>03723                 }
<a name="l03724"></a>03724                 <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="_d_x_u_t_8h.html#a7">DXUTERR_RESETTINGDEVICEOBJECTS</a> == hr || 
<a name="l03725"></a>03725                          <a class="code" href="_d_x_u_t_8h.html#a2">DXUTERR_MEDIANOTFOUND</a> == hr )
<a name="l03726"></a>03726                 {
<a name="l03727"></a>03727                     <a class="code" href="_d_x_u_t_8cpp.html#a52">DXUTDisplayErrorMessage</a>( hr );
<a name="l03728"></a>03728                     <a class="code" href="_d_x_u_t_8cpp.html#a89">DXUTShutdown</a>();
<a name="l03729"></a>03729                     <span class="keywordflow">return</span>;
<a name="l03730"></a>03730                 }
<a name="l03731"></a>03731                 <span class="keywordflow">else</span>
<a name="l03732"></a>03732                 {
<a name="l03733"></a>03733                     <span class="comment">// Reset failed, but the device wasn't lost so something bad happened, </span>
<a name="l03734"></a>03734                     <span class="comment">// so recreate the device to try to recover</span>
<a name="l03735"></a>03735                     <a class="code" href="struct_d_x_u_t_device_settings.html">DXUTDeviceSettings</a>* pDeviceSettings = <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetCurrentDeviceSettings();
<a name="l03736"></a>03736                     <span class="keywordflow">if</span>( FAILED( <a class="code" href="_d_x_u_t_8cpp.html#a41">DXUTChangeDevice</a>( pDeviceSettings, NULL, <span class="keyword">true</span>, <span class="keyword">false</span> ) ) )
<a name="l03737"></a>03737                     {
<a name="l03738"></a>03738                         <a class="code" href="_d_x_u_t_8cpp.html#a89">DXUTShutdown</a>();
<a name="l03739"></a>03739                         <span class="keywordflow">return</span>;
<a name="l03740"></a>03740                     }
<a name="l03741"></a>03741                 }
<a name="l03742"></a>03742             }
<a name="l03743"></a>03743         }
<a name="l03744"></a>03744 
<a name="l03745"></a>03745         <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetDeviceLost( <span class="keyword">false</span> );
<a name="l03746"></a>03746     }
<a name="l03747"></a>03747 
<a name="l03748"></a>03748     <span class="comment">// Get the app's time, in seconds. Skip rendering if no time elapsed</span>
<a name="l03749"></a>03749     <span class="keywordtype">double</span> fTime        = <a class="code" href="_d_x_u_tmisc_8cpp.html#a18">DXUTGetGlobalTimer</a>()-&gt;<a class="code" href="class_c_d_x_u_t_timer.html#a6">GetTime</a>();
<a name="l03750"></a>03750     <span class="keywordtype">float</span> fElapsedTime  = (float) <a class="code" href="_d_x_u_tmisc_8cpp.html#a18">DXUTGetGlobalTimer</a>()-&gt;<a class="code" href="class_c_d_x_u_t_timer.html#a7">GetElapsedTime</a>();
<a name="l03751"></a>03751 
<a name="l03752"></a>03752     <span class="comment">// Store the time for the app</span>
<a name="l03753"></a>03753     <span class="keywordflow">if</span>( <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetConstantFrameTime() )
<a name="l03754"></a>03754     {        
<a name="l03755"></a>03755         fElapsedTime = <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetTimePerFrame();
<a name="l03756"></a>03756         fTime     = <a class="code" href="_d_x_u_t_8cpp.html#a105">DXUTGetTime</a>() + fElapsedTime;
<a name="l03757"></a>03757     }
<a name="l03758"></a>03758 
<a name="l03759"></a>03759     <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetTime( fTime );
<a name="l03760"></a>03760     <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetElapsedTime( fElapsedTime );
<a name="l03761"></a>03761 
<a name="l03762"></a>03762     <span class="comment">// Update the FPS stats</span>
<a name="l03763"></a>03763     <a class="code" href="_d_x_u_t_8cpp.html#a47">DXUTUpdateFrameStats</a>();
<a name="l03764"></a>03764 
<a name="l03765"></a>03765     <a class="code" href="_d_x_u_t_8cpp.html#a50">DXUTHandleTimers</a>();
<a name="l03766"></a>03766 
<a name="l03767"></a>03767     <span class="comment">// Animate the scene by calling the app's frame move callback</span>
<a name="l03768"></a>03768     <a class="code" href="_d_x_u_t_8h.html#a15">LPDXUTCALLBACKFRAMEMOVE</a> pCallbackFrameMove = <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetFrameMoveFunc();
<a name="l03769"></a>03769     <span class="keywordflow">if</span>( pCallbackFrameMove != NULL )
<a name="l03770"></a>03770     {
<a name="l03771"></a>03771         pCallbackFrameMove( pd3dDevice, fTime, fElapsedTime, <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetFrameMoveFuncUserContext() );
<a name="l03772"></a>03772         pd3dDevice = <a class="code" href="_d_x_u_t_8cpp.html#a94">DXUTGetD3DDevice</a>();
<a name="l03773"></a>03773         <span class="keywordflow">if</span>( NULL == pd3dDevice ) <span class="comment">// Handle DXUTShutdown from inside callback</span>
<a name="l03774"></a>03774             <span class="keywordflow">return</span>;
<a name="l03775"></a>03775     }
<a name="l03776"></a>03776 
<a name="l03777"></a>03777     <span class="keywordflow">if</span>( !<a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetRenderingPaused() )
<a name="l03778"></a>03778     {
<a name="l03779"></a>03779         <span class="comment">// Render the scene by calling the app's render callback</span>
<a name="l03780"></a>03780         <a class="code" href="_d_x_u_t_8h.html#a16">LPDXUTCALLBACKFRAMERENDER</a> pCallbackFrameRender = <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetFrameRenderFunc();
<a name="l03781"></a>03781         <span class="keywordflow">if</span>( pCallbackFrameRender != NULL )
<a name="l03782"></a>03782         {
<a name="l03783"></a>03783             pCallbackFrameRender( pd3dDevice, fTime, fElapsedTime, <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetFrameRenderFuncUserContext() );
<a name="l03784"></a>03784             pd3dDevice = <a class="code" href="_d_x_u_t_8cpp.html#a94">DXUTGetD3DDevice</a>();
<a name="l03785"></a>03785             <span class="keywordflow">if</span>( NULL == pd3dDevice ) <span class="comment">// Handle DXUTShutdown from inside callback</span>
<a name="l03786"></a>03786                 <span class="keywordflow">return</span>;
<a name="l03787"></a>03787         }
<a name="l03788"></a>03788 
<a name="l03789"></a>03789 <span class="preprocessor">#if defined(DEBUG) | defined(_DEBUG)</span>
<a name="l03790"></a>03790 <span class="preprocessor"></span>        <span class="comment">// The back buffer should always match the client rect </span>
<a name="l03791"></a>03791         <span class="comment">// if the Direct3D backbuffer covers the entire window</span>
<a name="l03792"></a>03792         RECT rcClient;
<a name="l03793"></a>03793         GetClientRect( <a class="code" href="_d_x_u_t_8cpp.html#a98">DXUTGetHWND</a>(), &amp;rcClient );
<a name="l03794"></a>03794         <span class="keywordflow">if</span>( !IsIconic( <a class="code" href="_d_x_u_t_8cpp.html#a98">DXUTGetHWND</a>() ) )
<a name="l03795"></a>03795         {
<a name="l03796"></a>03796             GetClientRect( <a class="code" href="_d_x_u_t_8cpp.html#a98">DXUTGetHWND</a>(), &amp;rcClient );
<a name="l03797"></a>03797             assert( <a class="code" href="_d_x_u_t_8cpp.html#a95">DXUTGetBackBufferSurfaceDesc</a>()-&gt;Width == (<a class="code" href="_d_x_u_tgui_8cpp.html#a45">UINT</a>)rcClient.right );
<a name="l03798"></a>03798             assert( <a class="code" href="_d_x_u_t_8cpp.html#a95">DXUTGetBackBufferSurfaceDesc</a>()-&gt;Height == (<a class="code" href="_d_x_u_tgui_8cpp.html#a45">UINT</a>)rcClient.bottom );
<a name="l03799"></a>03799         }        
<a name="l03800"></a>03800 <span class="preprocessor">#endif</span>
<a name="l03801"></a>03801 <span class="preprocessor"></span>
<a name="l03802"></a>03802         <span class="comment">// Show the frame on the primary surface.</span>
<a name="l03803"></a>03803         hr = pd3dDevice-&gt;Present( NULL, NULL, NULL, NULL );
<a name="l03804"></a>03804         <span class="keywordflow">if</span>( FAILED(hr) )
<a name="l03805"></a>03805         {
<a name="l03806"></a>03806             <span class="keywordflow">if</span>( D3DERR_DEVICELOST == hr )
<a name="l03807"></a>03807             {
<a name="l03808"></a>03808                 <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetDeviceLost( <span class="keyword">true</span> );
<a name="l03809"></a>03809             }
<a name="l03810"></a>03810             <span class="keywordflow">else</span> <span class="keywordflow">if</span>( D3DERR_DRIVERINTERNALERROR == hr )
<a name="l03811"></a>03811             {
<a name="l03812"></a>03812                 <span class="comment">// When D3DERR_DRIVERINTERNALERROR is returned from Present(),</span>
<a name="l03813"></a>03813                 <span class="comment">// the application can do one of the following:</span>
<a name="l03814"></a>03814                 <span class="comment">// </span>
<a name="l03815"></a>03815                 <span class="comment">// - End, with the pop-up window saying that the application cannot continue </span>
<a name="l03816"></a>03816                 <span class="comment">//   because of problems in the display adapter and that the user should </span>
<a name="l03817"></a>03817                 <span class="comment">//   contact the adapter manufacturer.</span>
<a name="l03818"></a>03818                 <span class="comment">//</span>
<a name="l03819"></a>03819                 <span class="comment">// - Attempt to restart by calling IDirect3DDevice9::Reset, which is essentially the same </span>
<a name="l03820"></a>03820                 <span class="comment">//   path as recovering from a lost device. If IDirect3DDevice9::Reset fails with </span>
<a name="l03821"></a>03821                 <span class="comment">//   D3DERR_DRIVERINTERNALERROR, the application should end immediately with the message </span>
<a name="l03822"></a>03822                 <span class="comment">//   that the user should contact the adapter manufacturer.</span>
<a name="l03823"></a>03823                 <span class="comment">// </span>
<a name="l03824"></a>03824                 <span class="comment">// The framework attempts the path of resetting the device</span>
<a name="l03825"></a>03825                 <span class="comment">// </span>
<a name="l03826"></a>03826                 <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetDeviceLost( <span class="keyword">true</span> );
<a name="l03827"></a>03827             }
<a name="l03828"></a>03828         }
<a name="l03829"></a>03829     }
<a name="l03830"></a>03830 
<a name="l03831"></a>03831     <span class="comment">// Update current frame #</span>
<a name="l03832"></a>03832     <span class="keywordtype">int</span> nFrame = <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetCurrentFrameNumber();
<a name="l03833"></a>03833     nFrame++;
<a name="l03834"></a>03834     <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetCurrentFrameNumber( nFrame );
<a name="l03835"></a>03835 
<a name="l03836"></a>03836     <span class="comment">// Check to see if the app should shutdown due to cmdline</span>
<a name="l03837"></a>03837     <span class="keywordflow">if</span>( <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetOverrideQuitAfterFrame() != 0 )
<a name="l03838"></a>03838     {
<a name="l03839"></a>03839         <span class="keywordflow">if</span>( nFrame &gt; <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetOverrideQuitAfterFrame() )
<a name="l03840"></a>03840             <a class="code" href="_d_x_u_t_8cpp.html#a89">DXUTShutdown</a>();
<a name="l03841"></a>03841     }
<a name="l03842"></a>03842 
<a name="l03843"></a>03843     <span class="keywordflow">return</span>;
<a name="l03844"></a>03844 }
<a name="l03845"></a>03845 
<a name="l03846"></a>03846 
<a name="l03847"></a>03847 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l03848"></a>03848 <span class="comment">// Updates the string which describes the device </span>
<a name="l03849"></a>03849 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l03850"></a><a class="code" href="_d_x_u_t_8cpp.html#a48">03850</a> <span class="keywordtype">void</span> <a class="code" href="_d_x_u_t_8cpp.html#a48">DXUTUpdateDeviceStats</a>( D3DDEVTYPE DeviceType, <a class="code" href="_d_x_u_tgui_8cpp.html#a38">DWORD</a> BehaviorFlags, D3DADAPTER_IDENTIFIER9* pAdapterIdentifier )
<a name="l03851"></a>03851 {
<a name="l03852"></a>03852     <span class="comment">// Store device description</span>
<a name="l03853"></a>03853     WCHAR* pstrDeviceStats = <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetDeviceStats();
<a name="l03854"></a>03854     <span class="keywordflow">if</span>( DeviceType == D3DDEVTYPE_REF )
<a name="l03855"></a>03855         StringCchCopy( pstrDeviceStats, 256, L<span class="stringliteral">"REF"</span> );
<a name="l03856"></a>03856     <span class="keywordflow">else</span> <span class="keywordflow">if</span>( DeviceType == D3DDEVTYPE_HAL )
<a name="l03857"></a>03857         StringCchCopy( pstrDeviceStats, 256, L<span class="stringliteral">"HAL"</span> );
<a name="l03858"></a>03858     <span class="keywordflow">else</span> <span class="keywordflow">if</span>( DeviceType == D3DDEVTYPE_SW )
<a name="l03859"></a>03859         StringCchCopy( pstrDeviceStats, 256, L<span class="stringliteral">"SW"</span> );
<a name="l03860"></a>03860 
<a name="l03861"></a>03861     <span class="keywordflow">if</span>( BehaviorFlags &amp; D3DCREATE_HARDWARE_VERTEXPROCESSING &amp;&amp;
<a name="l03862"></a>03862         BehaviorFlags &amp; D3DCREATE_PUREDEVICE )
<a name="l03863"></a>03863     {
<a name="l03864"></a>03864         <span class="keywordflow">if</span>( DeviceType == D3DDEVTYPE_HAL )
<a name="l03865"></a>03865             StringCchCat( pstrDeviceStats, 256, L<span class="stringliteral">" (pure hw vp)"</span> );
<a name="l03866"></a>03866         <span class="keywordflow">else</span>
<a name="l03867"></a>03867             StringCchCat( pstrDeviceStats, 256, L<span class="stringliteral">" (simulated pure hw vp)"</span> );
<a name="l03868"></a>03868     }
<a name="l03869"></a>03869     <span class="keywordflow">else</span> <span class="keywordflow">if</span>( BehaviorFlags &amp; D3DCREATE_HARDWARE_VERTEXPROCESSING )
<a name="l03870"></a>03870     {
<a name="l03871"></a>03871         <span class="keywordflow">if</span>( DeviceType == D3DDEVTYPE_HAL )
<a name="l03872"></a>03872             StringCchCat( pstrDeviceStats, 256, L<span class="stringliteral">" (hw vp)"</span> );
<a name="l03873"></a>03873         <span class="keywordflow">else</span>
<a name="l03874"></a>03874             StringCchCat( pstrDeviceStats, 256, L<span class="stringliteral">" (simulated hw vp)"</span> );
<a name="l03875"></a>03875     }
<a name="l03876"></a>03876     <span class="keywordflow">else</span> <span class="keywordflow">if</span>( BehaviorFlags &amp; D3DCREATE_MIXED_VERTEXPROCESSING )
<a name="l03877"></a>03877     {
<a name="l03878"></a>03878         <span class="keywordflow">if</span>( DeviceType == D3DDEVTYPE_HAL )
<a name="l03879"></a>03879             StringCchCat( pstrDeviceStats, 256, L<span class="stringliteral">" (mixed vp)"</span> );
<a name="l03880"></a>03880         <span class="keywordflow">else</span>
<a name="l03881"></a>03881             StringCchCat( pstrDeviceStats, 256, L<span class="stringliteral">" (simulated mixed vp)"</span> );
<a name="l03882"></a>03882     }
<a name="l03883"></a>03883     <span class="keywordflow">else</span> <span class="keywordflow">if</span>( BehaviorFlags &amp; D3DCREATE_SOFTWARE_VERTEXPROCESSING )
<a name="l03884"></a>03884     {
<a name="l03885"></a>03885         StringCchCat( pstrDeviceStats, 256, L<span class="stringliteral">" (sw vp)"</span> );
<a name="l03886"></a>03886     }
<a name="l03887"></a>03887 
<a name="l03888"></a>03888     <span class="keywordflow">if</span>( DeviceType == D3DDEVTYPE_HAL )
<a name="l03889"></a>03889     {
<a name="l03890"></a>03890         <span class="comment">// Be sure not to overflow m_strDeviceStats when appending the adapter </span>
<a name="l03891"></a>03891         <span class="comment">// description, since it can be long.  </span>
<a name="l03892"></a>03892         StringCchCat( pstrDeviceStats, 256, L<span class="stringliteral">": "</span> );
<a name="l03893"></a>03893 
<a name="l03894"></a>03894         <span class="comment">// Try to get a unique description from the CD3DEnumDeviceSettingsCombo</span>
<a name="l03895"></a>03895         <a class="code" href="struct_d_x_u_t_device_settings.html">DXUTDeviceSettings</a>* pDeviceSettings = <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetCurrentDeviceSettings();
<a name="l03896"></a>03896         <a class="code" href="class_c_d3_d_enumeration.html">CD3DEnumeration</a>* pd3dEnum = <a class="code" href="_d_x_u_t_8cpp.html#a34">DXUTPrepareEnumerationObject</a>();
<a name="l03897"></a>03897         <a class="code" href="struct_c_d3_d_enum_device_settings_combo.html">CD3DEnumDeviceSettingsCombo</a>* pDeviceSettingsCombo = pd3dEnum-&gt;<a class="code" href="class_c_d3_d_enumeration.html#a16">GetDeviceSettingsCombo</a>( pDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o0">AdapterOrdinal</a>, pDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o1">DeviceType</a>, pDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o2">AdapterFormat</a>, pDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.BackBufferFormat, pDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.Windowed );
<a name="l03898"></a>03898         <span class="keywordflow">if</span>( pDeviceSettingsCombo )
<a name="l03899"></a>03899         {
<a name="l03900"></a>03900             StringCchCat( pstrDeviceStats, 256, pDeviceSettingsCombo-&gt;<a class="code" href="struct_c_d3_d_enum_device_settings_combo.html#o10">pAdapterInfo</a>-&gt;<a class="code" href="class_c_d3_d_enum_adapter_info.html#o2">szUniqueDescription</a> );
<a name="l03901"></a>03901         }
<a name="l03902"></a>03902         <span class="keywordflow">else</span>
<a name="l03903"></a>03903         {
<a name="l03904"></a>03904             <span class="keyword">const</span> <span class="keywordtype">int</span> cchDesc = <span class="keyword">sizeof</span>(pAdapterIdentifier-&gt;Description);
<a name="l03905"></a>03905             WCHAR szDescription[cchDesc];
<a name="l03906"></a>03906             MultiByteToWideChar( CP_ACP, 0, pAdapterIdentifier-&gt;Description, -1, szDescription, cchDesc );
<a name="l03907"></a>03907             szDescription[cchDesc-1] = 0;
<a name="l03908"></a>03908             StringCchCat( pstrDeviceStats, 256, szDescription );
<a name="l03909"></a>03909         }
<a name="l03910"></a>03910     }
<a name="l03911"></a>03911 }
<a name="l03912"></a>03912 
<a name="l03913"></a>03913 
<a name="l03914"></a>03914 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l03915"></a>03915 <span class="comment">// Updates the frames/sec stat once per second</span>
<a name="l03916"></a>03916 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l03917"></a><a class="code" href="_d_x_u_t_8cpp.html#a47">03917</a> <span class="keywordtype">void</span> <a class="code" href="_d_x_u_t_8cpp.html#a47">DXUTUpdateFrameStats</a>()
<a name="l03918"></a>03918 {
<a name="l03919"></a>03919     <span class="comment">// Keep track of the frame count</span>
<a name="l03920"></a>03920     <span class="keywordtype">double</span> fLastTime = <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetLastStatsUpdateTime();
<a name="l03921"></a>03921     <a class="code" href="_d_x_u_tgui_8cpp.html#a38">DWORD</a> dwFrames  = <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetLastStatsUpdateFrames();
<a name="l03922"></a>03922     <span class="keywordtype">double</span> fTime = <a class="code" href="_d_x_u_tmisc_8cpp.html#a18">DXUTGetGlobalTimer</a>()-&gt;<a class="code" href="class_c_d_x_u_t_timer.html#a5">GetAbsoluteTime</a>();
<a name="l03923"></a>03923     dwFrames++;
<a name="l03924"></a>03924     <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetLastStatsUpdateFrames( dwFrames );
<a name="l03925"></a>03925 
<a name="l03926"></a>03926     <span class="comment">// Update the scene stats once per second</span>
<a name="l03927"></a>03927     <span class="keywordflow">if</span>( fTime - fLastTime &gt; 1.0f )
<a name="l03928"></a>03928     {
<a name="l03929"></a>03929         <span class="keywordtype">float</span> fFPS = (float) (dwFrames / (fTime - fLastTime));
<a name="l03930"></a>03930         <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetFPS( fFPS );
<a name="l03931"></a>03931         <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetLastStatsUpdateTime( fTime );
<a name="l03932"></a>03932         <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetLastStatsUpdateFrames( 0 );
<a name="l03933"></a>03933 
<a name="l03934"></a>03934         WCHAR* pstrFrameStats = <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetFrameStats();
<a name="l03935"></a>03935         WCHAR* pstrStaticFrameStats = <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetStaticFrameStats();
<a name="l03936"></a>03936         StringCchPrintf( pstrFrameStats, 256, pstrStaticFrameStats, fFPS );
<a name="l03937"></a>03937         pstrFrameStats[255] = 0;
<a name="l03938"></a>03938     }
<a name="l03939"></a>03939 }
<a name="l03940"></a>03940 
<a name="l03941"></a>03941 
<a name="l03942"></a>03942 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l03943"></a>03943 <span class="comment">// Updates the static part of the frame stats so it doesn't have be generated every frame</span>
<a name="l03944"></a>03944 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l03945"></a><a class="code" href="_d_x_u_t_8cpp.html#a49">03945</a> <span class="keywordtype">void</span> <a class="code" href="_d_x_u_t_8cpp.html#a49">DXUTUpdateStaticFrameStats</a>()
<a name="l03946"></a>03946 {
<a name="l03947"></a>03947     <a class="code" href="struct_d_x_u_t_device_settings.html">DXUTDeviceSettings</a>* pDeviceSettings = <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetCurrentDeviceSettings();
<a name="l03948"></a>03948     <span class="keywordflow">if</span>( NULL == pDeviceSettings )
<a name="l03949"></a>03949         <span class="keywordflow">return</span>;
<a name="l03950"></a>03950     <a class="code" href="class_c_d3_d_enumeration.html">CD3DEnumeration</a>* pd3dEnum = <a class="code" href="_d_x_u_t_8cpp.html#a34">DXUTPrepareEnumerationObject</a>();
<a name="l03951"></a>03951     <span class="keywordflow">if</span>( NULL == pd3dEnum )
<a name="l03952"></a>03952         <span class="keywordflow">return</span>;
<a name="l03953"></a>03953 
<a name="l03954"></a>03954     <a class="code" href="struct_c_d3_d_enum_device_settings_combo.html">CD3DEnumDeviceSettingsCombo</a>* pDeviceSettingsCombo = pd3dEnum-&gt;<a class="code" href="class_c_d3_d_enumeration.html#a16">GetDeviceSettingsCombo</a>( pDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o0">AdapterOrdinal</a>, pDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o1">DeviceType</a>, pDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o2">AdapterFormat</a>, pDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.BackBufferFormat, pDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.Windowed );
<a name="l03955"></a>03955     <span class="keywordflow">if</span>( NULL == pDeviceSettingsCombo )
<a name="l03956"></a>03956         <span class="keywordflow">return</span>;
<a name="l03957"></a>03957 
<a name="l03958"></a>03958     WCHAR strFmt[100];
<a name="l03959"></a>03959     D3DPRESENT_PARAMETERS* pPP = &amp;pDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>;
<a name="l03960"></a>03960 
<a name="l03961"></a>03961     <span class="keywordflow">if</span>( pDeviceSettingsCombo-&gt;<a class="code" href="struct_c_d3_d_enum_device_settings_combo.html#o2">AdapterFormat</a> == pDeviceSettingsCombo-&gt;<a class="code" href="struct_c_d3_d_enum_device_settings_combo.html#o3">BackBufferFormat</a> )
<a name="l03962"></a>03962     {
<a name="l03963"></a>03963         StringCchCopy( strFmt, 100, <a class="code" href="_d_x_u_tmisc_8cpp.html#a28">DXUTD3DFormatToString</a>( pDeviceSettingsCombo-&gt;<a class="code" href="struct_c_d3_d_enum_device_settings_combo.html#o2">AdapterFormat</a>, <span class="keyword">false</span> ) );
<a name="l03964"></a>03964     }
<a name="l03965"></a>03965     <span class="keywordflow">else</span>
<a name="l03966"></a>03966     {
<a name="l03967"></a>03967         StringCchPrintf( strFmt, 100, L<span class="stringliteral">"backbuf %s, adapter %s"</span>, 
<a name="l03968"></a>03968             <a class="code" href="_d_x_u_tmisc_8cpp.html#a28">DXUTD3DFormatToString</a>( pDeviceSettingsCombo-&gt;<a class="code" href="struct_c_d3_d_enum_device_settings_combo.html#o3">BackBufferFormat</a>, <span class="keyword">false</span> ), 
<a name="l03969"></a>03969             <a class="code" href="_d_x_u_tmisc_8cpp.html#a28">DXUTD3DFormatToString</a>( pDeviceSettingsCombo-&gt;<a class="code" href="struct_c_d3_d_enum_device_settings_combo.html#o2">AdapterFormat</a>, <span class="keyword">false</span> ) );
<a name="l03970"></a>03970     }
<a name="l03971"></a>03971 
<a name="l03972"></a>03972     WCHAR strDepthFmt[100];
<a name="l03973"></a>03973     <span class="keywordflow">if</span>( pPP-&gt;EnableAutoDepthStencil )
<a name="l03974"></a>03974     {
<a name="l03975"></a>03975         StringCchPrintf( strDepthFmt, 100, L<span class="stringliteral">" (%s)"</span>, <a class="code" href="_d_x_u_tmisc_8cpp.html#a28">DXUTD3DFormatToString</a>( pPP-&gt;AutoDepthStencilFormat, <span class="keyword">false</span> ) );
<a name="l03976"></a>03976     }
<a name="l03977"></a>03977     <span class="keywordflow">else</span>
<a name="l03978"></a>03978     {
<a name="l03979"></a>03979         <span class="comment">// No depth buffer</span>
<a name="l03980"></a>03980         strDepthFmt[0] = 0;
<a name="l03981"></a>03981     }
<a name="l03982"></a>03982 
<a name="l03983"></a>03983     WCHAR strMultiSample[100];
<a name="l03984"></a>03984     <span class="keywordflow">switch</span>( pPP-&gt;MultiSampleType )
<a name="l03985"></a>03985     {
<a name="l03986"></a>03986         <span class="keywordflow">case</span> D3DMULTISAMPLE_NONMASKABLE: StringCchCopy( strMultiSample, 100, L<span class="stringliteral">" (Nonmaskable Multisample)"</span> ); <span class="keywordflow">break</span>;
<a name="l03987"></a>03987         <span class="keywordflow">case</span> D3DMULTISAMPLE_NONE:        StringCchCopy( strMultiSample, 100, L<span class="stringliteral">""</span> ); <span class="keywordflow">break</span>;
<a name="l03988"></a>03988         <span class="keywordflow">default</span>:                         StringCchPrintf( strMultiSample, 100, L<span class="stringliteral">" (%dx Multisample)"</span>, pPP-&gt;MultiSampleType ); <span class="keywordflow">break</span>;
<a name="l03989"></a>03989     }
<a name="l03990"></a>03990 
<a name="l03991"></a>03991     WCHAR* pstrStaticFrameStats = <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetStaticFrameStats();
<a name="l03992"></a>03992     StringCchPrintf( pstrStaticFrameStats, 256, L<span class="stringliteral">"%%.02f fps (%dx%d), %s%s%s"</span>, 
<a name="l03993"></a>03993                 pPP-&gt;BackBufferWidth, pPP-&gt;BackBufferHeight,
<a name="l03994"></a>03994                 strFmt, strDepthFmt, strMultiSample );
<a name="l03995"></a>03995 }
<a name="l03996"></a>03996 
<a name="l03997"></a>03997 
<a name="l03998"></a>03998 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l03999"></a>03999 <span class="comment">// Handles window messages </span>
<a name="l04000"></a>04000 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l04001"></a><a class="code" href="_d_x_u_t_8cpp.html#a53">04001</a> LRESULT CALLBACK <a class="code" href="_d_x_u_t_8cpp.html#a53">DXUTStaticWndProc</a>( <a class="code" href="_d_x_u_tgui_8cpp.html#a53">HWND</a> hWnd, <a class="code" href="_d_x_u_tgui_8cpp.html#a45">UINT</a> uMsg, WPARAM wParam, LPARAM lParam )
<a name="l04002"></a>04002 {
<a name="l04003"></a>04003     <span class="comment">// Consolidate the keyboard messages and pass them to the app's keyboard callback</span>
<a name="l04004"></a>04004     <span class="keywordflow">if</span>( uMsg == WM_KEYDOWN ||
<a name="l04005"></a>04005         uMsg == WM_SYSKEYDOWN || 
<a name="l04006"></a>04006         uMsg == WM_KEYUP ||
<a name="l04007"></a>04007         uMsg == WM_SYSKEYUP )
<a name="l04008"></a>04008     {
<a name="l04009"></a>04009         <span class="keywordtype">bool</span> bKeyDown = (uMsg == WM_KEYDOWN || uMsg == WM_SYSKEYDOWN);
<a name="l04010"></a>04010         <a class="code" href="_d_x_u_tgui_8cpp.html#a38">DWORD</a> dwMask = (1 &lt;&lt; 29);
<a name="l04011"></a>04011         <span class="keywordtype">bool</span> bAltDown = ( (lParam &amp; dwMask) != 0 );
<a name="l04012"></a>04012 
<a name="l04013"></a>04013         <span class="keywordtype">bool</span>* bKeys = <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetKeys();
<a name="l04014"></a>04014         bKeys[ (BYTE) (wParam &amp; 0xFF) ] = bKeyDown;
<a name="l04015"></a>04015 
<a name="l04016"></a>04016         <a class="code" href="_d_x_u_t_8h.html#a17">LPDXUTCALLBACKKEYBOARD</a> pCallbackKeyboard = <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetKeyboardFunc();
<a name="l04017"></a>04017         <span class="keywordflow">if</span>( pCallbackKeyboard )
<a name="l04018"></a>04018             pCallbackKeyboard( (<a class="code" href="_d_x_u_tgui_8cpp.html#a45">UINT</a>)wParam, bKeyDown, bAltDown, <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetKeyboardFuncUserContext() );           
<a name="l04019"></a>04019     }
<a name="l04020"></a>04020 
<a name="l04021"></a>04021     <span class="comment">// Consolidate the mouse button messages and pass them to the app's mouse callback</span>
<a name="l04022"></a>04022     <span class="keywordflow">if</span>( uMsg == WM_LBUTTONDOWN ||
<a name="l04023"></a>04023         uMsg == WM_LBUTTONUP ||
<a name="l04024"></a>04024         uMsg == WM_LBUTTONDBLCLK ||
<a name="l04025"></a>04025         uMsg == WM_MBUTTONDOWN ||
<a name="l04026"></a>04026         uMsg == WM_MBUTTONUP ||
<a name="l04027"></a>04027         uMsg == WM_MBUTTONDBLCLK ||
<a name="l04028"></a>04028         uMsg == WM_RBUTTONDOWN ||
<a name="l04029"></a>04029         uMsg == WM_RBUTTONUP ||
<a name="l04030"></a>04030         uMsg == WM_RBUTTONDBLCLK ||
<a name="l04031"></a>04031         uMsg == <a class="code" href="_d_x_u_tgui_8cpp.html#a0">WM_XBUTTONDOWN</a> ||
<a name="l04032"></a>04032         uMsg == <a class="code" href="_d_x_u_tgui_8cpp.html#a1">WM_XBUTTONUP</a> ||
<a name="l04033"></a>04033         uMsg == WM_XBUTTONDBLCLK ||
<a name="l04034"></a>04034         uMsg == <a class="code" href="_d_x_u_tgui_8cpp.html#a2">WM_MOUSEWHEEL</a> || 
<a name="l04035"></a>04035         (<a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetNotifyOnMouseMove() &amp;&amp; uMsg == WM_MOUSEMOVE) )
<a name="l04036"></a>04036     {
<a name="l04037"></a>04037         <span class="keywordtype">int</span> xPos = (short)LOWORD(lParam);
<a name="l04038"></a>04038         <span class="keywordtype">int</span> yPos = (short)HIWORD(lParam);
<a name="l04039"></a>04039 
<a name="l04040"></a>04040         <span class="keywordflow">if</span>( uMsg == <a class="code" href="_d_x_u_tgui_8cpp.html#a2">WM_MOUSEWHEEL</a> )
<a name="l04041"></a>04041         {
<a name="l04042"></a>04042             <span class="comment">// WM_MOUSEWHEEL passes screen mouse coords</span>
<a name="l04043"></a>04043             <span class="comment">// so convert them to client coords</span>
<a name="l04044"></a>04044             POINT pt;
<a name="l04045"></a>04045             pt.x = xPos; pt.y = yPos;
<a name="l04046"></a>04046             ScreenToClient( hWnd, &amp;pt );
<a name="l04047"></a>04047             xPos = pt.x; yPos = pt.y;
<a name="l04048"></a>04048         }
<a name="l04049"></a>04049 
<a name="l04050"></a>04050         <span class="keywordtype">int</span> nMouseWheelDelta = 0;
<a name="l04051"></a>04051         <span class="keywordflow">if</span>( uMsg == <a class="code" href="_d_x_u_tgui_8cpp.html#a2">WM_MOUSEWHEEL</a> ) 
<a name="l04052"></a>04052             nMouseWheelDelta = (short) HIWORD(wParam);
<a name="l04053"></a>04053 
<a name="l04054"></a>04054         <span class="keywordtype">int</span> nMouseButtonState = LOWORD(wParam);
<a name="l04055"></a>04055         <span class="keywordtype">bool</span> bLeftButton  = ((nMouseButtonState &amp; MK_LBUTTON) != 0);
<a name="l04056"></a>04056         <span class="keywordtype">bool</span> bRightButton = ((nMouseButtonState &amp; MK_RBUTTON) != 0);
<a name="l04057"></a>04057         <span class="keywordtype">bool</span> bMiddleButton = ((nMouseButtonState &amp; MK_MBUTTON) != 0);
<a name="l04058"></a>04058         <span class="keywordtype">bool</span> bSideButton1 = ((nMouseButtonState &amp; MK_XBUTTON1) != 0);
<a name="l04059"></a>04059         <span class="keywordtype">bool</span> bSideButton2 = ((nMouseButtonState &amp; MK_XBUTTON2) != 0);
<a name="l04060"></a>04060 
<a name="l04061"></a>04061         <span class="keywordtype">bool</span>* bMouseButtons = <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetMouseButtons();
<a name="l04062"></a>04062         bMouseButtons[0] = bLeftButton;
<a name="l04063"></a>04063         bMouseButtons[1] = bMiddleButton;
<a name="l04064"></a>04064         bMouseButtons[2] = bRightButton;
<a name="l04065"></a>04065         bMouseButtons[3] = bSideButton1;
<a name="l04066"></a>04066         bMouseButtons[4] = bSideButton2;
<a name="l04067"></a>04067 
<a name="l04068"></a>04068         <a class="code" href="_d_x_u_t_8h.html#a18">LPDXUTCALLBACKMOUSE</a> pCallbackMouse = <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetMouseFunc();
<a name="l04069"></a>04069         <span class="keywordflow">if</span>( pCallbackMouse )
<a name="l04070"></a>04070             pCallbackMouse( bLeftButton, bRightButton, bMiddleButton, bSideButton1, bSideButton2, nMouseWheelDelta, xPos, yPos, <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetMouseFuncUserContext() );
<a name="l04071"></a>04071     }
<a name="l04072"></a>04072 
<a name="l04073"></a>04073     <span class="comment">// Pass all messages to the app's MsgProc callback, and don't </span>
<a name="l04074"></a>04074     <span class="comment">// process further messages if the apps says not to.</span>
<a name="l04075"></a>04075     <a class="code" href="_d_x_u_t_8h.html#a19">LPDXUTCALLBACKMSGPROC</a> pCallbackMsgProc = <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetWindowMsgFunc();
<a name="l04076"></a>04076     <span class="keywordflow">if</span>( pCallbackMsgProc )
<a name="l04077"></a>04077     {
<a name="l04078"></a>04078         <span class="keywordtype">bool</span> bNoFurtherProcessing = <span class="keyword">false</span>;
<a name="l04079"></a>04079         LRESULT nResult = pCallbackMsgProc( hWnd, uMsg, wParam, lParam, &amp;bNoFurtherProcessing, <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetWindowMsgFuncUserContext() );
<a name="l04080"></a>04080         <span class="keywordflow">if</span>( bNoFurtherProcessing )
<a name="l04081"></a>04081             <span class="keywordflow">return</span> nResult;
<a name="l04082"></a>04082     }
<a name="l04083"></a>04083 
<a name="l04084"></a>04084     <span class="keywordflow">switch</span>( uMsg )
<a name="l04085"></a>04085     {
<a name="l04086"></a>04086         <span class="keywordflow">case</span> WM_PAINT:
<a name="l04087"></a>04087         {
<a name="l04088"></a>04088             IDirect3DDevice9* pd3dDevice = <a class="code" href="_d_x_u_t_8cpp.html#a94">DXUTGetD3DDevice</a>();
<a name="l04089"></a>04089 
<a name="l04090"></a>04090             <span class="comment">// Handle paint messages when the app is paused</span>
<a name="l04091"></a>04091             <span class="keywordflow">if</span>( pd3dDevice &amp;&amp; <a class="code" href="_d_x_u_t_8cpp.html#a111">DXUTIsRenderingPaused</a>() &amp;&amp; 
<a name="l04092"></a>04092                 <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetDeviceObjectsCreated() &amp;&amp; <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetDeviceObjectsReset() )
<a name="l04093"></a>04093             {
<a name="l04094"></a>04094                 <a class="code" href="_d_x_u_tgui_8cpp.html#a51">HRESULT</a> hr;
<a name="l04095"></a>04095                 <span class="keywordtype">double</span> fTime = <a class="code" href="_d_x_u_t_8cpp.html#a105">DXUTGetTime</a>();
<a name="l04096"></a>04096                 <span class="keywordtype">float</span> fElapsedTime = <a class="code" href="_d_x_u_t_8cpp.html#a106">DXUTGetElapsedTime</a>();
<a name="l04097"></a>04097 
<a name="l04098"></a>04098                 <a class="code" href="_d_x_u_t_8h.html#a16">LPDXUTCALLBACKFRAMERENDER</a> pCallbackFrameRender = <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetFrameRenderFunc();
<a name="l04099"></a>04099                 <span class="keywordflow">if</span>( pCallbackFrameRender != NULL )
<a name="l04100"></a>04100                     pCallbackFrameRender( pd3dDevice, fTime, fElapsedTime, <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetFrameRenderFuncUserContext() );
<a name="l04101"></a>04101 
<a name="l04102"></a>04102                 hr = pd3dDevice-&gt;Present( NULL, NULL, NULL, NULL );
<a name="l04103"></a>04103                 <span class="keywordflow">if</span>( D3DERR_DEVICELOST == hr )
<a name="l04104"></a>04104                 {
<a name="l04105"></a>04105                     <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetDeviceLost( <span class="keyword">true</span> );
<a name="l04106"></a>04106                 }
<a name="l04107"></a>04107                 <span class="keywordflow">else</span> <span class="keywordflow">if</span>( D3DERR_DRIVERINTERNALERROR == hr )
<a name="l04108"></a>04108                 {
<a name="l04109"></a>04109                     <span class="comment">// When D3DERR_DRIVERINTERNALERROR is returned from Present(),</span>
<a name="l04110"></a>04110                     <span class="comment">// the application can do one of the following:</span>
<a name="l04111"></a>04111                     <span class="comment">// </span>
<a name="l04112"></a>04112                     <span class="comment">// - End, with the pop-up window saying that the application cannot continue </span>
<a name="l04113"></a>04113                     <span class="comment">//   because of problems in the display adapter and that the user should </span>
<a name="l04114"></a>04114                     <span class="comment">//   contact the adapter manufacturer.</span>
<a name="l04115"></a>04115                     <span class="comment">//</span>
<a name="l04116"></a>04116                     <span class="comment">// - Attempt to restart by calling IDirect3DDevice9::Reset, which is essentially the same </span>
<a name="l04117"></a>04117                     <span class="comment">//   path as recovering from a lost device. If IDirect3DDevice9::Reset fails with </span>
<a name="l04118"></a>04118                     <span class="comment">//   D3DERR_DRIVERINTERNALERROR, the application should end immediately with the message </span>
<a name="l04119"></a>04119                     <span class="comment">//   that the user should contact the adapter manufacturer.</span>
<a name="l04120"></a>04120                     <span class="comment">// </span>
<a name="l04121"></a>04121                     <span class="comment">// The framework attempts the path of resetting the device</span>
<a name="l04122"></a>04122                     <span class="comment">// </span>
<a name="l04123"></a>04123                     <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetDeviceLost( <span class="keyword">true</span> );
<a name="l04124"></a>04124                 }
<a name="l04125"></a>04125             }
<a name="l04126"></a>04126             <span class="keywordflow">break</span>;
<a name="l04127"></a>04127         }
<a name="l04128"></a>04128 
<a name="l04129"></a>04129         <span class="keywordflow">case</span> WM_SIZE:
<a name="l04130"></a>04130             <span class="keywordflow">if</span>( SIZE_MINIMIZED == wParam )
<a name="l04131"></a>04131             {
<a name="l04132"></a>04132                 <a class="code" href="_d_x_u_t_8cpp.html#a86">DXUTPause</a>( <span class="keyword">true</span>, <span class="keyword">true</span> ); <span class="comment">// Pause while we're minimized</span>
<a name="l04133"></a>04133 
<a name="l04134"></a>04134                 <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetMinimized( <span class="keyword">true</span> );
<a name="l04135"></a>04135                 <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetMaximized( <span class="keyword">false</span> );
<a name="l04136"></a>04136             }
<a name="l04137"></a>04137             <span class="keywordflow">else</span>
<a name="l04138"></a>04138             {
<a name="l04139"></a>04139                 RECT rcCurrentClient;
<a name="l04140"></a>04140                 GetClientRect( <a class="code" href="_d_x_u_t_8cpp.html#a98">DXUTGetHWND</a>(), &amp;rcCurrentClient );
<a name="l04141"></a>04141                 <span class="keywordflow">if</span>( rcCurrentClient.top == 0 &amp;&amp; rcCurrentClient.bottom == 0 )
<a name="l04142"></a>04142                 {
<a name="l04143"></a>04143                     <span class="comment">// Rapidly clicking the task bar to minimize and restore a window</span>
<a name="l04144"></a>04144                     <span class="comment">// can cause a WM_SIZE message with SIZE_RESTORED when </span>
<a name="l04145"></a>04145                     <span class="comment">// the window has actually become minimized due to rapid change</span>
<a name="l04146"></a>04146                     <span class="comment">// so just ignore this message</span>
<a name="l04147"></a>04147                 }
<a name="l04148"></a>04148                 <span class="keywordflow">else</span> <span class="keywordflow">if</span>( SIZE_MAXIMIZED == wParam )
<a name="l04149"></a>04149                 {
<a name="l04150"></a>04150                     <span class="keywordflow">if</span>( <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetMinimized() )
<a name="l04151"></a>04151                         <a class="code" href="_d_x_u_t_8cpp.html#a86">DXUTPause</a>( <span class="keyword">false</span>, <span class="keyword">false</span> ); <span class="comment">// Unpause since we're no longer minimized</span>
<a name="l04152"></a>04152                     <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetMinimized( <span class="keyword">false</span> );
<a name="l04153"></a>04153                     <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetMaximized( <span class="keyword">true</span> );
<a name="l04154"></a>04154                     <a class="code" href="_d_x_u_t_8cpp.html#a54">DXUTCheckForWindowSizeChange</a>();
<a name="l04155"></a>04155                     <a class="code" href="_d_x_u_t_8cpp.html#a55">DXUTCheckForWindowChangingMonitors</a>();
<a name="l04156"></a>04156                 }
<a name="l04157"></a>04157                 <span class="keywordflow">else</span> <span class="keywordflow">if</span>( SIZE_RESTORED == wParam )
<a name="l04158"></a>04158                 {      
<a name="l04159"></a>04159                     <span class="keywordflow">if</span>( <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetMaximized() )
<a name="l04160"></a>04160                     {
<a name="l04161"></a>04161                         <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetMaximized( <span class="keyword">false</span> );
<a name="l04162"></a>04162                         <a class="code" href="_d_x_u_t_8cpp.html#a54">DXUTCheckForWindowSizeChange</a>();
<a name="l04163"></a>04163                         <a class="code" href="_d_x_u_t_8cpp.html#a55">DXUTCheckForWindowChangingMonitors</a>();
<a name="l04164"></a>04164                     }
<a name="l04165"></a>04165                     <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetMinimized() )
<a name="l04166"></a>04166                     {
<a name="l04167"></a>04167                         <a class="code" href="_d_x_u_t_8cpp.html#a86">DXUTPause</a>( <span class="keyword">false</span>, <span class="keyword">false</span> ); <span class="comment">// Unpause since we're no longer minimized</span>
<a name="l04168"></a>04168                         <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetMinimized( <span class="keyword">false</span> );
<a name="l04169"></a>04169                         <a class="code" href="_d_x_u_t_8cpp.html#a54">DXUTCheckForWindowSizeChange</a>();
<a name="l04170"></a>04170                         <a class="code" href="_d_x_u_t_8cpp.html#a55">DXUTCheckForWindowChangingMonitors</a>();
<a name="l04171"></a>04171                     }
<a name="l04172"></a>04172                     <span class="keywordflow">else</span> <span class="keywordflow">if</span>( <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetInSizeMove() )
<a name="l04173"></a>04173                     {
<a name="l04174"></a>04174                         <span class="comment">// If we're neither maximized nor minimized, the window size </span>
<a name="l04175"></a>04175                         <span class="comment">// is changing by the user dragging the window edges.  In this </span>
<a name="l04176"></a>04176                         <span class="comment">// case, we don't reset the device yet -- we wait until the </span>
<a name="l04177"></a>04177                         <span class="comment">// user stops dragging, and a WM_EXITSIZEMOVE message comes.</span>
<a name="l04178"></a>04178                     }
<a name="l04179"></a>04179                     <span class="keywordflow">else</span>
<a name="l04180"></a>04180                     {
<a name="l04181"></a>04181                         <span class="comment">// This WM_SIZE come from resizing the window via an API like SetWindowPos() so </span>
<a name="l04182"></a>04182                         <span class="comment">// resize and reset the device now.</span>
<a name="l04183"></a>04183                         <a class="code" href="_d_x_u_t_8cpp.html#a54">DXUTCheckForWindowSizeChange</a>();
<a name="l04184"></a>04184                         <a class="code" href="_d_x_u_t_8cpp.html#a55">DXUTCheckForWindowChangingMonitors</a>();
<a name="l04185"></a>04185                     }
<a name="l04186"></a>04186                 }
<a name="l04187"></a>04187             }
<a name="l04188"></a>04188             <span class="keywordflow">break</span>;
<a name="l04189"></a>04189 
<a name="l04190"></a>04190         <span class="keywordflow">case</span> WM_GETMINMAXINFO:
<a name="l04191"></a>04191             ((MINMAXINFO*)lParam)-&gt;ptMinTrackSize.x = <a class="code" href="_d_x_u_t_8cpp.html#a0">DXUT_MIN_WINDOW_SIZE_X</a>;
<a name="l04192"></a>04192             ((MINMAXINFO*)lParam)-&gt;ptMinTrackSize.y = <a class="code" href="_d_x_u_t_8cpp.html#a1">DXUT_MIN_WINDOW_SIZE_Y</a>;
<a name="l04193"></a>04193             <span class="keywordflow">break</span>;
<a name="l04194"></a>04194 
<a name="l04195"></a>04195         <span class="keywordflow">case</span> WM_ENTERSIZEMOVE:
<a name="l04196"></a>04196             <span class="comment">// Halt frame movement while the app is sizing or moving</span>
<a name="l04197"></a>04197             <a class="code" href="_d_x_u_t_8cpp.html#a86">DXUTPause</a>( <span class="keyword">true</span>, <span class="keyword">true</span> );
<a name="l04198"></a>04198             <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetInSizeMove( <span class="keyword">true</span> );
<a name="l04199"></a>04199             <span class="keywordflow">break</span>;
<a name="l04200"></a>04200 
<a name="l04201"></a>04201         <span class="keywordflow">case</span> WM_EXITSIZEMOVE:
<a name="l04202"></a>04202             <a class="code" href="_d_x_u_t_8cpp.html#a86">DXUTPause</a>( <span class="keyword">false</span>, <span class="keyword">false</span> );
<a name="l04203"></a>04203             <a class="code" href="_d_x_u_t_8cpp.html#a54">DXUTCheckForWindowSizeChange</a>();
<a name="l04204"></a>04204             <a class="code" href="_d_x_u_t_8cpp.html#a55">DXUTCheckForWindowChangingMonitors</a>();
<a name="l04205"></a>04205             <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetInSizeMove( <span class="keyword">false</span> );
<a name="l04206"></a>04206             <span class="keywordflow">break</span>;
<a name="l04207"></a>04207 
<a name="l04208"></a>04208          <span class="keywordflow">case</span> WM_MOUSEMOVE:
<a name="l04209"></a>04209             <span class="keywordflow">if</span>( <a class="code" href="_d_x_u_t_8cpp.html#a113">DXUTIsActive</a>() &amp;&amp; !<a class="code" href="_d_x_u_t_8cpp.html#a124">DXUTIsWindowed</a>() )
<a name="l04210"></a>04210             {
<a name="l04211"></a>04211                 IDirect3DDevice9* pd3dDevice = <a class="code" href="_d_x_u_t_8cpp.html#a94">DXUTGetD3DDevice</a>();
<a name="l04212"></a>04212                 <span class="keywordflow">if</span>( pd3dDevice )
<a name="l04213"></a>04213                 {
<a name="l04214"></a>04214                     POINT ptCursor;
<a name="l04215"></a>04215                     GetCursorPos( &amp;ptCursor );
<a name="l04216"></a>04216                     pd3dDevice-&gt;SetCursorPosition( ptCursor.x, ptCursor.y, 0 );
<a name="l04217"></a>04217                 }
<a name="l04218"></a>04218             }
<a name="l04219"></a>04219             <span class="keywordflow">break</span>;
<a name="l04220"></a>04220 
<a name="l04221"></a>04221         <span class="keywordflow">case</span> WM_SETCURSOR:
<a name="l04222"></a>04222             <span class="keywordflow">if</span>( <a class="code" href="_d_x_u_t_8cpp.html#a113">DXUTIsActive</a>() &amp;&amp; !<a class="code" href="_d_x_u_t_8cpp.html#a124">DXUTIsWindowed</a>() )
<a name="l04223"></a>04223             {
<a name="l04224"></a>04224                 SetCursor( NULL ); <span class="comment">// Turn off Windows cursor in full screen mode</span>
<a name="l04225"></a>04225                 IDirect3DDevice9* pd3dDevice = <a class="code" href="_d_x_u_t_8cpp.html#a94">DXUTGetD3DDevice</a>();
<a name="l04226"></a>04226                 <span class="keywordflow">if</span>( pd3dDevice &amp;&amp; <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetShowCursorWhenFullScreen() )
<a name="l04227"></a>04227                     pd3dDevice-&gt;ShowCursor( <span class="keyword">true</span> );
<a name="l04228"></a>04228                 <span class="keywordflow">return</span> <span class="keyword">true</span>; <span class="comment">// prevent Windows from setting cursor to window class cursor</span>
<a name="l04229"></a>04229             }
<a name="l04230"></a>04230             <span class="keywordflow">break</span>;
<a name="l04231"></a>04231 
<a name="l04232"></a>04232        <span class="keywordflow">case</span> WM_ACTIVATEAPP:
<a name="l04233"></a>04233             <span class="keywordflow">if</span>( wParam == TRUE &amp;&amp; !<a class="code" href="_d_x_u_t_8cpp.html#a113">DXUTIsActive</a>() ) <span class="comment">// Handle only if previously not active </span>
<a name="l04234"></a>04234             {
<a name="l04235"></a>04235                 <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetActive( <span class="keyword">true</span> );
<a name="l04236"></a>04236 
<a name="l04237"></a>04237                                 <span class="comment">// Setup cursor based on current settings (window/fullscreen mode, show cursor state, clip cursor state)</span>
<a name="l04238"></a>04238                                 <a class="code" href="_d_x_u_t_8cpp.html#a62">DXUTSetupCursor</a>();
<a name="l04239"></a>04239 
<a name="l04240"></a>04240                 <span class="comment">// The GetMinimizedWhileFullscreen() varible is used instead of !DXUTIsWindowed()</span>
<a name="l04241"></a>04241                 <span class="comment">// to handle the rare case toggling to windowed mode while the fullscreen application </span>
<a name="l04242"></a>04242                 <span class="comment">// is minimized and thus making the pause count wrong</span>
<a name="l04243"></a>04243                 <span class="keywordflow">if</span>( <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetMinimizedWhileFullscreen() ) 
<a name="l04244"></a>04244                 {
<a name="l04245"></a>04245                     <a class="code" href="_d_x_u_t_8cpp.html#a86">DXUTPause</a>( <span class="keyword">false</span>, <span class="keyword">false</span> ); <span class="comment">// Unpause since we're no longer minimized</span>
<a name="l04246"></a>04246                     <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetMinimizedWhileFullscreen( <span class="keyword">false</span> );
<a name="l04247"></a>04247                 }
<a name="l04248"></a>04248 
<a name="l04249"></a>04249                 <span class="comment">// Upon returning to this app, potentially disable shortcut keys </span>
<a name="l04250"></a>04250                 <span class="comment">// (Windows key, accessibility shortcuts) </span>
<a name="l04251"></a>04251                 <a class="code" href="_d_x_u_t_8cpp.html#a60">DXUTAllowShortcutKeys</a>( ( <a class="code" href="_d_x_u_t_8cpp.html#a124">DXUTIsWindowed</a>() ) ? <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetAllowShortcutKeysWhenWindowed() : 
<a name="l04252"></a>04252                                                               <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetAllowShortcutKeysWhenFullscreen() );
<a name="l04253"></a>04253 
<a name="l04254"></a>04254             }
<a name="l04255"></a>04255             <span class="keywordflow">else</span> <span class="keywordflow">if</span>( wParam == FALSE &amp;&amp; <a class="code" href="_d_x_u_t_8cpp.html#a113">DXUTIsActive</a>() ) <span class="comment">// Handle only if previously active </span>
<a name="l04256"></a>04256             {               
<a name="l04257"></a>04257                 <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetActive( <span class="keyword">false</span> );
<a name="l04258"></a>04258 
<a name="l04259"></a>04259                 <span class="keywordflow">if</span>( !<a class="code" href="_d_x_u_t_8cpp.html#a124">DXUTIsWindowed</a>() )
<a name="l04260"></a>04260                 {
<a name="l04261"></a>04261                     <span class="comment">// Going from full screen to a minimized state </span>
<a name="l04262"></a>04262                     ClipCursor( NULL );      <span class="comment">// don't limit the cursor anymore</span>
<a name="l04263"></a>04263                     <a class="code" href="_d_x_u_t_8cpp.html#a86">DXUTPause</a>( <span class="keyword">true</span>, <span class="keyword">true</span> ); <span class="comment">// Pause while we're minimized (take care not to pause twice by handling this message twice)</span>
<a name="l04264"></a>04264                     <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetMinimizedWhileFullscreen( <span class="keyword">true</span> ); 
<a name="l04265"></a>04265                 }
<a name="l04266"></a>04266 
<a name="l04267"></a>04267                 <span class="comment">// Restore shortcut keys (Windows key, accessibility shortcuts) to original state</span>
<a name="l04268"></a>04268                 <span class="comment">//</span>
<a name="l04269"></a>04269                 <span class="comment">// This is important to call here if the shortcuts are disabled, </span>
<a name="l04270"></a>04270                 <span class="comment">// because if this is not done then the Windows key will continue to </span>
<a name="l04271"></a>04271                 <span class="comment">// be disabled while this app is running which is very bad.</span>
<a name="l04272"></a>04272                 <span class="comment">// If the app crashes, the Windows key will return to normal.</span>
<a name="l04273"></a>04273                 <a class="code" href="_d_x_u_t_8cpp.html#a60">DXUTAllowShortcutKeys</a>( <span class="keyword">true</span> );
<a name="l04274"></a>04274             }
<a name="l04275"></a>04275             <span class="keywordflow">break</span>;
<a name="l04276"></a>04276 
<a name="l04277"></a>04277        <span class="keywordflow">case</span> WM_ENTERMENULOOP:
<a name="l04278"></a>04278             <span class="comment">// Pause the app when menus are displayed</span>
<a name="l04279"></a>04279             <a class="code" href="_d_x_u_t_8cpp.html#a86">DXUTPause</a>( <span class="keyword">true</span>, <span class="keyword">true</span> );
<a name="l04280"></a>04280             <span class="keywordflow">break</span>;
<a name="l04281"></a>04281 
<a name="l04282"></a>04282         <span class="keywordflow">case</span> WM_EXITMENULOOP:
<a name="l04283"></a>04283             <a class="code" href="_d_x_u_t_8cpp.html#a86">DXUTPause</a>( <span class="keyword">false</span>, <span class="keyword">false</span> );
<a name="l04284"></a>04284             <span class="keywordflow">break</span>;
<a name="l04285"></a>04285 
<a name="l04286"></a>04286         <span class="keywordflow">case</span> WM_MENUCHAR:
<a name="l04287"></a>04287             <span class="comment">// A menu is active and the user presses a key that does not correspond to any mnemonic or accelerator key</span>
<a name="l04288"></a>04288             <span class="comment">// So just ignore and don't beep</span>
<a name="l04289"></a>04289             <span class="keywordflow">return</span> MAKELRESULT(0,MNC_CLOSE);
<a name="l04290"></a>04290             <span class="keywordflow">break</span>;
<a name="l04291"></a>04291 
<a name="l04292"></a>04292         <span class="keywordflow">case</span> WM_NCHITTEST:
<a name="l04293"></a>04293             <span class="comment">// Prevent the user from selecting the menu in full screen mode</span>
<a name="l04294"></a>04294             <span class="keywordflow">if</span>( !<a class="code" href="_d_x_u_t_8cpp.html#a124">DXUTIsWindowed</a>() )
<a name="l04295"></a>04295                 <span class="keywordflow">return</span> HTCLIENT;
<a name="l04296"></a>04296             <span class="keywordflow">break</span>;
<a name="l04297"></a>04297 
<a name="l04298"></a>04298         <span class="keywordflow">case</span> WM_POWERBROADCAST:
<a name="l04299"></a>04299             <span class="keywordflow">switch</span>( wParam )
<a name="l04300"></a>04300             {
<a name="l04301"></a>04301 <span class="preprocessor">                #ifndef PBT_APMQUERYSUSPEND</span>
<a name="l04302"></a>04302 <span class="preprocessor"></span><span class="preprocessor">                    #define PBT_APMQUERYSUSPEND 0x0000</span>
<a name="l04303"></a>04303 <span class="preprocessor"></span><span class="preprocessor">                #endif</span>
<a name="l04304"></a>04304 <span class="preprocessor"></span>                <span class="keywordflow">case</span> <a class="code" href="_d_x_u_t_8cpp.html#a12">PBT_APMQUERYSUSPEND</a>:
<a name="l04305"></a>04305                     <span class="comment">// At this point, the app should save any data for open</span>
<a name="l04306"></a>04306                     <span class="comment">// network connections, files, etc., and prepare to go into</span>
<a name="l04307"></a>04307                     <span class="comment">// a suspended mode.  The app can use the MsgProc callback</span>
<a name="l04308"></a>04308                     <span class="comment">// to handle this if desired.</span>
<a name="l04309"></a>04309                     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l04310"></a>04310 
<a name="l04311"></a>04311 <span class="preprocessor">                #ifndef PBT_APMRESUMESUSPEND</span>
<a name="l04312"></a>04312 <span class="preprocessor"></span><span class="preprocessor">                    #define PBT_APMRESUMESUSPEND 0x0007</span>
<a name="l04313"></a>04313 <span class="preprocessor"></span><span class="preprocessor">                #endif</span>
<a name="l04314"></a>04314 <span class="preprocessor"></span>                <span class="keywordflow">case</span> <a class="code" href="_d_x_u_t_8cpp.html#a13">PBT_APMRESUMESUSPEND</a>:
<a name="l04315"></a>04315                     <span class="comment">// At this point, the app should recover any data, network</span>
<a name="l04316"></a>04316                     <span class="comment">// connections, files, etc., and resume running from when</span>
<a name="l04317"></a>04317                     <span class="comment">// the app was suspended. The app can use the MsgProc callback</span>
<a name="l04318"></a>04318                     <span class="comment">// to handle this if desired.</span>
<a name="l04319"></a>04319                    
<a name="l04320"></a>04320                    <span class="comment">// QPC may lose consistency when suspending, so reset the timer</span>
<a name="l04321"></a>04321                    <span class="comment">// upon resume.</span>
<a name="l04322"></a>04322                    <a class="code" href="_d_x_u_tmisc_8cpp.html#a18">DXUTGetGlobalTimer</a>()-&gt;<a class="code" href="class_c_d_x_u_t_timer.html#a1">Reset</a>();                   
<a name="l04323"></a>04323                    <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetLastStatsUpdateTime( 0 );
<a name="l04324"></a>04324                    <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l04325"></a>04325             }
<a name="l04326"></a>04326             <span class="keywordflow">break</span>;
<a name="l04327"></a>04327 
<a name="l04328"></a>04328         <span class="keywordflow">case</span> WM_SYSCOMMAND:
<a name="l04329"></a>04329             <span class="comment">// Prevent moving/sizing and power loss in full screen mode</span>
<a name="l04330"></a>04330             <span class="keywordflow">switch</span>( wParam )
<a name="l04331"></a>04331             {
<a name="l04332"></a>04332                 <span class="keywordflow">case</span> SC_MOVE:
<a name="l04333"></a>04333                 <span class="keywordflow">case</span> SC_SIZE:
<a name="l04334"></a>04334                 <span class="keywordflow">case</span> SC_MAXIMIZE:
<a name="l04335"></a>04335                 <span class="keywordflow">case</span> SC_KEYMENU:
<a name="l04336"></a>04336                 <span class="keywordflow">case</span> SC_MONITORPOWER:
<a name="l04337"></a>04337                     <span class="keywordflow">if</span>( !<a class="code" href="_d_x_u_t_8cpp.html#a124">DXUTIsWindowed</a>() )
<a name="l04338"></a>04338                         <span class="keywordflow">return</span> 0;
<a name="l04339"></a>04339                     <span class="keywordflow">break</span>;
<a name="l04340"></a>04340             }
<a name="l04341"></a>04341             <span class="keywordflow">break</span>;
<a name="l04342"></a>04342 
<a name="l04343"></a>04343         <span class="keywordflow">case</span> WM_SYSKEYDOWN:
<a name="l04344"></a>04344         {
<a name="l04345"></a>04345             <span class="keywordflow">switch</span>( wParam )
<a name="l04346"></a>04346             {
<a name="l04347"></a>04347                 <span class="keywordflow">case</span> VK_RETURN:
<a name="l04348"></a>04348                 {
<a name="l04349"></a>04349                     <span class="keywordflow">if</span>( <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetHandleAltEnter() )
<a name="l04350"></a>04350                     {
<a name="l04351"></a>04351                         <span class="comment">// Toggle full screen upon alt-enter </span>
<a name="l04352"></a>04352                         <a class="code" href="_d_x_u_tgui_8cpp.html#a38">DWORD</a> dwMask = (1 &lt;&lt; 29);
<a name="l04353"></a>04353                         <span class="keywordflow">if</span>( (lParam &amp; dwMask) != 0 ) <span class="comment">// Alt is down also</span>
<a name="l04354"></a>04354                         {
<a name="l04355"></a>04355                             <span class="comment">// Toggle the full screen/window mode</span>
<a name="l04356"></a>04356                             <a class="code" href="_d_x_u_t_8cpp.html#a86">DXUTPause</a>( <span class="keyword">true</span>, <span class="keyword">true</span> );
<a name="l04357"></a>04357                             <a class="code" href="_d_x_u_t_8cpp.html#a81">DXUTToggleFullScreen</a>();
<a name="l04358"></a>04358                             <a class="code" href="_d_x_u_t_8cpp.html#a86">DXUTPause</a>( <span class="keyword">false</span>, <span class="keyword">false</span> );                        
<a name="l04359"></a>04359                             <span class="keywordflow">return</span> 0;
<a name="l04360"></a>04360                         }
<a name="l04361"></a>04361                     }
<a name="l04362"></a>04362                 }
<a name="l04363"></a>04363             }
<a name="l04364"></a>04364             <span class="keywordflow">break</span>;
<a name="l04365"></a>04365         }
<a name="l04366"></a>04366 
<a name="l04367"></a>04367         <span class="keywordflow">case</span> WM_KEYDOWN:
<a name="l04368"></a>04368         {
<a name="l04369"></a>04369             <span class="keywordflow">if</span>( <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetHandleDefaultHotkeys() )
<a name="l04370"></a>04370             {
<a name="l04371"></a>04371                 <span class="keywordflow">switch</span>( wParam )
<a name="l04372"></a>04372                 {
<a name="l04373"></a>04373                     <span class="keywordflow">case</span> VK_F3:
<a name="l04374"></a>04374                     {
<a name="l04375"></a>04375                         <a class="code" href="_d_x_u_t_8cpp.html#a86">DXUTPause</a>( <span class="keyword">true</span>, <span class="keyword">true</span> );
<a name="l04376"></a>04376                         <a class="code" href="_d_x_u_t_8cpp.html#a82">DXUTToggleREF</a>();
<a name="l04377"></a>04377                         <a class="code" href="_d_x_u_t_8cpp.html#a86">DXUTPause</a>( <span class="keyword">false</span>, <span class="keyword">false</span> );                        
<a name="l04378"></a>04378                         <span class="keywordflow">break</span>;
<a name="l04379"></a>04379                     }
<a name="l04380"></a>04380 
<a name="l04381"></a>04381                     <span class="keywordflow">case</span> VK_F8:
<a name="l04382"></a>04382                     {
<a name="l04383"></a>04383                         <span class="keywordtype">bool</span> bWireFrame = <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetWireframeMode();
<a name="l04384"></a>04384                         bWireFrame = !bWireFrame; 
<a name="l04385"></a>04385                         <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetWireframeMode( bWireFrame );
<a name="l04386"></a>04386 
<a name="l04387"></a>04387                         IDirect3DDevice9* pd3dDevice = <a class="code" href="_d_x_u_t_8cpp.html#a94">DXUTGetD3DDevice</a>();
<a name="l04388"></a>04388                         <span class="keywordflow">if</span>( pd3dDevice )
<a name="l04389"></a>04389                             pd3dDevice-&gt;SetRenderState( D3DRS_FILLMODE, (bWireFrame) ? D3DFILL_WIREFRAME : D3DFILL_SOLID ); 
<a name="l04390"></a>04390                         <span class="keywordflow">break</span>;
<a name="l04391"></a>04391                     }
<a name="l04392"></a>04392 
<a name="l04393"></a>04393                     <span class="keywordflow">case</span> VK_ESCAPE:
<a name="l04394"></a>04394                     {
<a name="l04395"></a>04395                         <span class="comment">// Received key to exit app</span>
<a name="l04396"></a>04396                         SendMessage( hWnd, WM_CLOSE, 0, 0 );
<a name="l04397"></a>04397                     }
<a name="l04398"></a>04398 
<a name="l04399"></a>04399                     <span class="keywordflow">case</span> VK_PAUSE: 
<a name="l04400"></a>04400                     {
<a name="l04401"></a>04401                         <span class="keywordtype">bool</span> bTimePaused = <a class="code" href="_d_x_u_t_8cpp.html#a112">DXUTIsTimePaused</a>();
<a name="l04402"></a>04402                         bTimePaused = !bTimePaused;
<a name="l04403"></a>04403                         <span class="keywordflow">if</span>( bTimePaused ) 
<a name="l04404"></a>04404                             <a class="code" href="_d_x_u_t_8cpp.html#a86">DXUTPause</a>( <span class="keyword">true</span>, <span class="keyword">false</span> ); 
<a name="l04405"></a>04405                         <span class="keywordflow">else</span>
<a name="l04406"></a>04406                             <a class="code" href="_d_x_u_t_8cpp.html#a86">DXUTPause</a>( <span class="keyword">false</span>, <span class="keyword">false</span> ); 
<a name="l04407"></a>04407                         <span class="keywordflow">break</span>; 
<a name="l04408"></a>04408                     }
<a name="l04409"></a>04409                 }
<a name="l04410"></a>04410             }
<a name="l04411"></a>04411             <span class="keywordflow">break</span>;
<a name="l04412"></a>04412         }
<a name="l04413"></a>04413 
<a name="l04414"></a>04414         <span class="keywordflow">case</span> WM_CLOSE:
<a name="l04415"></a>04415         {
<a name="l04416"></a>04416             HMENU hMenu;
<a name="l04417"></a>04417             hMenu = GetMenu(hWnd);
<a name="l04418"></a>04418             <span class="keywordflow">if</span>( hMenu != NULL )
<a name="l04419"></a>04419                 DestroyMenu( hMenu );
<a name="l04420"></a>04420             DestroyWindow( hWnd );
<a name="l04421"></a>04421             UnregisterClass( L<span class="stringliteral">"Direct3DWindowClass"</span>, NULL );
<a name="l04422"></a>04422             <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetHWNDFocus( NULL );
<a name="l04423"></a>04423             <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetHWNDDeviceFullScreen( NULL );
<a name="l04424"></a>04424             <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetHWNDDeviceWindowed( NULL );
<a name="l04425"></a>04425             <span class="keywordflow">return</span> 0;
<a name="l04426"></a>04426         }
<a name="l04427"></a>04427 
<a name="l04428"></a>04428         <span class="keywordflow">case</span> WM_DESTROY:
<a name="l04429"></a>04429             PostQuitMessage(0);
<a name="l04430"></a>04430             <span class="keywordflow">break</span>;
<a name="l04431"></a>04431     }
<a name="l04432"></a>04432 
<a name="l04433"></a>04433     <span class="comment">// Don't allow the F10 key to act as a shortcut to the menu bar</span>
<a name="l04434"></a>04434     <span class="comment">// by not passing these messages to the DefWindowProc only when</span>
<a name="l04435"></a>04435     <span class="comment">// there's no menu present</span>
<a name="l04436"></a>04436     <span class="keywordflow">if</span>( !<a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetCallDefWindowProc() || <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetMenu() == NULL &amp;&amp; (uMsg == WM_SYSKEYDOWN || uMsg == WM_SYSKEYUP) &amp;&amp; wParam == VK_F10 )
<a name="l04437"></a>04437         <span class="keywordflow">return</span> 0;
<a name="l04438"></a>04438     <span class="keywordflow">else</span>
<a name="l04439"></a>04439         <span class="keywordflow">return</span> DefWindowProc( hWnd, uMsg, wParam, lParam );
<a name="l04440"></a>04440 }
<a name="l04441"></a>04441 
<a name="l04442"></a>04442 
<a name="l04443"></a>04443 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l04444"></a>04444 <span class="comment">// Resets the state associated with DXUT </span>
<a name="l04445"></a>04445 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l04446"></a><a class="code" href="_d_x_u_t_8h.html#a54">04446</a> <span class="keywordtype">void</span> <a class="code" href="_d_x_u_t_8cpp.html#a88">DXUTResetFrameworkState</a>()
<a name="l04447"></a>04447 {
<a name="l04448"></a>04448     <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().<a class="code" href="class_d_x_u_t_state.html#a3">Destroy</a>();
<a name="l04449"></a>04449     <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().<a class="code" href="class_d_x_u_t_state.html#a2">Create</a>();
<a name="l04450"></a>04450 }
<a name="l04451"></a>04451 
<a name="l04452"></a>04452 
<a name="l04453"></a>04453 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l04454"></a>04454 <span class="comment">// Closes down the window.  When the window closes, it will cleanup everything</span>
<a name="l04455"></a>04455 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l04456"></a><a class="code" href="_d_x_u_t_8h.html#a55">04456</a> <span class="keywordtype">void</span> <a class="code" href="_d_x_u_t_8cpp.html#a89">DXUTShutdown</a>( <span class="keywordtype">int</span> nExitCode )
<a name="l04457"></a>04457 {
<a name="l04458"></a>04458     <a class="code" href="_d_x_u_tgui_8cpp.html#a53">HWND</a> hWnd = <a class="code" href="_d_x_u_t_8cpp.html#a98">DXUTGetHWND</a>();
<a name="l04459"></a>04459     <span class="keywordflow">if</span>( hWnd != NULL )
<a name="l04460"></a>04460         SendMessage( hWnd, WM_CLOSE, 0, 0 );
<a name="l04461"></a>04461 
<a name="l04462"></a>04462     <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetExitCode(nExitCode);
<a name="l04463"></a>04463 
<a name="l04464"></a>04464     <a class="code" href="_d_x_u_t_8cpp.html#a46">DXUTCleanup3DEnvironment</a>( <span class="keyword">true</span> );
<a name="l04465"></a>04465 
<a name="l04466"></a>04466     <span class="comment">// Restore shortcut keys (Windows key, accessibility shortcuts) to original state</span>
<a name="l04467"></a>04467     <span class="comment">// This is important to call here if the shortcuts are disabled, </span>
<a name="l04468"></a>04468     <span class="comment">// because accessibility setting changes are permanent.</span>
<a name="l04469"></a>04469     <span class="comment">// This means that if this is not done then the accessibility settings </span>
<a name="l04470"></a>04470     <span class="comment">// might not be the same as when the app was started. </span>
<a name="l04471"></a>04471     <span class="comment">// If the app crashes without restoring the settings, this is also true so it</span>
<a name="l04472"></a>04472     <span class="comment">// would be wise to backup/restore the settings from a file so they can be </span>
<a name="l04473"></a>04473     <span class="comment">// restored when the crashed app is run again.</span>
<a name="l04474"></a>04474     <a class="code" href="_d_x_u_t_8cpp.html#a60">DXUTAllowShortcutKeys</a>( <span class="keyword">true</span> );
<a name="l04475"></a>04475     
<a name="l04476"></a>04476     <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetD3DEnumeration( NULL );
<a name="l04477"></a>04477 
<a name="l04478"></a>04478     IDirect3D9* pD3D = <a class="code" href="_d_x_u_t_8cpp.html#a93">DXUTGetD3DObject</a>();
<a name="l04479"></a>04479     <a class="code" href="dxstdafx_8h.html#a9">SAFE_RELEASE</a>( pD3D );
<a name="l04480"></a>04480     <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetD3D( NULL );
<a name="l04481"></a>04481 }
<a name="l04482"></a>04482 
<a name="l04483"></a>04483 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l04484"></a>04484 <span class="comment">// Shuts down DirectX without bothering about the window</span>
<a name="l04485"></a>04485 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l04486"></a><a class="code" href="_d_x_u_t_8h.html#a56">04486</a> <span class="keywordtype">void</span> <a class="code" href="_d_x_u_t_8cpp.html#a90">DXUTSimpleShutdown</a>( )
<a name="l04487"></a>04487 {
<a name="l04488"></a>04488     <a class="code" href="_d_x_u_t_8cpp.html#a46">DXUTCleanup3DEnvironment</a>( <span class="keyword">true</span> );
<a name="l04489"></a>04489 
<a name="l04490"></a>04490     <span class="comment">// Restore shortcut keys (Windows key, accessibility shortcuts) to original state</span>
<a name="l04491"></a>04491     <span class="comment">// This is important to call here if the shortcuts are disabled, </span>
<a name="l04492"></a>04492     <span class="comment">// because accessibility setting changes are permanent.</span>
<a name="l04493"></a>04493     <span class="comment">// This means that if this is not done then the accessibility settings </span>
<a name="l04494"></a>04494     <span class="comment">// might not be the same as when the app was started. </span>
<a name="l04495"></a>04495     <span class="comment">// If the app crashes without restoring the settings, this is also true so it</span>
<a name="l04496"></a>04496     <span class="comment">// would be wise to backup/restore the settings from a file so they can be </span>
<a name="l04497"></a>04497     <span class="comment">// restored when the crashed app is run again.</span>
<a name="l04498"></a>04498     <a class="code" href="_d_x_u_t_8cpp.html#a60">DXUTAllowShortcutKeys</a>( <span class="keyword">true</span> );
<a name="l04499"></a>04499     
<a name="l04500"></a>04500     <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetD3DEnumeration( NULL );
<a name="l04501"></a>04501 
<a name="l04502"></a>04502     IDirect3D9* pD3D = <a class="code" href="_d_x_u_t_8cpp.html#a93">DXUTGetD3DObject</a>();
<a name="l04503"></a>04503     <a class="code" href="dxstdafx_8h.html#a9">SAFE_RELEASE</a>( pD3D );
<a name="l04504"></a>04504     <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetD3D( NULL );
<a name="l04505"></a>04505 }
<a name="l04506"></a>04506 
<a name="l04507"></a>04507 
<a name="l04508"></a>04508 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l04509"></a>04509 <span class="comment">// Cleans up the 3D environment by:</span>
<a name="l04510"></a>04510 <span class="comment">//      - Calls the device lost callback </span>
<a name="l04511"></a>04511 <span class="comment">//      - Calls the device destroyed callback </span>
<a name="l04512"></a>04512 <span class="comment">//      - Releases the D3D device</span>
<a name="l04513"></a>04513 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l04514"></a><a class="code" href="_d_x_u_t_8cpp.html#a46">04514</a> <span class="keywordtype">void</span> <a class="code" href="_d_x_u_t_8cpp.html#a46">DXUTCleanup3DEnvironment</a>( <span class="keywordtype">bool</span> bReleaseSettings )
<a name="l04515"></a>04515 {
<a name="l04516"></a>04516     IDirect3DDevice9* pd3dDevice = <a class="code" href="_d_x_u_t_8cpp.html#a94">DXUTGetD3DDevice</a>();
<a name="l04517"></a>04517     <span class="keywordflow">if</span>( pd3dDevice != NULL )
<a name="l04518"></a>04518     {
<a name="l04519"></a>04519         <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetInsideDeviceCallback( <span class="keyword">true</span> );
<a name="l04520"></a>04520 
<a name="l04521"></a>04521         <span class="comment">// Call the app's device lost callback</span>
<a name="l04522"></a>04522         <span class="keywordflow">if</span>( <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetDeviceObjectsReset() == true )
<a name="l04523"></a>04523         {
<a name="l04524"></a>04524             <a class="code" href="_d_x_u_t_8h.html#a14">LPDXUTCALLBACKDEVICELOST</a> pCallbackDeviceLost = <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetDeviceLostFunc();
<a name="l04525"></a>04525             <span class="keywordflow">if</span>( pCallbackDeviceLost != NULL )
<a name="l04526"></a>04526                 pCallbackDeviceLost( <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetDeviceLostFuncUserContext() );
<a name="l04527"></a>04527             <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetDeviceObjectsReset( <span class="keyword">false</span> );
<a name="l04528"></a>04528 
<a name="l04529"></a>04529             <span class="comment">// Call the resource cache device lost function</span>
<a name="l04530"></a>04530             <a class="code" href="_d_x_u_tmisc_8cpp.html#a17">DXUTGetGlobalResourceCache</a>().<a class="code" href="class_c_d_x_u_t_resource_cache.html#a19">OnLostDevice</a>();
<a name="l04531"></a>04531         }
<a name="l04532"></a>04532 
<a name="l04533"></a>04533         <span class="comment">// Call the app's device destroyed callback</span>
<a name="l04534"></a>04534         <span class="keywordflow">if</span>( <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetDeviceObjectsCreated() == true )
<a name="l04535"></a>04535         {
<a name="l04536"></a>04536             <a class="code" href="_d_x_u_t_8h.html#a13">LPDXUTCALLBACKDEVICEDESTROYED</a> pCallbackDeviceDestroyed = <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetDeviceDestroyedFunc();
<a name="l04537"></a>04537             <span class="keywordflow">if</span>( pCallbackDeviceDestroyed != NULL )
<a name="l04538"></a>04538                 pCallbackDeviceDestroyed( <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetDeviceDestroyedFuncUserContext() );
<a name="l04539"></a>04539             <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetDeviceObjectsCreated( <span class="keyword">false</span> );
<a name="l04540"></a>04540 
<a name="l04541"></a>04541             <span class="comment">// Call the resource cache device destory function</span>
<a name="l04542"></a>04542             <a class="code" href="_d_x_u_tmisc_8cpp.html#a17">DXUTGetGlobalResourceCache</a>().<a class="code" href="class_c_d_x_u_t_resource_cache.html#a20">OnDestroyDevice</a>();
<a name="l04543"></a>04543         }
<a name="l04544"></a>04544 
<a name="l04545"></a>04545         <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetInsideDeviceCallback( <span class="keyword">false</span> );
<a name="l04546"></a>04546 
<a name="l04547"></a>04547         <span class="comment">// Release the D3D device and in debug configs, displays a message box if there </span>
<a name="l04548"></a>04548         <span class="comment">// are unrelease objects.</span>
<a name="l04549"></a>04549         <span class="keywordflow">if</span>( pd3dDevice )
<a name="l04550"></a>04550         {
<a name="l04551"></a>04551             <span class="keywordflow">if</span>( pd3dDevice-&gt;Release() &gt; 0 )  
<a name="l04552"></a>04552             {
<a name="l04553"></a>04553                 <a class="code" href="_d_x_u_t_8cpp.html#a52">DXUTDisplayErrorMessage</a>( <a class="code" href="_d_x_u_t_8h.html#a3">DXUTERR_NONZEROREFCOUNT</a> );
<a name="l04554"></a>04554                 <a class="code" href="_d_x_u_tmisc_8h.html#a7">DXUT_ERR</a>( L<span class="stringliteral">"DXUTCleanup3DEnvironment"</span>, <a class="code" href="_d_x_u_t_8h.html#a3">DXUTERR_NONZEROREFCOUNT</a> );
<a name="l04555"></a>04555             }
<a name="l04556"></a>04556         }
<a name="l04557"></a>04557         <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetD3DDevice( NULL );
<a name="l04558"></a>04558 
<a name="l04559"></a>04559         <span class="keywordflow">if</span>( bReleaseSettings )
<a name="l04560"></a>04560         {
<a name="l04561"></a>04561             <a class="code" href="struct_d_x_u_t_device_settings.html">DXUTDeviceSettings</a>* pOldDeviceSettings = <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetCurrentDeviceSettings();
<a name="l04562"></a>04562             <a class="code" href="dxstdafx_8h.html#a7">SAFE_DELETE</a>(pOldDeviceSettings);  
<a name="l04563"></a>04563             <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetCurrentDeviceSettings( NULL );
<a name="l04564"></a>04564         }
<a name="l04565"></a>04565 
<a name="l04566"></a>04566         D3DSURFACE_DESC* pbackBufferSurfaceDesc = <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetBackBufferSurfaceDesc();
<a name="l04567"></a>04567         ZeroMemory( pbackBufferSurfaceDesc, <span class="keyword">sizeof</span>(D3DSURFACE_DESC) );
<a name="l04568"></a>04568 
<a name="l04569"></a>04569         D3DCAPS9* pd3dCaps = <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetCaps();
<a name="l04570"></a>04570         ZeroMemory( pd3dCaps, <span class="keyword">sizeof</span>(D3DCAPS9) );
<a name="l04571"></a>04571 
<a name="l04572"></a>04572         <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetDeviceCreated( <span class="keyword">false</span> );
<a name="l04573"></a>04573     }
<a name="l04574"></a>04574 }
<a name="l04575"></a>04575 
<a name="l04576"></a>04576 
<a name="l04577"></a>04577 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l04578"></a>04578 <span class="comment">// Stores back buffer surface desc in GetDXUTState().GetBackBufferSurfaceDesc()</span>
<a name="l04579"></a>04579 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l04580"></a><a class="code" href="_d_x_u_t_8cpp.html#a61">04580</a> <span class="keywordtype">void</span> <a class="code" href="_d_x_u_t_8cpp.html#a61">DXUTUpdateBackBufferDesc</a>()
<a name="l04581"></a>04581 {
<a name="l04582"></a>04582     <a class="code" href="_d_x_u_tgui_8cpp.html#a51">HRESULT</a> hr;
<a name="l04583"></a>04583     IDirect3DSurface9* pBackBuffer;
<a name="l04584"></a>04584     hr = <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetD3DDevice()-&gt;GetBackBuffer( 0, 0, D3DBACKBUFFER_TYPE_MONO, &amp;pBackBuffer );
<a name="l04585"></a>04585     D3DSURFACE_DESC* pBBufferSurfaceDesc = <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetBackBufferSurfaceDesc();
<a name="l04586"></a>04586     ZeroMemory( pBBufferSurfaceDesc, <span class="keyword">sizeof</span>(D3DSURFACE_DESC) );
<a name="l04587"></a>04587     <span class="keywordflow">if</span>( SUCCEEDED(hr) )
<a name="l04588"></a>04588     {
<a name="l04589"></a>04589         pBackBuffer-&gt;GetDesc( pBBufferSurfaceDesc );
<a name="l04590"></a>04590         <a class="code" href="dxstdafx_8h.html#a9">SAFE_RELEASE</a>( pBackBuffer );
<a name="l04591"></a>04591     }
<a name="l04592"></a>04592 }
<a name="l04593"></a>04593 
<a name="l04594"></a>04594 
<a name="l04595"></a>04595 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l04596"></a>04596 <span class="comment">// Starts a user defined timer callback</span>
<a name="l04597"></a>04597 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l04598"></a><a class="code" href="_d_x_u_t_8h.html#a49">04598</a> <a class="code" href="_d_x_u_tgui_8cpp.html#a51">HRESULT</a> <a class="code" href="_d_x_u_t_8cpp.html#a91">DXUTSetTimer</a>( <a class="code" href="_d_x_u_t_8h.html#a20">LPDXUTCALLBACKTIMER</a> pCallbackTimer, <span class="keywordtype">float</span> fTimeoutInSecs, <a class="code" href="_d_x_u_tgui_8cpp.html#a45">UINT</a>* pnIDEvent, <span class="keywordtype">void</span>* pCallbackUserContext ) 
<a name="l04599"></a>04599 { 
<a name="l04600"></a>04600     <span class="keywordflow">if</span>( pCallbackTimer == NULL )
<a name="l04601"></a>04601         <span class="keywordflow">return</span> <a class="code" href="_d_x_u_tmisc_8h.html#a8">DXUT_ERR_MSGBOX</a>( L<span class="stringliteral">"DXUTSetTimer"</span>, E_INVALIDARG ); 
<a name="l04602"></a>04602 
<a name="l04603"></a>04603     <a class="code" href="_d_x_u_tgui_8cpp.html#a51">HRESULT</a> hr;
<a name="l04604"></a>04604     <a class="code" href="struct_d_x_u_t___t_i_m_e_r.html">DXUT_TIMER</a> DXUTTimer;
<a name="l04605"></a>04605     DXUTTimer.<a class="code" href="struct_d_x_u_t___t_i_m_e_r.html#o0">pCallbackTimer</a> = pCallbackTimer;
<a name="l04606"></a>04606     DXUTTimer.<a class="code" href="struct_d_x_u_t___t_i_m_e_r.html#o1">pCallbackUserContext</a> = pCallbackUserContext;
<a name="l04607"></a>04607     DXUTTimer.<a class="code" href="struct_d_x_u_t___t_i_m_e_r.html#o2">fTimeoutInSecs</a> = fTimeoutInSecs;
<a name="l04608"></a>04608     DXUTTimer.<a class="code" href="struct_d_x_u_t___t_i_m_e_r.html#o3">fCountdown</a> = fTimeoutInSecs;
<a name="l04609"></a>04609     DXUTTimer.<a class="code" href="struct_d_x_u_t___t_i_m_e_r.html#o4">bEnabled</a> = <span class="keyword">true</span>;
<a name="l04610"></a>04610 
<a name="l04611"></a>04611     <a class="code" href="class_c_growable_array.html">CGrowableArray&lt;DXUT_TIMER&gt;</a>* pTimerList = <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetTimerList();
<a name="l04612"></a>04612     <span class="keywordflow">if</span>( pTimerList == NULL )
<a name="l04613"></a>04613     {
<a name="l04614"></a>04614         pTimerList = <a class="code" href="dxstdafx_8h.html#a4">DX_NEW</a> <a class="code" href="class_c_growable_array.html">CGrowableArray&lt;DXUT_TIMER&gt;</a>;
<a name="l04615"></a>04615         <span class="keywordflow">if</span>( pTimerList == NULL )
<a name="l04616"></a>04616             <span class="keywordflow">return</span> E_OUTOFMEMORY; 
<a name="l04617"></a>04617         <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetTimerList( pTimerList );
<a name="l04618"></a>04618     }
<a name="l04619"></a>04619 
<a name="l04620"></a>04620     <span class="keywordflow">if</span>( FAILED( hr = pTimerList-&gt;<a class="code" href="class_c_growable_array.html#a7">Add</a>( DXUTTimer ) ) )
<a name="l04621"></a>04621         <span class="keywordflow">return</span> hr;
<a name="l04622"></a>04622 
<a name="l04623"></a>04623     <span class="keywordflow">if</span>( pnIDEvent )
<a name="l04624"></a>04624         *pnIDEvent = pTimerList-&gt;<a class="code" href="class_c_growable_array.html#a11">GetSize</a>();
<a name="l04625"></a>04625 
<a name="l04626"></a>04626     <span class="keywordflow">return</span> S_OK; 
<a name="l04627"></a>04627 }
<a name="l04628"></a>04628 
<a name="l04629"></a>04629 
<a name="l04630"></a>04630 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l04631"></a>04631 <span class="comment">// Stops a user defined timer callback</span>
<a name="l04632"></a>04632 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l04633"></a><a class="code" href="_d_x_u_t_8h.html#a50">04633</a> <a class="code" href="_d_x_u_tgui_8cpp.html#a51">HRESULT</a> <a class="code" href="_d_x_u_t_8cpp.html#a92">DXUTKillTimer</a>( <a class="code" href="_d_x_u_tgui_8cpp.html#a45">UINT</a> nIDEvent ) 
<a name="l04634"></a>04634 { 
<a name="l04635"></a>04635     <a class="code" href="class_c_growable_array.html">CGrowableArray&lt;DXUT_TIMER&gt;</a>* pTimerList = <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetTimerList();
<a name="l04636"></a>04636     <span class="keywordflow">if</span>( pTimerList == NULL )
<a name="l04637"></a>04637         <span class="keywordflow">return</span> S_FALSE;
<a name="l04638"></a>04638 
<a name="l04639"></a>04639     <span class="keywordflow">if</span>( nIDEvent &lt; (<a class="code" href="_d_x_u_tgui_8cpp.html#a45">UINT</a>)pTimerList-&gt;<a class="code" href="class_c_growable_array.html#a11">GetSize</a>() )
<a name="l04640"></a>04640     {
<a name="l04641"></a>04641         <a class="code" href="struct_d_x_u_t___t_i_m_e_r.html">DXUT_TIMER</a> DXUTTimer = pTimerList-&gt;<a class="code" href="class_c_growable_array.html#a10">GetAt</a>(nIDEvent);
<a name="l04642"></a>04642         DXUTTimer.<a class="code" href="struct_d_x_u_t___t_i_m_e_r.html#o4">bEnabled</a> = <span class="keyword">false</span>;
<a name="l04643"></a>04643         pTimerList-&gt;<a class="code" href="class_c_growable_array.html#a9">SetAt</a>(nIDEvent, DXUTTimer);
<a name="l04644"></a>04644     }
<a name="l04645"></a>04645     <span class="keywordflow">else</span>
<a name="l04646"></a>04646     {
<a name="l04647"></a>04647         <span class="keywordflow">return</span> <a class="code" href="_d_x_u_tmisc_8h.html#a8">DXUT_ERR_MSGBOX</a>( L<span class="stringliteral">"DXUTKillTimer"</span>, E_INVALIDARG );
<a name="l04648"></a>04648     }
<a name="l04649"></a>04649 
<a name="l04650"></a>04650     <span class="keywordflow">return</span> S_OK; 
<a name="l04651"></a>04651 }
<a name="l04652"></a>04652 
<a name="l04653"></a>04653 
<a name="l04654"></a>04654 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l04655"></a>04655 <span class="comment">// Internal helper function to handle calling the user defined timer callbacks</span>
<a name="l04656"></a>04656 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l04657"></a><a class="code" href="_d_x_u_t_8cpp.html#a50">04657</a> <span class="keywordtype">void</span> <a class="code" href="_d_x_u_t_8cpp.html#a50">DXUTHandleTimers</a>()
<a name="l04658"></a>04658 {
<a name="l04659"></a>04659     <span class="keywordtype">float</span> fElapsedTime = <a class="code" href="_d_x_u_t_8cpp.html#a106">DXUTGetElapsedTime</a>();
<a name="l04660"></a>04660 
<a name="l04661"></a>04661     <a class="code" href="class_c_growable_array.html">CGrowableArray&lt;DXUT_TIMER&gt;</a>* pTimerList = <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetTimerList();
<a name="l04662"></a>04662     <span class="keywordflow">if</span>( pTimerList == NULL )
<a name="l04663"></a>04663         <span class="keywordflow">return</span>;
<a name="l04664"></a>04664 
<a name="l04665"></a>04665     <span class="comment">// Walk through the list of timer callbacks</span>
<a name="l04666"></a>04666     <span class="keywordflow">for</span>( <span class="keywordtype">int</span> i=0; i&lt;pTimerList-&gt;<a class="code" href="class_c_growable_array.html#a11">GetSize</a>(); i++ )
<a name="l04667"></a>04667     {
<a name="l04668"></a>04668         <a class="code" href="struct_d_x_u_t___t_i_m_e_r.html">DXUT_TIMER</a> DXUTTimer = pTimerList-&gt;<a class="code" href="class_c_growable_array.html#a10">GetAt</a>(i);
<a name="l04669"></a>04669         <span class="keywordflow">if</span>( DXUTTimer.<a class="code" href="struct_d_x_u_t___t_i_m_e_r.html#o4">bEnabled</a> )
<a name="l04670"></a>04670         {
<a name="l04671"></a>04671             DXUTTimer.<a class="code" href="struct_d_x_u_t___t_i_m_e_r.html#o3">fCountdown</a> -= fElapsedTime;
<a name="l04672"></a>04672 
<a name="l04673"></a>04673             <span class="comment">// Call the callback if count down expired</span>
<a name="l04674"></a>04674             <span class="keywordflow">if</span>( DXUTTimer.<a class="code" href="struct_d_x_u_t___t_i_m_e_r.html#o3">fCountdown</a> &lt; 0 )
<a name="l04675"></a>04675             {
<a name="l04676"></a>04676                 DXUTTimer.<a class="code" href="struct_d_x_u_t___t_i_m_e_r.html#o0">pCallbackTimer</a>( i, DXUTTimer.<a class="code" href="struct_d_x_u_t___t_i_m_e_r.html#o1">pCallbackUserContext</a> );
<a name="l04677"></a>04677                 DXUTTimer.<a class="code" href="struct_d_x_u_t___t_i_m_e_r.html#o3">fCountdown</a> = DXUTTimer.<a class="code" href="struct_d_x_u_t___t_i_m_e_r.html#o2">fTimeoutInSecs</a>;
<a name="l04678"></a>04678             }
<a name="l04679"></a>04679             pTimerList-&gt;<a class="code" href="class_c_growable_array.html#a9">SetAt</a>(i, DXUTTimer);
<a name="l04680"></a>04680         }
<a name="l04681"></a>04681     }
<a name="l04682"></a>04682 }
<a name="l04683"></a>04683 
<a name="l04684"></a>04684 
<a name="l04685"></a>04685 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l04686"></a>04686 <span class="comment">// External state access functions</span>
<a name="l04687"></a>04687 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l04688"></a><a class="code" href="_d_x_u_t_8h.html#a57">04688</a> IDirect3D9* <a class="code" href="_d_x_u_t_8cpp.html#a93">DXUTGetD3DObject</a>()                      { <span class="keywordflow">return</span> <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetD3D(); }        
<a name="l04689"></a><a class="code" href="_d_x_u_t_8h.html#a58">04689</a> IDirect3DDevice9* <a class="code" href="_d_x_u_t_8cpp.html#a94">DXUTGetD3DDevice</a>()                { <span class="keywordflow">return</span> <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetD3DDevice(); }  
<a name="l04690"></a><a class="code" href="_d_x_u_t_8h.html#a61">04690</a> <span class="keyword">const</span> D3DSURFACE_DESC* <a class="code" href="_d_x_u_t_8cpp.html#a95">DXUTGetBackBufferSurfaceDesc</a>() { <span class="keywordflow">return</span> <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetBackBufferSurfaceDesc(); }
<a name="l04691"></a><a class="code" href="_d_x_u_t_8h.html#a62">04691</a> <span class="keyword">const</span> D3DCAPS9* <a class="code" href="_d_x_u_t_8cpp.html#a96">DXUTGetDeviceCaps</a>()                 { <span class="keywordflow">return</span> <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetCaps(); }
<a name="l04692"></a><a class="code" href="_d_x_u_t_8h.html#a63">04692</a> HINSTANCE <a class="code" href="_d_x_u_t_8cpp.html#a97">DXUTGetHINSTANCE</a>()                        { <span class="keywordflow">return</span> <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetHInstance(); }
<a name="l04693"></a><a class="code" href="_d_x_u_t_8h.html#a64">04693</a> <a class="code" href="_d_x_u_tgui_8cpp.html#a53">HWND</a> <a class="code" href="_d_x_u_t_8cpp.html#a98">DXUTGetHWND</a>()                                  { <span class="keywordflow">return</span> <a class="code" href="_d_x_u_t_8cpp.html#a124">DXUTIsWindowed</a>() ? <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetHWNDDeviceWindowed() : <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetHWNDDeviceFullScreen(); }
<a name="l04694"></a><a class="code" href="_d_x_u_t_8h.html#a65">04694</a> <a class="code" href="_d_x_u_tgui_8cpp.html#a53">HWND</a> <a class="code" href="_d_x_u_t_8cpp.html#a99">DXUTGetHWNDFocus</a>()                             { <span class="keywordflow">return</span> <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetHWNDFocus(); }
<a name="l04695"></a><a class="code" href="_d_x_u_t_8h.html#a66">04695</a> <a class="code" href="_d_x_u_tgui_8cpp.html#a53">HWND</a> <a class="code" href="_d_x_u_t_8cpp.html#a100">DXUTGetHWNDDeviceFullScreen</a>()                  { <span class="keywordflow">return</span> <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetHWNDDeviceFullScreen(); }
<a name="l04696"></a><a class="code" href="_d_x_u_t_8h.html#a67">04696</a> <a class="code" href="_d_x_u_tgui_8cpp.html#a53">HWND</a> <a class="code" href="_d_x_u_t_8cpp.html#a101">DXUTGetHWNDDeviceWindowed</a>()                    { <span class="keywordflow">return</span> <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetHWNDDeviceWindowed(); }
<a name="l04697"></a><a class="code" href="_d_x_u_t_8h.html#a68">04697</a> RECT <a class="code" href="_d_x_u_t_8cpp.html#a102">DXUTGetWindowClientRect</a>()                      { RECT rc; GetClientRect( <a class="code" href="_d_x_u_t_8cpp.html#a98">DXUTGetHWND</a>(), &amp;rc ); <span class="keywordflow">return</span> rc; }
<a name="l04698"></a><a class="code" href="_d_x_u_t_8h.html#a69">04698</a> RECT <a class="code" href="_d_x_u_t_8cpp.html#a103">DXUTGetWindowClientRectAtModeChange</a>()          { RECT rc = { 0, 0, <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetWindowBackBufferWidthAtModeChange(), <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetWindowBackBufferHeightAtModeChange() }; <span class="keywordflow">return</span> rc; }
<a name="l04699"></a><a class="code" href="_d_x_u_t_8h.html#a70">04699</a> RECT <a class="code" href="_d_x_u_t_8cpp.html#a104">DXUTGetFullsceenClientRectAtModeChange</a>()       { RECT rc = { 0, 0, <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetFullScreenBackBufferWidthAtModeChange(), <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetFullScreenBackBufferHeightAtModeChange() }; <span class="keywordflow">return</span> rc; }
<a name="l04700"></a><a class="code" href="_d_x_u_t_8h.html#a71">04700</a> <span class="keywordtype">double</span> <a class="code" href="_d_x_u_t_8cpp.html#a105">DXUTGetTime</a>()                                { <span class="keywordflow">return</span> <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetTime(); }
<a name="l04701"></a><a class="code" href="_d_x_u_t_8h.html#a72">04701</a> <span class="keywordtype">float</span> <a class="code" href="_d_x_u_t_8cpp.html#a106">DXUTGetElapsedTime</a>()                          { <span class="keywordflow">return</span> <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetElapsedTime(); }
<a name="l04702"></a><a class="code" href="_d_x_u_t_8h.html#a74">04702</a> <span class="keywordtype">float</span> <a class="code" href="_d_x_u_t_8cpp.html#a107">DXUTGetFPS</a>()                                  { <span class="keywordflow">return</span> <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetFPS(); }
<a name="l04703"></a><a class="code" href="_d_x_u_t_8h.html#a75">04703</a> LPCWSTR <a class="code" href="_d_x_u_t_8cpp.html#a108">DXUTGetWindowTitle</a>()                        { <span class="keywordflow">return</span> <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetWindowTitle(); }
<a name="l04704"></a><a class="code" href="_d_x_u_t_8h.html#a76">04704</a> LPCWSTR <a class="code" href="_d_x_u_t_8cpp.html#a109">DXUTGetFrameStats</a>()                         { <span class="keywordflow">return</span> <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetFrameStats(); }
<a name="l04705"></a><a class="code" href="_d_x_u_t_8h.html#a77">04705</a> LPCWSTR <a class="code" href="_d_x_u_t_8cpp.html#a110">DXUTGetDeviceStats</a>()                        { <span class="keywordflow">return</span> <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetDeviceStats(); }
<a name="l04706"></a><a class="code" href="_d_x_u_t_8h.html#a78">04706</a> <span class="keywordtype">bool</span> <a class="code" href="_d_x_u_t_8cpp.html#a111">DXUTIsRenderingPaused</a>()                        { <span class="keywordflow">return</span> <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetPauseRenderingCount() &gt; 0; }
<a name="l04707"></a><a class="code" href="_d_x_u_t_8h.html#a79">04707</a> <span class="keywordtype">bool</span> <a class="code" href="_d_x_u_t_8cpp.html#a112">DXUTIsTimePaused</a>()                             { <span class="keywordflow">return</span> <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetPauseTimeCount() &gt; 0; }
<a name="l04708"></a><a class="code" href="_d_x_u_t_8h.html#a80">04708</a> <span class="keywordtype">bool</span> <a class="code" href="_d_x_u_t_8cpp.html#a113">DXUTIsActive</a>()                                                                     { <span class="keywordflow">return</span> <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetActive(); }
<a name="l04709"></a><a class="code" href="_d_x_u_t_8h.html#a81">04709</a> <span class="keywordtype">int</span> <a class="code" href="_d_x_u_t_8cpp.html#a114">DXUTGetExitCode</a>()                               { <span class="keywordflow">return</span> <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetExitCode(); }
<a name="l04710"></a><a class="code" href="_d_x_u_t_8h.html#a82">04710</a> <span class="keywordtype">bool</span> <a class="code" href="_d_x_u_t_8cpp.html#a115">DXUTGetShowMsgBoxOnError</a>()                     { <span class="keywordflow">return</span> <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetShowMsgBoxOnError(); }
<a name="l04711"></a><a class="code" href="_d_x_u_t_8h.html#a86">04711</a> <span class="keywordtype">bool</span> <a class="code" href="_d_x_u_t_8cpp.html#a116">DXUTGetAutomation</a>()                            { <span class="keywordflow">return</span> <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetAutomation(); }
<a name="l04712"></a><a class="code" href="_d_x_u_t_8h.html#a83">04712</a> <span class="keywordtype">bool</span> <a class="code" href="_d_x_u_t_8cpp.html#a117">DXUTGetHandleDefaultHotkeys</a>()                  { <span class="keywordflow">return</span> <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetHandleDefaultHotkeys(); }
<a name="l04713"></a><a class="code" href="_d_x_u_t_8h.html#a84">04713</a> <span class="keywordtype">bool</span> <a class="code" href="_d_x_u_t_8cpp.html#a118">DXUTIsKeyDown</a>( BYTE vKey )
<a name="l04714"></a>04714 { 
<a name="l04715"></a>04715     <span class="keywordtype">bool</span>* bKeys = <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetKeys(); 
<a name="l04716"></a>04716     <span class="keywordflow">if</span>( vKey &gt;= 0xA0 &amp;&amp; vKey &lt;= 0xA5 )  <span class="comment">// VK_LSHIFT, VK_RSHIFT, VK_LCONTROL, VK_RCONTROL, VK_LMENU, VK_RMENU</span>
<a name="l04717"></a>04717         <span class="keywordflow">return</span> GetAsyncKeyState( vKey ) != 0; <span class="comment">// these keys only are tracked via GetAsyncKeyState()</span>
<a name="l04718"></a>04718     <span class="keywordflow">else</span> <span class="keywordflow">if</span>( vKey &gt;= 0x01 &amp;&amp; vKey &lt;= 0x06 &amp;&amp; vKey != 0x03 ) <span class="comment">// mouse buttons (VK_*BUTTON)</span>
<a name="l04719"></a>04719         <span class="keywordflow">return</span> <a class="code" href="_d_x_u_t_8cpp.html#a119">DXUTIsMouseButtonDown</a>(vKey);
<a name="l04720"></a>04720     <span class="keywordflow">else</span>
<a name="l04721"></a>04721         <span class="keywordflow">return</span> bKeys[vKey];
<a name="l04722"></a>04722 }
<a name="l04723"></a><a class="code" href="_d_x_u_t_8h.html#a85">04723</a> <span class="keywordtype">bool</span> <a class="code" href="_d_x_u_t_8cpp.html#a119">DXUTIsMouseButtonDown</a>( BYTE vButton )          
<a name="l04724"></a>04724 { 
<a name="l04725"></a>04725     <span class="keywordtype">bool</span>* bMouseButtons = <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetMouseButtons(); 
<a name="l04726"></a>04726     <span class="keywordtype">int</span> nIndex = <a class="code" href="_d_x_u_t_8cpp.html#a32">DXUTMapButtonToArrayIndex</a>(vButton); 
<a name="l04727"></a>04727     <span class="keywordflow">return</span> bMouseButtons[nIndex]; 
<a name="l04728"></a>04728 }
<a name="l04729"></a><a class="code" href="_d_x_u_t_8h.html#a45">04729</a> <span class="keywordtype">void</span> <a class="code" href="_d_x_u_t_8cpp.html#a120">DXUTSetMultimonSettings</a>( <span class="keywordtype">bool</span> bAutoChangeAdapter )
<a name="l04730"></a>04730 {
<a name="l04731"></a>04731     <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetAutoChangeAdapter( bAutoChangeAdapter );
<a name="l04732"></a>04732 }
<a name="l04733"></a><a class="code" href="_d_x_u_t_8h.html#a44">04733</a> <span class="keywordtype">void</span> <a class="code" href="_d_x_u_t_8cpp.html#a121">DXUTSetCursorSettings</a>( <span class="keywordtype">bool</span> bShowCursorWhenFullScreen, <span class="keywordtype">bool</span> bClipCursorWhenFullScreen ) 
<a name="l04734"></a>04734 { 
<a name="l04735"></a>04735     <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetClipCursorWhenFullScreen(bClipCursorWhenFullScreen); 
<a name="l04736"></a>04736     <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetShowCursorWhenFullScreen(bShowCursorWhenFullScreen); 
<a name="l04737"></a>04737 }
<a name="l04738"></a><a class="code" href="_d_x_u_t_8h.html#a47">04738</a> <span class="keywordtype">void</span> <a class="code" href="_d_x_u_t_8cpp.html#a122">DXUTSetWindowSettings</a>( <span class="keywordtype">bool</span> bCallDefWindowProc )
<a name="l04739"></a>04739 {
<a name="l04740"></a>04740     <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetCallDefWindowProc( bCallDefWindowProc );
<a name="l04741"></a>04741 }
<a name="l04742"></a><a class="code" href="_d_x_u_t_8h.html#a48">04742</a> <span class="keywordtype">void</span> <a class="code" href="_d_x_u_t_8cpp.html#a123">DXUTSetConstantFrameTime</a>( <span class="keywordtype">bool</span> bEnabled, <span class="keywordtype">float</span> fTimePerFrame ) 
<a name="l04743"></a>04743 { 
<a name="l04744"></a>04744     <span class="keywordflow">if</span>( <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetOverrideConstantFrameTime() ) 
<a name="l04745"></a>04745     { 
<a name="l04746"></a>04746         bEnabled = <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetOverrideConstantFrameTime(); 
<a name="l04747"></a>04747         fTimePerFrame = <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetOverrideConstantTimePerFrame(); 
<a name="l04748"></a>04748     } 
<a name="l04749"></a>04749     <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetConstantFrameTime(bEnabled); 
<a name="l04750"></a>04750     <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetTimePerFrame(fTimePerFrame); 
<a name="l04751"></a>04751 }
<a name="l04752"></a>04752 
<a name="l04753"></a>04753 
<a name="l04754"></a>04754 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l04755"></a>04755 <span class="comment">// Return if windowed in the current device.  If no device exists yet, then returns false</span>
<a name="l04756"></a>04756 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l04757"></a><a class="code" href="_d_x_u_t_8h.html#a73">04757</a> <span class="keywordtype">bool</span> <a class="code" href="_d_x_u_t_8cpp.html#a124">DXUTIsWindowed</a>()                               
<a name="l04758"></a>04758 { 
<a name="l04759"></a>04759     <a class="code" href="struct_d_x_u_t_device_settings.html">DXUTDeviceSettings</a>* pDeviceSettings = <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetCurrentDeviceSettings(); 
<a name="l04760"></a>04760     <span class="keywordflow">if</span>(pDeviceSettings) 
<a name="l04761"></a>04761         <span class="keywordflow">return</span> (pDeviceSettings-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>.Windowed != 0); 
<a name="l04762"></a>04762     <span class="keywordflow">else</span> 
<a name="l04763"></a>04763         <span class="keywordflow">return</span> <span class="keyword">false</span>; 
<a name="l04764"></a>04764 }
<a name="l04765"></a>04765 
<a name="l04766"></a>04766 
<a name="l04767"></a>04767 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l04768"></a>04768 <span class="comment">// Return the present params of the current device.  If no device exists yet, then</span>
<a name="l04769"></a>04769 <span class="comment">// return blank present params</span>
<a name="l04770"></a>04770 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l04771"></a><a class="code" href="_d_x_u_t_8h.html#a60">04771</a> D3DPRESENT_PARAMETERS <a class="code" href="_d_x_u_t_8cpp.html#a125">DXUTGetPresentParameters</a>()    
<a name="l04772"></a>04772 { 
<a name="l04773"></a>04773     <a class="code" href="struct_d_x_u_t_device_settings.html">DXUTDeviceSettings</a>* pDS = <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetCurrentDeviceSettings(); 
<a name="l04774"></a>04774     <span class="keywordflow">if</span>( pDS ) 
<a name="l04775"></a>04775     {
<a name="l04776"></a>04776         <span class="keywordflow">return</span> pDS-&gt;<a class="code" href="struct_d_x_u_t_device_settings.html#o4">pp</a>; 
<a name="l04777"></a>04777     }
<a name="l04778"></a>04778     <span class="keywordflow">else</span> 
<a name="l04779"></a>04779     {
<a name="l04780"></a>04780         D3DPRESENT_PARAMETERS pp;
<a name="l04781"></a>04781         ZeroMemory( &amp;pp, <span class="keyword">sizeof</span>(D3DPRESENT_PARAMETERS) );
<a name="l04782"></a>04782         <span class="keywordflow">return</span> pp; 
<a name="l04783"></a>04783     }
<a name="l04784"></a>04784 }
<a name="l04785"></a>04785 
<a name="l04786"></a>04786 
<a name="l04787"></a>04787 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l04788"></a>04788 <span class="comment">// Return the device settings of the current device.  If no device exists yet, then</span>
<a name="l04789"></a>04789 <span class="comment">// return blank device settings </span>
<a name="l04790"></a>04790 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l04791"></a><a class="code" href="_d_x_u_t_8h.html#a59">04791</a> <a class="code" href="struct_d_x_u_t_device_settings.html">DXUTDeviceSettings</a> <a class="code" href="_d_x_u_t_8cpp.html#a126">DXUTGetDeviceSettings</a>()   
<a name="l04792"></a>04792 { 
<a name="l04793"></a>04793     <a class="code" href="struct_d_x_u_t_device_settings.html">DXUTDeviceSettings</a>* pDS = <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetCurrentDeviceSettings();
<a name="l04794"></a>04794     <span class="keywordflow">if</span>( pDS )
<a name="l04795"></a>04795     {
<a name="l04796"></a>04796         <span class="keywordflow">return</span> *pDS;
<a name="l04797"></a>04797     }
<a name="l04798"></a>04798     <span class="keywordflow">else</span>
<a name="l04799"></a>04799     {
<a name="l04800"></a>04800         <a class="code" href="struct_d_x_u_t_device_settings.html">DXUTDeviceSettings</a> ds;
<a name="l04801"></a>04801         ZeroMemory( &amp;ds, <span class="keyword">sizeof</span>(<a class="code" href="struct_d_x_u_t_device_settings.html">DXUTDeviceSettings</a>) );
<a name="l04802"></a>04802         <span class="keywordflow">return</span> ds;
<a name="l04803"></a>04803     }
<a name="l04804"></a>04804 } 
<a name="l04805"></a>04805 
<a name="l04806"></a>04806 <span class="preprocessor">#ifndef SM_REMOTESESSION  // needs WINVER &gt;= 0x0500</span>
<a name="l04807"></a><a class="code" href="_d_x_u_t_8cpp.html#a14">04807</a> <span class="preprocessor"></span><span class="preprocessor">#define SM_REMOTESESSION  0x1000</span>
<a name="l04808"></a>04808 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l04809"></a>04809 <span class="preprocessor"></span>
<a name="l04810"></a>04810 
<a name="l04811"></a>04811 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l04812"></a>04812 <span class="comment">// Display an custom error msg box </span>
<a name="l04813"></a>04813 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l04814"></a><a class="code" href="_d_x_u_t_8cpp.html#a52">04814</a> <span class="keywordtype">void</span> <a class="code" href="_d_x_u_t_8cpp.html#a52">DXUTDisplayErrorMessage</a>( <a class="code" href="_d_x_u_tgui_8cpp.html#a51">HRESULT</a> hr )
<a name="l04815"></a>04815 {
<a name="l04816"></a>04816     WCHAR strBuffer[512];
<a name="l04817"></a>04817 
<a name="l04818"></a>04818     <span class="keywordtype">int</span> nExitCode;
<a name="l04819"></a>04819     <span class="keywordtype">bool</span> bFound = <span class="keyword">true</span>; 
<a name="l04820"></a>04820     <span class="keywordflow">switch</span>( hr )
<a name="l04821"></a>04821     {
<a name="l04822"></a>04822         <span class="keywordflow">case</span> <a class="code" href="_d_x_u_t_8h.html#a0">DXUTERR_NODIRECT3D</a>:             nExitCode = 2; StringCchCopy( strBuffer, 512, L<span class="stringliteral">"Could not initialize Direct3D. You may want to check that the latest version of DirectX is correctly installed on your system.  Also make sure that this program was compiled with header files that match the installed DirectX DLLs."</span> ); <span class="keywordflow">break</span>;
<a name="l04823"></a>04823         <span class="keywordflow">case</span> <a class="code" href="_d_x_u_t_8h.html#a8">DXUTERR_INCORRECTVERSION</a>:       nExitCode = 10; StringCchCopy( strBuffer, 512, L<span class="stringliteral">"Incorrect version of Direct3D and/or D3DX."</span> ); <span class="keywordflow">break</span>;
<a name="l04824"></a>04824         <span class="keywordflow">case</span> <a class="code" href="_d_x_u_t_8h.html#a2">DXUTERR_MEDIANOTFOUND</a>:          nExitCode = 4; StringCchCopy( strBuffer, 512, L<span class="stringliteral">"Could not find required media. Ensure that the DirectX SDK is correctly installed."</span> ); <span class="keywordflow">break</span>;
<a name="l04825"></a>04825         <span class="keywordflow">case</span> <a class="code" href="_d_x_u_t_8h.html#a3">DXUTERR_NONZEROREFCOUNT</a>:        nExitCode = 5; StringCchCopy( strBuffer, 512, L<span class="stringliteral">"The D3D device has a non-zero reference count, meaning some objects were not released."</span> ); <span class="keywordflow">break</span>;
<a name="l04826"></a>04826         <span class="keywordflow">case</span> <a class="code" href="_d_x_u_t_8h.html#a4">DXUTERR_CREATINGDEVICE</a>:         nExitCode = 6; StringCchCopy( strBuffer, 512, L<span class="stringliteral">"Failed creating the Direct3D device."</span> ); <span class="keywordflow">break</span>;
<a name="l04827"></a>04827         <span class="keywordflow">case</span> <a class="code" href="_d_x_u_t_8h.html#a5">DXUTERR_RESETTINGDEVICE</a>:        nExitCode = 7; StringCchCopy( strBuffer, 512, L<span class="stringliteral">"Failed resetting the Direct3D device."</span> ); <span class="keywordflow">break</span>;
<a name="l04828"></a>04828         <span class="keywordflow">case</span> <a class="code" href="_d_x_u_t_8h.html#a6">DXUTERR_CREATINGDEVICEOBJECTS</a>:  nExitCode = 8; StringCchCopy( strBuffer, 512, L<span class="stringliteral">"Failed creating Direct3D device objects."</span> ); <span class="keywordflow">break</span>;
<a name="l04829"></a>04829         <span class="keywordflow">case</span> <a class="code" href="_d_x_u_t_8h.html#a7">DXUTERR_RESETTINGDEVICEOBJECTS</a>: nExitCode = 9; StringCchCopy( strBuffer, 512, L<span class="stringliteral">"Failed resetting Direct3D device objects."</span> ); <span class="keywordflow">break</span>;
<a name="l04830"></a>04830         <span class="keywordflow">case</span> <a class="code" href="_d_x_u_t_8h.html#a1">DXUTERR_NOCOMPATIBLEDEVICES</a>:    
<a name="l04831"></a>04831             nExitCode = 3; 
<a name="l04832"></a>04832             <span class="keywordflow">if</span>( <a class="code" href="_d_x_u_t_8cpp.html#a29">DXUT_GetSystemMetrics</a>(<a class="code" href="_d_x_u_t_8cpp.html#a14">SM_REMOTESESSION</a>) != 0 )
<a name="l04833"></a>04833                 StringCchCopy( strBuffer, 512, L<span class="stringliteral">"Direct3D does not work over a remote session."</span> ); 
<a name="l04834"></a>04834             <span class="keywordflow">else</span>
<a name="l04835"></a>04835                 StringCchCopy( strBuffer, 512, L<span class="stringliteral">"Could not find any compatible Direct3D devices."</span> ); 
<a name="l04836"></a>04836             <span class="keywordflow">break</span>;
<a name="l04837"></a>04837         <span class="keywordflow">default</span>: bFound = <span class="keyword">false</span>; nExitCode = 1;<span class="keywordflow">break</span>;
<a name="l04838"></a>04838     }   
<a name="l04839"></a>04839 
<a name="l04840"></a>04840     <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetExitCode(nExitCode);
<a name="l04841"></a>04841 
<a name="l04842"></a>04842     <span class="keywordtype">bool</span> bShowMsgBoxOnError = <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetShowMsgBoxOnError();
<a name="l04843"></a>04843     <span class="keywordflow">if</span>( bFound &amp;&amp; bShowMsgBoxOnError )
<a name="l04844"></a>04844     {
<a name="l04845"></a>04845         <span class="keywordflow">if</span>( <a class="code" href="_d_x_u_t_8cpp.html#a108">DXUTGetWindowTitle</a>()[0] == 0 )
<a name="l04846"></a>04846             MessageBox( <a class="code" href="_d_x_u_t_8cpp.html#a98">DXUTGetHWND</a>(), strBuffer, L<span class="stringliteral">"DirectX Application"</span>, MB_ICONERROR|MB_OK );
<a name="l04847"></a>04847         <span class="keywordflow">else</span>
<a name="l04848"></a>04848             MessageBox( <a class="code" href="_d_x_u_t_8cpp.html#a98">DXUTGetHWND</a>(), strBuffer, <a class="code" href="_d_x_u_t_8cpp.html#a108">DXUTGetWindowTitle</a>(), MB_ICONERROR|MB_OK );
<a name="l04849"></a>04849     }
<a name="l04850"></a>04850 }
<a name="l04851"></a>04851 
<a name="l04852"></a>04852 
<a name="l04853"></a>04853 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l04854"></a>04854 <span class="comment">// Display error msg box to help debug </span>
<a name="l04855"></a>04855 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l04856"></a><a class="code" href="_d_x_u_tmisc_8h.html">04856</a> <a class="code" href="_d_x_u_tgui_8cpp.html#a51">HRESULT</a> WINAPI <a class="code" href="_d_x_u_t_8cpp.html#a127">DXUTTrace</a>( <span class="keyword">const</span> CHAR* strFile, <a class="code" href="_d_x_u_tgui_8cpp.html#a38">DWORD</a> dwLine, <a class="code" href="_d_x_u_tgui_8cpp.html#a51">HRESULT</a> hr,
<a name="l04857"></a>04857                           <span class="keyword">const</span> WCHAR* strMsg, <span class="keywordtype">bool</span> bPopMsgBox )
<a name="l04858"></a>04858 {
<a name="l04859"></a>04859     <span class="keywordtype">bool</span> bShowMsgBoxOnError = <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetShowMsgBoxOnError();
<a name="l04860"></a>04860     <span class="keywordflow">if</span>( bPopMsgBox &amp;&amp; bShowMsgBoxOnError == false )
<a name="l04861"></a>04861         bPopMsgBox = <span class="keyword">false</span>;
<a name="l04862"></a>04862 
<a name="l04863"></a>04863     <span class="keywordflow">return</span> DXTrace( strFile, dwLine, hr, strMsg, bPopMsgBox );
<a name="l04864"></a>04864 }
<a name="l04865"></a>04865 
<a name="l04866"></a>04866 
<a name="l04867"></a>04867 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l04868"></a>04868 <span class="comment">// Checks to see if the HWND changed monitors, and if it did it creates a device </span>
<a name="l04869"></a>04869 <span class="comment">// from the monitor's adapter and recreates the scene.</span>
<a name="l04870"></a>04870 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l04871"></a><a class="code" href="_d_x_u_t_8cpp.html#a55">04871</a> <span class="keywordtype">void</span> <a class="code" href="_d_x_u_t_8cpp.html#a55">DXUTCheckForWindowChangingMonitors</a>()
<a name="l04872"></a>04872 {
<a name="l04873"></a>04873     <span class="comment">// Skip this check for various reasons</span>
<a name="l04874"></a>04874     <span class="keywordflow">if</span>( !<a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetAutoChangeAdapter() || 
<a name="l04875"></a>04875          <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetIgnoreSizeChange() ||
<a name="l04876"></a>04876         !<a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetDeviceCreated() ||
<a name="l04877"></a>04877         !<a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetCurrentDeviceSettings()-&gt;pp.Windowed )
<a name="l04878"></a>04878     {
<a name="l04879"></a>04879         <span class="keywordflow">return</span>;
<a name="l04880"></a>04880     }
<a name="l04881"></a>04881 
<a name="l04882"></a>04882     <a class="code" href="_d_x_u_tgui_8cpp.html#a51">HRESULT</a> hr;
<a name="l04883"></a>04883     HMONITOR hWindowMonitor = <a class="code" href="_d_x_u_t_8cpp.html#a28">DXUT_MonitorFromWindow</a>( <a class="code" href="_d_x_u_t_8cpp.html#a98">DXUTGetHWND</a>(), <a class="code" href="_d_x_u_t_8cpp.html#a9">MONITOR_DEFAULTTOPRIMARY</a> );
<a name="l04884"></a>04884     HMONITOR hAdapterMonitor = <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetAdapterMonitor();
<a name="l04885"></a>04885     <span class="keywordflow">if</span>( hWindowMonitor != hAdapterMonitor )
<a name="l04886"></a>04886     {
<a name="l04887"></a>04887         <a class="code" href="_d_x_u_tgui_8cpp.html#a45">UINT</a> newOrdinal;
<a name="l04888"></a>04888         <span class="keywordflow">if</span>( SUCCEEDED( <a class="code" href="_d_x_u_t_8cpp.html#a59">DXUTGetAdapterOrdinalFromMonitor</a>( hWindowMonitor, &amp;newOrdinal ) ) )
<a name="l04889"></a>04889         {
<a name="l04890"></a>04890             <span class="comment">// Find the closest valid device settings with the new ordinal</span>
<a name="l04891"></a>04891             <a class="code" href="struct_d_x_u_t_device_settings.html">DXUTDeviceSettings</a> deviceSettings = <a class="code" href="_d_x_u_t_8cpp.html#a126">DXUTGetDeviceSettings</a>();
<a name="l04892"></a>04892             deviceSettings.<a class="code" href="struct_d_x_u_t_device_settings.html#o0">AdapterOrdinal</a> = newOrdinal;
<a name="l04893"></a>04893             
<a name="l04894"></a>04894             <a class="code" href="struct_d_x_u_t_match_options.html">DXUTMatchOptions</a> matchOptions;
<a name="l04895"></a>04895             matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o0">eAdapterOrdinal</a>     = <a class="code" href="_d_x_u_t_8h.html#a87a22">DXUTMT_PRESERVE_INPUT</a>;
<a name="l04896"></a>04896             matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o1">eDeviceType</a>         = <a class="code" href="_d_x_u_t_8h.html#a87a23">DXUTMT_CLOSEST_TO_INPUT</a>;
<a name="l04897"></a>04897             matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o2">eWindowed</a>           = <a class="code" href="_d_x_u_t_8h.html#a87a23">DXUTMT_CLOSEST_TO_INPUT</a>;
<a name="l04898"></a>04898             matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o3">eAdapterFormat</a>      = <a class="code" href="_d_x_u_t_8h.html#a87a23">DXUTMT_CLOSEST_TO_INPUT</a>;
<a name="l04899"></a>04899             matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o4">eVertexProcessing</a>   = <a class="code" href="_d_x_u_t_8h.html#a87a23">DXUTMT_CLOSEST_TO_INPUT</a>;
<a name="l04900"></a>04900             matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o5">eResolution</a>         = <a class="code" href="_d_x_u_t_8h.html#a87a23">DXUTMT_CLOSEST_TO_INPUT</a>;
<a name="l04901"></a>04901             matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o6">eBackBufferFormat</a>   = <a class="code" href="_d_x_u_t_8h.html#a87a23">DXUTMT_CLOSEST_TO_INPUT</a>;
<a name="l04902"></a>04902             matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o7">eBackBufferCount</a>    = <a class="code" href="_d_x_u_t_8h.html#a87a23">DXUTMT_CLOSEST_TO_INPUT</a>;
<a name="l04903"></a>04903             matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o8">eMultiSample</a>        = <a class="code" href="_d_x_u_t_8h.html#a87a23">DXUTMT_CLOSEST_TO_INPUT</a>;
<a name="l04904"></a>04904             matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o9">eSwapEffect</a>         = <a class="code" href="_d_x_u_t_8h.html#a87a23">DXUTMT_CLOSEST_TO_INPUT</a>;
<a name="l04905"></a>04905             matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o10">eDepthFormat</a>        = <a class="code" href="_d_x_u_t_8h.html#a87a23">DXUTMT_CLOSEST_TO_INPUT</a>;
<a name="l04906"></a>04906             matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o11">eStencilFormat</a>      = <a class="code" href="_d_x_u_t_8h.html#a87a23">DXUTMT_CLOSEST_TO_INPUT</a>;
<a name="l04907"></a>04907             matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o12">ePresentFlags</a>       = <a class="code" href="_d_x_u_t_8h.html#a87a23">DXUTMT_CLOSEST_TO_INPUT</a>;
<a name="l04908"></a>04908             matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o13">eRefreshRate</a>        = <a class="code" href="_d_x_u_t_8h.html#a87a23">DXUTMT_CLOSEST_TO_INPUT</a>;
<a name="l04909"></a>04909             matchOptions.<a class="code" href="struct_d_x_u_t_match_options.html#o14">ePresentInterval</a>    = <a class="code" href="_d_x_u_t_8h.html#a87a23">DXUTMT_CLOSEST_TO_INPUT</a>;
<a name="l04910"></a>04910 
<a name="l04911"></a>04911             hr = <a class="code" href="_d_x_u_t_8cpp.html#a83">DXUTFindValidDeviceSettings</a>( &amp;deviceSettings, &amp;deviceSettings, &amp;matchOptions );
<a name="l04912"></a>04912             <span class="keywordflow">if</span>( SUCCEEDED(hr) ) 
<a name="l04913"></a>04913             {
<a name="l04914"></a>04914                 <span class="comment">// Create a Direct3D device using the new device settings.  </span>
<a name="l04915"></a>04915                 <span class="comment">// If there is an existing device, then it will either reset or recreate the scene.</span>
<a name="l04916"></a>04916                 hr = <a class="code" href="_d_x_u_t_8cpp.html#a41">DXUTChangeDevice</a>( &amp;deviceSettings, NULL, <span class="keyword">false</span>, <span class="keyword">false</span> );
<a name="l04917"></a>04917 
<a name="l04918"></a>04918                 <span class="comment">// If hr == E_ABORT, this means the app rejected the device settings in the ModifySettingsCallback</span>
<a name="l04919"></a>04919                 <span class="keywordflow">if</span>( hr == E_ABORT )
<a name="l04920"></a>04920                 {
<a name="l04921"></a>04921                     <span class="comment">// so nothing changed and keep from attempting to switch adapters next time</span>
<a name="l04922"></a>04922                     <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().SetAutoChangeAdapter( <span class="keyword">false</span> );
<a name="l04923"></a>04923                 }
<a name="l04924"></a>04924                 <span class="keywordflow">else</span> <span class="keywordflow">if</span>( FAILED(hr) )
<a name="l04925"></a>04925                 {
<a name="l04926"></a>04926                     <a class="code" href="_d_x_u_t_8cpp.html#a89">DXUTShutdown</a>();
<a name="l04927"></a>04927                     <a class="code" href="_d_x_u_t_8cpp.html#a86">DXUTPause</a>( <span class="keyword">false</span>, <span class="keyword">false</span> );
<a name="l04928"></a>04928                     <span class="keywordflow">return</span>;
<a name="l04929"></a>04929                 }
<a name="l04930"></a>04930             }
<a name="l04931"></a>04931         }
<a name="l04932"></a>04932     }    
<a name="l04933"></a>04933 }
<a name="l04934"></a>04934 
<a name="l04935"></a>04935 
<a name="l04936"></a>04936 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l04937"></a>04937 <span class="comment">// Look for an adapter ordinal that is tied to a HMONITOR</span>
<a name="l04938"></a>04938 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l04939"></a><a class="code" href="_d_x_u_t_8cpp.html#a59">04939</a> <a class="code" href="_d_x_u_tgui_8cpp.html#a51">HRESULT</a> <a class="code" href="_d_x_u_t_8cpp.html#a59">DXUTGetAdapterOrdinalFromMonitor</a>( HMONITOR hMonitor, <a class="code" href="_d_x_u_tgui_8cpp.html#a45">UINT</a>* pAdapterOrdinal )
<a name="l04940"></a>04940 {
<a name="l04941"></a>04941     *pAdapterOrdinal = 0;
<a name="l04942"></a>04942 
<a name="l04943"></a>04943     <a class="code" href="class_c_d3_d_enumeration.html">CD3DEnumeration</a>* pd3dEnum = <a class="code" href="_d_x_u_t_8cpp.html#a34">DXUTPrepareEnumerationObject</a>();
<a name="l04944"></a>04944     IDirect3D9*      pD3D     = <a class="code" href="_d_x_u_t_8cpp.html#a93">DXUTGetD3DObject</a>();
<a name="l04945"></a>04945 
<a name="l04946"></a>04946     <a class="code" href="class_c_growable_array.html">CGrowableArray&lt;CD3DEnumAdapterInfo*&gt;</a>* pAdapterList = pd3dEnum-&gt;<a class="code" href="class_c_d3_d_enumeration.html#a13">GetAdapterInfoList</a>();
<a name="l04947"></a>04947     <span class="keywordflow">for</span>( <span class="keywordtype">int</span> iAdapter=0; iAdapter&lt;pAdapterList-&gt;<a class="code" href="class_c_growable_array.html#a11">GetSize</a>(); iAdapter++ )
<a name="l04948"></a>04948     {
<a name="l04949"></a>04949         <a class="code" href="class_c_d3_d_enum_adapter_info.html">CD3DEnumAdapterInfo</a>* pAdapterInfo = pAdapterList-&gt;<a class="code" href="class_c_growable_array.html#a10">GetAt</a>(iAdapter);
<a name="l04950"></a>04950         HMONITOR hAdapterMonitor = pD3D-&gt;GetAdapterMonitor( pAdapterInfo-&gt;<a class="code" href="class_c_d3_d_enum_adapter_info.html#o0">AdapterOrdinal</a> );
<a name="l04951"></a>04951         <span class="keywordflow">if</span>( hAdapterMonitor == hMonitor )
<a name="l04952"></a>04952         {
<a name="l04953"></a>04953             *pAdapterOrdinal = pAdapterInfo-&gt;<a class="code" href="class_c_d3_d_enum_adapter_info.html#o0">AdapterOrdinal</a>;
<a name="l04954"></a>04954             <span class="keywordflow">return</span> S_OK;
<a name="l04955"></a>04955         }
<a name="l04956"></a>04956     }
<a name="l04957"></a>04957 
<a name="l04958"></a>04958     <span class="keywordflow">return</span> E_FAIL;
<a name="l04959"></a>04959 }
<a name="l04960"></a>04960 
<a name="l04961"></a>04961 
<a name="l04962"></a>04962 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l04963"></a>04963 <span class="comment">// Internal function to map MK_* to an array index</span>
<a name="l04964"></a>04964 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l04965"></a><a class="code" href="_d_x_u_t_8cpp.html#a32">04965</a> <span class="keywordtype">int</span> <a class="code" href="_d_x_u_t_8cpp.html#a32">DXUTMapButtonToArrayIndex</a>( BYTE vButton )
<a name="l04966"></a>04966 {
<a name="l04967"></a>04967     <span class="keywordflow">switch</span>( vButton )
<a name="l04968"></a>04968     {
<a name="l04969"></a>04969         <span class="keywordflow">case</span> MK_LBUTTON: <span class="keywordflow">return</span> 0;
<a name="l04970"></a>04970         <span class="keywordflow">case</span> VK_MBUTTON: 
<a name="l04971"></a>04971         <span class="keywordflow">case</span> MK_MBUTTON: <span class="keywordflow">return</span> 1;
<a name="l04972"></a>04972         <span class="keywordflow">case</span> MK_RBUTTON: <span class="keywordflow">return</span> 2;
<a name="l04973"></a>04973         <span class="keywordflow">case</span> VK_XBUTTON1:
<a name="l04974"></a>04974         <span class="keywordflow">case</span> MK_XBUTTON1: <span class="keywordflow">return</span> 3;
<a name="l04975"></a>04975         <span class="keywordflow">case</span> VK_XBUTTON2:
<a name="l04976"></a>04976         <span class="keywordflow">case</span> MK_XBUTTON2: <span class="keywordflow">return</span> 4;
<a name="l04977"></a>04977     }
<a name="l04978"></a>04978 
<a name="l04979"></a>04979     <span class="keywordflow">return</span> 0;
<a name="l04980"></a>04980 }
<a name="l04981"></a>04981 
<a name="l04982"></a>04982 
<a name="l04983"></a>04983 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l04984"></a>04984 <span class="comment">// Setup cursor based on current settings (window/fullscreen mode, show cursor state, clip cursor state)</span>
<a name="l04985"></a>04985 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l04986"></a><a class="code" href="_d_x_u_t_8cpp.html#a62">04986</a> <span class="keywordtype">void</span> <a class="code" href="_d_x_u_t_8cpp.html#a62">DXUTSetupCursor</a>()
<a name="l04987"></a>04987 {
<a name="l04988"></a>04988         <span class="comment">// Show the cursor again if returning to fullscreen </span>
<a name="l04989"></a>04989         IDirect3DDevice9* pd3dDevice = <a class="code" href="_d_x_u_t_8cpp.html#a94">DXUTGetD3DDevice</a>();
<a name="l04990"></a>04990         <span class="keywordflow">if</span>( !<a class="code" href="_d_x_u_t_8cpp.html#a124">DXUTIsWindowed</a>() &amp;&amp; <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetShowCursorWhenFullScreen() &amp;&amp; pd3dDevice )
<a name="l04991"></a>04991         {
<a name="l04992"></a>04992                 HCURSOR hCursor = (HCURSOR)(ULONG_PTR)GetClassLongPtr( <a class="code" href="_d_x_u_t_8cpp.html#a100">DXUTGetHWNDDeviceFullScreen</a>(), GCLP_HCURSOR );
<a name="l04993"></a>04993                 <a class="code" href="_d_x_u_t_8cpp.html#a63">DXUTSetDeviceCursor</a>( pd3dDevice, hCursor, <span class="keyword">false</span> );
<a name="l04994"></a>04994         }
<a name="l04995"></a>04995 
<a name="l04996"></a>04996         <span class="comment">// Clip cursor if requested</span>
<a name="l04997"></a>04997         <span class="keywordflow">if</span>( !<a class="code" href="_d_x_u_t_8cpp.html#a124">DXUTIsWindowed</a>() &amp;&amp; <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetClipCursorWhenFullScreen() )
<a name="l04998"></a>04998         {
<a name="l04999"></a>04999                 <span class="comment">// Confine cursor to full screen window</span>
<a name="l05000"></a>05000                 RECT rcWindow;
<a name="l05001"></a>05001                 GetWindowRect( <a class="code" href="_d_x_u_t_8cpp.html#a100">DXUTGetHWNDDeviceFullScreen</a>(), &amp;rcWindow );
<a name="l05002"></a>05002                 ClipCursor( &amp;rcWindow );
<a name="l05003"></a>05003         }
<a name="l05004"></a>05004         <span class="keywordflow">else</span>
<a name="l05005"></a>05005         {
<a name="l05006"></a>05006                 ClipCursor( NULL );
<a name="l05007"></a>05007         }
<a name="l05008"></a>05008 }
<a name="l05009"></a>05009 
<a name="l05010"></a>05010 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l05011"></a>05011 <span class="comment">// Gives the D3D device a cursor with image and hotspot from hCursor.</span>
<a name="l05012"></a>05012 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l05013"></a><a class="code" href="_d_x_u_t_8cpp.html#a63">05013</a> <a class="code" href="_d_x_u_tgui_8cpp.html#a51">HRESULT</a> <a class="code" href="_d_x_u_t_8cpp.html#a63">DXUTSetDeviceCursor</a>( IDirect3DDevice9* pd3dDevice, HCURSOR hCursor, <span class="keywordtype">bool</span> bAddWatermark )
<a name="l05014"></a>05014 {
<a name="l05015"></a>05015     <a class="code" href="_d_x_u_tgui_8cpp.html#a51">HRESULT</a> hr = E_FAIL;
<a name="l05016"></a>05016     ICONINFO iconinfo;
<a name="l05017"></a>05017     <span class="keywordtype">bool</span> bBWCursor;
<a name="l05018"></a>05018     LPDIRECT3DSURFACE9 pCursorSurface = NULL;
<a name="l05019"></a>05019     HDC hdcColor = NULL;
<a name="l05020"></a>05020     HDC hdcMask = NULL;
<a name="l05021"></a>05021     HDC hdcScreen = NULL;
<a name="l05022"></a>05022     BITMAP bm;
<a name="l05023"></a>05023     <a class="code" href="_d_x_u_tgui_8cpp.html#a38">DWORD</a> dwWidth;
<a name="l05024"></a>05024     <a class="code" href="_d_x_u_tgui_8cpp.html#a38">DWORD</a> dwHeightSrc;
<a name="l05025"></a>05025     <a class="code" href="_d_x_u_tgui_8cpp.html#a38">DWORD</a> dwHeightDest;
<a name="l05026"></a>05026     COLORREF crColor;
<a name="l05027"></a>05027     COLORREF crMask;
<a name="l05028"></a>05028     <a class="code" href="_d_x_u_tgui_8cpp.html#a45">UINT</a> x;
<a name="l05029"></a>05029     <a class="code" href="_d_x_u_tgui_8cpp.html#a45">UINT</a> y;
<a name="l05030"></a>05030     BITMAPINFO bmi;
<a name="l05031"></a>05031     COLORREF* pcrArrayColor = NULL;
<a name="l05032"></a>05032     COLORREF* pcrArrayMask = NULL;
<a name="l05033"></a>05033     <a class="code" href="_d_x_u_tgui_8cpp.html#a38">DWORD</a>* pBitmap;
<a name="l05034"></a>05034     HGDIOBJ hgdiobjOld;
<a name="l05035"></a>05035 
<a name="l05036"></a>05036     ZeroMemory( &amp;iconinfo, <span class="keyword">sizeof</span>(iconinfo) );
<a name="l05037"></a>05037     <span class="keywordflow">if</span>( !GetIconInfo( hCursor, &amp;iconinfo ) )
<a name="l05038"></a>05038         <span class="keywordflow">goto</span> End;
<a name="l05039"></a>05039 
<a name="l05040"></a>05040     <span class="keywordflow">if</span> (0 == GetObject((HGDIOBJ)iconinfo.hbmMask, <span class="keyword">sizeof</span>(BITMAP), (<a class="code" href="_d_x_u_tgui_8cpp.html#a40">LPVOID</a>)&amp;bm))
<a name="l05041"></a>05041         <span class="keywordflow">goto</span> End;
<a name="l05042"></a>05042     dwWidth = bm.bmWidth;
<a name="l05043"></a>05043     dwHeightSrc = bm.bmHeight;
<a name="l05044"></a>05044 
<a name="l05045"></a>05045     <span class="keywordflow">if</span>( iconinfo.hbmColor == NULL )
<a name="l05046"></a>05046     {
<a name="l05047"></a>05047         bBWCursor = TRUE;
<a name="l05048"></a>05048         dwHeightDest = dwHeightSrc / 2;
<a name="l05049"></a>05049     }
<a name="l05050"></a>05050     <span class="keywordflow">else</span> 
<a name="l05051"></a>05051     {
<a name="l05052"></a>05052         bBWCursor = FALSE;
<a name="l05053"></a>05053         dwHeightDest = dwHeightSrc;
<a name="l05054"></a>05054     }
<a name="l05055"></a>05055 
<a name="l05056"></a>05056     <span class="comment">// Create a surface for the fullscreen cursor</span>
<a name="l05057"></a>05057     <span class="keywordflow">if</span>( FAILED( hr = pd3dDevice-&gt;CreateOffscreenPlainSurface( dwWidth, dwHeightDest, 
<a name="l05058"></a>05058         D3DFMT_A8R8G8B8, D3DPOOL_SCRATCH, &amp;pCursorSurface, NULL ) ) )
<a name="l05059"></a>05059     {
<a name="l05060"></a>05060         <span class="keywordflow">goto</span> End;
<a name="l05061"></a>05061     }
<a name="l05062"></a>05062 
<a name="l05063"></a>05063     pcrArrayMask = <a class="code" href="dxstdafx_8h.html#a4">DX_NEW</a> <a class="code" href="_d_x_u_tgui_8cpp.html#a38">DWORD</a>[dwWidth * dwHeightSrc];
<a name="l05064"></a>05064 
<a name="l05065"></a>05065     ZeroMemory(&amp;bmi, <span class="keyword">sizeof</span>(bmi));
<a name="l05066"></a>05066     bmi.bmiHeader.biSize = <span class="keyword">sizeof</span>(bmi.bmiHeader);
<a name="l05067"></a>05067     bmi.bmiHeader.biWidth = dwWidth;
<a name="l05068"></a>05068     bmi.bmiHeader.biHeight = dwHeightSrc;
<a name="l05069"></a>05069     bmi.bmiHeader.biPlanes = 1;
<a name="l05070"></a>05070     bmi.bmiHeader.biBitCount = 32;
<a name="l05071"></a>05071     bmi.bmiHeader.biCompression = BI_RGB;
<a name="l05072"></a>05072 
<a name="l05073"></a>05073     hdcScreen = GetDC( NULL );
<a name="l05074"></a>05074     hdcMask = CreateCompatibleDC( hdcScreen );
<a name="l05075"></a>05075     <span class="keywordflow">if</span>( hdcMask == NULL )
<a name="l05076"></a>05076     {
<a name="l05077"></a>05077         hr = E_FAIL;
<a name="l05078"></a>05078         <span class="keywordflow">goto</span> End;
<a name="l05079"></a>05079     }
<a name="l05080"></a>05080     hgdiobjOld = SelectObject(hdcMask, iconinfo.hbmMask);
<a name="l05081"></a>05081     GetDIBits(hdcMask, iconinfo.hbmMask, 0, dwHeightSrc, 
<a name="l05082"></a>05082         pcrArrayMask, &amp;bmi, DIB_RGB_COLORS);
<a name="l05083"></a>05083     SelectObject(hdcMask, hgdiobjOld);
<a name="l05084"></a>05084 
<a name="l05085"></a>05085     <span class="keywordflow">if</span> (!bBWCursor)
<a name="l05086"></a>05086     {
<a name="l05087"></a>05087         pcrArrayColor = <a class="code" href="dxstdafx_8h.html#a4">DX_NEW</a> DWORD[dwWidth * dwHeightDest];
<a name="l05088"></a>05088         hdcColor = CreateCompatibleDC( hdcScreen );
<a name="l05089"></a>05089         <span class="keywordflow">if</span>( hdcColor == NULL )
<a name="l05090"></a>05090         {
<a name="l05091"></a>05091             hr = E_FAIL;
<a name="l05092"></a>05092             <span class="keywordflow">goto</span> End;
<a name="l05093"></a>05093         }
<a name="l05094"></a>05094         SelectObject(hdcColor, iconinfo.hbmColor);
<a name="l05095"></a>05095         GetDIBits(hdcColor, iconinfo.hbmColor, 0, dwHeightDest, 
<a name="l05096"></a>05096             pcrArrayColor, &amp;bmi, DIB_RGB_COLORS);
<a name="l05097"></a>05097     }
<a name="l05098"></a>05098 
<a name="l05099"></a>05099     <span class="comment">// Transfer cursor image into the surface</span>
<a name="l05100"></a>05100     D3DLOCKED_RECT lr;
<a name="l05101"></a>05101     pCursorSurface-&gt;LockRect( &amp;lr, NULL, 0 );
<a name="l05102"></a>05102     pBitmap = (DWORD*)lr.pBits;
<a name="l05103"></a>05103     <span class="keywordflow">for</span>( y = 0; y &lt; dwHeightDest; y++ )
<a name="l05104"></a>05104     {
<a name="l05105"></a>05105         <span class="keywordflow">for</span>( x = 0; x &lt; dwWidth; x++ )
<a name="l05106"></a>05106         {
<a name="l05107"></a>05107             <span class="keywordflow">if</span> (bBWCursor)
<a name="l05108"></a>05108             {
<a name="l05109"></a>05109                 crColor = pcrArrayMask[dwWidth*(dwHeightDest-1-y) + x];
<a name="l05110"></a>05110                 crMask = pcrArrayMask[dwWidth*(dwHeightSrc-1-y) + x];
<a name="l05111"></a>05111             }
<a name="l05112"></a>05112             <span class="keywordflow">else</span>
<a name="l05113"></a>05113             {
<a name="l05114"></a>05114                 crColor = pcrArrayColor[dwWidth*(dwHeightDest-1-y) + x];
<a name="l05115"></a>05115                 crMask = pcrArrayMask[dwWidth*(dwHeightDest-1-y) + x];
<a name="l05116"></a>05116             }
<a name="l05117"></a>05117             <span class="keywordflow">if</span> (crMask == 0)
<a name="l05118"></a>05118                 pBitmap[dwWidth*y + x] = 0xff000000 | crColor;
<a name="l05119"></a>05119             <span class="keywordflow">else</span>
<a name="l05120"></a>05120                 pBitmap[dwWidth*y + x] = 0x00000000;
<a name="l05121"></a>05121 
<a name="l05122"></a>05122             <span class="comment">// It may be helpful to make the D3D cursor look slightly </span>
<a name="l05123"></a>05123             <span class="comment">// different from the Windows cursor so you can distinguish </span>
<a name="l05124"></a>05124             <span class="comment">// between the two when developing/testing code.  When</span>
<a name="l05125"></a>05125             <span class="comment">// bAddWatermark is TRUE, the following code adds some</span>
<a name="l05126"></a>05126             <span class="comment">// small grey "D3D" characters to the upper-left corner of</span>
<a name="l05127"></a>05127             <span class="comment">// the D3D cursor image.</span>
<a name="l05128"></a>05128             <span class="keywordflow">if</span>( bAddWatermark &amp;&amp; x &lt; 12 &amp;&amp; y &lt; 5 )
<a name="l05129"></a>05129             {
<a name="l05130"></a>05130                 <span class="comment">// 11.. 11.. 11.. .... CCC0</span>
<a name="l05131"></a>05131                 <span class="comment">// 1.1. ..1. 1.1. .... A2A0</span>
<a name="l05132"></a>05132                 <span class="comment">// 1.1. .1.. 1.1. .... A4A0</span>
<a name="l05133"></a>05133                 <span class="comment">// 1.1. ..1. 1.1. .... A2A0</span>
<a name="l05134"></a>05134                 <span class="comment">// 11.. 11.. 11.. .... CCC0</span>
<a name="l05135"></a>05135 
<a name="l05136"></a>05136                 <span class="keyword">const</span> WORD wMask[5] = { 0xccc0, 0xa2a0, 0xa4a0, 0xa2a0, 0xccc0 };
<a name="l05137"></a>05137                 <span class="keywordflow">if</span>( wMask[y] &amp; (1 &lt;&lt; (15 - x)) )
<a name="l05138"></a>05138                 {
<a name="l05139"></a>05139                     pBitmap[dwWidth*y + x] |= 0xff808080;
<a name="l05140"></a>05140                 }
<a name="l05141"></a>05141             }
<a name="l05142"></a>05142         }
<a name="l05143"></a>05143     }
<a name="l05144"></a>05144     pCursorSurface-&gt;UnlockRect();
<a name="l05145"></a>05145 
<a name="l05146"></a>05146     <span class="comment">// Set the device cursor</span>
<a name="l05147"></a>05147     <span class="keywordflow">if</span>( FAILED( hr = pd3dDevice-&gt;SetCursorProperties( iconinfo.xHotspot, 
<a name="l05148"></a>05148         iconinfo.yHotspot, pCursorSurface ) ) )
<a name="l05149"></a>05149     {
<a name="l05150"></a>05150         <span class="keywordflow">goto</span> End;
<a name="l05151"></a>05151     }
<a name="l05152"></a>05152 
<a name="l05153"></a>05153     hr = S_OK;
<a name="l05154"></a>05154 
<a name="l05155"></a>05155 End:
<a name="l05156"></a>05156     <span class="keywordflow">if</span>( iconinfo.hbmMask != NULL )
<a name="l05157"></a>05157         DeleteObject( iconinfo.hbmMask );
<a name="l05158"></a>05158     <span class="keywordflow">if</span>( iconinfo.hbmColor != NULL )
<a name="l05159"></a>05159         DeleteObject( iconinfo.hbmColor );
<a name="l05160"></a>05160     <span class="keywordflow">if</span>( hdcScreen != NULL )
<a name="l05161"></a>05161         ReleaseDC( NULL, hdcScreen );
<a name="l05162"></a>05162     <span class="keywordflow">if</span>( hdcColor != NULL )
<a name="l05163"></a>05163         DeleteDC( hdcColor );
<a name="l05164"></a>05164     <span class="keywordflow">if</span>( hdcMask != NULL )
<a name="l05165"></a>05165         DeleteDC( hdcMask );
<a name="l05166"></a>05166     <a class="code" href="dxstdafx_8h.html#a8">SAFE_DELETE_ARRAY</a>( pcrArrayColor );
<a name="l05167"></a>05167     <a class="code" href="dxstdafx_8h.html#a8">SAFE_DELETE_ARRAY</a>( pcrArrayMask );
<a name="l05168"></a>05168     <a class="code" href="dxstdafx_8h.html#a9">SAFE_RELEASE</a>( pCursorSurface );
<a name="l05169"></a>05169     <span class="keywordflow">return</span> hr;
<a name="l05170"></a>05170 }
<a name="l05171"></a>05171 
<a name="l05172"></a>05172 
<a name="l05173"></a>05173 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l05174"></a>05174 <span class="comment">// Get the desktop resolution of an adapter. This isn't the same as the current resolution </span>
<a name="l05175"></a>05175 <span class="comment">// from GetAdapterDisplayMode since the device might be fullscreen </span>
<a name="l05176"></a>05176 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l05177"></a><a class="code" href="_d_x_u_t_8cpp.html#a64">05177</a> <span class="keywordtype">void</span> <a class="code" href="_d_x_u_t_8cpp.html#a64">DXUTGetDesktopResolution</a>( <a class="code" href="_d_x_u_tgui_8cpp.html#a45">UINT</a> AdapterOrdinal, <a class="code" href="_d_x_u_tgui_8cpp.html#a38">DWORD</a>* pdwWidth, <a class="code" href="_d_x_u_tgui_8cpp.html#a38">DWORD</a>* pdwHeight )
<a name="l05178"></a>05178 {
<a name="l05179"></a>05179     <a class="code" href="class_c_d3_d_enumeration.html">CD3DEnumeration</a>* pd3dEnum = <a class="code" href="_d_x_u_t_8cpp.html#a34">DXUTPrepareEnumerationObject</a>();
<a name="l05180"></a>05180     <a class="code" href="class_c_d3_d_enum_adapter_info.html">CD3DEnumAdapterInfo</a>* pAdapterInfo = pd3dEnum-&gt;<a class="code" href="class_c_d3_d_enumeration.html#a14">GetAdapterInfo</a>( AdapterOrdinal );                       
<a name="l05181"></a>05181     DEVMODE devMode;
<a name="l05182"></a>05182     ZeroMemory( &amp;devMode, <span class="keyword">sizeof</span>(DEVMODE) );
<a name="l05183"></a>05183     devMode.dmSize = <span class="keyword">sizeof</span>(DEVMODE);
<a name="l05184"></a>05184     WCHAR strDeviceName[256];
<a name="l05185"></a>05185     MultiByteToWideChar( CP_ACP, 0, pAdapterInfo-&gt;<a class="code" href="class_c_d3_d_enum_adapter_info.html#o1">AdapterIdentifier</a>.DeviceName, -1, strDeviceName, 256 );
<a name="l05186"></a>05186     strDeviceName[255] = 0;
<a name="l05187"></a>05187     EnumDisplaySettings( strDeviceName, ENUM_REGISTRY_SETTINGS, &amp;devMode );
<a name="l05188"></a>05188     *pdwWidth = devMode.dmPelsWidth;
<a name="l05189"></a>05189     *pdwHeight = devMode.dmPelsHeight;
<a name="l05190"></a>05190 }
<a name="l05191"></a>05191 
<a name="l05192"></a>05192 
<a name="l05193"></a>05193 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l05194"></a>05194 <span class="comment">// Multimon API handling for OSes with or without multimon API support</span>
<a name="l05195"></a>05195 <span class="comment">//--------------------------------------------------------------------------------------</span>
<a name="l05196"></a><a class="code" href="_d_x_u_t_8cpp.html#a30">05196</a> <a class="code" href="_d_x_u_tgui_8cpp.html#a39">BOOL</a> WINAPI <a class="code" href="_d_x_u_t_8cpp.html#a30">DXUT_GetMonitorInfo</a>(HMONITOR hMonitor, LPMONITORINFO lpMonitorInfo)
<a name="l05197"></a>05197 {
<a name="l05198"></a>05198     <span class="keywordflow">if</span>( <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetFnGetMonitorInfo() ) 
<a name="l05199"></a>05199         <span class="keywordflow">return</span> <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetFnGetMonitorInfo()(hMonitor, lpMonitorInfo);
<a name="l05200"></a>05200 
<a name="l05201"></a>05201     RECT rcWork;
<a name="l05202"></a>05202     <span class="keywordflow">if</span> ((hMonitor == <a class="code" href="_d_x_u_t_8cpp.html#a11">DXUT_PRIMARY_MONITOR</a>) &amp;&amp; lpMonitorInfo &amp;&amp; (lpMonitorInfo-&gt;<a class="code" href="structtag_m_o_n_i_t_o_r_i_n_f_o.html#o0">cbSize</a> &gt;= <span class="keyword">sizeof</span>(<a class="code" href="structtag_m_o_n_i_t_o_r_i_n_f_o.html">MONITORINFO</a>)) &amp;&amp; SystemParametersInfoA(SPI_GETWORKAREA, 0, &amp;rcWork, 0))
<a name="l05203"></a>05203     {
<a name="l05204"></a>05204         lpMonitorInfo-&gt;<a class="code" href="structtag_m_o_n_i_t_o_r_i_n_f_o.html#o1">rcMonitor</a>.left = 0;
<a name="l05205"></a>05205         lpMonitorInfo-&gt;<a class="code" href="structtag_m_o_n_i_t_o_r_i_n_f_o.html#o1">rcMonitor</a>.top  = 0;
<a name="l05206"></a>05206         lpMonitorInfo-&gt;<a class="code" href="structtag_m_o_n_i_t_o_r_i_n_f_o.html#o1">rcMonitor</a>.right  = GetSystemMetrics(SM_CXSCREEN);
<a name="l05207"></a>05207         lpMonitorInfo-&gt;<a class="code" href="structtag_m_o_n_i_t_o_r_i_n_f_o.html#o1">rcMonitor</a>.bottom = GetSystemMetrics(SM_CYSCREEN);
<a name="l05208"></a>05208         lpMonitorInfo-&gt;<a class="code" href="structtag_m_o_n_i_t_o_r_i_n_f_o.html#o2">rcWork</a> = rcWork;
<a name="l05209"></a>05209         lpMonitorInfo-&gt;<a class="code" href="structtag_m_o_n_i_t_o_r_i_n_f_o.html#o3">dwFlags</a> = <a class="code" href="_d_x_u_t_8cpp.html#a8">MONITORINFOF_PRIMARY</a>;
<a name="l05210"></a>05210         <span class="keywordflow">return</span> TRUE;
<a name="l05211"></a>05211     }
<a name="l05212"></a>05212     <span class="keywordflow">return</span> FALSE;
<a name="l05213"></a>05213 }
<a name="l05214"></a>05214 
<a name="l05215"></a><a class="code" href="_d_x_u_t_8cpp.html#a29">05215</a> <span class="keywordtype">int</span> WINAPI <a class="code" href="_d_x_u_t_8cpp.html#a29">DXUT_GetSystemMetrics</a>(<span class="keywordtype">int</span> nIndex)
<a name="l05216"></a>05216 {
<a name="l05217"></a>05217     <span class="keywordflow">if</span>( <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetFnGetSystemMetrics() ) 
<a name="l05218"></a>05218         <span class="keywordflow">return</span> <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetFnGetSystemMetrics()(nIndex); 
<a name="l05219"></a>05219     <span class="keywordflow">return</span> GetSystemMetrics(nIndex);
<a name="l05220"></a>05220 }
<a name="l05221"></a>05221 
<a name="l05222"></a><a class="code" href="_d_x_u_t_8cpp.html#a28">05222</a> HMONITOR WINAPI <a class="code" href="_d_x_u_t_8cpp.html#a28">DXUT_MonitorFromWindow</a>(<a class="code" href="_d_x_u_tgui_8cpp.html#a53">HWND</a> hWnd, <a class="code" href="_d_x_u_tgui_8cpp.html#a38">DWORD</a> dwFlags)
<a name="l05223"></a>05223 {
<a name="l05224"></a>05224     <span class="keywordflow">if</span>( <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetFnMonitorFromWindow() ) 
<a name="l05225"></a>05225         <span class="keywordflow">return</span> <a class="code" href="_d_x_u_t_8cpp.html#a31">GetDXUTState</a>().GetFnMonitorFromWindow()(hWnd, dwFlags);
<a name="l05226"></a>05226     <span class="keywordflow">if</span> (dwFlags &amp; (<a class="code" href="_d_x_u_t_8cpp.html#a9">MONITOR_DEFAULTTOPRIMARY</a> | <a class="code" href="_d_x_u_t_8cpp.html#a10">MONITOR_DEFAULTTONEAREST</a>))
<a name="l05227"></a>05227         <span class="keywordflow">return</span> <a class="code" href="_d_x_u_t_8cpp.html#a11">DXUT_PRIMARY_MONITOR</a>;
<a name="l05228"></a>05228     <span class="keywordflow">return</span> NULL;
<a name="l05229"></a>05229 }
<a name="l05230"></a>05230 
</pre></div><hr size="1"><address style="align: right;"><small>Generated on Tue Aug 22 14:08:16 2006 for GameCode by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.3 </small></address>
</body>
</html>
